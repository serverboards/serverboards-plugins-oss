{"version":3,"file":null,"sources":["../src/actiondescription.js","../src/cronline.js","../src/screen.js"],"sourcesContent":["const React = Serverboards.React\n\nconst ActionDescription = React.createClass({\n  render(){\n    const {action, action_catalog} = this.props\n    const action_template = action_catalog.find( (a) => a.id == action.action ) || { name: action.action, params: [] }\n    const params = action.params || {}\n    const params_template = (action_template.extra.call.params || []).filter( (p) => p.card )\n    console.log(params, params_template)\n    return (\n      <div>\n        <label className=\"ui header tiny\">{action_template.name}</label>\n        {params_template.map( (p) => (\n          <div key={p.name}>{p.label}: <span className=\"meta\">{params[p.name]}</span></div>\n        ))}\n      </div>\n    )\n  }\n})\n\nexport default ActionDescription\n","const React = Serverboards.React\nconst {goto} = Serverboards.location\nimport ActionDescription from './actiondescription'\n\nconst CronLine = React.createClass({\n  render(){\n    const props=this.props\n\n    return (\n      <div className=\"ui card\">\n        <div className=\"content\">\n          <div className=\"header\">\n          {props.name && (props.name != props.spec) ? (\n            <span>{props.name} / </span>\n          ) : null}\n          {props.spec}\n          </div>\n          <ActionDescription action={props.action} action_catalog={props.action_catalog}/>\n          <a onClick={() => goto(`/serverboard/${props.serverboard}/rules/${props.id}`)}>Edit</a>\n        </div>\n      </div>\n    )\n  }\n})\n\nexport default CronLine\n","const React = Serverboards.React\nconst plugin_id = \"serverboards.cron\"\nconst rpc = Serverboards.rpc\nconst {is_empty} = Serverboards.utils\nconst {goto} = Serverboards.location\n\nimport CronLine from './cronline'\n\nconst Manager = React.createClass({\n  getInitialState(){\n    return {\n      cronlines: undefined,\n      action_catalog: undefined\n    }\n  },\n  componentDidMount(){\n    rpc.call('rules.list', {serverboard:this.props.serverboard.shortname}).then( (rules) =>\n      rules\n        .filter( (r) => r.trigger.trigger == plugin_id+'/trigger' )\n        .map( (r) => ({\n          id: r.uuid,\n          spec: r.trigger.params.timespec,\n          name: r.name,\n          action: r.actions.tick,\n          is_active: r.is_active\n        }) )\n    ).then( (cronlines) =>\n      this.setState({cronlines})\n    ).catch( (e) => {\n      console.error(e)\n      Serverboards.Flash.error(JSON.stringify(e))\n    })\n    const action_catalog = Serverboards.store.getState().action.catalog\n    if (!is_empty(action_catalog))\n      this.setState({action_catalog})\n    else{\n      rpc.call(\"action.filter\",{}).then( (actions) => {\n        this.setState({action_catalog: actions})\n      })\n    }\n  },\n  handleAddRule(){\n    goto(`/serverboard/${this.props.serverboard.shortname}/rules/add`, {trigger: `${plugin_id}/trigger`})\n  },\n  render(){\n    const {cronlines, action_catalog} = this.state\n\n    if (!cronlines || !action_catalog){\n      return (\n        <Serverboards.Components.Loading>Cron info</Serverboards.Components.Loading>\n      )\n    }\n    return (\n      <div className=\"ui container\">\n        <h1 className=\"ui header\">Cron manager</h1>\n        <div className=\"ui cards\">\n          {cronlines.sort( (a,b) => (a.spec.localeCompare(b.spec)) ).map( (cl) => (\n            <CronLine key={cl.id} serverboard={this.props.serverboard.shortname} action_catalog={action_catalog}{...cl}/>\n          ))}\n        </div>\n        <a className=\"ui massive button _add icon floating pink\" onClick={this.handleAddRule}>\n          <i className=\"add icon\"></i>\n        </a>\n      </div>\n    )\n  }\n})\n\nfunction main(el, config){\n  Serverboards.ReactDOM.render(React.createElement(Manager, {serverboard: config.serverboard}), el)\n\n  return function(){\n    Serverboards.ReactDOM.unmountComponentAtNode(el)\n  }\n}\n\nServerboards.add_screen(plugin_id+\"/screen\", main)\n"],"names":["Serverboards","React","ActionDescription","createClass","render","props","action","action_catalog","action_template","find","a","id","name","params","params_template","extra","call","filter","p","card","log","map","label","goto","location","spec","serverboard","plugin_id","rpc","is_empty","utils","getInitialState","cronlines","componentDidMount","shortname","then","rules","r","trigger","uuid","timespec","actions","tick","is_active","setState","catch","e","console","error","Flash","JSON","stringify","store","getState","catalog","handleAddRule","state","sort","b","localeCompare","cl","el","config","ReactDOM","createElement","Manager","unmountComponentAtNode","add_screen","main"],"mappings":"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"}