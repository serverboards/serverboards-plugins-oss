{"version":3,"file":null,"sources":["../src/actiondescription.js","../src/cronline.js","../src/screen.js"],"sourcesContent":["const React = Serverboards.React\n\nconst ActionDescription = React.createClass({\n  render(){\n    const {action, action_catalog} = this.props\n    const action_template = action_catalog.find( (a) => a.id == action.action ) || { name: action.action, params: [] }\n    const params = action.params || {}\n    const params_template = (action_template.extra.call.params || []).filter( (p) => p.card )\n    console.log(params, params_template)\n    return (\n      <div>\n        <label className=\"ui header tiny\">{action_template.name}</label>\n        {params_template.map( (p) => (\n          <div key={p.name}>{p.label}: <span className=\"meta\">{params[p.name]}</span></div>\n        ))}\n      </div>\n    )\n  }\n})\n\nexport default ActionDescription\n","const React = Serverboards.React\nconst {goto} = Serverboards.location\nimport ActionDescription from './actiondescription'\n\nconst CronLine = React.createClass({\n  render(){\n    const props=this.props\n\n    return (\n      <div className=\"ui card\">\n        <div className=\"content\">\n          <div className=\"header\">\n          {props.name && (props.name != props.spec) ? (\n            <span>{props.name} / </span>\n          ) : null}\n          {props.spec}\n          </div>\n          <ActionDescription action={props.action} action_catalog={props.action_catalog}/>\n          <a onClick={() => goto(`/serverboard/SBDS/rules/${props.id}`)}>Edit</a>\n        </div>\n      </div>\n    )\n  }\n})\n\nexport default CronLine\n","const React = Serverboards.React\nconst plugin_id = \"serverboards.cron\"\nconst rpc = Serverboards.rpc\nconst {is_empty} = Serverboards.utils\n\nimport CronLine from './cronline'\n\nconst Manager = React.createClass({\n  getInitialState(){\n    return {\n      cronlines: undefined,\n      action_catalog: undefined\n    }\n  },\n  componentDidMount(){\n    rpc.call('rules.list', {serverboard:this.props.serverboard.shortname}).then( (rules) =>\n      rules\n        .filter( (r) => r.trigger.trigger == plugin_id+'/trigger' )\n        .map( (r) => ({\n          id: r.uuid,\n          spec: r.trigger.params.timespec,\n          name: r.name,\n          action: r.actions.tick,\n          is_active: r.is_active\n        }) )\n    ).then( (cronlines) =>\n      this.setState({cronlines})\n    ).catch( (e) => {\n      console.error(e)\n      Serverboards.Flash.error(JSON.stringify(e))\n    })\n    const action_catalog = Serverboards.store.getState().action.catalog\n    if (!is_empty(action_catalog))\n      this.setState({action_catalog})\n    else{\n      rpc.call(\"action.filter\",{}).then( (actions) => {\n        this.setState({action_catalog: actions})\n      })\n    }\n  },\n  render(){\n    const {cronlines, action_catalog} = this.state\n\n    if (!cronlines || !action_catalog){\n      return (\n        <Serverboards.Components.Loading>Cron info</Serverboards.Components.Loading>\n      )\n    }\n    return (\n      <div className=\"ui container\">\n        <h1 className=\"ui header\">Cron manager</h1>\n        <ul>\n          {cronlines.sort( (a,b) => (a.spec.localeCompare(b.spec)) ).map( (cl) => (\n            <CronLine key={cl.id} action_catalog={action_catalog}{...cl}/>\n          ))}\n        </ul>\n      </div>\n    )\n  }\n})\n\nfunction main(el, config){\n  Serverboards.ReactDOM.render(React.createElement(Manager, {serverboard: config.serverboard}), el)\n\n  return function(){\n    Serverboards.ReactDOM.unmountComponentAtNode(el)\n  }\n}\n\nServerboards.add_screen(plugin_id+\"/screen\", main)\n"],"names":["Serverboards","React","ActionDescription","createClass","render","props","action","action_catalog","action_template","find","a","id","name","params","params_template","extra","call","filter","p","card","log","map","label","goto","location","spec","plugin_id","rpc","is_empty","utils","getInitialState","cronlines","componentDidMount","serverboard","shortname","then","rules","r","trigger","uuid","timespec","actions","tick","is_active","setState","catch","e","console","error","Flash","JSON","stringify","store","getState","catalog","state","sort","b","localeCompare","cl","el","config","ReactDOM","createElement","Manager","unmountComponentAtNode","add_screen","main"],"mappings":"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"}