window.Modernizr=function(a,b,c){function z(a){j.cssText=a}function A(a,b){return z(m.join(a+";")+(b||""))}function B(a,b){return typeof a===b}function C(a,b){return!!~(""+a).indexOf(b)}function D(a,b,d){for(var e in a){var f=b[a[e]];if(f!==c)return d===!1?a[e]:B(f,"function")?f.bind(d||b):f}return!1}var d="2.6.0",e={},f=!0,g=b.documentElement,h="modernizr",i=b.createElement(h),j=i.style,k,l={}.toString,m=" -webkit- -moz- -o- -ms- ".split(" "),n="Webkit Moz O ms",o=n.split(" "),p=n.toLowerCase().split(" "),q={},r={},s={},t=[],u=t.slice,v,w=function(a,c,d,e){var f,i,j,k=b.createElement("div"),l=b.body,m=l?l:b.createElement("body");if(parseInt(d,10))while(d--)j=b.createElement("div"),j.id=e?e[d]:h+(d+1),k.appendChild(j);return f=["&#173;",'<style id="s',h,'">',a,"</style>"].join(""),k.id=h,(l?k:m).innerHTML+=f,m.appendChild(k),l||(m.style.background="",g.appendChild(m)),i=c(k,a),l?k.parentNode.removeChild(k):m.parentNode.removeChild(m),!!i},x={}.hasOwnProperty,y;!B(x,"undefined")&&!B(x.call,"undefined")?y=function(a,b){return x.call(a,b)}:y=function(a,b){return b in a&&B(a.constructor.prototype[b],"undefined")},Function.prototype.bind||(Function.prototype.bind=function(b){var c=this;if(typeof c!="function")throw new TypeError;var d=u.call(arguments,1),e=function(){if(this instanceof e){var a=function(){};a.prototype=c.prototype;var f=new a,g=c.apply(f,d.concat(u.call(arguments)));return Object(g)===g?g:f}return c.apply(b,d.concat(u.call(arguments)))};return e}),q.canvas=function(){var a=b.createElement("canvas");return!!a.getContext&&!!a.getContext("2d")},q.webgl=function(){return!!a.WebGLRenderingContext},q.touch=function(){var c;return"ontouchstart"in a||a.DocumentTouch&&b instanceof DocumentTouch?c=!0:w(["@media (",m.join("touch-enabled),("),h,")","{#modernizr{top:9px;position:absolute}}"].join(""),function(a){c=a.offsetTop===9}),c},q.websockets=function(){return"WebSocket"in a||"MozWebSocket"in a};for(var E in q)y(q,E)&&(v=E.toLowerCase(),e[v]=q[E](),t.push((e[v]?"":"no-")+v));return e.addTest=function(a,b){if(typeof a=="object")for(var d in a)y(a,d)&&e.addTest(d,a[d]);else{a=a.toLowerCase();if(e[a]!==c)return e;b=typeof b=="function"?b():b,f&&(g.className+=" "+(b?"":"no-")+a),e[a]=b}return e},z(""),i=k=null,function(a,b){function k(a,b){var c=a.createElement("p"),d=a.getElementsByTagName("head")[0]||a.documentElement;return c.innerHTML="x<style>"+b+"</style>",d.insertBefore(c.lastChild,d.firstChild)}function l(){var a=r.elements;return typeof a=="string"?a.split(" "):a}function m(a){var b=i[a[g]];return b||(b={},h++,a[g]=h,i[h]=b),b}function n(a,c,f){c||(c=b);if(j)return c.createElement(a);f||(f=m(c));var g;return f.cache[a]?g=f.cache[a].cloneNode():e.test(a)?g=(f.cache[a]=f.createElem(a)).cloneNode():g=f.createElem(a),g.canHaveChildren&&!d.test(a)?f.frag.appendChild(g):g}function o(a,c){a||(a=b);if(j)return a.createDocumentFragment();c=c||m(a);var d=c.frag.cloneNode(),e=0,f=l(),g=f.length;for(;e<g;e++)d.createElement(f[e]);return d}function p(a,b){b.cache||(b.cache={},b.createElem=a.createElement,b.createFrag=a.createDocumentFragment,b.frag=b.createFrag()),a.createElement=function(c){return r.shivMethods?n(c,a,b):b.createElem(c)},a.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+l().join().replace(/\w+/g,function(a){return b.createElem(a),b.frag.createElement(a),'c("'+a+'")'})+");return n}")(r,b.frag)}function q(a){a||(a=b);var c=m(a);return r.shivCSS&&!f&&!c.hasCSS&&(c.hasCSS=!!k(a,"article,aside,figcaption,figure,footer,header,hgroup,nav,section{display:block}mark{background:#FF0;color:#000}")),j||p(a,c),a}var c=a.html5||{},d=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,e=/^<|^(?:a|b|button|code|div|fieldset|form|h1|h2|h3|h4|h5|h6|i|iframe|img|input|label|li|link|ol|option|p|param|q|script|select|span|strong|style|table|tbody|td|textarea|tfoot|th|thead|tr|ul)$/i,f,g="_html5shiv",h=0,i={},j;(function(){try{var a=b.createElement("a");a.innerHTML="<xyz></xyz>",f="hidden"in a,j=a.childNodes.length==1||function(){b.createElement("a");var a=b.createDocumentFragment();return typeof a.cloneNode=="undefined"||typeof a.createDocumentFragment=="undefined"||typeof a.createElement=="undefined"}()}catch(c){f=!0,j=!0}})();var r={elements:c.elements||"abbr article aside audio bdi canvas data datalist details figcaption figure footer header hgroup mark meter nav output progress section summary time video",shivCSS:c.shivCSS!==!1,supportsUnknownElements:j,shivMethods:c.shivMethods!==!1,type:"default",shivDocument:q,createElement:n,createDocumentFragment:o};a.html5=r,q(b)}(this,b),e._version=d,e._prefixes=m,e._domPrefixes=p,e._cssomPrefixes=o,e.testStyles=w,g.className=g.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(f?" js "+t.join(" "):""),e}(this,this.document),function(a,b,c){function d(a){return o.call(a)=="[object Function]"}function e(a){return typeof a=="string"}function f(){}function g(a){return!a||a=="loaded"||a=="complete"||a=="uninitialized"}function h(){var a=p.shift();q=1,a?a.t?m(function(){(a.t=="c"?B.injectCss:B.injectJs)(a.s,0,a.a,a.x,a.e,1)},0):(a(),h()):q=0}function i(a,c,d,e,f,i,j){function k(b){if(!o&&g(l.readyState)&&(u.r=o=1,!q&&h(),l.onload=l.onreadystatechange=null,b)){a!="img"&&m(function(){t.removeChild(l)},50);for(var d in y[c])y[c].hasOwnProperty(d)&&y[c][d].onload()}}var j=j||B.errorTimeout,l={},o=0,r=0,u={t:d,s:c,e:f,a:i,x:j};y[c]===1&&(r=1,y[c]=[],l=b.createElement(a)),a=="object"?l.data=c:(l.src=c,l.type=a),l.width=l.height="0",l.onerror=l.onload=l.onreadystatechange=function(){k.call(this,r)},p.splice(e,0,u),a!="img"&&(r||y[c]===2?(t.insertBefore(l,s?null:n),m(k,j)):y[c].push(l))}function j(a,b,c,d,f){return q=0,b=b||"j",e(a)?i(b=="c"?v:u,a,b,this.i++,c,d,f):(p.splice(this.i++,0,a),p.length==1&&h()),this}function k(){var a=B;return a.loader={load:j,i:0},a}var l=b.documentElement,m=a.setTimeout,n=b.getElementsByTagName("script")[0],o={}.toString,p=[],q=0,r="MozAppearance"in l.style,s=r&&!!b.createRange().compareNode,t=s?l:n.parentNode,l=a.opera&&o.call(a.opera)=="[object Opera]",l=!!b.attachEvent&&!l,u=r?"object":l?"script":"img",v=l?"script":u,w=Array.isArray||function(a){return o.call(a)=="[object Array]"},x=[],y={},z={timeout:function(a,b){return b.length&&(a.timeout=b[0]),a}},A,B;B=function(a){function b(a){var a=a.split("!"),b=x.length,c=a.pop(),d=a.length,c={url:c,origUrl:c,prefixes:a},e,f,g;for(f=0;f<d;f++)g=a[f].split("="),(e=z[g.shift()])&&(c=e(c,g));for(f=0;f<b;f++)c=x[f](c);return c}function g(a,e,f,g,i){var j=b(a),l=j.autoCallback;j.url.split(".").pop().split("?").shift(),j.bypass||(e&&(e=d(e)?e:e[a]||e[g]||e[a.split("/").pop().split("?")[0]]||h),j.instead?j.instead(a,e,f,g,i):(y[j.url]?j.noexec=!0:y[j.url]=1,f.load(j.url,j.forceCSS||!j.forceJS&&"css"==j.url.split(".").pop().split("?").shift()?"c":c,j.noexec,j.attrs,j.timeout),(d(e)||d(l))&&f.load(function(){k(),e&&e(j.origUrl,i,g),l&&l(j.origUrl,i,g),y[j.url]=2})))}function i(a,b){function c(a,c){if(a){if(e(a))c||(j=function(){var a=[].slice.call(arguments);k.apply(this,a),l()}),g(a,j,b,0,h);else if(Object(a)===a)for(n in m=function(){var b=0,c;for(c in a)a.hasOwnProperty(c)&&b++;return b}(),a)a.hasOwnProperty(n)&&(!c&&!--m&&(d(j)?j=function(){var a=[].slice.call(arguments);k.apply(this,a),l()}:j[n]=function(a){return function(){var b=[].slice.call(arguments);a&&a.apply(this,b),l()}}(k[n])),g(a[n],j,b,n,h))}else!c&&l()}var h=!!a.test,i=a.load||a.both,j=a.callback||f,k=j,l=a.complete||f,m,n;c(h?a.yep:a.nope,!!i),i&&c(i)}var j,l,m=this.yepnope.loader;if(e(a))g(a,0,m,0);else if(w(a))for(j=0;j<a.length;j++)l=a[j],e(l)?g(l,0,m,0):w(l)?B(l):Object(l)===l&&i(l,m);else Object(a)===a&&i(a,m)},B.addPrefix=function(a,b){z[a]=b},B.addFilter=function(a){x.push(a)},B.errorTimeout=1e4,b.readyState==null&&b.addEventListener&&(b.readyState="loading",b.addEventListener("DOMContentLoaded",A=function(){b.removeEventListener("DOMContentLoaded",A,0),b.readyState="complete"},0)),a.yepnope=k(),a.yepnope.executeStack=h,a.yepnope.injectJs=function(a,c,d,e,i,j){var k=b.createElement("script"),l,o,e=e||B.errorTimeout;k.src=a;for(o in d)k.setAttribute(o,d[o]);c=j?h:c||f,k.onreadystatechange=k.onload=function(){!l&&g(k.readyState)&&(l=1,c(),k.onload=k.onreadystatechange=null)},m(function(){l||(l=1,c(1))},e),i?k.onload():n.parentNode.insertBefore(k,n)},a.yepnope.injectCss=function(a,c,d,e,g,i){var e=b.createElement("link"),j,c=i?h:c||f;e.href=a,e.rel="stylesheet",e.type="text/css";for(j in d)e.setAttribute(j,d[j]);g||(n.parentNode.insertBefore(e,n),m(c,0))}}(this,document),Modernizr.load=function(){yepnope.apply(window,[].slice.call(arguments,0))};Modernizr.addTest("websocketsbinary",function(){var protocol="https:"==location.protocol?"wss":"ws",protoBin;if("WebSocket"in window){if(protoBin="binaryType"in WebSocket.prototype)return protoBin;try{return!!new WebSocket(protocol+"://.").binaryType}catch(e){}}return false});(function(window,undefined){var rootjQuery,readyList,core_strundefined=typeof undefined,location=window.location,document=window.document,docElem=document.documentElement,_jQuery=window.jQuery,_$=window.$,class2type={},core_deletedIds=[],core_version="2.0.3",core_concat=core_deletedIds.concat,core_push=core_deletedIds.push,core_slice=core_deletedIds.slice,core_indexOf=core_deletedIds.indexOf,core_toString=class2type.toString,core_hasOwn=class2type.hasOwnProperty,core_trim=core_version.trim,jQuery=function(selector,context){return new jQuery.fn.init(selector,context,rootjQuery)},core_pnum=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,core_rnotwhite=/\S+/g,rquickExpr=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,rsingleTag=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,rmsPrefix=/^-ms-/,rdashAlpha=/-([\da-z])/gi,fcamelCase=function(all,letter){return letter.toUpperCase()},completed=function(){document.removeEventListener("DOMContentLoaded",completed,false);window.removeEventListener("load",completed,false);jQuery.ready()};jQuery.fn=jQuery.prototype={jquery:core_version,constructor:jQuery,init:function(selector,context,rootjQuery){var match,elem;if(!selector){return this}if(typeof selector==="string"){if(selector.charAt(0)==="<"&&selector.charAt(selector.length-1)===">"&&selector.length>=3){match=[null,selector,null]}else{match=rquickExpr.exec(selector)}if(match&&(match[1]||!context)){if(match[1]){context=context instanceof jQuery?context[0]:context;jQuery.merge(this,jQuery.parseHTML(match[1],context&&context.nodeType?context.ownerDocument||context:document,true));if(rsingleTag.test(match[1])&&jQuery.isPlainObject(context)){for(match in context){if(jQuery.isFunction(this[match])){this[match](context[match])}else{this.attr(match,context[match])}}}return this}else{elem=document.getElementById(match[2]);if(elem&&elem.parentNode){this.length=1;this[0]=elem}this.context=document;this.selector=selector;return this}}else if(!context||context.jquery){return(context||rootjQuery).find(selector)}else{return this.constructor(context).find(selector)}}else if(selector.nodeType){this.context=this[0]=selector;this.length=1;return this}else if(jQuery.isFunction(selector)){return rootjQuery.ready(selector)}if(selector.selector!==undefined){this.selector=selector.selector;this.context=selector.context}return jQuery.makeArray(selector,this)},selector:"",length:0,toArray:function(){return core_slice.call(this)},get:function(num){return num==null?this.toArray():num<0?this[this.length+num]:this[num]},pushStack:function(elems){var ret=jQuery.merge(this.constructor(),elems);ret.prevObject=this;ret.context=this.context;return ret},each:function(callback,args){return jQuery.each(this,callback,args)},ready:function(fn){jQuery.ready.promise().done(fn);return this},slice:function(){return this.pushStack(core_slice.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(i){var len=this.length,j=+i+(i<0?len:0);return this.pushStack(j>=0&&j<len?[this[j]]:[])},map:function(callback){return this.pushStack(jQuery.map(this,function(elem,i){return callback.call(elem,i,elem)}))},end:function(){return this.prevObject||this.constructor(null)},push:core_push,sort:[].sort,splice:[].splice};jQuery.fn.init.prototype=jQuery.fn;jQuery.extend=jQuery.fn.extend=function(){var options,name,src,copy,copyIsArray,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=false;if(typeof target==="boolean"){deep=target;target=arguments[1]||{};i=2}if(typeof target!=="object"&&!jQuery.isFunction(target)){target={}}if(length===i){target=this;--i}for(;i<length;i++){if((options=arguments[i])!=null){for(name in options){src=target[name];copy=options[name];if(target===copy){continue}if(deep&&copy&&(jQuery.isPlainObject(copy)||(copyIsArray=jQuery.isArray(copy)))){if(copyIsArray){copyIsArray=false;clone=src&&jQuery.isArray(src)?src:[]}else{clone=src&&jQuery.isPlainObject(src)?src:{}}target[name]=jQuery.extend(deep,clone,copy)}else if(copy!==undefined){target[name]=copy}}}}return target};jQuery.extend({expando:"jQuery"+(core_version+Math.random()).replace(/\D/g,""),noConflict:function(deep){if(window.$===jQuery){window.$=_$}if(deep&&window.jQuery===jQuery){window.jQuery=_jQuery}return jQuery},isReady:false,readyWait:1,holdReady:function(hold){if(hold){jQuery.readyWait++}else{jQuery.ready(true)}},ready:function(wait){if(wait===true?--jQuery.readyWait:jQuery.isReady){return}jQuery.isReady=true;if(wait!==true&&--jQuery.readyWait>0){return}readyList.resolveWith(document,[jQuery]);if(jQuery.fn.trigger){jQuery(document).trigger("ready").off("ready")}},isFunction:function(obj){return jQuery.type(obj)==="function"},isArray:Array.isArray,isWindow:function(obj){return obj!=null&&obj===obj.window},isNumeric:function(obj){return!isNaN(parseFloat(obj))&&isFinite(obj)},type:function(obj){if(obj==null){return String(obj)}return typeof obj==="object"||typeof obj==="function"?class2type[core_toString.call(obj)]||"object":typeof obj},isPlainObject:function(obj){if(jQuery.type(obj)!=="object"||obj.nodeType||jQuery.isWindow(obj)){return false}try{if(obj.constructor&&!core_hasOwn.call(obj.constructor.prototype,"isPrototypeOf")){return false}}catch(e){return false}return true},isEmptyObject:function(obj){var name;for(name in obj){return false}return true},error:function(msg){throw new Error(msg)},parseHTML:function(data,context,keepScripts){if(!data||typeof data!=="string"){return null}if(typeof context==="boolean"){keepScripts=context;context=false}context=context||document;var parsed=rsingleTag.exec(data),scripts=!keepScripts&&[];if(parsed){return[context.createElement(parsed[1])]}parsed=jQuery.buildFragment([data],context,scripts);if(scripts){jQuery(scripts).remove()}return jQuery.merge([],parsed.childNodes)},parseJSON:JSON.parse,parseXML:function(data){var xml,tmp;if(!data||typeof data!=="string"){return null}try{tmp=new DOMParser;xml=tmp.parseFromString(data,"text/xml")}catch(e){xml=undefined}if(!xml||xml.getElementsByTagName("parsererror").length){jQuery.error("Invalid XML: "+data)}return xml},noop:function(){},globalEval:function(code){var script,indirect=eval;code=jQuery.trim(code);if(code){if(code.indexOf("use strict")===1){script=document.createElement("script");script.text=code;document.head.appendChild(script).parentNode.removeChild(script)}else{indirect(code)}}},camelCase:function(string){return string.replace(rmsPrefix,"ms-").replace(rdashAlpha,fcamelCase)},nodeName:function(elem,name){return elem.nodeName&&elem.nodeName.toLowerCase()===name.toLowerCase()},each:function(obj,callback,args){var value,i=0,length=obj.length,isArray=isArraylike(obj);if(args){if(isArray){for(;i<length;i++){value=callback.apply(obj[i],args);if(value===false){break}}}else{for(i in obj){value=callback.apply(obj[i],args);if(value===false){break}}}}else{if(isArray){for(;i<length;i++){value=callback.call(obj[i],i,obj[i]);if(value===false){break}}}else{for(i in obj){value=callback.call(obj[i],i,obj[i]);if(value===false){break}}}}return obj},trim:function(text){return text==null?"":core_trim.call(text)},makeArray:function(arr,results){var ret=results||[];if(arr!=null){if(isArraylike(Object(arr))){jQuery.merge(ret,typeof arr==="string"?[arr]:arr)}else{core_push.call(ret,arr)}}return ret},inArray:function(elem,arr,i){return arr==null?-1:core_indexOf.call(arr,elem,i)},merge:function(first,second){var l=second.length,i=first.length,j=0;if(typeof l==="number"){for(;j<l;j++){first[i++]=second[j]}}else{while(second[j]!==undefined){first[i++]=second[j++]}}first.length=i;return first},grep:function(elems,callback,inv){var retVal,ret=[],i=0,length=elems.length;inv=!!inv;for(;i<length;i++){retVal=!!callback(elems[i],i);if(inv!==retVal){ret.push(elems[i])}}return ret},map:function(elems,callback,arg){var value,i=0,length=elems.length,isArray=isArraylike(elems),ret=[];if(isArray){for(;i<length;i++){value=callback(elems[i],i,arg);if(value!=null){ret[ret.length]=value}}}else{for(i in elems){value=callback(elems[i],i,arg);if(value!=null){ret[ret.length]=value}}}return core_concat.apply([],ret)},guid:1,proxy:function(fn,context){var tmp,args,proxy;if(typeof context==="string"){tmp=fn[context];context=fn;fn=tmp}if(!jQuery.isFunction(fn)){return undefined}args=core_slice.call(arguments,2);proxy=function(){return fn.apply(context||this,args.concat(core_slice.call(arguments)))};proxy.guid=fn.guid=fn.guid||jQuery.guid++;return proxy},access:function(elems,fn,key,value,chainable,emptyGet,raw){var i=0,length=elems.length,bulk=key==null;if(jQuery.type(key)==="object"){chainable=true;for(i in key){jQuery.access(elems,fn,i,key[i],true,emptyGet,raw)}}else if(value!==undefined){chainable=true;if(!jQuery.isFunction(value)){raw=true}if(bulk){if(raw){fn.call(elems,value);fn=null}else{bulk=fn;fn=function(elem,key,value){return bulk.call(jQuery(elem),value)}}}if(fn){for(;i<length;i++){fn(elems[i],key,raw?value:value.call(elems[i],i,fn(elems[i],key)))}}}return chainable?elems:bulk?fn.call(elems):length?fn(elems[0],key):emptyGet},now:Date.now,swap:function(elem,options,callback,args){var ret,name,old={};for(name in options){old[name]=elem.style[name];elem.style[name]=options[name]}ret=callback.apply(elem,args||[]);for(name in options){elem.style[name]=old[name]}return ret}});jQuery.ready.promise=function(obj){if(!readyList){readyList=jQuery.Deferred();if(document.readyState==="complete"){setTimeout(jQuery.ready)}else{document.addEventListener("DOMContentLoaded",completed,false);window.addEventListener("load",completed,false)}}return readyList.promise(obj)};jQuery.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(i,name){class2type["[object "+name+"]"]=name.toLowerCase()});function isArraylike(obj){var length=obj.length,type=jQuery.type(obj);if(jQuery.isWindow(obj)){return false}if(obj.nodeType===1&&length){return true}return type==="array"||type!=="function"&&(length===0||typeof length==="number"&&length>0&&length-1 in obj)}rootjQuery=jQuery(document);(function(window,undefined){var i,support,cachedruns,Expr,getText,isXML,compile,outermostContext,sortInput,setDocument,document,docElem,documentIsHTML,rbuggyQSA,rbuggyMatches,matches,contains,expando="sizzle"+-new Date,preferredDoc=window.document,dirruns=0,done=0,classCache=createCache(),tokenCache=createCache(),compilerCache=createCache(),hasDuplicate=false,sortOrder=function(a,b){if(a===b){hasDuplicate=true;return 0}return 0},strundefined=typeof undefined,MAX_NEGATIVE=1<<31,hasOwn={}.hasOwnProperty,arr=[],pop=arr.pop,push_native=arr.push,push=arr.push,slice=arr.slice,indexOf=arr.indexOf||function(elem){var i=0,len=this.length;for(;i<len;i++){if(this[i]===elem){return i}}return-1},booleans="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",whitespace="[\\x20\\t\\r\\n\\f]",characterEncoding="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",identifier=characterEncoding.replace("w","w#"),attributes="\\["+whitespace+"*("+characterEncoding+")"+whitespace+"*(?:([*^$|!~]?=)"+whitespace+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+identifier+")|)|)"+whitespace+"*\\]",pseudos=":("+characterEncoding+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+attributes.replace(3,8)+")*)|.*)\\)|)",rtrim=new RegExp("^"+whitespace+"+|((?:^|[^\\\\])(?:\\\\.)*)"+whitespace+"+$","g"),rcomma=new RegExp("^"+whitespace+"*,"+whitespace+"*"),rcombinators=new RegExp("^"+whitespace+"*([>+~]|"+whitespace+")"+whitespace+"*"),rsibling=new RegExp(whitespace+"*[+~]"),rattributeQuotes=new RegExp("="+whitespace+"*([^\\]'\"]*)"+whitespace+"*\\]","g"),rpseudo=new RegExp(pseudos),ridentifier=new RegExp("^"+identifier+"$"),matchExpr={ID:new RegExp("^#("+characterEncoding+")"),CLASS:new RegExp("^\\.("+characterEncoding+")"),TAG:new RegExp("^("+characterEncoding.replace("w","w*")+")"),ATTR:new RegExp("^"+attributes),PSEUDO:new RegExp("^"+pseudos),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+whitespace+"*(even|odd|(([+-]|)(\\d*)n|)"+whitespace+"*(?:([+-]|)"+whitespace+"*(\\d+)|))"+whitespace+"*\\)|)","i"),bool:new RegExp("^(?:"+booleans+")$","i"),needsContext:new RegExp("^"+whitespace+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+whitespace+"*((?:-\\d)?\\d*)"+whitespace+"*\\)|)(?=[^-]|$)","i")},rnative=/^[^{]+\{\s*\[native \w/,rquickExpr=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,rinputs=/^(?:input|select|textarea|button)$/i,rheader=/^h\d$/i,rescape=/'|\\/g,runescape=new RegExp("\\\\([\\da-f]{1,6}"+whitespace+"?|("+whitespace+")|.)","ig"),funescape=function(_,escaped,escapedWhitespace){var high="0x"+escaped-65536;return high!==high||escapedWhitespace?escaped:high<0?String.fromCharCode(high+65536):String.fromCharCode(high>>10|55296,high&1023|56320)};try{push.apply(arr=slice.call(preferredDoc.childNodes),preferredDoc.childNodes);arr[preferredDoc.childNodes.length].nodeType}catch(e){push={apply:arr.length?function(target,els){push_native.apply(target,slice.call(els))}:function(target,els){var j=target.length,i=0;while(target[j++]=els[i++]){}target.length=j-1}}}function Sizzle(selector,context,results,seed){var match,elem,m,nodeType,i,groups,old,nid,newContext,newSelector;if((context?context.ownerDocument||context:preferredDoc)!==document){setDocument(context)}context=context||document;results=results||[];if(!selector||typeof selector!=="string"){return results}if((nodeType=context.nodeType)!==1&&nodeType!==9){return[]}if(documentIsHTML&&!seed){if(match=rquickExpr.exec(selector)){if(m=match[1]){if(nodeType===9){elem=context.getElementById(m);if(elem&&elem.parentNode){if(elem.id===m){results.push(elem);return results}}else{return results}}else{if(context.ownerDocument&&(elem=context.ownerDocument.getElementById(m))&&contains(context,elem)&&elem.id===m){results.push(elem);return results}}}else if(match[2]){push.apply(results,context.getElementsByTagName(selector));return results}else if((m=match[3])&&support.getElementsByClassName&&context.getElementsByClassName){push.apply(results,context.getElementsByClassName(m));return results}}if(support.qsa&&(!rbuggyQSA||!rbuggyQSA.test(selector))){nid=old=expando;newContext=context;newSelector=nodeType===9&&selector;if(nodeType===1&&context.nodeName.toLowerCase()!=="object"){groups=tokenize(selector);if(old=context.getAttribute("id")){nid=old.replace(rescape,"\\$&")}else{context.setAttribute("id",nid)}nid="[id='"+nid+"'] ";i=groups.length;while(i--){groups[i]=nid+toSelector(groups[i])}newContext=rsibling.test(selector)&&context.parentNode||context;newSelector=groups.join(",")}if(newSelector){try{push.apply(results,newContext.querySelectorAll(newSelector));return results}catch(qsaError){}finally{if(!old){context.removeAttribute("id")}}}}}return select(selector.replace(rtrim,"$1"),context,results,seed)}function createCache(){var keys=[];function cache(key,value){if(keys.push(key+=" ")>Expr.cacheLength){delete cache[keys.shift()]}return cache[key]=value}return cache}function markFunction(fn){fn[expando]=true;return fn}function assert(fn){var div=document.createElement("div");try{return!!fn(div)}catch(e){return false}finally{if(div.parentNode){div.parentNode.removeChild(div)}div=null}}function addHandle(attrs,handler){var arr=attrs.split("|"),i=attrs.length;while(i--){Expr.attrHandle[arr[i]]=handler}}function siblingCheck(a,b){var cur=b&&a,diff=cur&&a.nodeType===1&&b.nodeType===1&&(~b.sourceIndex||MAX_NEGATIVE)-(~a.sourceIndex||MAX_NEGATIVE);if(diff){return diff}if(cur){while(cur=cur.nextSibling){if(cur===b){return-1}}}return a?1:-1}function createInputPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return name==="input"&&elem.type===type}}function createButtonPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return(name==="input"||name==="button")&&elem.type===type}}function createPositionalPseudo(fn){return markFunction(function(argument){argument=+argument;return markFunction(function(seed,matches){var j,matchIndexes=fn([],seed.length,argument),i=matchIndexes.length;while(i--){if(seed[j=matchIndexes[i]]){seed[j]=!(matches[j]=seed[j])}}})})}isXML=Sizzle.isXML=function(elem){var documentElement=elem&&(elem.ownerDocument||elem).documentElement;return documentElement?documentElement.nodeName!=="HTML":false};support=Sizzle.support={};setDocument=Sizzle.setDocument=function(node){var doc=node?node.ownerDocument||node:preferredDoc,parent=doc.defaultView;if(doc===document||doc.nodeType!==9||!doc.documentElement){return document}document=doc;docElem=doc.documentElement;documentIsHTML=!isXML(doc);if(parent&&parent.attachEvent&&parent!==parent.top){parent.attachEvent("onbeforeunload",function(){setDocument()})}support.attributes=assert(function(div){div.className="i";return!div.getAttribute("className")});support.getElementsByTagName=assert(function(div){div.appendChild(doc.createComment(""));return!div.getElementsByTagName("*").length});support.getElementsByClassName=assert(function(div){div.innerHTML="<div class='a'></div><div class='a i'></div>";div.firstChild.className="i";return div.getElementsByClassName("i").length===2});support.getById=assert(function(div){docElem.appendChild(div).id=expando;return!doc.getElementsByName||!doc.getElementsByName(expando).length});if(support.getById){Expr.find["ID"]=function(id,context){if(typeof context.getElementById!==strundefined&&documentIsHTML){var m=context.getElementById(id);return m&&m.parentNode?[m]:[]}};Expr.filter["ID"]=function(id){var attrId=id.replace(runescape,funescape);return function(elem){return elem.getAttribute("id")===attrId}}}else{delete Expr.find["ID"];Expr.filter["ID"]=function(id){var attrId=id.replace(runescape,funescape);return function(elem){var node=typeof elem.getAttributeNode!==strundefined&&elem.getAttributeNode("id");return node&&node.value===attrId}}}Expr.find["TAG"]=support.getElementsByTagName?function(tag,context){if(typeof context.getElementsByTagName!==strundefined){return context.getElementsByTagName(tag)}}:function(tag,context){var elem,tmp=[],i=0,results=context.getElementsByTagName(tag);if(tag==="*"){while(elem=results[i++]){if(elem.nodeType===1){tmp.push(elem)}}return tmp}return results};Expr.find["CLASS"]=support.getElementsByClassName&&function(className,context){if(typeof context.getElementsByClassName!==strundefined&&documentIsHTML){return context.getElementsByClassName(className)}};rbuggyMatches=[];rbuggyQSA=[];if(support.qsa=rnative.test(doc.querySelectorAll)){assert(function(div){div.innerHTML="<select><option selected=''></option></select>";if(!div.querySelectorAll("[selected]").length){rbuggyQSA.push("\\["+whitespace+"*(?:value|"+booleans+")")}if(!div.querySelectorAll(":checked").length){rbuggyQSA.push(":checked")}});assert(function(div){var input=doc.createElement("input");input.setAttribute("type","hidden");div.appendChild(input).setAttribute("t","");if(div.querySelectorAll("[t^='']").length){rbuggyQSA.push("[*^$]="+whitespace+"*(?:''|\"\")")}if(!div.querySelectorAll(":enabled").length){rbuggyQSA.push(":enabled",":disabled")}div.querySelectorAll("*,:x");rbuggyQSA.push(",.*:")})}if(support.matchesSelector=rnative.test(matches=docElem.webkitMatchesSelector||docElem.mozMatchesSelector||docElem.oMatchesSelector||docElem.msMatchesSelector)){assert(function(div){support.disconnectedMatch=matches.call(div,"div");matches.call(div,"[s!='']:x");rbuggyMatches.push("!=",pseudos)})}rbuggyQSA=rbuggyQSA.length&&new RegExp(rbuggyQSA.join("|"));rbuggyMatches=rbuggyMatches.length&&new RegExp(rbuggyMatches.join("|"));contains=rnative.test(docElem.contains)||docElem.compareDocumentPosition?function(a,b){var adown=a.nodeType===9?a.documentElement:a,bup=b&&b.parentNode;return a===bup||!!(bup&&bup.nodeType===1&&(adown.contains?adown.contains(bup):a.compareDocumentPosition&&a.compareDocumentPosition(bup)&16))}:function(a,b){if(b){while(b=b.parentNode){if(b===a){return true}}}return false};sortOrder=docElem.compareDocumentPosition?function(a,b){if(a===b){hasDuplicate=true;return 0}var compare=b.compareDocumentPosition&&a.compareDocumentPosition&&a.compareDocumentPosition(b);if(compare){if(compare&1||!support.sortDetached&&b.compareDocumentPosition(a)===compare){if(a===doc||contains(preferredDoc,a)){return-1}if(b===doc||contains(preferredDoc,b)){return 1}return sortInput?indexOf.call(sortInput,a)-indexOf.call(sortInput,b):0}return compare&4?-1:1}return a.compareDocumentPosition?-1:1}:function(a,b){var cur,i=0,aup=a.parentNode,bup=b.parentNode,ap=[a],bp=[b];if(a===b){hasDuplicate=true;return 0}else if(!aup||!bup){return a===doc?-1:b===doc?1:aup?-1:bup?1:sortInput?indexOf.call(sortInput,a)-indexOf.call(sortInput,b):0}else if(aup===bup){return siblingCheck(a,b)}cur=a;while(cur=cur.parentNode){ap.unshift(cur)}cur=b;while(cur=cur.parentNode){bp.unshift(cur)}while(ap[i]===bp[i]){i++}return i?siblingCheck(ap[i],bp[i]):ap[i]===preferredDoc?-1:bp[i]===preferredDoc?1:0};return doc};Sizzle.matches=function(expr,elements){return Sizzle(expr,null,null,elements)};Sizzle.matchesSelector=function(elem,expr){if((elem.ownerDocument||elem)!==document){setDocument(elem)}expr=expr.replace(rattributeQuotes,"='$1']");if(support.matchesSelector&&documentIsHTML&&(!rbuggyMatches||!rbuggyMatches.test(expr))&&(!rbuggyQSA||!rbuggyQSA.test(expr))){try{var ret=matches.call(elem,expr);if(ret||support.disconnectedMatch||elem.document&&elem.document.nodeType!==11){return ret}}catch(e){}}return Sizzle(expr,document,null,[elem]).length>0};Sizzle.contains=function(context,elem){if((context.ownerDocument||context)!==document){setDocument(context)}return contains(context,elem)};Sizzle.attr=function(elem,name){if((elem.ownerDocument||elem)!==document){setDocument(elem)}var fn=Expr.attrHandle[name.toLowerCase()],val=fn&&hasOwn.call(Expr.attrHandle,name.toLowerCase())?fn(elem,name,!documentIsHTML):undefined;return val===undefined?support.attributes||!documentIsHTML?elem.getAttribute(name):(val=elem.getAttributeNode(name))&&val.specified?val.value:null:val};Sizzle.error=function(msg){throw new Error("Syntax error, unrecognized expression: "+msg)};Sizzle.uniqueSort=function(results){var elem,duplicates=[],j=0,i=0;hasDuplicate=!support.detectDuplicates;sortInput=!support.sortStable&&results.slice(0);results.sort(sortOrder);if(hasDuplicate){while(elem=results[i++]){if(elem===results[i]){j=duplicates.push(i)}}while(j--){results.splice(duplicates[j],1)}}return results};getText=Sizzle.getText=function(elem){var node,ret="",i=0,nodeType=elem.nodeType;if(!nodeType){for(;node=elem[i];i++){ret+=getText(node)}}else if(nodeType===1||nodeType===9||nodeType===11){if(typeof elem.textContent==="string"){return elem.textContent}else{for(elem=elem.firstChild;elem;elem=elem.nextSibling){ret+=getText(elem)}}}else if(nodeType===3||nodeType===4){return elem.nodeValue}return ret};Expr=Sizzle.selectors={cacheLength:50,createPseudo:markFunction,match:matchExpr,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:true}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:true},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(match){match[1]=match[1].replace(runescape,funescape);match[3]=(match[4]||match[5]||"").replace(runescape,funescape);
if(match[2]==="~="){match[3]=" "+match[3]+" "}return match.slice(0,4)},CHILD:function(match){match[1]=match[1].toLowerCase();if(match[1].slice(0,3)==="nth"){if(!match[3]){Sizzle.error(match[0])}match[4]=+(match[4]?match[5]+(match[6]||1):2*(match[3]==="even"||match[3]==="odd"));match[5]=+(match[7]+match[8]||match[3]==="odd")}else if(match[3]){Sizzle.error(match[0])}return match},PSEUDO:function(match){var excess,unquoted=!match[5]&&match[2];if(matchExpr["CHILD"].test(match[0])){return null}if(match[3]&&match[4]!==undefined){match[2]=match[4]}else if(unquoted&&rpseudo.test(unquoted)&&(excess=tokenize(unquoted,true))&&(excess=unquoted.indexOf(")",unquoted.length-excess)-unquoted.length)){match[0]=match[0].slice(0,excess);match[2]=unquoted.slice(0,excess)}return match.slice(0,3)}},filter:{TAG:function(nodeNameSelector){var nodeName=nodeNameSelector.replace(runescape,funescape).toLowerCase();return nodeNameSelector==="*"?function(){return true}:function(elem){return elem.nodeName&&elem.nodeName.toLowerCase()===nodeName}},CLASS:function(className){var pattern=classCache[className+" "];return pattern||(pattern=new RegExp("(^|"+whitespace+")"+className+"("+whitespace+"|$)"))&&classCache(className,function(elem){return pattern.test(typeof elem.className==="string"&&elem.className||typeof elem.getAttribute!==strundefined&&elem.getAttribute("class")||"")})},ATTR:function(name,operator,check){return function(elem){var result=Sizzle.attr(elem,name);if(result==null){return operator==="!="}if(!operator){return true}result+="";return operator==="="?result===check:operator==="!="?result!==check:operator==="^="?check&&result.indexOf(check)===0:operator==="*="?check&&result.indexOf(check)>-1:operator==="$="?check&&result.slice(-check.length)===check:operator==="~="?(" "+result+" ").indexOf(check)>-1:operator==="|="?result===check||result.slice(0,check.length+1)===check+"-":false}},CHILD:function(type,what,argument,first,last){var simple=type.slice(0,3)!=="nth",forward=type.slice(-4)!=="last",ofType=what==="of-type";return first===1&&last===0?function(elem){return!!elem.parentNode}:function(elem,context,xml){var cache,outerCache,node,diff,nodeIndex,start,dir=simple!==forward?"nextSibling":"previousSibling",parent=elem.parentNode,name=ofType&&elem.nodeName.toLowerCase(),useCache=!xml&&!ofType;if(parent){if(simple){while(dir){node=elem;while(node=node[dir]){if(ofType?node.nodeName.toLowerCase()===name:node.nodeType===1){return false}}start=dir=type==="only"&&!start&&"nextSibling"}return true}start=[forward?parent.firstChild:parent.lastChild];if(forward&&useCache){outerCache=parent[expando]||(parent[expando]={});cache=outerCache[type]||[];nodeIndex=cache[0]===dirruns&&cache[1];diff=cache[0]===dirruns&&cache[2];node=nodeIndex&&parent.childNodes[nodeIndex];while(node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop()){if(node.nodeType===1&&++diff&&node===elem){outerCache[type]=[dirruns,nodeIndex,diff];break}}}else if(useCache&&(cache=(elem[expando]||(elem[expando]={}))[type])&&cache[0]===dirruns){diff=cache[1]}else{while(node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop()){if((ofType?node.nodeName.toLowerCase()===name:node.nodeType===1)&&++diff){if(useCache){(node[expando]||(node[expando]={}))[type]=[dirruns,diff]}if(node===elem){break}}}}diff-=last;return diff===first||diff%first===0&&diff/first>=0}}},PSEUDO:function(pseudo,argument){var args,fn=Expr.pseudos[pseudo]||Expr.setFilters[pseudo.toLowerCase()]||Sizzle.error("unsupported pseudo: "+pseudo);if(fn[expando]){return fn(argument)}if(fn.length>1){args=[pseudo,pseudo,"",argument];return Expr.setFilters.hasOwnProperty(pseudo.toLowerCase())?markFunction(function(seed,matches){var idx,matched=fn(seed,argument),i=matched.length;while(i--){idx=indexOf.call(seed,matched[i]);seed[idx]=!(matches[idx]=matched[i])}}):function(elem){return fn(elem,0,args)}}return fn}},pseudos:{not:markFunction(function(selector){var input=[],results=[],matcher=compile(selector.replace(rtrim,"$1"));return matcher[expando]?markFunction(function(seed,matches,context,xml){var elem,unmatched=matcher(seed,null,xml,[]),i=seed.length;while(i--){if(elem=unmatched[i]){seed[i]=!(matches[i]=elem)}}}):function(elem,context,xml){input[0]=elem;matcher(input,null,xml,results);return!results.pop()}}),has:markFunction(function(selector){return function(elem){return Sizzle(selector,elem).length>0}}),contains:markFunction(function(text){return function(elem){return(elem.textContent||elem.innerText||getText(elem)).indexOf(text)>-1}}),lang:markFunction(function(lang){if(!ridentifier.test(lang||"")){Sizzle.error("unsupported lang: "+lang)}lang=lang.replace(runescape,funescape).toLowerCase();return function(elem){var elemLang;do{if(elemLang=documentIsHTML?elem.lang:elem.getAttribute("xml:lang")||elem.getAttribute("lang")){elemLang=elemLang.toLowerCase();return elemLang===lang||elemLang.indexOf(lang+"-")===0}}while((elem=elem.parentNode)&&elem.nodeType===1);return false}}),target:function(elem){var hash=window.location&&window.location.hash;return hash&&hash.slice(1)===elem.id},root:function(elem){return elem===docElem},focus:function(elem){return elem===document.activeElement&&(!document.hasFocus||document.hasFocus())&&!!(elem.type||elem.href||~elem.tabIndex)},enabled:function(elem){return elem.disabled===false},disabled:function(elem){return elem.disabled===true},checked:function(elem){var nodeName=elem.nodeName.toLowerCase();return nodeName==="input"&&!!elem.checked||nodeName==="option"&&!!elem.selected},selected:function(elem){if(elem.parentNode){elem.parentNode.selectedIndex}return elem.selected===true},empty:function(elem){for(elem=elem.firstChild;elem;elem=elem.nextSibling){if(elem.nodeName>"@"||elem.nodeType===3||elem.nodeType===4){return false}}return true},parent:function(elem){return!Expr.pseudos["empty"](elem)},header:function(elem){return rheader.test(elem.nodeName)},input:function(elem){return rinputs.test(elem.nodeName)},button:function(elem){var name=elem.nodeName.toLowerCase();return name==="input"&&elem.type==="button"||name==="button"},text:function(elem){var attr;return elem.nodeName.toLowerCase()==="input"&&elem.type==="text"&&((attr=elem.getAttribute("type"))==null||attr.toLowerCase()===elem.type)},first:createPositionalPseudo(function(){return[0]}),last:createPositionalPseudo(function(matchIndexes,length){return[length-1]}),eq:createPositionalPseudo(function(matchIndexes,length,argument){return[argument<0?argument+length:argument]}),even:createPositionalPseudo(function(matchIndexes,length){var i=0;for(;i<length;i+=2){matchIndexes.push(i)}return matchIndexes}),odd:createPositionalPseudo(function(matchIndexes,length){var i=1;for(;i<length;i+=2){matchIndexes.push(i)}return matchIndexes}),lt:createPositionalPseudo(function(matchIndexes,length,argument){var i=argument<0?argument+length:argument;for(;--i>=0;){matchIndexes.push(i)}return matchIndexes}),gt:createPositionalPseudo(function(matchIndexes,length,argument){var i=argument<0?argument+length:argument;for(;++i<length;){matchIndexes.push(i)}return matchIndexes})}};Expr.pseudos["nth"]=Expr.pseudos["eq"];for(i in{radio:true,checkbox:true,file:true,password:true,image:true}){Expr.pseudos[i]=createInputPseudo(i)}for(i in{submit:true,reset:true}){Expr.pseudos[i]=createButtonPseudo(i)}function setFilters(){}setFilters.prototype=Expr.filters=Expr.pseudos;Expr.setFilters=new setFilters;function tokenize(selector,parseOnly){var matched,match,tokens,type,soFar,groups,preFilters,cached=tokenCache[selector+" "];if(cached){return parseOnly?0:cached.slice(0)}soFar=selector;groups=[];preFilters=Expr.preFilter;while(soFar){if(!matched||(match=rcomma.exec(soFar))){if(match){soFar=soFar.slice(match[0].length)||soFar}groups.push(tokens=[])}matched=false;if(match=rcombinators.exec(soFar)){matched=match.shift();tokens.push({value:matched,type:match[0].replace(rtrim," ")});soFar=soFar.slice(matched.length)}for(type in Expr.filter){if((match=matchExpr[type].exec(soFar))&&(!preFilters[type]||(match=preFilters[type](match)))){matched=match.shift();tokens.push({value:matched,type:type,matches:match});soFar=soFar.slice(matched.length)}}if(!matched){break}}return parseOnly?soFar.length:soFar?Sizzle.error(selector):tokenCache(selector,groups).slice(0)}function toSelector(tokens){var i=0,len=tokens.length,selector="";for(;i<len;i++){selector+=tokens[i].value}return selector}function addCombinator(matcher,combinator,base){var dir=combinator.dir,checkNonElements=base&&dir==="parentNode",doneName=done++;return combinator.first?function(elem,context,xml){while(elem=elem[dir]){if(elem.nodeType===1||checkNonElements){return matcher(elem,context,xml)}}}:function(elem,context,xml){var data,cache,outerCache,dirkey=dirruns+" "+doneName;if(xml){while(elem=elem[dir]){if(elem.nodeType===1||checkNonElements){if(matcher(elem,context,xml)){return true}}}}else{while(elem=elem[dir]){if(elem.nodeType===1||checkNonElements){outerCache=elem[expando]||(elem[expando]={});if((cache=outerCache[dir])&&cache[0]===dirkey){if((data=cache[1])===true||data===cachedruns){return data===true}}else{cache=outerCache[dir]=[dirkey];cache[1]=matcher(elem,context,xml)||cachedruns;if(cache[1]===true){return true}}}}}}}function elementMatcher(matchers){return matchers.length>1?function(elem,context,xml){var i=matchers.length;while(i--){if(!matchers[i](elem,context,xml)){return false}}return true}:matchers[0]}function condense(unmatched,map,filter,context,xml){var elem,newUnmatched=[],i=0,len=unmatched.length,mapped=map!=null;for(;i<len;i++){if(elem=unmatched[i]){if(!filter||filter(elem,context,xml)){newUnmatched.push(elem);if(mapped){map.push(i)}}}}return newUnmatched}function setMatcher(preFilter,selector,matcher,postFilter,postFinder,postSelector){if(postFilter&&!postFilter[expando]){postFilter=setMatcher(postFilter)}if(postFinder&&!postFinder[expando]){postFinder=setMatcher(postFinder,postSelector)}return markFunction(function(seed,results,context,xml){var temp,i,elem,preMap=[],postMap=[],preexisting=results.length,elems=seed||multipleContexts(selector||"*",context.nodeType?[context]:context,[]),matcherIn=preFilter&&(seed||!selector)?condense(elems,preMap,preFilter,context,xml):elems,matcherOut=matcher?postFinder||(seed?preFilter:preexisting||postFilter)?[]:results:matcherIn;if(matcher){matcher(matcherIn,matcherOut,context,xml)}if(postFilter){temp=condense(matcherOut,postMap);postFilter(temp,[],context,xml);i=temp.length;while(i--){if(elem=temp[i]){matcherOut[postMap[i]]=!(matcherIn[postMap[i]]=elem)}}}if(seed){if(postFinder||preFilter){if(postFinder){temp=[];i=matcherOut.length;while(i--){if(elem=matcherOut[i]){temp.push(matcherIn[i]=elem)}}postFinder(null,matcherOut=[],temp,xml)}i=matcherOut.length;while(i--){if((elem=matcherOut[i])&&(temp=postFinder?indexOf.call(seed,elem):preMap[i])>-1){seed[temp]=!(results[temp]=elem)}}}}else{matcherOut=condense(matcherOut===results?matcherOut.splice(preexisting,matcherOut.length):matcherOut);if(postFinder){postFinder(null,results,matcherOut,xml)}else{push.apply(results,matcherOut)}}})}function matcherFromTokens(tokens){var checkContext,matcher,j,len=tokens.length,leadingRelative=Expr.relative[tokens[0].type],implicitRelative=leadingRelative||Expr.relative[" "],i=leadingRelative?1:0,matchContext=addCombinator(function(elem){return elem===checkContext},implicitRelative,true),matchAnyContext=addCombinator(function(elem){return indexOf.call(checkContext,elem)>-1},implicitRelative,true),matchers=[function(elem,context,xml){return!leadingRelative&&(xml||context!==outermostContext)||((checkContext=context).nodeType?matchContext(elem,context,xml):matchAnyContext(elem,context,xml))}];for(;i<len;i++){if(matcher=Expr.relative[tokens[i].type]){matchers=[addCombinator(elementMatcher(matchers),matcher)]}else{matcher=Expr.filter[tokens[i].type].apply(null,tokens[i].matches);if(matcher[expando]){j=++i;for(;j<len;j++){if(Expr.relative[tokens[j].type]){break}}return setMatcher(i>1&&elementMatcher(matchers),i>1&&toSelector(tokens.slice(0,i-1).concat({value:tokens[i-2].type===" "?"*":""})).replace(rtrim,"$1"),matcher,i<j&&matcherFromTokens(tokens.slice(i,j)),j<len&&matcherFromTokens(tokens=tokens.slice(j)),j<len&&toSelector(tokens))}matchers.push(matcher)}}return elementMatcher(matchers)}function matcherFromGroupMatchers(elementMatchers,setMatchers){var matcherCachedRuns=0,bySet=setMatchers.length>0,byElement=elementMatchers.length>0,superMatcher=function(seed,context,xml,results,expandContext){var elem,j,matcher,setMatched=[],matchedCount=0,i="0",unmatched=seed&&[],outermost=expandContext!=null,contextBackup=outermostContext,elems=seed||byElement&&Expr.find["TAG"]("*",expandContext&&context.parentNode||context),dirrunsUnique=dirruns+=contextBackup==null?1:Math.random()||.1;if(outermost){outermostContext=context!==document&&context;cachedruns=matcherCachedRuns}for(;(elem=elems[i])!=null;i++){if(byElement&&elem){j=0;while(matcher=elementMatchers[j++]){if(matcher(elem,context,xml)){results.push(elem);break}}if(outermost){dirruns=dirrunsUnique;cachedruns=++matcherCachedRuns}}if(bySet){if(elem=!matcher&&elem){matchedCount--}if(seed){unmatched.push(elem)}}}matchedCount+=i;if(bySet&&i!==matchedCount){j=0;while(matcher=setMatchers[j++]){matcher(unmatched,setMatched,context,xml)}if(seed){if(matchedCount>0){while(i--){if(!(unmatched[i]||setMatched[i])){setMatched[i]=pop.call(results)}}}setMatched=condense(setMatched)}push.apply(results,setMatched);if(outermost&&!seed&&setMatched.length>0&&matchedCount+setMatchers.length>1){Sizzle.uniqueSort(results)}}if(outermost){dirruns=dirrunsUnique;outermostContext=contextBackup}return unmatched};return bySet?markFunction(superMatcher):superMatcher}compile=Sizzle.compile=function(selector,group){var i,setMatchers=[],elementMatchers=[],cached=compilerCache[selector+" "];if(!cached){if(!group){group=tokenize(selector)}i=group.length;while(i--){cached=matcherFromTokens(group[i]);if(cached[expando]){setMatchers.push(cached)}else{elementMatchers.push(cached)}}cached=compilerCache(selector,matcherFromGroupMatchers(elementMatchers,setMatchers))}return cached};function multipleContexts(selector,contexts,results){var i=0,len=contexts.length;for(;i<len;i++){Sizzle(selector,contexts[i],results)}return results}function select(selector,context,results,seed){var i,tokens,token,type,find,match=tokenize(selector);if(!seed){if(match.length===1){tokens=match[0]=match[0].slice(0);if(tokens.length>2&&(token=tokens[0]).type==="ID"&&support.getById&&context.nodeType===9&&documentIsHTML&&Expr.relative[tokens[1].type]){context=(Expr.find["ID"](token.matches[0].replace(runescape,funescape),context)||[])[0];if(!context){return results}selector=selector.slice(tokens.shift().value.length)}i=matchExpr["needsContext"].test(selector)?0:tokens.length;while(i--){token=tokens[i];if(Expr.relative[type=token.type]){break}if(find=Expr.find[type]){if(seed=find(token.matches[0].replace(runescape,funescape),rsibling.test(tokens[0].type)&&context.parentNode||context)){tokens.splice(i,1);selector=seed.length&&toSelector(tokens);if(!selector){push.apply(results,seed);return results}break}}}}}compile(selector,match)(seed,context,!documentIsHTML,results,rsibling.test(selector));return results}support.sortStable=expando.split("").sort(sortOrder).join("")===expando;support.detectDuplicates=hasDuplicate;setDocument();support.sortDetached=assert(function(div1){return div1.compareDocumentPosition(document.createElement("div"))&1});if(!assert(function(div){div.innerHTML="<a href='#'></a>";return div.firstChild.getAttribute("href")==="#"})){addHandle("type|href|height|width",function(elem,name,isXML){if(!isXML){return elem.getAttribute(name,name.toLowerCase()==="type"?1:2)}})}if(!support.attributes||!assert(function(div){div.innerHTML="<input/>";div.firstChild.setAttribute("value","");return div.firstChild.getAttribute("value")===""})){addHandle("value",function(elem,name,isXML){if(!isXML&&elem.nodeName.toLowerCase()==="input"){return elem.defaultValue}})}if(!assert(function(div){return div.getAttribute("disabled")==null})){addHandle(booleans,function(elem,name,isXML){var val;if(!isXML){return(val=elem.getAttributeNode(name))&&val.specified?val.value:elem[name]===true?name.toLowerCase():null}})}jQuery.find=Sizzle;jQuery.expr=Sizzle.selectors;jQuery.expr[":"]=jQuery.expr.pseudos;jQuery.unique=Sizzle.uniqueSort;jQuery.text=Sizzle.getText;jQuery.isXMLDoc=Sizzle.isXML;jQuery.contains=Sizzle.contains})(window);var optionsCache={};function createOptions(options){var object=optionsCache[options]={};jQuery.each(options.match(core_rnotwhite)||[],function(_,flag){object[flag]=true});return object}jQuery.Callbacks=function(options){options=typeof options==="string"?optionsCache[options]||createOptions(options):jQuery.extend({},options);var memory,fired,firing,firingStart,firingLength,firingIndex,list=[],stack=!options.once&&[],fire=function(data){memory=options.memory&&data;fired=true;firingIndex=firingStart||0;firingStart=0;firingLength=list.length;firing=true;for(;list&&firingIndex<firingLength;firingIndex++){if(list[firingIndex].apply(data[0],data[1])===false&&options.stopOnFalse){memory=false;break}}firing=false;if(list){if(stack){if(stack.length){fire(stack.shift())}}else if(memory){list=[]}else{self.disable()}}},self={add:function(){if(list){var start=list.length;(function add(args){jQuery.each(args,function(_,arg){var type=jQuery.type(arg);if(type==="function"){if(!options.unique||!self.has(arg)){list.push(arg)}}else if(arg&&arg.length&&type!=="string"){add(arg)}})})(arguments);if(firing){firingLength=list.length}else if(memory){firingStart=start;fire(memory)}}return this},remove:function(){if(list){jQuery.each(arguments,function(_,arg){var index;while((index=jQuery.inArray(arg,list,index))>-1){list.splice(index,1);if(firing){if(index<=firingLength){firingLength--}if(index<=firingIndex){firingIndex--}}}})}return this},has:function(fn){return fn?jQuery.inArray(fn,list)>-1:!!(list&&list.length)},empty:function(){list=[];firingLength=0;return this},disable:function(){list=stack=memory=undefined;return this},disabled:function(){return!list},lock:function(){stack=undefined;if(!memory){self.disable()}return this},locked:function(){return!stack},fireWith:function(context,args){if(list&&(!fired||stack)){args=args||[];args=[context,args.slice?args.slice():args];if(firing){stack.push(args)}else{fire(args)}}return this},fire:function(){self.fireWith(this,arguments);return this},fired:function(){return!!fired}};return self};jQuery.extend({Deferred:function(func){var tuples=[["resolve","done",jQuery.Callbacks("once memory"),"resolved"],["reject","fail",jQuery.Callbacks("once memory"),"rejected"],["notify","progress",jQuery.Callbacks("memory")]],state="pending",promise={state:function(){return state},always:function(){deferred.done(arguments).fail(arguments);return this},then:function(){var fns=arguments;return jQuery.Deferred(function(newDefer){jQuery.each(tuples,function(i,tuple){var action=tuple[0],fn=jQuery.isFunction(fns[i])&&fns[i];deferred[tuple[1]](function(){var returned=fn&&fn.apply(this,arguments);if(returned&&jQuery.isFunction(returned.promise)){returned.promise().done(newDefer.resolve).fail(newDefer.reject).progress(newDefer.notify)}else{newDefer[action+"With"](this===promise?newDefer.promise():this,fn?[returned]:arguments)}})});fns=null}).promise()},promise:function(obj){return obj!=null?jQuery.extend(obj,promise):promise}},deferred={};promise.pipe=promise.then;jQuery.each(tuples,function(i,tuple){var list=tuple[2],stateString=tuple[3];promise[tuple[1]]=list.add;if(stateString){list.add(function(){state=stateString},tuples[i^1][2].disable,tuples[2][2].lock)}deferred[tuple[0]]=function(){deferred[tuple[0]+"With"](this===deferred?promise:this,arguments);return this};deferred[tuple[0]+"With"]=list.fireWith});promise.promise(deferred);if(func){func.call(deferred,deferred)}return deferred},when:function(subordinate){var i=0,resolveValues=core_slice.call(arguments),length=resolveValues.length,remaining=length!==1||subordinate&&jQuery.isFunction(subordinate.promise)?length:0,deferred=remaining===1?subordinate:jQuery.Deferred(),updateFunc=function(i,contexts,values){return function(value){contexts[i]=this;values[i]=arguments.length>1?core_slice.call(arguments):value;if(values===progressValues){deferred.notifyWith(contexts,values)}else if(!--remaining){deferred.resolveWith(contexts,values)}}},progressValues,progressContexts,resolveContexts;if(length>1){progressValues=new Array(length);progressContexts=new Array(length);resolveContexts=new Array(length);for(;i<length;i++){if(resolveValues[i]&&jQuery.isFunction(resolveValues[i].promise)){resolveValues[i].promise().done(updateFunc(i,resolveContexts,resolveValues)).fail(deferred.reject).progress(updateFunc(i,progressContexts,progressValues))}else{--remaining}}}if(!remaining){deferred.resolveWith(resolveContexts,resolveValues)}return deferred.promise()}});jQuery.support=function(support){var input=document.createElement("input"),fragment=document.createDocumentFragment(),div=document.createElement("div"),select=document.createElement("select"),opt=select.appendChild(document.createElement("option"));if(!input.type){return support}input.type="checkbox";support.checkOn=input.value!=="";support.optSelected=opt.selected;support.reliableMarginRight=true;support.boxSizingReliable=true;support.pixelPosition=false;input.checked=true;support.noCloneChecked=input.cloneNode(true).checked;select.disabled=true;support.optDisabled=!opt.disabled;input=document.createElement("input");input.value="t";input.type="radio";support.radioValue=input.value==="t";input.setAttribute("checked","t");input.setAttribute("name","t");fragment.appendChild(input);support.checkClone=fragment.cloneNode(true).cloneNode(true).lastChild.checked;support.focusinBubbles="onfocusin"in window;div.style.backgroundClip="content-box";div.cloneNode(true).style.backgroundClip="";support.clearCloneStyle=div.style.backgroundClip==="content-box";jQuery(function(){var container,marginDiv,divReset="padding:0;margin:0;border:0;display:block;-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box",body=document.getElementsByTagName("body")[0];if(!body){return}container=document.createElement("div");container.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px";body.appendChild(container).appendChild(div);div.innerHTML="";div.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%";jQuery.swap(body,body.style.zoom!=null?{zoom:1}:{},function(){support.boxSizing=div.offsetWidth===4});if(window.getComputedStyle){support.pixelPosition=(window.getComputedStyle(div,null)||{}).top!=="1%";support.boxSizingReliable=(window.getComputedStyle(div,null)||{width:"4px"}).width==="4px";marginDiv=div.appendChild(document.createElement("div"));marginDiv.style.cssText=div.style.cssText=divReset;marginDiv.style.marginRight=marginDiv.style.width="0";div.style.width="1px";support.reliableMarginRight=!parseFloat((window.getComputedStyle(marginDiv,null)||{}).marginRight)}body.removeChild(container)});return support}({});var data_user,data_priv,rbrace=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,rmultiDash=/([A-Z])/g;function Data(){Object.defineProperty(this.cache={},0,{get:function(){return{}}});this.expando=jQuery.expando+Math.random()}Data.uid=1;Data.accepts=function(owner){return owner.nodeType?owner.nodeType===1||owner.nodeType===9:true};Data.prototype={key:function(owner){if(!Data.accepts(owner)){return 0}var descriptor={},unlock=owner[this.expando];if(!unlock){unlock=Data.uid++;try{descriptor[this.expando]={value:unlock};Object.defineProperties(owner,descriptor)}catch(e){descriptor[this.expando]=unlock;jQuery.extend(owner,descriptor)}}if(!this.cache[unlock]){this.cache[unlock]={}}return unlock},set:function(owner,data,value){var prop,unlock=this.key(owner),cache=this.cache[unlock];if(typeof data==="string"){cache[data]=value}else{if(jQuery.isEmptyObject(cache)){jQuery.extend(this.cache[unlock],data)}else{for(prop in data){cache[prop]=data[prop]}}}return cache},get:function(owner,key){var cache=this.cache[this.key(owner)];return key===undefined?cache:cache[key]},access:function(owner,key,value){var stored;if(key===undefined||key&&typeof key==="string"&&value===undefined){stored=this.get(owner,key);return stored!==undefined?stored:this.get(owner,jQuery.camelCase(key))}this.set(owner,key,value);return value!==undefined?value:key},remove:function(owner,key){var i,name,camel,unlock=this.key(owner),cache=this.cache[unlock];if(key===undefined){this.cache[unlock]={}}else{if(jQuery.isArray(key)){name=key.concat(key.map(jQuery.camelCase))}else{camel=jQuery.camelCase(key);if(key in cache){name=[key,camel]}else{name=camel;name=name in cache?[name]:name.match(core_rnotwhite)||[]}}i=name.length;while(i--){delete cache[name[i]]}}},hasData:function(owner){return!jQuery.isEmptyObject(this.cache[owner[this.expando]]||{})},discard:function(owner){if(owner[this.expando]){delete this.cache[owner[this.expando]]}}};data_user=new Data;data_priv=new Data;jQuery.extend({acceptData:Data.accepts,hasData:function(elem){return data_user.hasData(elem)||data_priv.hasData(elem)},data:function(elem,name,data){return data_user.access(elem,name,data)},removeData:function(elem,name){data_user.remove(elem,name)},_data:function(elem,name,data){return data_priv.access(elem,name,data)},_removeData:function(elem,name){data_priv.remove(elem,name)}});jQuery.fn.extend({data:function(key,value){var attrs,name,elem=this[0],i=0,data=null;if(key===undefined){if(this.length){data=data_user.get(elem);if(elem.nodeType===1&&!data_priv.get(elem,"hasDataAttrs")){attrs=elem.attributes;for(;i<attrs.length;i++){name=attrs[i].name;if(name.indexOf("data-")===0){name=jQuery.camelCase(name.slice(5));dataAttr(elem,name,data[name])}}data_priv.set(elem,"hasDataAttrs",true)}}return data}if(typeof key==="object"){return this.each(function(){data_user.set(this,key)})}return jQuery.access(this,function(value){var data,camelKey=jQuery.camelCase(key);if(elem&&value===undefined){data=data_user.get(elem,key);if(data!==undefined){return data}data=data_user.get(elem,camelKey);if(data!==undefined){return data}data=dataAttr(elem,camelKey,undefined);if(data!==undefined){return data}return}this.each(function(){var data=data_user.get(this,camelKey);data_user.set(this,camelKey,value);if(key.indexOf("-")!==-1&&data!==undefined){data_user.set(this,key,value)}})},null,value,arguments.length>1,null,true)},removeData:function(key){return this.each(function(){data_user.remove(this,key)})}});function dataAttr(elem,key,data){var name;if(data===undefined&&elem.nodeType===1){name="data-"+key.replace(rmultiDash,"-$1").toLowerCase();data=elem.getAttribute(name);if(typeof data==="string"){try{data=data==="true"?true:data==="false"?false:data==="null"?null:+data+""===data?+data:rbrace.test(data)?JSON.parse(data):data}catch(e){}data_user.set(elem,key,data)}else{data=undefined}}return data}jQuery.extend({queue:function(elem,type,data){var queue;if(elem){type=(type||"fx")+"queue";queue=data_priv.get(elem,type);if(data){if(!queue||jQuery.isArray(data)){queue=data_priv.access(elem,type,jQuery.makeArray(data))}else{queue.push(data)}}return queue||[]}},dequeue:function(elem,type){type=type||"fx";var queue=jQuery.queue(elem,type),startLength=queue.length,fn=queue.shift(),hooks=jQuery._queueHooks(elem,type),next=function(){jQuery.dequeue(elem,type)};if(fn==="inprogress"){fn=queue.shift();startLength--}if(fn){if(type==="fx"){queue.unshift("inprogress")}delete hooks.stop;fn.call(elem,next,hooks)}if(!startLength&&hooks){hooks.empty.fire()}},_queueHooks:function(elem,type){var key=type+"queueHooks";return data_priv.get(elem,key)||data_priv.access(elem,key,{empty:jQuery.Callbacks("once memory").add(function(){data_priv.remove(elem,[type+"queue",key])})})}});jQuery.fn.extend({queue:function(type,data){var setter=2;if(typeof type!=="string"){data=type;type="fx";setter--}if(arguments.length<setter){return jQuery.queue(this[0],type)}return data===undefined?this:this.each(function(){var queue=jQuery.queue(this,type,data);jQuery._queueHooks(this,type);if(type==="fx"&&queue[0]!=="inprogress"){jQuery.dequeue(this,type)}})},dequeue:function(type){return this.each(function(){jQuery.dequeue(this,type)})},delay:function(time,type){time=jQuery.fx?jQuery.fx.speeds[time]||time:time;type=type||"fx";return this.queue(type,function(next,hooks){var timeout=setTimeout(next,time);hooks.stop=function(){clearTimeout(timeout)}})},clearQueue:function(type){return this.queue(type||"fx",[])},promise:function(type,obj){var tmp,count=1,defer=jQuery.Deferred(),elements=this,i=this.length,resolve=function(){if(!--count){defer.resolveWith(elements,[elements])}};if(typeof type!=="string"){obj=type;type=undefined}type=type||"fx";while(i--){tmp=data_priv.get(elements[i],type+"queueHooks");if(tmp&&tmp.empty){count++;tmp.empty.add(resolve)}}resolve();return defer.promise(obj)}});var nodeHook,boolHook,rclass=/[\t\r\n\f]/g,rreturn=/\r/g,rfocusable=/^(?:input|select|textarea|button)$/i;jQuery.fn.extend({attr:function(name,value){return jQuery.access(this,jQuery.attr,name,value,arguments.length>1)},removeAttr:function(name){return this.each(function(){jQuery.removeAttr(this,name)})},prop:function(name,value){return jQuery.access(this,jQuery.prop,name,value,arguments.length>1)},removeProp:function(name){return this.each(function(){delete this[jQuery.propFix[name]||name]})},addClass:function(value){var classes,elem,cur,clazz,j,i=0,len=this.length,proceed=typeof value==="string"&&value;if(jQuery.isFunction(value)){return this.each(function(j){jQuery(this).addClass(value.call(this,j,this.className))})}if(proceed){classes=(value||"").match(core_rnotwhite)||[];for(;i<len;i++){elem=this[i];cur=elem.nodeType===1&&(elem.className?(" "+elem.className+" ").replace(rclass," "):" ");if(cur){j=0;while(clazz=classes[j++]){if(cur.indexOf(" "+clazz+" ")<0){cur+=clazz+" "}}elem.className=jQuery.trim(cur)}}}return this},removeClass:function(value){var classes,elem,cur,clazz,j,i=0,len=this.length,proceed=arguments.length===0||typeof value==="string"&&value;if(jQuery.isFunction(value)){return this.each(function(j){jQuery(this).removeClass(value.call(this,j,this.className))})}if(proceed){classes=(value||"").match(core_rnotwhite)||[];for(;i<len;i++){elem=this[i];cur=elem.nodeType===1&&(elem.className?(" "+elem.className+" ").replace(rclass," "):"");if(cur){j=0;while(clazz=classes[j++]){while(cur.indexOf(" "+clazz+" ")>=0){cur=cur.replace(" "+clazz+" "," ")}}elem.className=value?jQuery.trim(cur):""}}}return this},toggleClass:function(value,stateVal){var type=typeof value;if(typeof stateVal==="boolean"&&type==="string"){return stateVal?this.addClass(value):this.removeClass(value)}if(jQuery.isFunction(value)){return this.each(function(i){jQuery(this).toggleClass(value.call(this,i,this.className,stateVal),stateVal)})}return this.each(function(){if(type==="string"){var className,i=0,self=jQuery(this),classNames=value.match(core_rnotwhite)||[];while(className=classNames[i++]){if(self.hasClass(className)){self.removeClass(className)}else{self.addClass(className)}}}else if(type===core_strundefined||type==="boolean"){if(this.className){data_priv.set(this,"__className__",this.className)}this.className=this.className||value===false?"":data_priv.get(this,"__className__")||""}})},hasClass:function(selector){var className=" "+selector+" ",i=0,l=this.length;for(;i<l;i++){if(this[i].nodeType===1&&(" "+this[i].className+" ").replace(rclass," ").indexOf(className)>=0){return true}}return false},val:function(value){var hooks,ret,isFunction,elem=this[0];if(!arguments.length){if(elem){hooks=jQuery.valHooks[elem.type]||jQuery.valHooks[elem.nodeName.toLowerCase()];if(hooks&&"get"in hooks&&(ret=hooks.get(elem,"value"))!==undefined){return ret}ret=elem.value;return typeof ret==="string"?ret.replace(rreturn,""):ret==null?"":ret}return}isFunction=jQuery.isFunction(value);
return this.each(function(i){var val;if(this.nodeType!==1){return}if(isFunction){val=value.call(this,i,jQuery(this).val())}else{val=value}if(val==null){val=""}else if(typeof val==="number"){val+=""}else if(jQuery.isArray(val)){val=jQuery.map(val,function(value){return value==null?"":value+""})}hooks=jQuery.valHooks[this.type]||jQuery.valHooks[this.nodeName.toLowerCase()];if(!hooks||!("set"in hooks)||hooks.set(this,val,"value")===undefined){this.value=val}})}});jQuery.extend({valHooks:{option:{get:function(elem){var val=elem.attributes.value;return!val||val.specified?elem.value:elem.text}},select:{get:function(elem){var value,option,options=elem.options,index=elem.selectedIndex,one=elem.type==="select-one"||index<0,values=one?null:[],max=one?index+1:options.length,i=index<0?max:one?index:0;for(;i<max;i++){option=options[i];if((option.selected||i===index)&&(jQuery.support.optDisabled?!option.disabled:option.getAttribute("disabled")===null)&&(!option.parentNode.disabled||!jQuery.nodeName(option.parentNode,"optgroup"))){value=jQuery(option).val();if(one){return value}values.push(value)}}return values},set:function(elem,value){var optionSet,option,options=elem.options,values=jQuery.makeArray(value),i=options.length;while(i--){option=options[i];if(option.selected=jQuery.inArray(jQuery(option).val(),values)>=0){optionSet=true}}if(!optionSet){elem.selectedIndex=-1}return values}}},attr:function(elem,name,value){var hooks,ret,nType=elem.nodeType;if(!elem||nType===3||nType===8||nType===2){return}if(typeof elem.getAttribute===core_strundefined){return jQuery.prop(elem,name,value)}if(nType!==1||!jQuery.isXMLDoc(elem)){name=name.toLowerCase();hooks=jQuery.attrHooks[name]||(jQuery.expr.match.bool.test(name)?boolHook:nodeHook)}if(value!==undefined){if(value===null){jQuery.removeAttr(elem,name)}else if(hooks&&"set"in hooks&&(ret=hooks.set(elem,value,name))!==undefined){return ret}else{elem.setAttribute(name,value+"");return value}}else if(hooks&&"get"in hooks&&(ret=hooks.get(elem,name))!==null){return ret}else{ret=jQuery.find.attr(elem,name);return ret==null?undefined:ret}},removeAttr:function(elem,value){var name,propName,i=0,attrNames=value&&value.match(core_rnotwhite);if(attrNames&&elem.nodeType===1){while(name=attrNames[i++]){propName=jQuery.propFix[name]||name;if(jQuery.expr.match.bool.test(name)){elem[propName]=false}elem.removeAttribute(name)}}},attrHooks:{type:{set:function(elem,value){if(!jQuery.support.radioValue&&value==="radio"&&jQuery.nodeName(elem,"input")){var val=elem.value;elem.setAttribute("type",value);if(val){elem.value=val}return value}}}},propFix:{"for":"htmlFor","class":"className"},prop:function(elem,name,value){var ret,hooks,notxml,nType=elem.nodeType;if(!elem||nType===3||nType===8||nType===2){return}notxml=nType!==1||!jQuery.isXMLDoc(elem);if(notxml){name=jQuery.propFix[name]||name;hooks=jQuery.propHooks[name]}if(value!==undefined){return hooks&&"set"in hooks&&(ret=hooks.set(elem,value,name))!==undefined?ret:elem[name]=value}else{return hooks&&"get"in hooks&&(ret=hooks.get(elem,name))!==null?ret:elem[name]}},propHooks:{tabIndex:{get:function(elem){return elem.hasAttribute("tabindex")||rfocusable.test(elem.nodeName)||elem.href?elem.tabIndex:-1}}}});boolHook={set:function(elem,value,name){if(value===false){jQuery.removeAttr(elem,name)}else{elem.setAttribute(name,name)}return name}};jQuery.each(jQuery.expr.match.bool.source.match(/\w+/g),function(i,name){var getter=jQuery.expr.attrHandle[name]||jQuery.find.attr;jQuery.expr.attrHandle[name]=function(elem,name,isXML){var fn=jQuery.expr.attrHandle[name],ret=isXML?undefined:(jQuery.expr.attrHandle[name]=undefined)!=getter(elem,name,isXML)?name.toLowerCase():null;jQuery.expr.attrHandle[name]=fn;return ret}});if(!jQuery.support.optSelected){jQuery.propHooks.selected={get:function(elem){var parent=elem.parentNode;if(parent&&parent.parentNode){parent.parentNode.selectedIndex}return null}}}jQuery.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){jQuery.propFix[this.toLowerCase()]=this});jQuery.each(["radio","checkbox"],function(){jQuery.valHooks[this]={set:function(elem,value){if(jQuery.isArray(value)){return elem.checked=jQuery.inArray(jQuery(elem).val(),value)>=0}}};if(!jQuery.support.checkOn){jQuery.valHooks[this].get=function(elem){return elem.getAttribute("value")===null?"on":elem.value}}});var rkeyEvent=/^key/,rmouseEvent=/^(?:mouse|contextmenu)|click/,rfocusMorph=/^(?:focusinfocus|focusoutblur)$/,rtypenamespace=/^([^.]*)(?:\.(.+)|)$/;function returnTrue(){return true}function returnFalse(){return false}function safeActiveElement(){try{return document.activeElement}catch(err){}}jQuery.event={global:{},add:function(elem,types,handler,data,selector){var handleObjIn,eventHandle,tmp,events,t,handleObj,special,handlers,type,namespaces,origType,elemData=data_priv.get(elem);if(!elemData){return}if(handler.handler){handleObjIn=handler;handler=handleObjIn.handler;selector=handleObjIn.selector}if(!handler.guid){handler.guid=jQuery.guid++}if(!(events=elemData.events)){events=elemData.events={}}if(!(eventHandle=elemData.handle)){eventHandle=elemData.handle=function(e){return typeof jQuery!==core_strundefined&&(!e||jQuery.event.triggered!==e.type)?jQuery.event.dispatch.apply(eventHandle.elem,arguments):undefined};eventHandle.elem=elem}types=(types||"").match(core_rnotwhite)||[""];t=types.length;while(t--){tmp=rtypenamespace.exec(types[t])||[];type=origType=tmp[1];namespaces=(tmp[2]||"").split(".").sort();if(!type){continue}special=jQuery.event.special[type]||{};type=(selector?special.delegateType:special.bindType)||type;special=jQuery.event.special[type]||{};handleObj=jQuery.extend({type:type,origType:origType,data:data,handler:handler,guid:handler.guid,selector:selector,needsContext:selector&&jQuery.expr.match.needsContext.test(selector),namespace:namespaces.join(".")},handleObjIn);if(!(handlers=events[type])){handlers=events[type]=[];handlers.delegateCount=0;if(!special.setup||special.setup.call(elem,data,namespaces,eventHandle)===false){if(elem.addEventListener){elem.addEventListener(type,eventHandle,false)}}}if(special.add){special.add.call(elem,handleObj);if(!handleObj.handler.guid){handleObj.handler.guid=handler.guid}}if(selector){handlers.splice(handlers.delegateCount++,0,handleObj)}else{handlers.push(handleObj)}jQuery.event.global[type]=true}elem=null},remove:function(elem,types,handler,selector,mappedTypes){var j,origCount,tmp,events,t,handleObj,special,handlers,type,namespaces,origType,elemData=data_priv.hasData(elem)&&data_priv.get(elem);if(!elemData||!(events=elemData.events)){return}types=(types||"").match(core_rnotwhite)||[""];t=types.length;while(t--){tmp=rtypenamespace.exec(types[t])||[];type=origType=tmp[1];namespaces=(tmp[2]||"").split(".").sort();if(!type){for(type in events){jQuery.event.remove(elem,type+types[t],handler,selector,true)}continue}special=jQuery.event.special[type]||{};type=(selector?special.delegateType:special.bindType)||type;handlers=events[type]||[];tmp=tmp[2]&&new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)");origCount=j=handlers.length;while(j--){handleObj=handlers[j];if((mappedTypes||origType===handleObj.origType)&&(!handler||handler.guid===handleObj.guid)&&(!tmp||tmp.test(handleObj.namespace))&&(!selector||selector===handleObj.selector||selector==="**"&&handleObj.selector)){handlers.splice(j,1);if(handleObj.selector){handlers.delegateCount--}if(special.remove){special.remove.call(elem,handleObj)}}}if(origCount&&!handlers.length){if(!special.teardown||special.teardown.call(elem,namespaces,elemData.handle)===false){jQuery.removeEvent(elem,type,elemData.handle)}delete events[type]}}if(jQuery.isEmptyObject(events)){delete elemData.handle;data_priv.remove(elem,"events")}},trigger:function(event,data,elem,onlyHandlers){var i,cur,tmp,bubbleType,ontype,handle,special,eventPath=[elem||document],type=core_hasOwn.call(event,"type")?event.type:event,namespaces=core_hasOwn.call(event,"namespace")?event.namespace.split("."):[];cur=tmp=elem=elem||document;if(elem.nodeType===3||elem.nodeType===8){return}if(rfocusMorph.test(type+jQuery.event.triggered)){return}if(type.indexOf(".")>=0){namespaces=type.split(".");type=namespaces.shift();namespaces.sort()}ontype=type.indexOf(":")<0&&"on"+type;event=event[jQuery.expando]?event:new jQuery.Event(type,typeof event==="object"&&event);event.isTrigger=onlyHandlers?2:3;event.namespace=namespaces.join(".");event.namespace_re=event.namespace?new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)"):null;event.result=undefined;if(!event.target){event.target=elem}data=data==null?[event]:jQuery.makeArray(data,[event]);special=jQuery.event.special[type]||{};if(!onlyHandlers&&special.trigger&&special.trigger.apply(elem,data)===false){return}if(!onlyHandlers&&!special.noBubble&&!jQuery.isWindow(elem)){bubbleType=special.delegateType||type;if(!rfocusMorph.test(bubbleType+type)){cur=cur.parentNode}for(;cur;cur=cur.parentNode){eventPath.push(cur);tmp=cur}if(tmp===(elem.ownerDocument||document)){eventPath.push(tmp.defaultView||tmp.parentWindow||window)}}i=0;while((cur=eventPath[i++])&&!event.isPropagationStopped()){event.type=i>1?bubbleType:special.bindType||type;handle=(data_priv.get(cur,"events")||{})[event.type]&&data_priv.get(cur,"handle");if(handle){handle.apply(cur,data)}handle=ontype&&cur[ontype];if(handle&&jQuery.acceptData(cur)&&handle.apply&&handle.apply(cur,data)===false){event.preventDefault()}}event.type=type;if(!onlyHandlers&&!event.isDefaultPrevented()){if((!special._default||special._default.apply(eventPath.pop(),data)===false)&&jQuery.acceptData(elem)){if(ontype&&jQuery.isFunction(elem[type])&&!jQuery.isWindow(elem)){tmp=elem[ontype];if(tmp){elem[ontype]=null}jQuery.event.triggered=type;elem[type]();jQuery.event.triggered=undefined;if(tmp){elem[ontype]=tmp}}}}return event.result},dispatch:function(event){event=jQuery.event.fix(event);var i,j,ret,matched,handleObj,handlerQueue=[],args=core_slice.call(arguments),handlers=(data_priv.get(this,"events")||{})[event.type]||[],special=jQuery.event.special[event.type]||{};args[0]=event;event.delegateTarget=this;if(special.preDispatch&&special.preDispatch.call(this,event)===false){return}handlerQueue=jQuery.event.handlers.call(this,event,handlers);i=0;while((matched=handlerQueue[i++])&&!event.isPropagationStopped()){event.currentTarget=matched.elem;j=0;while((handleObj=matched.handlers[j++])&&!event.isImmediatePropagationStopped()){if(!event.namespace_re||event.namespace_re.test(handleObj.namespace)){event.handleObj=handleObj;event.data=handleObj.data;ret=((jQuery.event.special[handleObj.origType]||{}).handle||handleObj.handler).apply(matched.elem,args);if(ret!==undefined){if((event.result=ret)===false){event.preventDefault();event.stopPropagation()}}}}}if(special.postDispatch){special.postDispatch.call(this,event)}return event.result},handlers:function(event,handlers){var i,matches,sel,handleObj,handlerQueue=[],delegateCount=handlers.delegateCount,cur=event.target;if(delegateCount&&cur.nodeType&&(!event.button||event.type!=="click")){for(;cur!==this;cur=cur.parentNode||this){if(cur.disabled!==true||event.type!=="click"){matches=[];for(i=0;i<delegateCount;i++){handleObj=handlers[i];sel=handleObj.selector+" ";if(matches[sel]===undefined){matches[sel]=handleObj.needsContext?jQuery(sel,this).index(cur)>=0:jQuery.find(sel,this,null,[cur]).length}if(matches[sel]){matches.push(handleObj)}}if(matches.length){handlerQueue.push({elem:cur,handlers:matches})}}}}if(delegateCount<handlers.length){handlerQueue.push({elem:this,handlers:handlers.slice(delegateCount)})}return handlerQueue},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(event,original){if(event.which==null){event.which=original.charCode!=null?original.charCode:original.keyCode}return event}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(event,original){var eventDoc,doc,body,button=original.button;if(event.pageX==null&&original.clientX!=null){eventDoc=event.target.ownerDocument||document;doc=eventDoc.documentElement;body=eventDoc.body;event.pageX=original.clientX+(doc&&doc.scrollLeft||body&&body.scrollLeft||0)-(doc&&doc.clientLeft||body&&body.clientLeft||0);event.pageY=original.clientY+(doc&&doc.scrollTop||body&&body.scrollTop||0)-(doc&&doc.clientTop||body&&body.clientTop||0)}if(!event.which&&button!==undefined){event.which=button&1?1:button&2?3:button&4?2:0}return event}},fix:function(event){if(event[jQuery.expando]){return event}var i,prop,copy,type=event.type,originalEvent=event,fixHook=this.fixHooks[type];if(!fixHook){this.fixHooks[type]=fixHook=rmouseEvent.test(type)?this.mouseHooks:rkeyEvent.test(type)?this.keyHooks:{}}copy=fixHook.props?this.props.concat(fixHook.props):this.props;event=new jQuery.Event(originalEvent);i=copy.length;while(i--){prop=copy[i];event[prop]=originalEvent[prop]}if(!event.target){event.target=document}if(event.target.nodeType===3){event.target=event.target.parentNode}return fixHook.filter?fixHook.filter(event,originalEvent):event},special:{load:{noBubble:true},focus:{trigger:function(){if(this!==safeActiveElement()&&this.focus){this.focus();return false}},delegateType:"focusin"},blur:{trigger:function(){if(this===safeActiveElement()&&this.blur){this.blur();return false}},delegateType:"focusout"},click:{trigger:function(){if(this.type==="checkbox"&&this.click&&jQuery.nodeName(this,"input")){this.click();return false}},_default:function(event){return jQuery.nodeName(event.target,"a")}},beforeunload:{postDispatch:function(event){if(event.result!==undefined){event.originalEvent.returnValue=event.result}}}},simulate:function(type,elem,event,bubble){var e=jQuery.extend(new jQuery.Event,event,{type:type,isSimulated:true,originalEvent:{}});if(bubble){jQuery.event.trigger(e,null,elem)}else{jQuery.event.dispatch.call(elem,e)}if(e.isDefaultPrevented()){event.preventDefault()}}};jQuery.removeEvent=function(elem,type,handle){if(elem.removeEventListener){elem.removeEventListener(type,handle,false)}};jQuery.Event=function(src,props){if(!(this instanceof jQuery.Event)){return new jQuery.Event(src,props)}if(src&&src.type){this.originalEvent=src;this.type=src.type;this.isDefaultPrevented=src.defaultPrevented||src.getPreventDefault&&src.getPreventDefault()?returnTrue:returnFalse}else{this.type=src}if(props){jQuery.extend(this,props)}this.timeStamp=src&&src.timeStamp||jQuery.now();this[jQuery.expando]=true};jQuery.Event.prototype={isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=returnTrue;if(e&&e.preventDefault){e.preventDefault()}},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=returnTrue;if(e&&e.stopPropagation){e.stopPropagation()}},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=returnTrue;this.stopPropagation()}};jQuery.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(orig,fix){jQuery.event.special[orig]={delegateType:fix,bindType:fix,handle:function(event){var ret,target=this,related=event.relatedTarget,handleObj=event.handleObj;if(!related||related!==target&&!jQuery.contains(target,related)){event.type=handleObj.origType;ret=handleObj.handler.apply(this,arguments);event.type=fix}return ret}}});if(!jQuery.support.focusinBubbles){jQuery.each({focus:"focusin",blur:"focusout"},function(orig,fix){var attaches=0,handler=function(event){jQuery.event.simulate(fix,event.target,jQuery.event.fix(event),true)};jQuery.event.special[fix]={setup:function(){if(attaches++===0){document.addEventListener(orig,handler,true)}},teardown:function(){if(--attaches===0){document.removeEventListener(orig,handler,true)}}}})}jQuery.fn.extend({on:function(types,selector,data,fn,one){var origFn,type;if(typeof types==="object"){if(typeof selector!=="string"){data=data||selector;selector=undefined}for(type in types){this.on(type,selector,data,types[type],one)}return this}if(data==null&&fn==null){fn=selector;data=selector=undefined}else if(fn==null){if(typeof selector==="string"){fn=data;data=undefined}else{fn=data;data=selector;selector=undefined}}if(fn===false){fn=returnFalse}else if(!fn){return this}if(one===1){origFn=fn;fn=function(event){jQuery().off(event);return origFn.apply(this,arguments)};fn.guid=origFn.guid||(origFn.guid=jQuery.guid++)}return this.each(function(){jQuery.event.add(this,types,fn,data,selector)})},one:function(types,selector,data,fn){return this.on(types,selector,data,fn,1)},off:function(types,selector,fn){var handleObj,type;if(types&&types.preventDefault&&types.handleObj){handleObj=types.handleObj;jQuery(types.delegateTarget).off(handleObj.namespace?handleObj.origType+"."+handleObj.namespace:handleObj.origType,handleObj.selector,handleObj.handler);return this}if(typeof types==="object"){for(type in types){this.off(type,selector,types[type])}return this}if(selector===false||typeof selector==="function"){fn=selector;selector=undefined}if(fn===false){fn=returnFalse}return this.each(function(){jQuery.event.remove(this,types,fn,selector)})},trigger:function(type,data){return this.each(function(){jQuery.event.trigger(type,data,this)})},triggerHandler:function(type,data){var elem=this[0];if(elem){return jQuery.event.trigger(type,data,elem,true)}}});var isSimple=/^.[^:#\[\.,]*$/,rparentsprev=/^(?:parents|prev(?:Until|All))/,rneedsContext=jQuery.expr.match.needsContext,guaranteedUnique={children:true,contents:true,next:true,prev:true};jQuery.fn.extend({find:function(selector){var i,ret=[],self=this,len=self.length;if(typeof selector!=="string"){return this.pushStack(jQuery(selector).filter(function(){for(i=0;i<len;i++){if(jQuery.contains(self[i],this)){return true}}}))}for(i=0;i<len;i++){jQuery.find(selector,self[i],ret)}ret=this.pushStack(len>1?jQuery.unique(ret):ret);ret.selector=this.selector?this.selector+" "+selector:selector;return ret},has:function(target){var targets=jQuery(target,this),l=targets.length;return this.filter(function(){var i=0;for(;i<l;i++){if(jQuery.contains(this,targets[i])){return true}}})},not:function(selector){return this.pushStack(winnow(this,selector||[],true))},filter:function(selector){return this.pushStack(winnow(this,selector||[],false))},is:function(selector){return!!winnow(this,typeof selector==="string"&&rneedsContext.test(selector)?jQuery(selector):selector||[],false).length},closest:function(selectors,context){var cur,i=0,l=this.length,matched=[],pos=rneedsContext.test(selectors)||typeof selectors!=="string"?jQuery(selectors,context||this.context):0;for(;i<l;i++){for(cur=this[i];cur&&cur!==context;cur=cur.parentNode){if(cur.nodeType<11&&(pos?pos.index(cur)>-1:cur.nodeType===1&&jQuery.find.matchesSelector(cur,selectors))){cur=matched.push(cur);break}}}return this.pushStack(matched.length>1?jQuery.unique(matched):matched)},index:function(elem){if(!elem){return this[0]&&this[0].parentNode?this.first().prevAll().length:-1}if(typeof elem==="string"){return core_indexOf.call(jQuery(elem),this[0])}return core_indexOf.call(this,elem.jquery?elem[0]:elem)},add:function(selector,context){var set=typeof selector==="string"?jQuery(selector,context):jQuery.makeArray(selector&&selector.nodeType?[selector]:selector),all=jQuery.merge(this.get(),set);return this.pushStack(jQuery.unique(all))},addBack:function(selector){return this.add(selector==null?this.prevObject:this.prevObject.filter(selector))}});function sibling(cur,dir){while((cur=cur[dir])&&cur.nodeType!==1){}return cur}jQuery.each({parent:function(elem){var parent=elem.parentNode;return parent&&parent.nodeType!==11?parent:null},parents:function(elem){return jQuery.dir(elem,"parentNode")},parentsUntil:function(elem,i,until){return jQuery.dir(elem,"parentNode",until)},next:function(elem){return sibling(elem,"nextSibling")},prev:function(elem){return sibling(elem,"previousSibling")},nextAll:function(elem){return jQuery.dir(elem,"nextSibling")},prevAll:function(elem){return jQuery.dir(elem,"previousSibling")},nextUntil:function(elem,i,until){return jQuery.dir(elem,"nextSibling",until)},prevUntil:function(elem,i,until){return jQuery.dir(elem,"previousSibling",until)},siblings:function(elem){return jQuery.sibling((elem.parentNode||{}).firstChild,elem)},children:function(elem){return jQuery.sibling(elem.firstChild)},contents:function(elem){return elem.contentDocument||jQuery.merge([],elem.childNodes)}},function(name,fn){jQuery.fn[name]=function(until,selector){var matched=jQuery.map(this,fn,until);if(name.slice(-5)!=="Until"){selector=until}if(selector&&typeof selector==="string"){matched=jQuery.filter(selector,matched)}if(this.length>1){if(!guaranteedUnique[name]){jQuery.unique(matched)}if(rparentsprev.test(name)){matched.reverse()}}return this.pushStack(matched)}});jQuery.extend({filter:function(expr,elems,not){var elem=elems[0];if(not){expr=":not("+expr+")"}return elems.length===1&&elem.nodeType===1?jQuery.find.matchesSelector(elem,expr)?[elem]:[]:jQuery.find.matches(expr,jQuery.grep(elems,function(elem){return elem.nodeType===1}))},dir:function(elem,dir,until){var matched=[],truncate=until!==undefined;while((elem=elem[dir])&&elem.nodeType!==9){if(elem.nodeType===1){if(truncate&&jQuery(elem).is(until)){break}matched.push(elem)}}return matched},sibling:function(n,elem){var matched=[];for(;n;n=n.nextSibling){if(n.nodeType===1&&n!==elem){matched.push(n)}}return matched}});function winnow(elements,qualifier,not){if(jQuery.isFunction(qualifier)){return jQuery.grep(elements,function(elem,i){return!!qualifier.call(elem,i,elem)!==not})}if(qualifier.nodeType){return jQuery.grep(elements,function(elem){return elem===qualifier!==not})}if(typeof qualifier==="string"){if(isSimple.test(qualifier)){return jQuery.filter(qualifier,elements,not)}qualifier=jQuery.filter(qualifier,elements)}return jQuery.grep(elements,function(elem){return core_indexOf.call(qualifier,elem)>=0!==not})}var rxhtmlTag=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,rtagName=/<([\w:]+)/,rhtml=/<|&#?\w+;/,rnoInnerhtml=/<(?:script|style|link)/i,manipulation_rcheckableType=/^(?:checkbox|radio)$/i,rchecked=/checked\s*(?:[^=]|=\s*.checked.)/i,rscriptType=/^$|\/(?:java|ecma)script/i,rscriptTypeMasked=/^true\/(.*)/,rcleanScript=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,wrapMap={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};wrapMap.optgroup=wrapMap.option;wrapMap.tbody=wrapMap.tfoot=wrapMap.colgroup=wrapMap.caption=wrapMap.thead;wrapMap.th=wrapMap.td;jQuery.fn.extend({text:function(value){return jQuery.access(this,function(value){return value===undefined?jQuery.text(this):this.empty().append((this[0]&&this[0].ownerDocument||document).createTextNode(value))},null,value,arguments.length)},append:function(){return this.domManip(arguments,function(elem){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var target=manipulationTarget(this,elem);target.appendChild(elem)}})},prepend:function(){return this.domManip(arguments,function(elem){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var target=manipulationTarget(this,elem);target.insertBefore(elem,target.firstChild)}})},before:function(){return this.domManip(arguments,function(elem){if(this.parentNode){this.parentNode.insertBefore(elem,this)}})},after:function(){return this.domManip(arguments,function(elem){if(this.parentNode){this.parentNode.insertBefore(elem,this.nextSibling)}})},remove:function(selector,keepData){var elem,elems=selector?jQuery.filter(selector,this):this,i=0;for(;(elem=elems[i])!=null;i++){if(!keepData&&elem.nodeType===1){jQuery.cleanData(getAll(elem))}if(elem.parentNode){if(keepData&&jQuery.contains(elem.ownerDocument,elem)){setGlobalEval(getAll(elem,"script"))}elem.parentNode.removeChild(elem)}}return this},empty:function(){var elem,i=0;for(;(elem=this[i])!=null;i++){if(elem.nodeType===1){jQuery.cleanData(getAll(elem,false));elem.textContent=""}}return this},clone:function(dataAndEvents,deepDataAndEvents){dataAndEvents=dataAndEvents==null?false:dataAndEvents;deepDataAndEvents=deepDataAndEvents==null?dataAndEvents:deepDataAndEvents;return this.map(function(){return jQuery.clone(this,dataAndEvents,deepDataAndEvents)})},html:function(value){return jQuery.access(this,function(value){var elem=this[0]||{},i=0,l=this.length;if(value===undefined&&elem.nodeType===1){return elem.innerHTML}if(typeof value==="string"&&!rnoInnerhtml.test(value)&&!wrapMap[(rtagName.exec(value)||["",""])[1].toLowerCase()]){value=value.replace(rxhtmlTag,"<$1></$2>");try{for(;i<l;i++){elem=this[i]||{};if(elem.nodeType===1){jQuery.cleanData(getAll(elem,false));elem.innerHTML=value}}elem=0}catch(e){}}if(elem){this.empty().append(value)}},null,value,arguments.length)},replaceWith:function(){var args=jQuery.map(this,function(elem){return[elem.nextSibling,elem.parentNode]}),i=0;this.domManip(arguments,function(elem){var next=args[i++],parent=args[i++];if(parent){if(next&&next.parentNode!==parent){next=this.nextSibling}jQuery(this).remove();parent.insertBefore(elem,next)}},true);return i?this:this.remove()},detach:function(selector){return this.remove(selector,true)},domManip:function(args,callback,allowIntersection){args=core_concat.apply([],args);var fragment,first,scripts,hasScripts,node,doc,i=0,l=this.length,set=this,iNoClone=l-1,value=args[0],isFunction=jQuery.isFunction(value);if(isFunction||!(l<=1||typeof value!=="string"||jQuery.support.checkClone||!rchecked.test(value))){return this.each(function(index){var self=set.eq(index);if(isFunction){args[0]=value.call(this,index,self.html())}self.domManip(args,callback,allowIntersection)})}if(l){fragment=jQuery.buildFragment(args,this[0].ownerDocument,false,!allowIntersection&&this);first=fragment.firstChild;if(fragment.childNodes.length===1){fragment=first}if(first){scripts=jQuery.map(getAll(fragment,"script"),disableScript);hasScripts=scripts.length;for(;i<l;i++){node=fragment;if(i!==iNoClone){node=jQuery.clone(node,true,true);if(hasScripts){jQuery.merge(scripts,getAll(node,"script"))}}callback.call(this[i],node,i)}if(hasScripts){doc=scripts[scripts.length-1].ownerDocument;jQuery.map(scripts,restoreScript);for(i=0;i<hasScripts;i++){node=scripts[i];if(rscriptType.test(node.type||"")&&!data_priv.access(node,"globalEval")&&jQuery.contains(doc,node)){if(node.src){jQuery._evalUrl(node.src)}else{jQuery.globalEval(node.textContent.replace(rcleanScript,""))}}}}}}return this}});jQuery.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(name,original){jQuery.fn[name]=function(selector){var elems,ret=[],insert=jQuery(selector),last=insert.length-1,i=0;for(;i<=last;i++){elems=i===last?this:this.clone(true);jQuery(insert[i])[original](elems);core_push.apply(ret,elems.get())}return this.pushStack(ret)}});jQuery.extend({clone:function(elem,dataAndEvents,deepDataAndEvents){var i,l,srcElements,destElements,clone=elem.cloneNode(true),inPage=jQuery.contains(elem.ownerDocument,elem);if(!jQuery.support.noCloneChecked&&(elem.nodeType===1||elem.nodeType===11)&&!jQuery.isXMLDoc(elem)){destElements=getAll(clone);srcElements=getAll(elem);for(i=0,l=srcElements.length;i<l;i++){fixInput(srcElements[i],destElements[i])}}if(dataAndEvents){if(deepDataAndEvents){srcElements=srcElements||getAll(elem);destElements=destElements||getAll(clone);for(i=0,l=srcElements.length;i<l;i++){cloneCopyEvent(srcElements[i],destElements[i])}}else{cloneCopyEvent(elem,clone)}}destElements=getAll(clone,"script");if(destElements.length>0){setGlobalEval(destElements,!inPage&&getAll(elem,"script"))}return clone},buildFragment:function(elems,context,scripts,selection){var elem,tmp,tag,wrap,contains,j,i=0,l=elems.length,fragment=context.createDocumentFragment(),nodes=[];for(;i<l;i++){elem=elems[i];if(elem||elem===0){if(jQuery.type(elem)==="object"){jQuery.merge(nodes,elem.nodeType?[elem]:elem)}else if(!rhtml.test(elem)){nodes.push(context.createTextNode(elem))}else{tmp=tmp||fragment.appendChild(context.createElement("div"));tag=(rtagName.exec(elem)||["",""])[1].toLowerCase();wrap=wrapMap[tag]||wrapMap._default;tmp.innerHTML=wrap[1]+elem.replace(rxhtmlTag,"<$1></$2>")+wrap[2];j=wrap[0];while(j--){tmp=tmp.lastChild}jQuery.merge(nodes,tmp.childNodes);tmp=fragment.firstChild;tmp.textContent=""}}}fragment.textContent="";i=0;while(elem=nodes[i++]){if(selection&&jQuery.inArray(elem,selection)!==-1){continue}contains=jQuery.contains(elem.ownerDocument,elem);tmp=getAll(fragment.appendChild(elem),"script");if(contains){setGlobalEval(tmp)}if(scripts){j=0;while(elem=tmp[j++]){if(rscriptType.test(elem.type||"")){scripts.push(elem)}}}}return fragment},cleanData:function(elems){var data,elem,events,type,key,j,special=jQuery.event.special,i=0;for(;(elem=elems[i])!==undefined;i++){if(Data.accepts(elem)){key=elem[data_priv.expando];if(key&&(data=data_priv.cache[key])){events=Object.keys(data.events||{});if(events.length){for(j=0;(type=events[j])!==undefined;j++){if(special[type]){jQuery.event.remove(elem,type)}else{jQuery.removeEvent(elem,type,data.handle)}}}if(data_priv.cache[key]){delete data_priv.cache[key]}}}delete data_user.cache[elem[data_user.expando]]}},_evalUrl:function(url){return jQuery.ajax({url:url,type:"GET",dataType:"script",async:false,global:false,"throws":true})}});function manipulationTarget(elem,content){return jQuery.nodeName(elem,"table")&&jQuery.nodeName(content.nodeType===1?content:content.firstChild,"tr")?elem.getElementsByTagName("tbody")[0]||elem.appendChild(elem.ownerDocument.createElement("tbody")):elem}function disableScript(elem){elem.type=(elem.getAttribute("type")!==null)+"/"+elem.type;return elem}function restoreScript(elem){var match=rscriptTypeMasked.exec(elem.type);if(match){elem.type=match[1]}else{elem.removeAttribute("type")}return elem}function setGlobalEval(elems,refElements){var l=elems.length,i=0;for(;i<l;i++){data_priv.set(elems[i],"globalEval",!refElements||data_priv.get(refElements[i],"globalEval"))}}function cloneCopyEvent(src,dest){var i,l,type,pdataOld,pdataCur,udataOld,udataCur,events;if(dest.nodeType!==1){return}if(data_priv.hasData(src)){pdataOld=data_priv.access(src);pdataCur=data_priv.set(dest,pdataOld);events=pdataOld.events;if(events){delete pdataCur.handle;pdataCur.events={};for(type in events){for(i=0,l=events[type].length;i<l;i++){jQuery.event.add(dest,type,events[type][i])}}}}if(data_user.hasData(src)){udataOld=data_user.access(src);udataCur=jQuery.extend({},udataOld);data_user.set(dest,udataCur)}}function getAll(context,tag){var ret=context.getElementsByTagName?context.getElementsByTagName(tag||"*"):context.querySelectorAll?context.querySelectorAll(tag||"*"):[];return tag===undefined||tag&&jQuery.nodeName(context,tag)?jQuery.merge([context],ret):ret}function fixInput(src,dest){var nodeName=dest.nodeName.toLowerCase();if(nodeName==="input"&&manipulation_rcheckableType.test(src.type)){dest.checked=src.checked}else if(nodeName==="input"||nodeName==="textarea"){dest.defaultValue=src.defaultValue}}jQuery.fn.extend({wrapAll:function(html){var wrap;if(jQuery.isFunction(html)){return this.each(function(i){jQuery(this).wrapAll(html.call(this,i))})}if(this[0]){wrap=jQuery(html,this[0].ownerDocument).eq(0).clone(true);if(this[0].parentNode){wrap.insertBefore(this[0])}wrap.map(function(){var elem=this;while(elem.firstElementChild){elem=elem.firstElementChild}return elem}).append(this)}return this},wrapInner:function(html){if(jQuery.isFunction(html)){return this.each(function(i){jQuery(this).wrapInner(html.call(this,i))})}return this.each(function(){var self=jQuery(this),contents=self.contents();if(contents.length){contents.wrapAll(html);
}else{self.append(html)}})},wrap:function(html){var isFunction=jQuery.isFunction(html);return this.each(function(i){jQuery(this).wrapAll(isFunction?html.call(this,i):html)})},unwrap:function(){return this.parent().each(function(){if(!jQuery.nodeName(this,"body")){jQuery(this).replaceWith(this.childNodes)}}).end()}});var curCSS,iframe,rdisplayswap=/^(none|table(?!-c[ea]).+)/,rmargin=/^margin/,rnumsplit=new RegExp("^("+core_pnum+")(.*)$","i"),rnumnonpx=new RegExp("^("+core_pnum+")(?!px)[a-z%]+$","i"),rrelNum=new RegExp("^([+-])=("+core_pnum+")","i"),elemdisplay={BODY:"block"},cssShow={position:"absolute",visibility:"hidden",display:"block"},cssNormalTransform={letterSpacing:0,fontWeight:400},cssExpand=["Top","Right","Bottom","Left"],cssPrefixes=["Webkit","O","Moz","ms"];function vendorPropName(style,name){if(name in style){return name}var capName=name.charAt(0).toUpperCase()+name.slice(1),origName=name,i=cssPrefixes.length;while(i--){name=cssPrefixes[i]+capName;if(name in style){return name}}return origName}function isHidden(elem,el){elem=el||elem;return jQuery.css(elem,"display")==="none"||!jQuery.contains(elem.ownerDocument,elem)}function getStyles(elem){return window.getComputedStyle(elem,null)}function showHide(elements,show){var display,elem,hidden,values=[],index=0,length=elements.length;for(;index<length;index++){elem=elements[index];if(!elem.style){continue}values[index]=data_priv.get(elem,"olddisplay");display=elem.style.display;if(show){if(!values[index]&&display==="none"){elem.style.display=""}if(elem.style.display===""&&isHidden(elem)){values[index]=data_priv.access(elem,"olddisplay",css_defaultDisplay(elem.nodeName))}}else{if(!values[index]){hidden=isHidden(elem);if(display&&display!=="none"||!hidden){data_priv.set(elem,"olddisplay",hidden?display:jQuery.css(elem,"display"))}}}}for(index=0;index<length;index++){elem=elements[index];if(!elem.style){continue}if(!show||elem.style.display==="none"||elem.style.display===""){elem.style.display=show?values[index]||"":"none"}}return elements}jQuery.fn.extend({css:function(name,value){return jQuery.access(this,function(elem,name,value){var styles,len,map={},i=0;if(jQuery.isArray(name)){styles=getStyles(elem);len=name.length;for(;i<len;i++){map[name[i]]=jQuery.css(elem,name[i],false,styles)}return map}return value!==undefined?jQuery.style(elem,name,value):jQuery.css(elem,name)},name,value,arguments.length>1)},show:function(){return showHide(this,true)},hide:function(){return showHide(this)},toggle:function(state){if(typeof state==="boolean"){return state?this.show():this.hide()}return this.each(function(){if(isHidden(this)){jQuery(this).show()}else{jQuery(this).hide()}})}});jQuery.extend({cssHooks:{opacity:{get:function(elem,computed){if(computed){var ret=curCSS(elem,"opacity");return ret===""?"1":ret}}}},cssNumber:{columnCount:true,fillOpacity:true,fontWeight:true,lineHeight:true,opacity:true,order:true,orphans:true,widows:true,zIndex:true,zoom:true},cssProps:{"float":"cssFloat"},style:function(elem,name,value,extra){if(!elem||elem.nodeType===3||elem.nodeType===8||!elem.style){return}var ret,type,hooks,origName=jQuery.camelCase(name),style=elem.style;name=jQuery.cssProps[origName]||(jQuery.cssProps[origName]=vendorPropName(style,origName));hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName];if(value!==undefined){type=typeof value;if(type==="string"&&(ret=rrelNum.exec(value))){value=(ret[1]+1)*ret[2]+parseFloat(jQuery.css(elem,name));type="number"}if(value==null||type==="number"&&isNaN(value)){return}if(type==="number"&&!jQuery.cssNumber[origName]){value+="px"}if(!jQuery.support.clearCloneStyle&&value===""&&name.indexOf("background")===0){style[name]="inherit"}if(!hooks||!("set"in hooks)||(value=hooks.set(elem,value,extra))!==undefined){style[name]=value}}else{if(hooks&&"get"in hooks&&(ret=hooks.get(elem,false,extra))!==undefined){return ret}return style[name]}},css:function(elem,name,extra,styles){var val,num,hooks,origName=jQuery.camelCase(name);name=jQuery.cssProps[origName]||(jQuery.cssProps[origName]=vendorPropName(elem.style,origName));hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName];if(hooks&&"get"in hooks){val=hooks.get(elem,true,extra)}if(val===undefined){val=curCSS(elem,name,styles)}if(val==="normal"&&name in cssNormalTransform){val=cssNormalTransform[name]}if(extra===""||extra){num=parseFloat(val);return extra===true||jQuery.isNumeric(num)?num||0:val}return val}});curCSS=function(elem,name,_computed){var width,minWidth,maxWidth,computed=_computed||getStyles(elem),ret=computed?computed.getPropertyValue(name)||computed[name]:undefined,style=elem.style;if(computed){if(ret===""&&!jQuery.contains(elem.ownerDocument,elem)){ret=jQuery.style(elem,name)}if(rnumnonpx.test(ret)&&rmargin.test(name)){width=style.width;minWidth=style.minWidth;maxWidth=style.maxWidth;style.minWidth=style.maxWidth=style.width=ret;ret=computed.width;style.width=width;style.minWidth=minWidth;style.maxWidth=maxWidth}}return ret};function setPositiveNumber(elem,value,subtract){var matches=rnumsplit.exec(value);return matches?Math.max(0,matches[1]-(subtract||0))+(matches[2]||"px"):value}function augmentWidthOrHeight(elem,name,extra,isBorderBox,styles){var i=extra===(isBorderBox?"border":"content")?4:name==="width"?1:0,val=0;for(;i<4;i+=2){if(extra==="margin"){val+=jQuery.css(elem,extra+cssExpand[i],true,styles)}if(isBorderBox){if(extra==="content"){val-=jQuery.css(elem,"padding"+cssExpand[i],true,styles)}if(extra!=="margin"){val-=jQuery.css(elem,"border"+cssExpand[i]+"Width",true,styles)}}else{val+=jQuery.css(elem,"padding"+cssExpand[i],true,styles);if(extra!=="padding"){val+=jQuery.css(elem,"border"+cssExpand[i]+"Width",true,styles)}}}return val}function getWidthOrHeight(elem,name,extra){var valueIsBorderBox=true,val=name==="width"?elem.offsetWidth:elem.offsetHeight,styles=getStyles(elem),isBorderBox=jQuery.support.boxSizing&&jQuery.css(elem,"boxSizing",false,styles)==="border-box";if(val<=0||val==null){val=curCSS(elem,name,styles);if(val<0||val==null){val=elem.style[name]}if(rnumnonpx.test(val)){return val}valueIsBorderBox=isBorderBox&&(jQuery.support.boxSizingReliable||val===elem.style[name]);val=parseFloat(val)||0}return val+augmentWidthOrHeight(elem,name,extra||(isBorderBox?"border":"content"),valueIsBorderBox,styles)+"px"}function css_defaultDisplay(nodeName){var doc=document,display=elemdisplay[nodeName];if(!display){display=actualDisplay(nodeName,doc);if(display==="none"||!display){iframe=(iframe||jQuery("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(doc.documentElement);doc=(iframe[0].contentWindow||iframe[0].contentDocument).document;doc.write("<!doctype html><html><body>");doc.close();display=actualDisplay(nodeName,doc);iframe.detach()}elemdisplay[nodeName]=display}return display}function actualDisplay(name,doc){var elem=jQuery(doc.createElement(name)).appendTo(doc.body),display=jQuery.css(elem[0],"display");elem.remove();return display}jQuery.each(["height","width"],function(i,name){jQuery.cssHooks[name]={get:function(elem,computed,extra){if(computed){return elem.offsetWidth===0&&rdisplayswap.test(jQuery.css(elem,"display"))?jQuery.swap(elem,cssShow,function(){return getWidthOrHeight(elem,name,extra)}):getWidthOrHeight(elem,name,extra)}},set:function(elem,value,extra){var styles=extra&&getStyles(elem);return setPositiveNumber(elem,value,extra?augmentWidthOrHeight(elem,name,extra,jQuery.support.boxSizing&&jQuery.css(elem,"boxSizing",false,styles)==="border-box",styles):0)}}});jQuery(function(){if(!jQuery.support.reliableMarginRight){jQuery.cssHooks.marginRight={get:function(elem,computed){if(computed){return jQuery.swap(elem,{display:"inline-block"},curCSS,[elem,"marginRight"])}}}}if(!jQuery.support.pixelPosition&&jQuery.fn.position){jQuery.each(["top","left"],function(i,prop){jQuery.cssHooks[prop]={get:function(elem,computed){if(computed){computed=curCSS(elem,prop);return rnumnonpx.test(computed)?jQuery(elem).position()[prop]+"px":computed}}}})}});if(jQuery.expr&&jQuery.expr.filters){jQuery.expr.filters.hidden=function(elem){return elem.offsetWidth<=0&&elem.offsetHeight<=0};jQuery.expr.filters.visible=function(elem){return!jQuery.expr.filters.hidden(elem)}}jQuery.each({margin:"",padding:"",border:"Width"},function(prefix,suffix){jQuery.cssHooks[prefix+suffix]={expand:function(value){var i=0,expanded={},parts=typeof value==="string"?value.split(" "):[value];for(;i<4;i++){expanded[prefix+cssExpand[i]+suffix]=parts[i]||parts[i-2]||parts[0]}return expanded}};if(!rmargin.test(prefix)){jQuery.cssHooks[prefix+suffix].set=setPositiveNumber}});var r20=/%20/g,rbracket=/\[\]$/,rCRLF=/\r?\n/g,rsubmitterTypes=/^(?:submit|button|image|reset|file)$/i,rsubmittable=/^(?:input|select|textarea|keygen)/i;jQuery.fn.extend({serialize:function(){return jQuery.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var elements=jQuery.prop(this,"elements");return elements?jQuery.makeArray(elements):this}).filter(function(){var type=this.type;return this.name&&!jQuery(this).is(":disabled")&&rsubmittable.test(this.nodeName)&&!rsubmitterTypes.test(type)&&(this.checked||!manipulation_rcheckableType.test(type))}).map(function(i,elem){var val=jQuery(this).val();return val==null?null:jQuery.isArray(val)?jQuery.map(val,function(val){return{name:elem.name,value:val.replace(rCRLF,"\r\n")}}):{name:elem.name,value:val.replace(rCRLF,"\r\n")}}).get()}});jQuery.param=function(a,traditional){var prefix,s=[],add=function(key,value){value=jQuery.isFunction(value)?value():value==null?"":value;s[s.length]=encodeURIComponent(key)+"="+encodeURIComponent(value)};if(traditional===undefined){traditional=jQuery.ajaxSettings&&jQuery.ajaxSettings.traditional}if(jQuery.isArray(a)||a.jquery&&!jQuery.isPlainObject(a)){jQuery.each(a,function(){add(this.name,this.value)})}else{for(prefix in a){buildParams(prefix,a[prefix],traditional,add)}}return s.join("&").replace(r20,"+")};function buildParams(prefix,obj,traditional,add){var name;if(jQuery.isArray(obj)){jQuery.each(obj,function(i,v){if(traditional||rbracket.test(prefix)){add(prefix,v)}else{buildParams(prefix+"["+(typeof v==="object"?i:"")+"]",v,traditional,add)}})}else if(!traditional&&jQuery.type(obj)==="object"){for(name in obj){buildParams(prefix+"["+name+"]",obj[name],traditional,add)}}else{add(prefix,obj)}}jQuery.each(("blur focus focusin focusout load resize scroll unload click dblclick "+"mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave "+"change select submit keydown keypress keyup error contextmenu").split(" "),function(i,name){jQuery.fn[name]=function(data,fn){return arguments.length>0?this.on(name,null,data,fn):this.trigger(name)}});jQuery.fn.extend({hover:function(fnOver,fnOut){return this.mouseenter(fnOver).mouseleave(fnOut||fnOver)},bind:function(types,data,fn){return this.on(types,null,data,fn)},unbind:function(types,fn){return this.off(types,null,fn)},delegate:function(selector,types,data,fn){return this.on(types,selector,data,fn)},undelegate:function(selector,types,fn){return arguments.length===1?this.off(selector,"**"):this.off(types,selector||"**",fn)}});var ajaxLocParts,ajaxLocation,ajax_nonce=jQuery.now(),ajax_rquery=/\?/,rhash=/#.*$/,rts=/([?&])_=[^&]*/,rheaders=/^(.*?):[ \t]*([^\r\n]*)$/gm,rlocalProtocol=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,rnoContent=/^(?:GET|HEAD)$/,rprotocol=/^\/\//,rurl=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,_load=jQuery.fn.load,prefilters={},transports={},allTypes="*/".concat("*");try{ajaxLocation=location.href}catch(e){ajaxLocation=document.createElement("a");ajaxLocation.href="";ajaxLocation=ajaxLocation.href}ajaxLocParts=rurl.exec(ajaxLocation.toLowerCase())||[];function addToPrefiltersOrTransports(structure){return function(dataTypeExpression,func){if(typeof dataTypeExpression!=="string"){func=dataTypeExpression;dataTypeExpression="*"}var dataType,i=0,dataTypes=dataTypeExpression.toLowerCase().match(core_rnotwhite)||[];if(jQuery.isFunction(func)){while(dataType=dataTypes[i++]){if(dataType[0]==="+"){dataType=dataType.slice(1)||"*";(structure[dataType]=structure[dataType]||[]).unshift(func)}else{(structure[dataType]=structure[dataType]||[]).push(func)}}}}}function inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR){var inspected={},seekingTransport=structure===transports;function inspect(dataType){var selected;inspected[dataType]=true;jQuery.each(structure[dataType]||[],function(_,prefilterOrFactory){var dataTypeOrTransport=prefilterOrFactory(options,originalOptions,jqXHR);if(typeof dataTypeOrTransport==="string"&&!seekingTransport&&!inspected[dataTypeOrTransport]){options.dataTypes.unshift(dataTypeOrTransport);inspect(dataTypeOrTransport);return false}else if(seekingTransport){return!(selected=dataTypeOrTransport)}});return selected}return inspect(options.dataTypes[0])||!inspected["*"]&&inspect("*")}function ajaxExtend(target,src){var key,deep,flatOptions=jQuery.ajaxSettings.flatOptions||{};for(key in src){if(src[key]!==undefined){(flatOptions[key]?target:deep||(deep={}))[key]=src[key]}}if(deep){jQuery.extend(true,target,deep)}return target}jQuery.fn.load=function(url,params,callback){if(typeof url!=="string"&&_load){return _load.apply(this,arguments)}var selector,type,response,self=this,off=url.indexOf(" ");if(off>=0){selector=url.slice(off);url=url.slice(0,off)}if(jQuery.isFunction(params)){callback=params;params=undefined}else if(params&&typeof params==="object"){type="POST"}if(self.length>0){jQuery.ajax({url:url,type:type,dataType:"html",data:params}).done(function(responseText){response=arguments;self.html(selector?jQuery("<div>").append(jQuery.parseHTML(responseText)).find(selector):responseText)}).complete(callback&&function(jqXHR,status){self.each(callback,response||[jqXHR.responseText,status,jqXHR])})}return this};jQuery.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(i,type){jQuery.fn[type]=function(fn){return this.on(type,fn)}});jQuery.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:ajaxLocation,type:"GET",isLocal:rlocalProtocol.test(ajaxLocParts[1]),global:true,processData:true,async:true,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":allTypes,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":true,"text json":jQuery.parseJSON,"text xml":jQuery.parseXML},flatOptions:{url:true,context:true}},ajaxSetup:function(target,settings){return settings?ajaxExtend(ajaxExtend(target,jQuery.ajaxSettings),settings):ajaxExtend(jQuery.ajaxSettings,target)},ajaxPrefilter:addToPrefiltersOrTransports(prefilters),ajaxTransport:addToPrefiltersOrTransports(transports),ajax:function(url,options){if(typeof url==="object"){options=url;url=undefined}options=options||{};var transport,cacheURL,responseHeadersString,responseHeaders,timeoutTimer,parts,fireGlobals,i,s=jQuery.ajaxSetup({},options),callbackContext=s.context||s,globalEventContext=s.context&&(callbackContext.nodeType||callbackContext.jquery)?jQuery(callbackContext):jQuery.event,deferred=jQuery.Deferred(),completeDeferred=jQuery.Callbacks("once memory"),statusCode=s.statusCode||{},requestHeaders={},requestHeadersNames={},state=0,strAbort="canceled",jqXHR={readyState:0,getResponseHeader:function(key){var match;if(state===2){if(!responseHeaders){responseHeaders={};while(match=rheaders.exec(responseHeadersString)){responseHeaders[match[1].toLowerCase()]=match[2]}}match=responseHeaders[key.toLowerCase()]}return match==null?null:match},getAllResponseHeaders:function(){return state===2?responseHeadersString:null},setRequestHeader:function(name,value){var lname=name.toLowerCase();if(!state){name=requestHeadersNames[lname]=requestHeadersNames[lname]||name;requestHeaders[name]=value}return this},overrideMimeType:function(type){if(!state){s.mimeType=type}return this},statusCode:function(map){var code;if(map){if(state<2){for(code in map){statusCode[code]=[statusCode[code],map[code]]}}else{jqXHR.always(map[jqXHR.status])}}return this},abort:function(statusText){var finalText=statusText||strAbort;if(transport){transport.abort(finalText)}done(0,finalText);return this}};deferred.promise(jqXHR).complete=completeDeferred.add;jqXHR.success=jqXHR.done;jqXHR.error=jqXHR.fail;s.url=((url||s.url||ajaxLocation)+"").replace(rhash,"").replace(rprotocol,ajaxLocParts[1]+"//");s.type=options.method||options.type||s.method||s.type;s.dataTypes=jQuery.trim(s.dataType||"*").toLowerCase().match(core_rnotwhite)||[""];if(s.crossDomain==null){parts=rurl.exec(s.url.toLowerCase());s.crossDomain=!!(parts&&(parts[1]!==ajaxLocParts[1]||parts[2]!==ajaxLocParts[2]||(parts[3]||(parts[1]==="http:"?"80":"443"))!==(ajaxLocParts[3]||(ajaxLocParts[1]==="http:"?"80":"443"))))}if(s.data&&s.processData&&typeof s.data!=="string"){s.data=jQuery.param(s.data,s.traditional)}inspectPrefiltersOrTransports(prefilters,s,options,jqXHR);if(state===2){return jqXHR}fireGlobals=s.global;if(fireGlobals&&jQuery.active++===0){jQuery.event.trigger("ajaxStart")}s.type=s.type.toUpperCase();s.hasContent=!rnoContent.test(s.type);cacheURL=s.url;if(!s.hasContent){if(s.data){cacheURL=s.url+=(ajax_rquery.test(cacheURL)?"&":"?")+s.data;delete s.data}if(s.cache===false){s.url=rts.test(cacheURL)?cacheURL.replace(rts,"$1_="+ajax_nonce++):cacheURL+(ajax_rquery.test(cacheURL)?"&":"?")+"_="+ajax_nonce++}}if(s.ifModified){if(jQuery.lastModified[cacheURL]){jqXHR.setRequestHeader("If-Modified-Since",jQuery.lastModified[cacheURL])}if(jQuery.etag[cacheURL]){jqXHR.setRequestHeader("If-None-Match",jQuery.etag[cacheURL])}}if(s.data&&s.hasContent&&s.contentType!==false||options.contentType){jqXHR.setRequestHeader("Content-Type",s.contentType)}jqXHR.setRequestHeader("Accept",s.dataTypes[0]&&s.accepts[s.dataTypes[0]]?s.accepts[s.dataTypes[0]]+(s.dataTypes[0]!=="*"?", "+allTypes+"; q=0.01":""):s.accepts["*"]);for(i in s.headers){jqXHR.setRequestHeader(i,s.headers[i])}if(s.beforeSend&&(s.beforeSend.call(callbackContext,jqXHR,s)===false||state===2)){return jqXHR.abort()}strAbort="abort";for(i in{success:1,error:1,complete:1}){jqXHR[i](s[i])}transport=inspectPrefiltersOrTransports(transports,s,options,jqXHR);if(!transport){done(-1,"No Transport")}else{jqXHR.readyState=1;if(fireGlobals){globalEventContext.trigger("ajaxSend",[jqXHR,s])}if(s.async&&s.timeout>0){timeoutTimer=setTimeout(function(){jqXHR.abort("timeout")},s.timeout)}try{state=1;transport.send(requestHeaders,done)}catch(e){if(state<2){done(-1,e)}else{throw e}}}function done(status,nativeStatusText,responses,headers){var isSuccess,success,error,response,modified,statusText=nativeStatusText;if(state===2){return}state=2;if(timeoutTimer){clearTimeout(timeoutTimer)}transport=undefined;responseHeadersString=headers||"";jqXHR.readyState=status>0?4:0;isSuccess=status>=200&&status<300||status===304;if(responses){response=ajaxHandleResponses(s,jqXHR,responses)}response=ajaxConvert(s,response,jqXHR,isSuccess);if(isSuccess){if(s.ifModified){modified=jqXHR.getResponseHeader("Last-Modified");if(modified){jQuery.lastModified[cacheURL]=modified}modified=jqXHR.getResponseHeader("etag");if(modified){jQuery.etag[cacheURL]=modified}}if(status===204||s.type==="HEAD"){statusText="nocontent"}else if(status===304){statusText="notmodified"}else{statusText=response.state;success=response.data;error=response.error;isSuccess=!error}}else{error=statusText;if(status||!statusText){statusText="error";if(status<0){status=0}}}jqXHR.status=status;jqXHR.statusText=(nativeStatusText||statusText)+"";if(isSuccess){deferred.resolveWith(callbackContext,[success,statusText,jqXHR])}else{deferred.rejectWith(callbackContext,[jqXHR,statusText,error])}jqXHR.statusCode(statusCode);statusCode=undefined;if(fireGlobals){globalEventContext.trigger(isSuccess?"ajaxSuccess":"ajaxError",[jqXHR,s,isSuccess?success:error])}completeDeferred.fireWith(callbackContext,[jqXHR,statusText]);if(fireGlobals){globalEventContext.trigger("ajaxComplete",[jqXHR,s]);if(!--jQuery.active){jQuery.event.trigger("ajaxStop")}}}return jqXHR},getJSON:function(url,data,callback){return jQuery.get(url,data,callback,"json")},getScript:function(url,callback){return jQuery.get(url,undefined,callback,"script")}});jQuery.each(["get","post"],function(i,method){jQuery[method]=function(url,data,callback,type){if(jQuery.isFunction(data)){type=type||callback;callback=data;data=undefined}return jQuery.ajax({url:url,type:method,dataType:type,data:data,success:callback})}});function ajaxHandleResponses(s,jqXHR,responses){var ct,type,finalDataType,firstDataType,contents=s.contents,dataTypes=s.dataTypes;while(dataTypes[0]==="*"){dataTypes.shift();if(ct===undefined){ct=s.mimeType||jqXHR.getResponseHeader("Content-Type")}}if(ct){for(type in contents){if(contents[type]&&contents[type].test(ct)){dataTypes.unshift(type);break}}}if(dataTypes[0]in responses){finalDataType=dataTypes[0]}else{for(type in responses){if(!dataTypes[0]||s.converters[type+" "+dataTypes[0]]){finalDataType=type;break}if(!firstDataType){firstDataType=type}}finalDataType=finalDataType||firstDataType}if(finalDataType){if(finalDataType!==dataTypes[0]){dataTypes.unshift(finalDataType)}return responses[finalDataType]}}function ajaxConvert(s,response,jqXHR,isSuccess){var conv2,current,conv,tmp,prev,converters={},dataTypes=s.dataTypes.slice();if(dataTypes[1]){for(conv in s.converters){converters[conv.toLowerCase()]=s.converters[conv]}}current=dataTypes.shift();while(current){if(s.responseFields[current]){jqXHR[s.responseFields[current]]=response}if(!prev&&isSuccess&&s.dataFilter){response=s.dataFilter(response,s.dataType)}prev=current;current=dataTypes.shift();if(current){if(current==="*"){current=prev}else if(prev!=="*"&&prev!==current){conv=converters[prev+" "+current]||converters["* "+current];if(!conv){for(conv2 in converters){tmp=conv2.split(" ");if(tmp[1]===current){conv=converters[prev+" "+tmp[0]]||converters["* "+tmp[0]];if(conv){if(conv===true){conv=converters[conv2]}else if(converters[conv2]!==true){current=tmp[0];dataTypes.unshift(tmp[1])}break}}}}if(conv!==true){if(conv&&s["throws"]){response=conv(response)}else{try{response=conv(response)}catch(e){return{state:"parsererror",error:conv?e:"No conversion from "+prev+" to "+current}}}}}}}return{state:"success",data:response}}jQuery.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(text){jQuery.globalEval(text);return text}}});jQuery.ajaxPrefilter("script",function(s){if(s.cache===undefined){s.cache=false}if(s.crossDomain){s.type="GET"}});jQuery.ajaxTransport("script",function(s){if(s.crossDomain){var script,callback;return{send:function(_,complete){script=jQuery("<script>").prop({async:true,charset:s.scriptCharset,src:s.url}).on("load error",callback=function(evt){script.remove();callback=null;if(evt){complete(evt.type==="error"?404:200,evt.type)}});document.head.appendChild(script[0])},abort:function(){if(callback){callback()}}}}});var oldCallbacks=[],rjsonp=/(=)\?(?=&|$)|\?\?/;jQuery.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var callback=oldCallbacks.pop()||jQuery.expando+"_"+ajax_nonce++;this[callback]=true;return callback}});jQuery.ajaxPrefilter("json jsonp",function(s,originalSettings,jqXHR){var callbackName,overwritten,responseContainer,jsonProp=s.jsonp!==false&&(rjsonp.test(s.url)?"url":typeof s.data==="string"&&!(s.contentType||"").indexOf("application/x-www-form-urlencoded")&&rjsonp.test(s.data)&&"data");if(jsonProp||s.dataTypes[0]==="jsonp"){callbackName=s.jsonpCallback=jQuery.isFunction(s.jsonpCallback)?s.jsonpCallback():s.jsonpCallback;if(jsonProp){s[jsonProp]=s[jsonProp].replace(rjsonp,"$1"+callbackName)}else if(s.jsonp!==false){s.url+=(ajax_rquery.test(s.url)?"&":"?")+s.jsonp+"="+callbackName}s.converters["script json"]=function(){if(!responseContainer){jQuery.error(callbackName+" was not called")}return responseContainer[0]};s.dataTypes[0]="json";overwritten=window[callbackName];window[callbackName]=function(){responseContainer=arguments};jqXHR.always(function(){window[callbackName]=overwritten;if(s[callbackName]){s.jsonpCallback=originalSettings.jsonpCallback;oldCallbacks.push(callbackName)}if(responseContainer&&jQuery.isFunction(overwritten)){overwritten(responseContainer[0])}responseContainer=overwritten=undefined});return"script"}});jQuery.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(e){}};var xhrSupported=jQuery.ajaxSettings.xhr(),xhrSuccessStatus={0:200,1223:204},xhrId=0,xhrCallbacks={};if(window.ActiveXObject){jQuery(window).on("unload",function(){for(var key in xhrCallbacks){xhrCallbacks[key]()}xhrCallbacks=undefined})}jQuery.support.cors=!!xhrSupported&&"withCredentials"in xhrSupported;jQuery.support.ajax=xhrSupported=!!xhrSupported;jQuery.ajaxTransport(function(options){var callback;if(jQuery.support.cors||xhrSupported&&!options.crossDomain){return{send:function(headers,complete){var i,id,xhr=options.xhr();xhr.open(options.type,options.url,options.async,options.username,options.password);if(options.xhrFields){for(i in options.xhrFields){xhr[i]=options.xhrFields[i]}}if(options.mimeType&&xhr.overrideMimeType){xhr.overrideMimeType(options.mimeType)}if(!options.crossDomain&&!headers["X-Requested-With"]){headers["X-Requested-With"]="XMLHttpRequest"}for(i in headers){xhr.setRequestHeader(i,headers[i])}callback=function(type){return function(){if(callback){delete xhrCallbacks[id];callback=xhr.onload=xhr.onerror=null;if(type==="abort"){xhr.abort()}else if(type==="error"){complete(xhr.status||404,xhr.statusText)}else{complete(xhrSuccessStatus[xhr.status]||xhr.status,xhr.statusText,typeof xhr.responseText==="string"?{text:xhr.responseText}:undefined,xhr.getAllResponseHeaders())}}}};xhr.onload=callback();xhr.onerror=callback("error");callback=xhrCallbacks[id=xhrId++]=callback("abort");xhr.send(options.hasContent&&options.data||null)},abort:function(){if(callback){callback()}}}}});var fxNow,timerId,rfxtypes=/^(?:toggle|show|hide)$/,rfxnum=new RegExp("^(?:([+-])=|)("+core_pnum+")([a-z%]*)$","i"),rrun=/queueHooks$/,animationPrefilters=[defaultPrefilter],tweeners={"*":[function(prop,value){var tween=this.createTween(prop,value),target=tween.cur(),parts=rfxnum.exec(value),unit=parts&&parts[3]||(jQuery.cssNumber[prop]?"":"px"),start=(jQuery.cssNumber[prop]||unit!=="px"&&+target)&&rfxnum.exec(jQuery.css(tween.elem,prop)),scale=1,maxIterations=20;if(start&&start[3]!==unit){unit=unit||start[3];parts=parts||[];start=+target||1;do{scale=scale||".5";start=start/scale;jQuery.style(tween.elem,prop,start+unit)}while(scale!==(scale=tween.cur()/target)&&scale!==1&&--maxIterations)}if(parts){start=tween.start=+start||+target||0;tween.unit=unit;tween.end=parts[1]?start+(parts[1]+1)*parts[2]:+parts[2]}return tween}]};function createFxNow(){setTimeout(function(){fxNow=undefined});return fxNow=jQuery.now()}function createTween(value,prop,animation){var tween,collection=(tweeners[prop]||[]).concat(tweeners["*"]),index=0,length=collection.length;for(;index<length;index++){if(tween=collection[index].call(animation,prop,value)){return tween}}}function Animation(elem,properties,options){var result,stopped,index=0,length=animationPrefilters.length,deferred=jQuery.Deferred().always(function(){delete tick.elem}),tick=function(){if(stopped){return false}var currentTime=fxNow||createFxNow(),remaining=Math.max(0,animation.startTime+animation.duration-currentTime),temp=remaining/animation.duration||0,percent=1-temp,index=0,length=animation.tweens.length;for(;index<length;index++){animation.tweens[index].run(percent)}deferred.notifyWith(elem,[animation,percent,remaining]);if(percent<1&&length){return remaining}else{deferred.resolveWith(elem,[animation]);return false}},animation=deferred.promise({elem:elem,props:jQuery.extend({},properties),opts:jQuery.extend(true,{specialEasing:{}},options),originalProperties:properties,originalOptions:options,startTime:fxNow||createFxNow(),duration:options.duration,tweens:[],createTween:function(prop,end){var tween=jQuery.Tween(elem,animation.opts,prop,end,animation.opts.specialEasing[prop]||animation.opts.easing);animation.tweens.push(tween);return tween},stop:function(gotoEnd){var index=0,length=gotoEnd?animation.tweens.length:0;if(stopped){return this}stopped=true;for(;index<length;index++){animation.tweens[index].run(1)}if(gotoEnd){deferred.resolveWith(elem,[animation,gotoEnd])}else{deferred.rejectWith(elem,[animation,gotoEnd])}return this}}),props=animation.props;propFilter(props,animation.opts.specialEasing);for(;index<length;index++){result=animationPrefilters[index].call(animation,elem,props,animation.opts);if(result){return result}}jQuery.map(props,createTween,animation);if(jQuery.isFunction(animation.opts.start)){animation.opts.start.call(elem,animation)}jQuery.fx.timer(jQuery.extend(tick,{elem:elem,anim:animation,queue:animation.opts.queue}));return animation.progress(animation.opts.progress).done(animation.opts.done,animation.opts.complete).fail(animation.opts.fail).always(animation.opts.always)}function propFilter(props,specialEasing){var index,name,easing,value,hooks;for(index in props){name=jQuery.camelCase(index);easing=specialEasing[name];value=props[index];if(jQuery.isArray(value)){easing=value[1];value=props[index]=value[0]}if(index!==name){props[name]=value;delete props[index]}hooks=jQuery.cssHooks[name];if(hooks&&"expand"in hooks){value=hooks.expand(value);delete props[name];for(index in value){if(!(index in props)){props[index]=value[index];specialEasing[index]=easing}}}else{specialEasing[name]=easing}}}jQuery.Animation=jQuery.extend(Animation,{tweener:function(props,callback){if(jQuery.isFunction(props)){callback=props;props=["*"]}else{props=props.split(" ")}var prop,index=0,length=props.length;for(;index<length;index++){prop=props[index];tweeners[prop]=tweeners[prop]||[];tweeners[prop].unshift(callback)}},prefilter:function(callback,prepend){if(prepend){animationPrefilters.unshift(callback)}else{animationPrefilters.push(callback)}}});function defaultPrefilter(elem,props,opts){var prop,value,toggle,tween,hooks,oldfire,anim=this,orig={},style=elem.style,hidden=elem.nodeType&&isHidden(elem),dataShow=data_priv.get(elem,"fxshow");if(!opts.queue){hooks=jQuery._queueHooks(elem,"fx");if(hooks.unqueued==null){hooks.unqueued=0;oldfire=hooks.empty.fire;hooks.empty.fire=function(){if(!hooks.unqueued){oldfire()}}}hooks.unqueued++;anim.always(function(){anim.always(function(){hooks.unqueued--;if(!jQuery.queue(elem,"fx").length){hooks.empty.fire()}})})}if(elem.nodeType===1&&("height"in props||"width"in props)){opts.overflow=[style.overflow,style.overflowX,style.overflowY];if(jQuery.css(elem,"display")==="inline"&&jQuery.css(elem,"float")==="none"){style.display="inline-block"}}if(opts.overflow){style.overflow="hidden";anim.always(function(){style.overflow=opts.overflow[0];style.overflowX=opts.overflow[1];style.overflowY=opts.overflow[2]})}for(prop in props){value=props[prop];if(rfxtypes.exec(value)){delete props[prop];toggle=toggle||value==="toggle";if(value===(hidden?"hide":"show")){if(value==="show"&&dataShow&&dataShow[prop]!==undefined){hidden=true}else{continue}}orig[prop]=dataShow&&dataShow[prop]||jQuery.style(elem,prop)}}if(!jQuery.isEmptyObject(orig)){if(dataShow){if("hidden"in dataShow){hidden=dataShow.hidden}}else{dataShow=data_priv.access(elem,"fxshow",{})}if(toggle){dataShow.hidden=!hidden}if(hidden){jQuery(elem).show()}else{anim.done(function(){jQuery(elem).hide()})}anim.done(function(){var prop;data_priv.remove(elem,"fxshow");for(prop in orig){jQuery.style(elem,prop,orig[prop])}});for(prop in orig){tween=createTween(hidden?dataShow[prop]:0,prop,anim);if(!(prop in dataShow)){dataShow[prop]=tween.start;if(hidden){tween.end=tween.start;tween.start=prop==="width"||prop==="height"?1:0}}}}}function Tween(elem,options,prop,end,easing){
return new Tween.prototype.init(elem,options,prop,end,easing)}jQuery.Tween=Tween;Tween.prototype={constructor:Tween,init:function(elem,options,prop,end,easing,unit){this.elem=elem;this.prop=prop;this.easing=easing||"swing";this.options=options;this.start=this.now=this.cur();this.end=end;this.unit=unit||(jQuery.cssNumber[prop]?"":"px")},cur:function(){var hooks=Tween.propHooks[this.prop];return hooks&&hooks.get?hooks.get(this):Tween.propHooks._default.get(this)},run:function(percent){var eased,hooks=Tween.propHooks[this.prop];if(this.options.duration){this.pos=eased=jQuery.easing[this.easing](percent,this.options.duration*percent,0,1,this.options.duration)}else{this.pos=eased=percent}this.now=(this.end-this.start)*eased+this.start;if(this.options.step){this.options.step.call(this.elem,this.now,this)}if(hooks&&hooks.set){hooks.set(this)}else{Tween.propHooks._default.set(this)}return this}};Tween.prototype.init.prototype=Tween.prototype;Tween.propHooks={_default:{get:function(tween){var result;if(tween.elem[tween.prop]!=null&&(!tween.elem.style||tween.elem.style[tween.prop]==null)){return tween.elem[tween.prop]}result=jQuery.css(tween.elem,tween.prop,"");return!result||result==="auto"?0:result},set:function(tween){if(jQuery.fx.step[tween.prop]){jQuery.fx.step[tween.prop](tween)}else if(tween.elem.style&&(tween.elem.style[jQuery.cssProps[tween.prop]]!=null||jQuery.cssHooks[tween.prop])){jQuery.style(tween.elem,tween.prop,tween.now+tween.unit)}else{tween.elem[tween.prop]=tween.now}}}};Tween.propHooks.scrollTop=Tween.propHooks.scrollLeft={set:function(tween){if(tween.elem.nodeType&&tween.elem.parentNode){tween.elem[tween.prop]=tween.now}}};jQuery.each(["toggle","show","hide"],function(i,name){var cssFn=jQuery.fn[name];jQuery.fn[name]=function(speed,easing,callback){return speed==null||typeof speed==="boolean"?cssFn.apply(this,arguments):this.animate(genFx(name,true),speed,easing,callback)}});jQuery.fn.extend({fadeTo:function(speed,to,easing,callback){return this.filter(isHidden).css("opacity",0).show().end().animate({opacity:to},speed,easing,callback)},animate:function(prop,speed,easing,callback){var empty=jQuery.isEmptyObject(prop),optall=jQuery.speed(speed,easing,callback),doAnimation=function(){var anim=Animation(this,jQuery.extend({},prop),optall);if(empty||data_priv.get(this,"finish")){anim.stop(true)}};doAnimation.finish=doAnimation;return empty||optall.queue===false?this.each(doAnimation):this.queue(optall.queue,doAnimation)},stop:function(type,clearQueue,gotoEnd){var stopQueue=function(hooks){var stop=hooks.stop;delete hooks.stop;stop(gotoEnd)};if(typeof type!=="string"){gotoEnd=clearQueue;clearQueue=type;type=undefined}if(clearQueue&&type!==false){this.queue(type||"fx",[])}return this.each(function(){var dequeue=true,index=type!=null&&type+"queueHooks",timers=jQuery.timers,data=data_priv.get(this);if(index){if(data[index]&&data[index].stop){stopQueue(data[index])}}else{for(index in data){if(data[index]&&data[index].stop&&rrun.test(index)){stopQueue(data[index])}}}for(index=timers.length;index--;){if(timers[index].elem===this&&(type==null||timers[index].queue===type)){timers[index].anim.stop(gotoEnd);dequeue=false;timers.splice(index,1)}}if(dequeue||!gotoEnd){jQuery.dequeue(this,type)}})},finish:function(type){if(type!==false){type=type||"fx"}return this.each(function(){var index,data=data_priv.get(this),queue=data[type+"queue"],hooks=data[type+"queueHooks"],timers=jQuery.timers,length=queue?queue.length:0;data.finish=true;jQuery.queue(this,type,[]);if(hooks&&hooks.stop){hooks.stop.call(this,true)}for(index=timers.length;index--;){if(timers[index].elem===this&&timers[index].queue===type){timers[index].anim.stop(true);timers.splice(index,1)}}for(index=0;index<length;index++){if(queue[index]&&queue[index].finish){queue[index].finish.call(this)}}delete data.finish})}});function genFx(type,includeWidth){var which,attrs={height:type},i=0;includeWidth=includeWidth?1:0;for(;i<4;i+=2-includeWidth){which=cssExpand[i];attrs["margin"+which]=attrs["padding"+which]=type}if(includeWidth){attrs.opacity=attrs.width=type}return attrs}jQuery.each({slideDown:genFx("show"),slideUp:genFx("hide"),slideToggle:genFx("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(name,props){jQuery.fn[name]=function(speed,easing,callback){return this.animate(props,speed,easing,callback)}});jQuery.speed=function(speed,easing,fn){var opt=speed&&typeof speed==="object"?jQuery.extend({},speed):{complete:fn||!fn&&easing||jQuery.isFunction(speed)&&speed,duration:speed,easing:fn&&easing||easing&&!jQuery.isFunction(easing)&&easing};opt.duration=jQuery.fx.off?0:typeof opt.duration==="number"?opt.duration:opt.duration in jQuery.fx.speeds?jQuery.fx.speeds[opt.duration]:jQuery.fx.speeds._default;if(opt.queue==null||opt.queue===true){opt.queue="fx"}opt.old=opt.complete;opt.complete=function(){if(jQuery.isFunction(opt.old)){opt.old.call(this)}if(opt.queue){jQuery.dequeue(this,opt.queue)}};return opt};jQuery.easing={linear:function(p){return p},swing:function(p){return.5-Math.cos(p*Math.PI)/2}};jQuery.timers=[];jQuery.fx=Tween.prototype.init;jQuery.fx.tick=function(){var timer,timers=jQuery.timers,i=0;fxNow=jQuery.now();for(;i<timers.length;i++){timer=timers[i];if(!timer()&&timers[i]===timer){timers.splice(i--,1)}}if(!timers.length){jQuery.fx.stop()}fxNow=undefined};jQuery.fx.timer=function(timer){if(timer()&&jQuery.timers.push(timer)){jQuery.fx.start()}};jQuery.fx.interval=13;jQuery.fx.start=function(){if(!timerId){timerId=setInterval(jQuery.fx.tick,jQuery.fx.interval)}};jQuery.fx.stop=function(){clearInterval(timerId);timerId=null};jQuery.fx.speeds={slow:600,fast:200,_default:400};jQuery.fx.step={};if(jQuery.expr&&jQuery.expr.filters){jQuery.expr.filters.animated=function(elem){return jQuery.grep(jQuery.timers,function(fn){return elem===fn.elem}).length}}jQuery.fn.offset=function(options){if(arguments.length){return options===undefined?this:this.each(function(i){jQuery.offset.setOffset(this,options,i)})}var docElem,win,elem=this[0],box={top:0,left:0},doc=elem&&elem.ownerDocument;if(!doc){return}docElem=doc.documentElement;if(!jQuery.contains(docElem,elem)){return box}if(typeof elem.getBoundingClientRect!==core_strundefined){box=elem.getBoundingClientRect()}win=getWindow(doc);return{top:box.top+win.pageYOffset-docElem.clientTop,left:box.left+win.pageXOffset-docElem.clientLeft}};jQuery.offset={setOffset:function(elem,options,i){var curPosition,curLeft,curCSSTop,curTop,curOffset,curCSSLeft,calculatePosition,position=jQuery.css(elem,"position"),curElem=jQuery(elem),props={};if(position==="static"){elem.style.position="relative"}curOffset=curElem.offset();curCSSTop=jQuery.css(elem,"top");curCSSLeft=jQuery.css(elem,"left");calculatePosition=(position==="absolute"||position==="fixed")&&(curCSSTop+curCSSLeft).indexOf("auto")>-1;if(calculatePosition){curPosition=curElem.position();curTop=curPosition.top;curLeft=curPosition.left}else{curTop=parseFloat(curCSSTop)||0;curLeft=parseFloat(curCSSLeft)||0}if(jQuery.isFunction(options)){options=options.call(elem,i,curOffset)}if(options.top!=null){props.top=options.top-curOffset.top+curTop}if(options.left!=null){props.left=options.left-curOffset.left+curLeft}if("using"in options){options.using.call(elem,props)}else{curElem.css(props)}}};jQuery.fn.extend({position:function(){if(!this[0]){return}var offsetParent,offset,elem=this[0],parentOffset={top:0,left:0};if(jQuery.css(elem,"position")==="fixed"){offset=elem.getBoundingClientRect()}else{offsetParent=this.offsetParent();offset=this.offset();if(!jQuery.nodeName(offsetParent[0],"html")){parentOffset=offsetParent.offset()}parentOffset.top+=jQuery.css(offsetParent[0],"borderTopWidth",true);parentOffset.left+=jQuery.css(offsetParent[0],"borderLeftWidth",true)}return{top:offset.top-parentOffset.top-jQuery.css(elem,"marginTop",true),left:offset.left-parentOffset.left-jQuery.css(elem,"marginLeft",true)}},offsetParent:function(){return this.map(function(){var offsetParent=this.offsetParent||docElem;while(offsetParent&&(!jQuery.nodeName(offsetParent,"html")&&jQuery.css(offsetParent,"position")==="static")){offsetParent=offsetParent.offsetParent}return offsetParent||docElem})}});jQuery.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(method,prop){var top="pageYOffset"===prop;jQuery.fn[method]=function(val){return jQuery.access(this,function(elem,method,val){var win=getWindow(elem);if(val===undefined){return win?win[prop]:elem[method]}if(win){win.scrollTo(!top?val:window.pageXOffset,top?val:window.pageYOffset)}else{elem[method]=val}},method,val,arguments.length,null)}});function getWindow(elem){return jQuery.isWindow(elem)?elem:elem.nodeType===9&&elem.defaultView}jQuery.each({Height:"height",Width:"width"},function(name,type){jQuery.each({padding:"inner"+name,content:type,"":"outer"+name},function(defaultExtra,funcName){jQuery.fn[funcName]=function(margin,value){var chainable=arguments.length&&(defaultExtra||typeof margin!=="boolean"),extra=defaultExtra||(margin===true||value===true?"margin":"border");return jQuery.access(this,function(elem,type,value){var doc;if(jQuery.isWindow(elem)){return elem.document.documentElement["client"+name]}if(elem.nodeType===9){doc=elem.documentElement;return Math.max(elem.body["scroll"+name],doc["scroll"+name],elem.body["offset"+name],doc["offset"+name],doc["client"+name])}return value===undefined?jQuery.css(elem,type,extra):jQuery.style(elem,type,value,extra)},type,chainable?margin:undefined,chainable,null)}})});jQuery.fn.size=function(){return this.length};jQuery.fn.andSelf=jQuery.fn.addBack;if(typeof module==="object"&&module&&typeof module.exports==="object"){module.exports=jQuery}else{if(typeof define==="function"&&define.amd){define("jquery",[],function(){return jQuery})}}if(typeof window==="object"&&typeof window.document==="object"){window.jQuery=window.$=jQuery}})(window);(function($){var types=["DOMMouseScroll","mousewheel"];if($.event.fixHooks){for(var i=types.length;i;){$.event.fixHooks[types[--i]]=$.event.mouseHooks}}$.event.special.mousewheel={setup:function(){if(this.addEventListener){for(var i=types.length;i;){this.addEventListener(types[--i],handler,false)}}else{this.onmousewheel=handler}},teardown:function(){if(this.removeEventListener){for(var i=types.length;i;){this.removeEventListener(types[--i],handler,false)}}else{this.onmousewheel=null}}};$.fn.extend({mousewheel:function(fn){return fn?this.bind("mousewheel",fn):this.trigger("mousewheel")},unmousewheel:function(fn){return this.unbind("mousewheel",fn)}});function handler(event){var orgEvent=event||window.event,args=[].slice.call(arguments,1),delta=0,returnValue=true,deltaX=0,deltaY=0;event=$.event.fix(orgEvent);event.type="mousewheel";if(orgEvent.wheelDelta){delta=orgEvent.wheelDelta/120}if(orgEvent.detail){delta=-orgEvent.detail/3}deltaY=delta;if(orgEvent.axis!==undefined&&orgEvent.axis===orgEvent.HORIZONTAL_AXIS){deltaY=0;deltaX=-1*delta}if(orgEvent.wheelDeltaY!==undefined){deltaY=orgEvent.wheelDeltaY/120}if(orgEvent.wheelDeltaX!==undefined){deltaX=-1*orgEvent.wheelDeltaX/120}args.unshift(event,delta,deltaX,deltaY);return($.event.dispatch||$.event.handle).apply(this,args)}})(jQuery);(function(b){b.jGestures={};b.jGestures.defaults={};b.jGestures.defaults.thresholdPinchopen=.05;b.jGestures.defaults.thresholdPinchmove=.05;b.jGestures.defaults.thresholdPinch=.05;b.jGestures.defaults.thresholdPinchclose=.05;b.jGestures.defaults.thresholdRotatecw=5;b.jGestures.defaults.thresholdRotateccw=5;b.jGestures.defaults.thresholdMove=20;b.jGestures.defaults.thresholdSwipe=100;b.jGestures.data={};b.jGestures.data.capableDevicesInUserAgentString=["iPad","iPhone","iPod","Mobile Safari"];b.jGestures.data.hasGestures=function(){var j;for(j=0;j<b.jGestures.data.capableDevicesInUserAgentString.length;j++){if(navigator.userAgent.indexOf(b.jGestures.data.capableDevicesInUserAgentString[j])!==-1){return true}}return false}();b.hasGestures=b.jGestures.data.hasGestures;b.jGestures.events={touchstart:"jGestures.touchstart",touchendStart:"jGestures.touchend;start",touchendProcessed:"jGestures.touchend;processed",gesturestart:"jGestures.gesturestart",gestureendStart:"jGestures.gestureend;start",gestureendProcessed:"jGestures.gestureend;processed"};jQuery.each({orientationchange_orientationchange01:"orientationchange",gestureend_pinchopen01:"pinchopen",gestureend_pinchclose01:"pinchclose",gestureend_rotatecw01:"rotatecw",gestureend_rotateccw01:"rotateccw",gesturechange_pinch01:"pinch",gesturechange_rotate01:"rotate",touchstart_swipe13:"swipemove",touchstart_swipe01:"swipeone",touchstart_swipe02:"swipetwo",touchstart_swipe03:"swipethree",touchstart_swipe04:"swipefour",touchstart_swipe05:"swipeup",touchstart_swipe06:"swiperightup",touchstart_swipe07:"swiperight",touchstart_swipe08:"swiperightdown",touchstart_swipe09:"swipedown",touchstart_swipe10:"swipeleftdown",touchstart_swipe11:"swipeleft",touchstart_swipe12:"swipeleftup",touchstart_tap01:"tapone",touchstart_tap02:"taptwo",touchstart_tap03:"tapthree",touchstart_tap04:"tapfour"},function(k,j){jQuery.event.special[j]={setup:function(){var q=k.split("_");var n=q[0];var l=q[1].slice(0,q[1].length-2);var o=jQuery(this);if(!o.data("ojQueryGestures")||!o.data("ojQueryGestures")[n]){var p=o.data("ojQueryGestures")||{};var m={};m[n]=true;b.extend(true,p,m);o.data("ojQueryGestures",p);if(b.hasGestures){switch(l){case"orientationchange":o.get(0).addEventListener("orientationchange",a,false);break;case"tap":case"swipe":case"swipeup":case"swiperightup":case"swiperight":case"swiperightdown":case"swipedown":case"swipeleftdown":case"swipeleft":o.get(0).addEventListener("touchstart",g,false);break;case"pinchopen":case"pinchclose":case"rotatecw":case"rotateccw":o.get(0).addEventListener("gesturestart",d,false);o.get(0).addEventListener("gestureend",h,false);break;case"pinch":case"rotate":o.get(0).addEventListener("gesturestart",d,false);o.get(0).addEventListener("gesturechange",e,false);break}}else{switch(l){case"tap":case"swipe":o.bind("mousedown",g);break;case"orientationchange":case"pinchopen":case"pinchclose":case"rotatecw":case"rotateccw":case"pinch":case"rotate":break}}}return false},add:function(m){var l=jQuery(this);var n=l.data("ojQueryGestures");n[m.type]={originalType:m.type};return false},remove:function(m){var l=jQuery(this);var n=l.data("ojQueryGestures");n[m.type]=false;l.data("ojQueryGestures",n);return false},teardown:function(){var q=k.split("_");var n=q[0];var l=q[1].slice(0,q[1].length-2);var o=jQuery(this);if(!o.data("ojQueryGestures")||!o.data("ojQueryGestures")[n]){var p=o.data("ojQueryGestures")||{};var m={};m[n]=false;b.extend(true,p,m);o.data("ojQueryGestures",p);if(b.hasGestures){switch(l){case"orientationchange":o.get(0).removeEventListener("orientationchange",a,false);break;case"tap":case"swipe":case"swipeup":case"swiperightup":case"swiperight":case"swiperightdown":case"swipedown":case"swipeleftdown":case"swipeleft":case"swipeleftup":o.get(0).removeEventListener("touchstart",g,false);o.get(0).removeEventListener("touchmove",f,false);o.get(0).removeEventListener("touchend",i,false);break;case"pinchopen":case"pinchclose":case"rotatecw":case"rotateccw":o.get(0).removeEventListener("gesturestart",d,false);o.get(0).removeEventListener("gestureend",h,false);break;case"pinch":case"rotate":o.get(0).removeEventListener("gesturestart",d,false);o.get(0).removeEventListener("gesturechange",e,false);break}}else{switch(l){case"tap":case"swipe":o.unbind("mousedown",g);o.unbind("mousemove",f);o.unbind("mouseup",i);break;case"orientationchange":case"pinchopen":case"pinchclose":case"rotatecw":case"rotateccw":case"pinch":case"rotate":break}}}return false}}});function c(j){j.startMove=j.startMove?j.startMove:{startX:null,startY:null,timestamp:null};var k=(new Date).getTime();if(j.touches){var m=[{lastX:j.deltaX,lastY:j.deltaY,moved:null,startX:j.screenX-j.startMove.screenX,startY:j.screenY-j.startMove.screenY}];var l={vector:j.vector,orientation:window.orientation||null,lastX:m[0].lastX>0?+1:m[0].lastX<0?-1:0,lastY:m[0].lastY>0?+1:m[0].lastY<0?-1:0,startX:m[0].startX>0?+1:m[0].startX<0?-1:0,startY:m[0].startY>0?+1:m[0].startY<0?-1:0};m[0].moved=Math.sqrt(Math.pow(Math.abs(m[0].startX),2)+Math.pow(Math.abs(m[0].startY),2))}return{type:j.type||null,originalEvent:j.event||null,delta:m||null,direction:l||{orientation:window.orientation||null,vector:j.vector||null},duration:j.startMove.timestamp?k-j.timestamp:null,rotation:j.rotation||null,scale:j.scale||null,description:j.description||[j.type,":",j.touches,":",m[0].lastX!=0?m[0].lastX>0?"right":"left":"steady",":",m[0].lastY!=0?m[0].lastY>0?"down":"up":"steady"].join("")}}function a(k){var j=["landscape:clockwise:","portrait:default:","landscape:counterclockwise:","portrait:upsidedown:"];b(window).triggerHandler("orientationchange",{direction:{orientation:window.orientation},description:["orientationchange:",j[window.orientation/90+1],window.orientation].join("")})}function g(k){var j=jQuery(k.currentTarget);j.triggerHandler(b.jGestures.events.touchstart,k);if(b.hasGestures){k.currentTarget.addEventListener("touchmove",f,false);k.currentTarget.addEventListener("touchend",i,false)}else{j.bind("mousemove",f);j.bind("mouseup",i)}var m=j.data("ojQueryGestures");var l=k.touches?k.touches[0]:k;var n={};n.oLastSwipemove={screenX:l.screenX,screenY:l.screenY,timestamp:(new Date).getTime()};n.oStartTouch={screenX:l.screenX,screenY:l.screenY,timestamp:(new Date).getTime()};j.data("ojQueryGestures",b.extend(true,m,n))}function f(s){var u=jQuery(s.currentTarget);var r=u.data("ojQueryGestures");var p=!!s.touches;var k=p?s.changedTouches[0].screenX:s.screenX;var j=p?s.changedTouches[0].screenY:s.screenY;var q=r.oLastSwipemove;var n=k-q.screenX;var m=j-q.screenY;if(!!r.oLastSwipemove){var t=c({type:"swipemove",touches:p?s.touches.length:"1",screenY:j,screenX:k,deltaY:m,deltaX:n,startMove:q,event:s,timestamp:q.timestamp});u.triggerHandler(t.type,t)}var l={};var o=s.touches?s.touches[0]:s;l.oLastSwipemove={screenX:o.screenX,screenY:o.screenY,timestamp:(new Date).getTime()};u.data("ojQueryGestures",b.extend(true,r,l))}function i(q){var u=jQuery(q.currentTarget);var w=!!q.changedTouches;var t=w?q.changedTouches.length:"1";var o=w?q.changedTouches[0].screenX:q.screenX;var n=w?q.changedTouches[0].screenY:q.screenY;u.triggerHandler(b.jGestures.events.touchendStart,q);if(b.hasGestures){q.currentTarget.removeEventListener("touchmove",f,false);q.currentTarget.removeEventListener("touchend",i,false)}else{u.unbind("mousemove",f);u.unbind("mouseup",i)}var l=u.data("ojQueryGestures");var x=Math.abs(l.oStartTouch.screenX-o)>b.jGestures.defaults.thresholdMove||Math.abs(l.oStartTouch.screenY-n)>b.jGestures.defaults.thresholdMove?true:false;var A=Math.abs(l.oStartTouch.screenX-o)>b.jGestures.defaults.thresholdSwipe||Math.abs(l.oStartTouch.screenY-n)>b.jGestures.defaults.thresholdSwipe?true:false;var z;for(z in l){var s=l.oStartTouch;var m={};var o=w?q.changedTouches[0].screenX:q.screenX;var n=w?q.changedTouches[0].screenY:q.screenY;var k=o-s.screenX;var j=n-s.screenY;var p=c({type:"swipe",touches:t,screenY:n,screenX:o,deltaY:j,deltaX:k,startMove:s,event:q,timestamp:s.timestamp});var v=["zero","one","two","three","four"];var r=false;switch(z){case"swipeone":if(w===false&&t==1&&x===false){break}if(w===false||t==1&&x===true&&A===true){r=true;p.type=["swipe",v[t]].join("");u.triggerHandler(p.type,p)}break;case"swipetwo":if(w&&t==2&&x===true&&A===true){r=true;p.type=["swipe",v[t]].join("");u.triggerHandler(p.type,p)}break;case"swipethree":if(w&&t==3&&x===true&&A===true){r=true;p.type=["swipe",v[t]].join("");u.triggerHandler(p.type,p)}break;case"swipefour":if(w&&t==4&&x===true&&A===true){r=true;p.type=["swipe",v[t]].join("");u.triggerHandler(p.type,p)}break;case"swipeup":case"swiperightup":case"swiperight":case"swiperightdown":case"swipedown":case"swipeleftdown":case"swipeleft":case"swipeleftup":if(w&&x===true&&A===true){r=true;p.type=["swipe",p.delta[0].lastX!=0?p.delta[0].lastX>0?"right":"left":"",p.delta[0].lastY!=0?p.delta[0].lastY>0?"down":"up":""].join("");u.triggerHandler(p.type,p)}break;case"tapone":case"taptwo":case"tapthree":case"tapfour":if(x!==true&&r!==true&&v[t]==z.slice(3)){p.description=["tap",v[t]].join("");p.type=["tap",v[t]].join("");u.triggerHandler(p.type,p)}break}var y={};u.data("ojQueryGestures",b.extend(true,l,y));u.data("ojQueryGestures",b.extend(true,l,y))}u.triggerHandler(b.jGestures.events.touchendProcessed,q)}function d(k){var j=jQuery(k.currentTarget);j.triggerHandler(b.jGestures.events.gesturestart,k);var l=j.data("ojQueryGestures");var m={};m.oStartTouch={timestamp:(new Date).getTime()};j.data("ojQueryGestures",b.extend(true,l,m))}function e(k){var j=jQuery(k.currentTarget);var o,l,q,n;var p=j.data("ojQueryGestures");var m;for(m in p){switch(m){case"pinch":o=k.scale;if(o<1&&o%1<1-b.jGestures.defaults.thresholdPinchclose||o>1&&o%1>b.jGestures.defaults.thresholdPinchopen){l=o<1?-1:+1;n=c({type:"pinch",scale:o,touches:null,startMove:p.oStartTouch,event:k,timestamp:p.oStartTouch.timestamp,vector:l,description:["pinch:",l,":",o<1?"close":"open"].join("")});j.triggerHandler(n.type,n)}break;case"rotate":o=k.rotation;if(o<1&&-1*o>b.jGestures.defaults.thresholdRotateccw||o>1&&o>b.jGestures.defaults.thresholdRotatecw){l=o<1?-1:+1;n=c({type:"rotate",rotation:o,touches:null,startMove:p.oStartTouch,event:k,timestamp:p.oStartTouch.timestamp,vector:l,description:["rotate:",l,":",o<1?"counterclockwise":"clockwise"].join("")});j.triggerHandler(n.type,n)}break}}}function h(k){var j=jQuery(k.currentTarget);j.triggerHandler(b.jGestures.events.gestureendStart,k);var m;var n=j.data("ojQueryGestures");var l;for(l in n){switch(l){case"pinchclose":m=k.scale;if(m<1&&m%1<1-b.jGestures.defaults.thresholdPinchclose){j.triggerHandler("pinchclose",c({type:"pinchclose",scale:m,vector:-1,touches:null,startMove:n.oStartTouch,event:k,timestamp:n.oStartTouch.timestamp,description:"pinch:-1:close"}))}break;case"pinchopen":m=k.scale;if(m>1&&m%1>b.jGestures.defaults.thresholdPinchopen){j.triggerHandler("pinchopen",c({type:"pinchopen",scale:m,vector:+1,touches:null,startMove:n.oStartTouch,event:k,timestamp:n.oStartTouch.timestamp,description:"pinch:+1:open"}))}break;case"rotatecw":m=k.rotation;if(m>1&&m>b.jGestures.defaults.thresholdRotatecw){j.triggerHandler("rotatecw",c({type:"rotatecw",rotation:m,vector:+1,touches:null,startMove:n.oStartTouch,event:k,timestamp:n.oStartTouch.timestamp,description:"rotate:+1:clockwise"}))}break;case"rotateccw":m=k.rotation;if(m<1&&-1*m>b.jGestures.defaults.thresholdRotateccw){j.triggerHandler("rotateccw",c({type:"rotateccw",rotation:m,vector:-1,touches:null,startMove:n.oStartTouch,event:k,timestamp:n.oStartTouch.timestamp,description:"rotate:-1:counterclockwise"}))}break}}j.triggerHandler(b.jGestures.events.gestureendProcessed,k)}})(jQuery);var Pixastic=function(){function addEvent(el,event,handler){if(el.addEventListener)el.addEventListener(event,handler,false);else if(el.attachEvent)el.attachEvent("on"+event,handler)}function onready(handler){var handlerDone=false;var execHandler=function(){if(!handlerDone){handlerDone=true;handler()}};document.write("<"+'script defer src="//:" id="__onload_ie_pixastic__"></'+"script>");var script=document.getElementById("__onload_ie_pixastic__");script.onreadystatechange=function(){if(script.readyState=="complete"){script.parentNode.removeChild(script);execHandler()}};if(document.addEventListener)document.addEventListener("DOMContentLoaded",execHandler,false);addEvent(window,"load",execHandler)}function init(){var imgEls=getElementsByClass("pixastic",null,"img");var canvasEls=getElementsByClass("pixastic",null,"canvas");var elements=imgEls.concat(canvasEls);for(var i=0;i<elements.length;i++){(function(){var el=elements[i];var actions=[];var classes=el.className.split(" ");for(var c=0;c<classes.length;c++){var cls=classes[c];if(cls.substring(0,9)=="pixastic-"){var actionName=cls.substring(9);if(actionName!="")actions.push(actionName)}}if(actions.length){if(el.tagName.toLowerCase()=="img"){var dataImg=new Image;dataImg.src=el.src;if(dataImg.complete){for(var a=0;a<actions.length;a++){var res=Pixastic.applyAction(el,el,actions[a],null);if(res)el=res}}else{dataImg.onload=function(){for(var a=0;a<actions.length;a++){var res=Pixastic.applyAction(el,el,actions[a],null);if(res)el=res}}}}else{setTimeout(function(){for(var a=0;a<actions.length;a++){var res=Pixastic.applyAction(el,el,actions[a],null);if(res)el=res}},1)}}})()}}if(typeof pixastic_parseonload!="undefined"&&pixastic_parseonload)onready(init);function getElementsByClass(searchClass,node,tag){var classElements=new Array;if(node==null)node=document;if(tag==null)tag="*";var els=node.getElementsByTagName(tag);var elsLen=els.length;var pattern=new RegExp("(^|\\s)"+searchClass+"(\\s|$)");for(i=0,j=0;i<elsLen;i++){if(pattern.test(els[i].className)){classElements[j]=els[i];j++}}return classElements}var debugElement;function writeDebug(text,level){if(!Pixastic.debug)return;try{switch(level){case"warn":console.warn("Pixastic:",text);break;case"error":console.error("Pixastic:",text);break;default:console.log("Pixastic:",text)}}catch(e){}if(!debugElement){}}var hasCanvas=function(){var c=document.createElement("canvas");var val=false;try{val=!!(typeof c.getContext=="function"&&c.getContext("2d"))}catch(e){}return function(){return val}}();var hasCanvasImageData=function(){var c=document.createElement("canvas");var val=false;var ctx;try{if(typeof c.getContext=="function"&&(ctx=c.getContext("2d"))){val=typeof ctx.getImageData=="function"}}catch(e){}return function(){return val}}();var hasGlobalAlpha=function(){var hasAlpha=false;var red=document.createElement("canvas");if(hasCanvas()&&hasCanvasImageData()){red.width=red.height=1;var redctx=red.getContext("2d");redctx.fillStyle="rgb(255,0,0)";redctx.fillRect(0,0,1,1);var blue=document.createElement("canvas");blue.width=blue.height=1;var bluectx=blue.getContext("2d");bluectx.fillStyle="rgb(0,0,255)";bluectx.fillRect(0,0,1,1);redctx.globalAlpha=.5;redctx.drawImage(blue,0,0);var reddata=redctx.getImageData(0,0,1,1).data;hasAlpha=reddata[2]!=255}return function(){return hasAlpha}}();return{parseOnLoad:false,debug:false,applyAction:function(img,dataImg,actionName,options){options=options||{};var imageIsCanvas=img.tagName.toLowerCase()=="canvas";if(imageIsCanvas&&Pixastic.Client.isIE()){if(Pixastic.debug)writeDebug("Tried to process a canvas element but browser is IE.");return false}var canvas,ctx;var hasOutputCanvas=false;if(Pixastic.Client.hasCanvas()){hasOutputCanvas=!!options.resultCanvas;canvas=options.resultCanvas||document.createElement("canvas");ctx=canvas.getContext("2d")}var w=img.offsetWidth;var h=img.offsetHeight;if(imageIsCanvas){w=img.width;h=img.height}if(w==0||h==0){if(img.parentNode==null){var oldpos=img.style.position;var oldleft=img.style.left;img.style.position="absolute";img.style.left="-9999px";document.body.appendChild(img);w=img.offsetWidth;h=img.offsetHeight;document.body.removeChild(img);img.style.position=oldpos;img.style.left=oldleft}else{if(Pixastic.debug)writeDebug("Image has 0 width and/or height.");return}}if(actionName.indexOf("(")>-1){var tmp=actionName;actionName=tmp.substr(0,tmp.indexOf("("));var arg=tmp.match(/\((.*?)\)/);if(arg[1]){arg=arg[1].split(";");for(var a=0;a<arg.length;a++){thisArg=arg[a].split("=");if(thisArg.length==2){if(thisArg[0]=="rect"){var rectVal=thisArg[1].split(",");options[thisArg[0]]={left:parseInt(rectVal[0],10)||0,top:parseInt(rectVal[1],10)||0,width:parseInt(rectVal[2],10)||0,height:parseInt(rectVal[3],10)||0}}else{options[thisArg[0]]=thisArg[1]}}}}}if(!options.rect){options.rect={left:0,top:0,width:w,height:h}}else{options.rect.left=Math.round(options.rect.left);options.rect.top=Math.round(options.rect.top);options.rect.width=Math.round(options.rect.width);options.rect.height=Math.round(options.rect.height)}var validAction=false;if(Pixastic.Actions[actionName]&&typeof Pixastic.Actions[actionName].process=="function"){validAction=true}if(!validAction){if(Pixastic.debug)writeDebug('Invalid action "'+actionName+'". Maybe file not included?');return false}if(!Pixastic.Actions[actionName].checkSupport()){if(Pixastic.debug)writeDebug('Action "'+actionName+'" not supported by this browser.');return false}if(Pixastic.Client.hasCanvas()){if(canvas!==img){canvas.width=w;canvas.height=h}if(!hasOutputCanvas){canvas.style.width=w+"px";canvas.style.height=h+"px"}ctx.drawImage(dataImg,0,0,w,h);if(!img.__pixastic_org_image){canvas.__pixastic_org_image=img;canvas.__pixastic_org_width=w;canvas.__pixastic_org_height=h}else{canvas.__pixastic_org_image=img.__pixastic_org_image;canvas.__pixastic_org_width=img.__pixastic_org_width;canvas.__pixastic_org_height=img.__pixastic_org_height}}else if(Pixastic.Client.isIE()&&typeof img.__pixastic_org_style=="undefined"){img.__pixastic_org_style=img.style.cssText}var params={image:img,canvas:canvas,width:w,height:h,useData:true,options:options};var res=Pixastic.Actions[actionName].process(params);if(!res){return false}if(Pixastic.Client.hasCanvas()){if(params.useData){if(Pixastic.Client.hasCanvasImageData()){canvas.getContext("2d").putImageData(params.canvasData,options.rect.left,options.rect.top);canvas.getContext("2d").fillRect(0,0,0,0)}}if(!options.leaveDOM){canvas.title=img.title;canvas.imgsrc=img.imgsrc;if(!imageIsCanvas)canvas.alt=img.alt;if(!imageIsCanvas)canvas.imgsrc=img.src;canvas.className=img.className;canvas.style.cssText=img.style.cssText;canvas.name=img.name;canvas.tabIndex=img.tabIndex;canvas.id=img.id;if(img.parentNode&&img.parentNode.replaceChild){img.parentNode.replaceChild(canvas,img)}}options.resultCanvas=canvas;return canvas}return img},prepareData:function(params,getCopy){var ctx=params.canvas.getContext("2d");var rect=params.options.rect;var dataDesc=ctx.getImageData(rect.left,rect.top,rect.width,rect.height);var data=dataDesc.data;if(!getCopy)params.canvasData=dataDesc;return data},process:function(img,actionName,options,callback){if(img.tagName.toLowerCase()=="img"){var dataImg=new Image;dataImg.src=img.src;if(dataImg.complete){var res=Pixastic.applyAction(img,dataImg,actionName,options);if(callback)callback(res);return res}else{dataImg.onload=function(){var res=Pixastic.applyAction(img,dataImg,actionName,options);if(callback)callback(res)}}}if(img.tagName.toLowerCase()=="canvas"){var res=Pixastic.applyAction(img,img,actionName,options);if(callback)callback(res);return res}},revert:function(img){if(Pixastic.Client.hasCanvas()){if(img.tagName.toLowerCase()=="canvas"&&img.__pixastic_org_image){img.width=img.__pixastic_org_width;img.height=img.__pixastic_org_height;img.getContext("2d").drawImage(img.__pixastic_org_image,0,0);if(img.parentNode&&img.parentNode.replaceChild){img.parentNode.replaceChild(img.__pixastic_org_image,img)}return img}}else if(Pixastic.Client.isIE()){if(typeof img.__pixastic_org_style!="undefined")img.style.cssText=img.__pixastic_org_style}},Client:{hasCanvas:hasCanvas,hasCanvasImageData:hasCanvasImageData,hasGlobalAlpha:hasGlobalAlpha,isIE:function(){return!!document.all&&!!window.attachEvent&&!window.opera}},Actions:{}}}();if(typeof jQuery!="undefined"&&jQuery&&jQuery.fn){jQuery.fn.pixastic=function(action,options){var newElements=[];this.each(function(){if(this.tagName.toLowerCase()=="img"&&!this.complete){return}var res=Pixastic.process(this,action,options);if(res){newElements.push(res)}});if(newElements.length>0)return jQuery(newElements);else return this}}Pixastic.Actions.blend={process:function(params){var amount=parseFloat(params.options.amount);var mode=(params.options.mode||"normal").toLowerCase();var image=params.options.image;amount=Math.max(0,Math.min(1,amount));if(!image)return false;if(Pixastic.Client.hasCanvasImageData()){var rect=params.options.rect;var data=Pixastic.prepareData(params);var w=rect.width;var h=rect.height;params.useData=false;var otherCanvas=document.createElement("canvas");otherCanvas.width=params.canvas.width;otherCanvas.height=params.canvas.height;var otherCtx=otherCanvas.getContext("2d");
otherCtx.drawImage(image,0,0);var params2={canvas:otherCanvas,options:params.options};var data2=Pixastic.prepareData(params2);var dataDesc2=params2.canvasData;var p=w*h;var pix=p*4;var pix1,pix2;var r1,g1,b1;var r2,g2,b2;var r3,g3,b3;var r4,g4,b4;var dataChanged=false;switch(mode){case"normal":break;case"multiply":while(p--){data2[pix-=4]=data[pix]*data2[pix]/255;data2[pix1=pix+1]=data[pix1]*data2[pix1]/255;data2[pix2=pix+2]=data[pix2]*data2[pix2]/255}dataChanged=true;break;case"lighten":while(p--){if((r1=data[pix-=4])>data2[pix])data2[pix]=r1;if((g1=data[pix1=pix+1])>data2[pix1])data2[pix1]=g1;if((b1=data[pix2=pix+2])>data2[pix2])data2[pix2]=b1}dataChanged=true;break;case"darken":while(p--){if((r1=data[pix-=4])<data2[pix])data2[pix]=r1;if((g1=data[pix1=pix+1])<data2[pix1])data2[pix1]=g1;if((b1=data[pix2=pix+2])<data2[pix2])data2[pix2]=b1}dataChanged=true;break;case"darkercolor":while(p--){if((r1=data[pix-=4])*.3+(g1=data[pix1=pix+1])*.59+(b1=data[pix2=pix+2])*.11<=data2[pix]*.3+data2[pix1]*.59+data2[pix2]*.11){data2[pix]=r1;data2[pix1]=g1;data2[pix2]=b1}}dataChanged=true;break;case"lightercolor":while(p--){if((r1=data[pix-=4])*.3+(g1=data[pix1=pix+1])*.59+(b1=data[pix2=pix+2])*.11>data2[pix]*.3+data2[pix1]*.59+data2[pix2]*.11){data2[pix]=r1;data2[pix1]=g1;data2[pix2]=b1}}dataChanged=true;break;case"lineardodge":while(p--){if((r3=data[pix-=4]+data2[pix])>255)data2[pix]=255;else data2[pix]=r3;if((g3=data[pix1=pix+1]+data2[pix1])>255)data2[pix1]=255;else data2[pix1]=g3;if((b3=data[pix2=pix+2]+data2[pix2])>255)data2[pix2]=255;else data2[pix2]=b3}dataChanged=true;break;case"linearburn":while(p--){if((r3=data[pix-=4]+data2[pix])<255)data2[pix]=0;else data2[pix]=r3-255;if((g3=data[pix1=pix+1]+data2[pix1])<255)data2[pix1]=0;else data2[pix1]=g3-255;if((b3=data[pix2=pix+2]+data2[pix2])<255)data2[pix2]=0;else data2[pix2]=b3-255}dataChanged=true;break;case"difference":while(p--){if((r3=data[pix-=4]-data2[pix])<0)data2[pix]=-r3;else data2[pix]=r3;if((g3=data[pix1=pix+1]-data2[pix1])<0)data2[pix1]=-g3;else data2[pix1]=g3;if((b3=data[pix2=pix+2]-data2[pix2])<0)data2[pix2]=-b3;else data2[pix2]=b3}dataChanged=true;break;case"screen":while(p--){data2[pix-=4]=255-((255-data2[pix])*(255-data[pix])>>8);data2[pix1=pix+1]=255-((255-data2[pix1])*(255-data[pix1])>>8);data2[pix2=pix+2]=255-((255-data2[pix2])*(255-data[pix2])>>8)}dataChanged=true;break;case"exclusion":var div_2_255=2/255;while(p--){data2[pix-=4]=(r1=data[pix])-(r1*div_2_255-1)*data2[pix];data2[pix1=pix+1]=(g1=data[pix1])-(g1*div_2_255-1)*data2[pix1];data2[pix2=pix+2]=(b1=data[pix2])-(b1*div_2_255-1)*data2[pix2]}dataChanged=true;break;case"overlay":var div_2_255=2/255;while(p--){if((r1=data[pix-=4])<128)data2[pix]=data2[pix]*r1*div_2_255;else data2[pix]=255-(255-data2[pix])*(255-r1)*div_2_255;if((g1=data[pix1=pix+1])<128)data2[pix1]=data2[pix1]*g1*div_2_255;else data2[pix1]=255-(255-data2[pix1])*(255-g1)*div_2_255;if((b1=data[pix2=pix+2])<128)data2[pix2]=data2[pix2]*b1*div_2_255;else data2[pix2]=255-(255-data2[pix2])*(255-b1)*div_2_255}dataChanged=true;break;case"softlight":var div_2_255=2/255;while(p--){if((r1=data[pix-=4])<128)data2[pix]=((data2[pix]>>1)+64)*r1*div_2_255;else data2[pix]=255-(191-(data2[pix]>>1))*(255-r1)*div_2_255;if((g1=data[pix1=pix+1])<128)data2[pix1]=((data2[pix1]>>1)+64)*g1*div_2_255;else data2[pix1]=255-(191-(data2[pix1]>>1))*(255-g1)*div_2_255;if((b1=data[pix2=pix+2])<128)data2[pix2]=((data2[pix2]>>1)+64)*b1*div_2_255;else data2[pix2]=255-(191-(data2[pix2]>>1))*(255-b1)*div_2_255}dataChanged=true;break;case"hardlight":var div_2_255=2/255;while(p--){if((r2=data2[pix-=4])<128)data2[pix]=data[pix]*r2*div_2_255;else data2[pix]=255-(255-data[pix])*(255-r2)*div_2_255;if((g2=data2[pix1=pix+1])<128)data2[pix1]=data[pix1]*g2*div_2_255;else data2[pix1]=255-(255-data[pix1])*(255-g2)*div_2_255;if((b2=data2[pix2=pix+2])<128)data2[pix2]=data[pix2]*b2*div_2_255;else data2[pix2]=255-(255-data[pix2])*(255-b2)*div_2_255}dataChanged=true;break;case"colordodge":while(p--){if((r3=(data[pix-=4]<<8)/(255-(r2=data2[pix])))>255||r2==255)data2[pix]=255;else data2[pix]=r3;if((g3=(data[pix1=pix+1]<<8)/(255-(g2=data2[pix1])))>255||g2==255)data2[pix1]=255;else data2[pix1]=g3;if((b3=(data[pix2=pix+2]<<8)/(255-(b2=data2[pix2])))>255||b2==255)data2[pix2]=255;else data2[pix2]=b3}dataChanged=true;break;case"colorburn":while(p--){if((r3=255-(255-data[pix-=4]<<8)/data2[pix])<0||data2[pix]==0)data2[pix]=0;else data2[pix]=r3;if((g3=255-(255-data[pix1=pix+1]<<8)/data2[pix1])<0||data2[pix1]==0)data2[pix1]=0;else data2[pix1]=g3;if((b3=255-(255-data[pix2=pix+2]<<8)/data2[pix2])<0||data2[pix2]==0)data2[pix2]=0;else data2[pix2]=b3}dataChanged=true;break;case"linearlight":while(p--){if((r3=2*(r2=data2[pix-=4])+data[pix]-256)<0||r2<128&&r3<0){data2[pix]=0}else{if(r3>255)data2[pix]=255;else data2[pix]=r3}if((g3=2*(g2=data2[pix1=pix+1])+data[pix1]-256)<0||g2<128&&g3<0){data2[pix1]=0}else{if(g3>255)data2[pix1]=255;else data2[pix1]=g3}if((b3=2*(b2=data2[pix2=pix+2])+data[pix2]-256)<0||b2<128&&b3<0){data2[pix2]=0}else{if(b3>255)data2[pix2]=255;else data2[pix2]=b3}}dataChanged=true;break;case"vividlight":while(p--){if((r2=data2[pix-=4])<128){if(r2){if((r3=255-(255-data[pix]<<8)/(2*r2))<0)data2[pix]=0;else data2[pix]=r3}else{data2[pix]=0}}else if((r3=r4=2*r2-256)<255){if((r3=(data[pix]<<8)/(255-r4))>255)data2[pix]=255;else data2[pix]=r3}else{if(r3<0)data2[pix]=0;else data2[pix]=r3}if((g2=data2[pix1=pix+1])<128){if(g2){if((g3=255-(255-data[pix1]<<8)/(2*g2))<0)data2[pix1]=0;else data2[pix1]=g3}else{data2[pix1]=0}}else if((g3=g4=2*g2-256)<255){if((g3=(data[pix1]<<8)/(255-g4))>255)data2[pix1]=255;else data2[pix1]=g3}else{if(g3<0)data2[pix1]=0;else data2[pix1]=g3}if((b2=data2[pix2=pix+2])<128){if(b2){if((b3=255-(255-data[pix2]<<8)/(2*b2))<0)data2[pix2]=0;else data2[pix2]=b3}else{data2[pix2]=0}}else if((b3=b4=2*b2-256)<255){if((b3=(data[pix2]<<8)/(255-b4))>255)data2[pix2]=255;else data2[pix2]=b3}else{if(b3<0)data2[pix2]=0;else data2[pix2]=b3}}dataChanged=true;break;case"pinlight":while(p--){if((r2=data2[pix-=4])<128)if((r1=data[pix])<(r4=2*r2))data2[pix]=r1;else data2[pix]=r4;else if((r1=data[pix])>(r4=2*r2-256))data2[pix]=r1;else data2[pix]=r4;if((g2=data2[pix1=pix+1])<128)if((g1=data[pix1])<(g4=2*g2))data2[pix1]=g1;else data2[pix1]=g4;else if((g1=data[pix1])>(g4=2*g2-256))data2[pix1]=g1;else data2[pix1]=g4;if((r2=data2[pix2=pix+2])<128)if((r1=data[pix2])<(r4=2*r2))data2[pix2]=r1;else data2[pix2]=r4;else if((r1=data[pix2])>(r4=2*r2-256))data2[pix2]=r1;else data2[pix2]=r4}dataChanged=true;break;case"hardmix":while(p--){if((r2=data2[pix-=4])<128)if(255-(255-data[pix]<<8)/(2*r2)<128||r2==0)data2[pix]=0;else data2[pix]=255;else if((r4=2*r2-256)<255&&(data[pix]<<8)/(255-r4)<128)data2[pix]=0;else data2[pix]=255;if((g2=data2[pix1=pix+1])<128)if(255-(255-data[pix1]<<8)/(2*g2)<128||g2==0)data2[pix1]=0;else data2[pix1]=255;else if((g4=2*g2-256)<255&&(data[pix1]<<8)/(255-g4)<128)data2[pix1]=0;else data2[pix1]=255;if((b2=data2[pix2=pix+2])<128)if(255-(255-data[pix2]<<8)/(2*b2)<128||b2==0)data2[pix2]=0;else data2[pix2]=255;else if((b4=2*b2-256)<255&&(data[pix2]<<8)/(255-b4)<128)data2[pix2]=0;else data2[pix2]=255}dataChanged=true;break}if(dataChanged)otherCtx.putImageData(dataDesc2,0,0);if(amount!=1&&!Pixastic.Client.hasGlobalAlpha()){var p=w*h;var amount2=amount;var amount1=1-amount;while(p--){var pix=p*4;var r=data[pix]*amount1+data2[pix]*amount2>>0;var g=data[pix+1]*amount1+data2[pix+1]*amount2>>0;var b=data[pix+2]*amount1+data2[pix+2]*amount2>>0;data[pix]=r;data[pix+1]=g;data[pix+2]=b}params.useData=true}else{var ctx=params.canvas.getContext("2d");ctx.save();ctx.globalAlpha=amount;ctx.drawImage(otherCanvas,0,0,rect.width,rect.height,rect.left,rect.top,rect.width,rect.height);ctx.globalAlpha=1;ctx.restore()}return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.blur={process:function(params){if(typeof params.options.fixMargin=="undefined")params.options.fixMargin=true;if(Pixastic.Client.hasCanvasImageData()){var data=Pixastic.prepareData(params);var dataCopy=Pixastic.prepareData(params,true);var kernel=[[0,1,0],[1,2,1],[0,1,0]];var weight=0;for(var i=0;i<3;i++){for(var j=0;j<3;j++){weight+=kernel[i][j]}}weight=1/(weight*2);var rect=params.options.rect;var w=rect.width;var h=rect.height;var w4=w*4;var y=h;do{var offsetY=(y-1)*w4;var prevY=y==1?0:y-2;var nextY=y==h?y-1:y;var offsetYPrev=prevY*w*4;var offsetYNext=nextY*w*4;var x=w;do{var offset=offsetY+(x*4-4);var offsetPrev=offsetYPrev+(x==1?0:x-2)*4;var offsetNext=offsetYNext+(x==w?x-1:x)*4;data[offset]=((dataCopy[offsetPrev]+dataCopy[offset-4]+dataCopy[offset+4]+dataCopy[offsetNext])*2+dataCopy[offset]*4)*weight;data[offset+1]=((dataCopy[offsetPrev+1]+dataCopy[offset-3]+dataCopy[offset+5]+dataCopy[offsetNext+1])*2+dataCopy[offset+1]*4)*weight;data[offset+2]=((dataCopy[offsetPrev+2]+dataCopy[offset-2]+dataCopy[offset+6]+dataCopy[offsetNext+2])*2+dataCopy[offset+2]*4)*weight}while(--x)}while(--y);return true}else if(Pixastic.Client.isIE()){params.image.style.filter+=" progid:DXImageTransform.Microsoft.Blur(pixelradius=1.5)";if(params.options.fixMargin){params.image.style.marginLeft=(parseInt(params.image.style.marginLeft,10)||0)-2+"px";params.image.style.marginTop=(parseInt(params.image.style.marginTop,10)||0)-2+"px"}return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()||Pixastic.Client.isIE()}};Pixastic.Actions.blurfast={process:function(params){var amount=parseFloat(params.options.amount)||0;var clear=!!(params.options.clear&&params.options.clear!="false");amount=Math.max(0,Math.min(5,amount));if(Pixastic.Client.hasCanvas()){var rect=params.options.rect;var ctx=params.canvas.getContext("2d");ctx.save();ctx.beginPath();ctx.rect(rect.left,rect.top,rect.width,rect.height);ctx.clip();var scale=2;var smallWidth=Math.round(params.width/scale);var smallHeight=Math.round(params.height/scale);var copy=document.createElement("canvas");copy.width=smallWidth;copy.height=smallHeight;var clear=false;var steps=Math.round(amount*20);var copyCtx=copy.getContext("2d");for(var i=0;i<steps;i++){var scaledWidth=Math.max(1,Math.round(smallWidth-i));var scaledHeight=Math.max(1,Math.round(smallHeight-i));copyCtx.clearRect(0,0,smallWidth,smallHeight);copyCtx.drawImage(params.canvas,0,0,params.width,params.height,0,0,scaledWidth,scaledHeight);if(clear)ctx.clearRect(rect.left,rect.top,rect.width,rect.height);ctx.drawImage(copy,0,0,scaledWidth,scaledHeight,0,0,params.width,params.height)}ctx.restore();params.useData=false;return true}else if(Pixastic.Client.isIE()){var radius=10*amount;params.image.style.filter+=" progid:DXImageTransform.Microsoft.Blur(pixelradius="+radius+")";if(params.options.fixMargin||1){params.image.style.marginLeft=(parseInt(params.image.style.marginLeft,10)||0)-Math.round(radius)+"px";params.image.style.marginTop=(parseInt(params.image.style.marginTop,10)||0)-Math.round(radius)+"px"}return true}},checkSupport:function(){return Pixastic.Client.hasCanvas()||Pixastic.Client.isIE()}};Pixastic.Actions.brightness={process:function(params){var brightness=parseInt(params.options.brightness,10)||0;var contrast=parseFloat(params.options.contrast)||0;var legacy=!!(params.options.legacy&&params.options.legacy!="false");if(legacy){brightness=Math.min(150,Math.max(-150,brightness))}else{var brightMul=1+Math.min(150,Math.max(-150,brightness))/150}contrast=Math.max(0,contrast+1);if(Pixastic.Client.hasCanvasImageData()){var data=Pixastic.prepareData(params);var rect=params.options.rect;var w=rect.width;var h=rect.height;var p=w*h;var pix=p*4,pix1,pix2;var mul,add;if(contrast!=1){if(legacy){mul=contrast;add=(brightness-128)*contrast+128}else{mul=brightMul*contrast;add=-contrast*128+128}}else{if(legacy){mul=1;add=brightness}else{mul=brightMul;add=0}}var r,g,b;while(p--){if((r=data[pix-=4]*mul+add)>255)data[pix]=255;else if(r<0)data[pix]=0;else data[pix]=r;if((g=data[pix1=pix+1]*mul+add)>255)data[pix1]=255;else if(g<0)data[pix1]=0;else data[pix1]=g;if((b=data[pix2=pix+2]*mul+add)>255)data[pix2]=255;else if(b<0)data[pix2]=0;else data[pix2]=b}return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.coloradjust={process:function(params){var red=parseFloat(params.options.red)||0;var green=parseFloat(params.options.green)||0;var blue=parseFloat(params.options.blue)||0;red=Math.round(red*255);green=Math.round(green*255);blue=Math.round(blue*255);if(Pixastic.Client.hasCanvasImageData()){var data=Pixastic.prepareData(params);var rect=params.options.rect;var p=rect.width*rect.height;var pix=p*4,pix1,pix2;var r,g,b;while(p--){pix-=4;if(red){if((r=data[pix]+red)<0)data[pix]=0;else if(r>255)data[pix]=255;else data[pix]=r}if(green){if((g=data[pix1=pix+1]+green)<0)data[pix1]=0;else if(g>255)data[pix1]=255;else data[pix1]=g}if(blue){if((b=data[pix2=pix+2]+blue)<0)data[pix2]=0;else if(b>255)data[pix2]=255;else data[pix2]=b}}return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.colorhistogram={array256:function(default_value){arr=[];for(var i=0;i<256;i++){arr[i]=default_value}return arr},process:function(params){var values=[];if(typeof params.options.returnValue!="object"){params.options.returnValue={rvals:[],gvals:[],bvals:[]}}var paint=!!params.options.paint;var returnValue=params.options.returnValue;if(typeof returnValue.values!="array"){returnValue.rvals=[];returnValue.gvals=[];returnValue.bvals=[]}if(Pixastic.Client.hasCanvasImageData()){var data=Pixastic.prepareData(params);params.useData=false;var rvals=this.array256(0);var gvals=this.array256(0);var bvals=this.array256(0);var rect=params.options.rect;var p=rect.width*rect.height;var pix=p*4;while(p--){rvals[data[pix-=4]]++;gvals[data[pix+1]]++;bvals[data[pix+2]]++}returnValue.rvals=rvals;returnValue.gvals=gvals;returnValue.bvals=bvals;if(paint){var ctx=params.canvas.getContext("2d");var vals=[rvals,gvals,bvals];for(var v=0;v<3;v++){var yoff=(v+1)*params.height/3;var maxValue=0;for(var i=0;i<256;i++){if(vals[v][i]>maxValue)maxValue=vals[v][i]}var heightScale=params.height/3/maxValue;var widthScale=params.width/256;if(v==0)ctx.fillStyle="rgba(255,0,0,0.5)";else if(v==1)ctx.fillStyle="rgba(0,255,0,0.5)";else if(v==2)ctx.fillStyle="rgba(0,0,255,0.5)";for(var i=0;i<256;i++){ctx.fillRect(i*widthScale,params.height-heightScale*vals[v][i]-params.height+yoff,widthScale,vals[v][i]*heightScale)}}}return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.crop={process:function(params){if(Pixastic.Client.hasCanvas()){var rect=params.options.rect;var width=rect.width;var height=rect.height;var top=rect.top;var left=rect.left;if(typeof params.options.left!="undefined")left=parseInt(params.options.left,10);if(typeof params.options.top!="undefined")top=parseInt(params.options.top,10);if(typeof params.options.height!="undefined")width=parseInt(params.options.width,10);if(typeof params.options.height!="undefined")height=parseInt(params.options.height,10);if(left<0)left=0;if(left>params.width-1)left=params.width-1;if(top<0)top=0;if(top>params.height-1)top=params.height-1;if(width<1)width=1;if(left+width>params.width)width=params.width-left;if(height<1)height=1;if(top+height>params.height)height=params.height-top;var copy=document.createElement("canvas");copy.width=params.width;copy.height=params.height;copy.getContext("2d").drawImage(params.canvas,0,0);params.canvas.width=width;params.canvas.height=height;params.canvas.getContext("2d").clearRect(0,0,width,height);params.canvas.getContext("2d").drawImage(copy,left,top,width,height,0,0,width,height);params.useData=false;return true}},checkSupport:function(){return Pixastic.Client.hasCanvas()}};Pixastic.Actions.desaturate={process:function(params){var useAverage=!!(params.options.average&&params.options.average!="false");if(Pixastic.Client.hasCanvasImageData()){var data=Pixastic.prepareData(params);var rect=params.options.rect;var w=rect.width;var h=rect.height;var p=w*h;var pix=p*4,pix1,pix2;if(useAverage){while(p--)data[pix-=4]=data[pix1=pix+1]=data[pix2=pix+2]=(data[pix]+data[pix1]+data[pix2])/3}else{while(p--)data[pix-=4]=data[pix1=pix+1]=data[pix2=pix+2]=data[pix]*.3+data[pix1]*.59+data[pix2]*.11}return true}else if(Pixastic.Client.isIE()){params.image.style.filter+=" gray";return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()||Pixastic.Client.isIE()}};Pixastic.Actions.edges={process:function(params){var mono=!!(params.options.mono&&params.options.mono!="false");var invert=!!(params.options.invert&&params.options.invert!="false");if(Pixastic.Client.hasCanvasImageData()){var data=Pixastic.prepareData(params);var dataCopy=Pixastic.prepareData(params,true);var c=-1/8;var kernel=[[c,c,c],[c,1,c],[c,c,c]];weight=1/c;var rect=params.options.rect;var w=rect.width;var h=rect.height;var w4=w*4;var y=h;do{var offsetY=(y-1)*w4;var nextY=y==h?y-1:y;var prevY=y==1?0:y-2;var offsetYPrev=prevY*w*4;var offsetYNext=nextY*w*4;var x=w;do{var offset=offsetY+(x*4-4);var offsetPrev=offsetYPrev+(x==1?0:x-2)*4;var offsetNext=offsetYNext+(x==w?x-1:x)*4;var r=((dataCopy[offsetPrev-4]+dataCopy[offsetPrev]+dataCopy[offsetPrev+4]+dataCopy[offset-4]+dataCopy[offset+4]+dataCopy[offsetNext-4]+dataCopy[offsetNext]+dataCopy[offsetNext+4])*c+dataCopy[offset])*weight;var g=((dataCopy[offsetPrev-3]+dataCopy[offsetPrev+1]+dataCopy[offsetPrev+5]+dataCopy[offset-3]+dataCopy[offset+5]+dataCopy[offsetNext-3]+dataCopy[offsetNext+1]+dataCopy[offsetNext+5])*c+dataCopy[offset+1])*weight;var b=((dataCopy[offsetPrev-2]+dataCopy[offsetPrev+2]+dataCopy[offsetPrev+6]+dataCopy[offset-2]+dataCopy[offset+6]+dataCopy[offsetNext-2]+dataCopy[offsetNext+2]+dataCopy[offsetNext+6])*c+dataCopy[offset+2])*weight;if(mono){var brightness=r*.3+g*.59+b*.11||0;if(invert)brightness=255-brightness;if(brightness<0)brightness=0;if(brightness>255)brightness=255;r=g=b=brightness}else{if(invert){r=255-r;g=255-g;b=255-b}if(r<0)r=0;if(g<0)g=0;if(b<0)b=0;if(r>255)r=255;if(g>255)g=255;if(b>255)b=255}data[offset]=r;data[offset+1]=g;data[offset+2]=b}while(--x)}while(--y);return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.edges2={process:function(params){if(Pixastic.Client.hasCanvasImageData()){var data=Pixastic.prepareData(params);var dataCopy=Pixastic.prepareData(params,true);var rect=params.options.rect;var w=rect.width;var h=rect.height;var w4=w*4;var pixel=w4+4;var hm1=h-1;var wm1=w-1;for(var y=1;y<hm1;++y){var centerRow=pixel-4;var priorRow=centerRow-w4;var nextRow=centerRow+w4;var r1=-dataCopy[priorRow]-dataCopy[centerRow]-dataCopy[nextRow];var g1=-dataCopy[++priorRow]-dataCopy[++centerRow]-dataCopy[++nextRow];var b1=-dataCopy[++priorRow]-dataCopy[++centerRow]-dataCopy[++nextRow];var rp=dataCopy[priorRow+=2];var gp=dataCopy[++priorRow];var bp=dataCopy[++priorRow];var rc=dataCopy[centerRow+=2];var gc=dataCopy[++centerRow];var bc=dataCopy[++centerRow];var rn=dataCopy[nextRow+=2];var gn=dataCopy[++nextRow];var bn=dataCopy[++nextRow];var r2=-rp-rc-rn;var g2=-gp-gc-gn;var b2=-bp-bc-bn;for(var x=1;x<wm1;++x){centerRow=pixel+4;priorRow=centerRow-w4;nextRow=centerRow+w4;var r=127+r1-rp-rc*-8-rn;var g=127+g1-gp-gc*-8-gn;var b=127+b1-bp-bc*-8-bn;r1=r2;g1=g2;b1=b2;rp=dataCopy[priorRow];gp=dataCopy[++priorRow];bp=dataCopy[++priorRow];rc=dataCopy[centerRow];gc=dataCopy[++centerRow];bc=dataCopy[++centerRow];rn=dataCopy[nextRow];gn=dataCopy[++nextRow];bn=dataCopy[++nextRow];r+=r2=-rp-rc-rn;g+=g2=-gp-gc-gn;b+=b2=-bp-bc-bn;if(r>255)r=255;if(g>255)g=255;if(b>255)b=255;if(r<0)r=0;if(g<0)g=0;if(b<0)b=0;data[pixel]=r;data[++pixel]=g;data[++pixel]=b;pixel+=2}pixel+=8}return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.emboss={process:function(params){var strength=parseFloat(params.options.strength)||1;var greyLevel=typeof params.options.greyLevel!="undefined"?parseInt(params.options.greyLevel):180;var direction=params.options.direction||"topleft";var blend=!!(params.options.blend&&params.options.blend!="false");var dirY=0;var dirX=0;switch(direction){case"topleft":dirY=-1;dirX=-1;break;case"top":dirY=-1;dirX=0;break;case"topright":dirY=-1;dirX=1;break;case"right":dirY=0;dirX=1;break;case"bottomright":dirY=1;dirX=1;break;case"bottom":dirY=1;dirX=0;break;case"bottomleft":dirY=1;dirX=-1;break;case"left":dirY=0;dirX=-1;break}if(Pixastic.Client.hasCanvasImageData()){var data=Pixastic.prepareData(params);var dataCopy=Pixastic.prepareData(params,true);var invertAlpha=!!params.options.invertAlpha;var rect=params.options.rect;var w=rect.width;var h=rect.height;var w4=w*4;var y=h;do{var offsetY=(y-1)*w4;var otherY=dirY;if(y+otherY<1)otherY=0;if(y+otherY>h)otherY=0;var offsetYOther=(y-1+otherY)*w*4;var x=w;do{var offset=offsetY+(x-1)*4;var otherX=dirX;if(x+otherX<1)otherX=0;if(x+otherX>w)otherX=0;var offsetOther=offsetYOther+(x-1+otherX)*4;var dR=dataCopy[offset]-dataCopy[offsetOther];var dG=dataCopy[offset+1]-dataCopy[offsetOther+1];var dB=dataCopy[offset+2]-dataCopy[offsetOther+2];var dif=dR;var absDif=dif>0?dif:-dif;var absG=dG>0?dG:-dG;var absB=dB>0?dB:-dB;if(absG>absDif){dif=dG}if(absB>absDif){dif=dB}dif*=strength;if(blend){var r=data[offset]+dif;var g=data[offset+1]+dif;var b=data[offset+2]+dif;data[offset]=r>255?255:r<0?0:r;data[offset+1]=g>255?255:g<0?0:g;data[offset+2]=b>255?255:b<0?0:b}else{var grey=greyLevel-dif;if(grey<0){grey=0}else if(grey>255){grey=255}data[offset]=data[offset+1]=data[offset+2]=grey}}while(--x)}while(--y);return true}else if(Pixastic.Client.isIE()){params.image.style.filter+=" progid:DXImageTransform.Microsoft.emboss()";return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()||Pixastic.Client.isIE()}};Pixastic.Actions.flip={process:function(params){var rect=params.options.rect;var copyCanvas=document.createElement("canvas");copyCanvas.width=rect.width;copyCanvas.height=rect.height;copyCanvas.getContext("2d").drawImage(params.image,rect.left,rect.top,rect.width,rect.height,0,0,rect.width,rect.height);var ctx=params.canvas.getContext("2d");ctx.clearRect(rect.left,rect.top,rect.width,rect.height);if(params.options.axis=="horizontal"){ctx.scale(-1,1);ctx.drawImage(copyCanvas,-rect.left-rect.width,rect.top,rect.width,rect.height)}else{ctx.scale(1,-1);ctx.drawImage(copyCanvas,rect.left,-rect.top-rect.height,rect.width,rect.height)}params.useData=false;return true},checkSupport:function(){return Pixastic.Client.hasCanvas()}};Pixastic.Actions.fliph={process:function(params){if(Pixastic.Client.hasCanvas()){var rect=params.options.rect;var copyCanvas=document.createElement("canvas");copyCanvas.width=rect.width;copyCanvas.height=rect.height;copyCanvas.getContext("2d").drawImage(params.image,rect.left,rect.top,rect.width,rect.height,0,0,rect.width,rect.height);var ctx=params.canvas.getContext("2d");ctx.clearRect(rect.left,rect.top,rect.width,rect.height);ctx.scale(-1,1);ctx.drawImage(copyCanvas,-rect.left-rect.width,rect.top,rect.width,rect.height);params.useData=false;return true}else if(Pixastic.Client.isIE()){params.image.style.filter+=" fliph";return true}},checkSupport:function(){return Pixastic.Client.hasCanvas()||Pixastic.Client.isIE()}};Pixastic.Actions.flipv={process:function(params){if(Pixastic.Client.hasCanvas()){var rect=params.options.rect;var copyCanvas=document.createElement("canvas");copyCanvas.width=rect.width;copyCanvas.height=rect.height;copyCanvas.getContext("2d").drawImage(params.image,rect.left,rect.top,rect.width,rect.height,0,0,rect.width,rect.height);var ctx=params.canvas.getContext("2d");ctx.clearRect(rect.left,rect.top,rect.width,rect.height);ctx.scale(1,-1);ctx.drawImage(copyCanvas,rect.left,-rect.top-rect.height,rect.width,rect.height);params.useData=false;return true}else if(Pixastic.Client.isIE()){params.image.style.filter+=" flipv";return true}},checkSupport:function(){return Pixastic.Client.hasCanvas()||Pixastic.Client.isIE()}};Pixastic.Actions.glow={process:function(params){var amount=parseFloat(params.options.amount)||0;var blurAmount=parseFloat(params.options.radius)||0;amount=Math.min(1,Math.max(0,amount));blurAmount=Math.min(5,Math.max(0,blurAmount));if(Pixastic.Client.hasCanvasImageData()){var rect=params.options.rect;var blurCanvas=document.createElement("canvas");blurCanvas.width=params.width;blurCanvas.height=params.height;var blurCtx=blurCanvas.getContext("2d");blurCtx.drawImage(params.canvas,0,0);var scale=2;var smallWidth=Math.round(params.width/scale);var smallHeight=Math.round(params.height/scale);var copy=document.createElement("canvas");copy.width=smallWidth;copy.height=smallHeight;var clear=true;var steps=Math.round(blurAmount*20);var copyCtx=copy.getContext("2d");for(var i=0;i<steps;i++){var scaledWidth=Math.max(1,Math.round(smallWidth-i));var scaledHeight=Math.max(1,Math.round(smallHeight-i));copyCtx.clearRect(0,0,smallWidth,smallHeight);copyCtx.drawImage(blurCanvas,0,0,params.width,params.height,0,0,scaledWidth,scaledHeight);blurCtx.clearRect(0,0,params.width,params.height);blurCtx.drawImage(copy,0,0,scaledWidth,scaledHeight,0,0,params.width,params.height)}var data=Pixastic.prepareData(params);var blurData=Pixastic.prepareData({canvas:blurCanvas,options:params.options});var p=rect.width*rect.height;var pix=p*4,pix1=pix+1,pix2=pix+2,pix3=pix+3;while(p--){if((data[pix-=4]+=amount*blurData[pix])>255)data[pix]=255;if((data[pix1-=4]+=amount*blurData[pix1])>255)data[pix1]=255;if((data[pix2-=4]+=amount*blurData[pix2])>255)data[pix2]=255}return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.histogram={process:function(params){var average=!!(params.options.average&&params.options.average!="false");var paint=!!(params.options.paint&&params.options.paint!="false");var color=params.options.color||"rgba(255,255,255,0.5)";var values=[];if(typeof params.options.returnValue!="object"){params.options.returnValue={values:[]}}var returnValue=params.options.returnValue;if(typeof returnValue.values!="array"){returnValue.values=[]}values=returnValue.values;if(Pixastic.Client.hasCanvasImageData()){var data=Pixastic.prepareData(params);params.useData=false;for(var i=0;i<256;i++){values[i]=0}var rect=params.options.rect;var p=rect.width*rect.height;var pix=p*4,pix1=pix+1,pix2=pix+2,pix3=pix+3;var round=Math.round;if(average){while(p--){values[round((data[pix-=4]+data[pix+1]+data[pix+2])/3)]++}}else{while(p--){values[round(data[pix-=4]*.3+data[pix+1]*.59+data[pix+2]*.11)]++}}if(paint){var maxValue=0;for(var i=0;i<256;i++){if(values[i]>maxValue){maxValue=values[i]}}var heightScale=params.height/maxValue;var widthScale=params.width/256;var ctx=params.canvas.getContext("2d");ctx.fillStyle=color;for(var i=0;i<256;i++){ctx.fillRect(i*widthScale,params.height-heightScale*values[i],widthScale,values[i]*heightScale)}}returnValue.values=values;return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.hsl={process:function(params){var hue=parseInt(params.options.hue,10)||0;var saturation=(parseInt(params.options.saturation,10)||0)/100;var lightness=(parseInt(params.options.lightness,10)||0)/100;if(saturation<0){var satMul=1+saturation}else{var satMul=1+saturation*2}hue=hue%360/360;var hue6=hue*6;var rgbDiv=1/255;var light255=lightness*255;var lightp1=1+lightness;var lightm1=1-lightness;if(Pixastic.Client.hasCanvasImageData()){var data=Pixastic.prepareData(params);var rect=params.options.rect;var p=rect.width*rect.height;var pix=p*4,pix1=pix+1,pix2=pix+2,pix3=pix+3;while(p--){var r=data[pix-=4];var g=data[pix1=pix+1];var b=data[pix2=pix+2];if(hue!=0||saturation!=0){var vs=r;if(g>vs)vs=g;if(b>vs)vs=b;var ms=r;if(g<ms)ms=g;if(b<ms)ms=b;var vm=vs-ms;var l=(ms+vs)/510;if(l>0){if(vm>0){if(l<=.5){var s=vm/(vs+ms)*satMul;if(s>1)s=1;var v=l*(1+s)}else{var s=vm/(510-vs-ms)*satMul;if(s>1)s=1;var v=l+s-l*s}if(r==vs){if(g==ms)var h=5+(vs-b)/vm+hue6;else var h=1-(vs-g)/vm+hue6}else if(g==vs){if(b==ms)var h=1+(vs-r)/vm+hue6;else var h=3-(vs-b)/vm+hue6}else{if(r==ms)var h=3+(vs-g)/vm+hue6;else var h=5-(vs-r)/vm+hue6}if(h<0)h+=6;if(h>=6)h-=6;var m=l+l-v;var sextant=h>>0;if(sextant==0){r=v*255;g=(m+(v-m)*(h-sextant))*255;b=m*255}else if(sextant==1){r=(v-(v-m)*(h-sextant))*255;g=v*255;b=m*255}else if(sextant==2){r=m*255;g=v*255;b=(m+(v-m)*(h-sextant))*255}else if(sextant==3){r=m*255;g=(v-(v-m)*(h-sextant))*255;b=v*255}else if(sextant==4){r=(m+(v-m)*(h-sextant))*255;g=m*255;b=v*255}else if(sextant==5){r=v*255;g=m*255;b=(v-(v-m)*(h-sextant))*255}}}}if(lightness<0){r*=lightp1;g*=lightp1;b*=lightp1}else if(lightness>0){r=r*lightm1+light255;g=g*lightm1+light255;b=b*lightm1+light255}if(r<0)data[pix]=0;else if(r>255)data[pix]=255;else data[pix]=r;if(g<0)data[pix1]=0;else if(g>255)data[pix1]=255;else data[pix1]=g;if(b<0)data[pix2]=0;else if(b>255)data[pix2]=255;else data[pix2]=b}return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.invert={process:function(params){if(Pixastic.Client.hasCanvasImageData()){var data=Pixastic.prepareData(params);var invertAlpha=!!params.options.invertAlpha;var rect=params.options.rect;var p=rect.width*rect.height;var pix=p*4,pix1=pix+1,pix2=pix+2,pix3=pix+3;while(p--){data[pix-=4]=255-data[pix];data[pix1-=4]=255-data[pix1];data[pix2-=4]=255-data[pix2];if(invertAlpha)data[pix3-=4]=255-data[pix3]}return true}else if(Pixastic.Client.isIE()){params.image.style.filter+=" invert";return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()||Pixastic.Client.isIE()}};Pixastic.Actions.laplace={process:function(params){var strength=1;var invert=!!(params.options.invert&&params.options.invert!="false");var contrast=parseFloat(params.options.edgeStrength)||0;var greyLevel=parseInt(params.options.greyLevel)||0;contrast=-contrast;if(Pixastic.Client.hasCanvasImageData()){var data=Pixastic.prepareData(params);var dataCopy=Pixastic.prepareData(params,true);var kernel=[[-1,-1,-1],[-1,8,-1],[-1,-1,-1]];var weight=1/8;var rect=params.options.rect;var w=rect.width;var h=rect.height;var w4=w*4;var y=h;do{var offsetY=(y-1)*w4;var nextY=y==h?y-1:y;var prevY=y==1?0:y-2;var offsetYPrev=prevY*w*4;var offsetYNext=nextY*w*4;var x=w;do{var offset=offsetY+(x*4-4);var offsetPrev=offsetYPrev+(x==1?0:x-2)*4;var offsetNext=offsetYNext+(x==w?x-1:x)*4;var r=(-dataCopy[offsetPrev-4]-dataCopy[offsetPrev]-dataCopy[offsetPrev+4]-dataCopy[offset-4]-dataCopy[offset+4]-dataCopy[offsetNext-4]-dataCopy[offsetNext]-dataCopy[offsetNext+4]+dataCopy[offset]*8)*weight;var g=(-dataCopy[offsetPrev-3]-dataCopy[offsetPrev+1]-dataCopy[offsetPrev+5]-dataCopy[offset-3]-dataCopy[offset+5]-dataCopy[offsetNext-3]-dataCopy[offsetNext+1]-dataCopy[offsetNext+5]+dataCopy[offset+1]*8)*weight;var b=(-dataCopy[offsetPrev-2]-dataCopy[offsetPrev+2]-dataCopy[offsetPrev+6]-dataCopy[offset-2]-dataCopy[offset+6]-dataCopy[offsetNext-2]-dataCopy[offsetNext+2]-dataCopy[offsetNext+6]+dataCopy[offset+2]*8)*weight;var brightness=(r+g+b)/3+greyLevel;if(contrast!=0){if(brightness>127){brightness+=(brightness+1-128)*contrast}else if(brightness<127){brightness-=(brightness+1)*contrast}}if(invert){brightness=255-brightness}if(brightness<0)brightness=0;if(brightness>255)brightness=255;data[offset]=data[offset+1]=data[offset+2]=brightness}while(--x)}while(--y);return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.lighten={process:function(params){var amount=parseFloat(params.options.amount)||0;amount=Math.max(-1,Math.min(1,amount));if(Pixastic.Client.hasCanvasImageData()){var data=Pixastic.prepareData(params);var rect=params.options.rect;var p=rect.width*rect.height;var pix=p*4,pix1=pix+1,pix2=pix+2;var mul=amount+1;while(p--){if((data[pix-=4]=data[pix]*mul)>255)data[pix]=255;if((data[pix1-=4]=data[pix1]*mul)>255)data[pix1]=255;if((data[pix2-=4]=data[pix2]*mul)>255)data[pix2]=255}return true}else if(Pixastic.Client.isIE()){var img=params.image;if(amount<0){img.style.filter+=" light()";img.filters[img.filters.length-1].addAmbient(255,255,255,100*-amount)}else if(amount>0){img.style.filter+=" light()";
img.filters[img.filters.length-1].addAmbient(255,255,255,100);img.filters[img.filters.length-1].addAmbient(255,255,255,100*amount)}return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()||Pixastic.Client.isIE()}};Pixastic.Actions.mosaic={process:function(params){var blockSize=Math.max(1,parseInt(params.options.blockSize,10));if(Pixastic.Client.hasCanvasImageData()){var rect=params.options.rect;var w=rect.width;var h=rect.height;var w4=w*4;var y=h;var ctx=params.canvas.getContext("2d");var pixel=document.createElement("canvas");pixel.width=pixel.height=1;var pixelCtx=pixel.getContext("2d");var copy=document.createElement("canvas");copy.width=w;copy.height=h;var copyCtx=copy.getContext("2d");copyCtx.drawImage(params.canvas,rect.left,rect.top,w,h,0,0,w,h);for(var y=0;y<h;y+=blockSize){for(var x=0;x<w;x+=blockSize){var blockSizeX=blockSize;var blockSizeY=blockSize;if(blockSizeX+x>w)blockSizeX=w-x;if(blockSizeY+y>h)blockSizeY=h-y;pixelCtx.drawImage(copy,x,y,blockSizeX,blockSizeY,0,0,1,1);var data=pixelCtx.getImageData(0,0,1,1).data;ctx.fillStyle="rgb("+data[0]+","+data[1]+","+data[2]+")";ctx.fillRect(rect.left+x,rect.top+y,blockSize,blockSize)}}params.useData=false;return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.noise={process:function(params){var amount=0;var strength=0;var mono=false;if(typeof params.options.amount!="undefined")amount=parseFloat(params.options.amount)||0;if(typeof params.options.strength!="undefined")strength=parseFloat(params.options.strength)||0;if(typeof params.options.mono!="undefined")mono=!!(params.options.mono&&params.options.mono!="false");amount=Math.max(0,Math.min(1,amount));strength=Math.max(0,Math.min(1,strength));var noise=128*strength;var noise2=noise/2;if(Pixastic.Client.hasCanvasImageData()){var data=Pixastic.prepareData(params);var rect=params.options.rect;var w=rect.width;var h=rect.height;var w4=w*4;var y=h;var random=Math.random;do{var offsetY=(y-1)*w4;var x=w;do{var offset=offsetY+(x-1)*4;if(random()<amount){if(mono){var pixelNoise=-noise2+random()*noise;var r=data[offset]+pixelNoise;var g=data[offset+1]+pixelNoise;var b=data[offset+2]+pixelNoise}else{var r=data[offset]-noise2+random()*noise;var g=data[offset+1]-noise2+random()*noise;var b=data[offset+2]-noise2+random()*noise}if(r<0)r=0;if(g<0)g=0;if(b<0)b=0;if(r>255)r=255;if(g>255)g=255;if(b>255)b=255;data[offset]=r;data[offset+1]=g;data[offset+2]=b}}while(--x)}while(--y);return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.posterize={process:function(params){var numLevels=256;if(typeof params.options.levels!="undefined")numLevels=parseInt(params.options.levels,10)||1;if(Pixastic.Client.hasCanvasImageData()){var data=Pixastic.prepareData(params);numLevels=Math.max(2,Math.min(256,numLevels));var numAreas=256/numLevels;var numValues=256/(numLevels-1);var rect=params.options.rect;var w=rect.width;var h=rect.height;var w4=w*4;var y=h;do{var offsetY=(y-1)*w4;var x=w;do{var offset=offsetY+(x-1)*4;var r=numValues*(data[offset]/numAreas>>0);var g=numValues*(data[offset+1]/numAreas>>0);var b=numValues*(data[offset+2]/numAreas>>0);if(r>255)r=255;if(g>255)g=255;if(b>255)b=255;data[offset]=r;data[offset+1]=g;data[offset+2]=b}while(--x)}while(--y);return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.pointillize={process:function(params){var radius=Math.max(1,parseInt(params.options.radius,10));var density=Math.min(5,Math.max(0,parseFloat(params.options.density)||0));var noise=Math.max(0,parseFloat(params.options.noise)||0);var transparent=!!(params.options.transparent&&params.options.transparent!="false");if(Pixastic.Client.hasCanvasImageData()){var rect=params.options.rect;var w=rect.width;var h=rect.height;var w4=w*4;var y=h;var ctx=params.canvas.getContext("2d");var canvasWidth=params.canvas.width;var canvasHeight=params.canvas.height;var pixel=document.createElement("canvas");pixel.width=pixel.height=1;var pixelCtx=pixel.getContext("2d");var copy=document.createElement("canvas");copy.width=w;copy.height=h;var copyCtx=copy.getContext("2d");copyCtx.drawImage(params.canvas,rect.left,rect.top,w,h,0,0,w,h);var diameter=radius*2;if(transparent)ctx.clearRect(rect.left,rect.top,rect.width,rect.height);var noiseRadius=radius*noise;var dist=1/density;for(var y=0;y<h+radius;y+=diameter*dist){for(var x=0;x<w+radius;x+=diameter*dist){rndX=noise?x+(Math.random()*2-1)*noiseRadius>>0:x;rndY=noise?y+(Math.random()*2-1)*noiseRadius>>0:y;var pixX=rndX-radius;var pixY=rndY-radius;if(pixX<0)pixX=0;if(pixY<0)pixY=0;var cx=rndX+rect.left;var cy=rndY+rect.top;if(cx<0)cx=0;if(cx>canvasWidth)cx=canvasWidth;if(cy<0)cy=0;if(cy>canvasHeight)cy=canvasHeight;var diameterX=diameter;var diameterY=diameter;if(diameterX+pixX>w)diameterX=w-pixX;if(diameterY+pixY>h)diameterY=h-pixY;if(diameterX<1)diameterX=1;if(diameterY<1)diameterY=1;pixelCtx.drawImage(copy,pixX,pixY,diameterX,diameterY,0,0,1,1);var data=pixelCtx.getImageData(0,0,1,1).data;ctx.fillStyle="rgb("+data[0]+","+data[1]+","+data[2]+")";ctx.beginPath();ctx.arc(cx,cy,radius,0,Math.PI*2,true);ctx.closePath();ctx.fill()}}params.useData=false;return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.removenoise={process:function(params){if(Pixastic.Client.hasCanvasImageData()){var data=Pixastic.prepareData(params);var rect=params.options.rect;var w=rect.width;var h=rect.height;var w4=w*4;var y=h;do{var offsetY=(y-1)*w4;var nextY=y==h?y-1:y;var prevY=y==1?0:y-2;var offsetYPrev=prevY*w*4;var offsetYNext=nextY*w*4;var x=w;do{var offset=offsetY+(x*4-4);var offsetPrev=offsetYPrev+(x==1?0:x-2)*4;var offsetNext=offsetYNext+(x==w?x-1:x)*4;var minR,maxR,minG,maxG,minB,maxB;minR=maxR=data[offsetPrev];var r1=data[offset-4],r2=data[offset+4],r3=data[offsetNext];if(r1<minR)minR=r1;if(r2<minR)minR=r2;if(r3<minR)minR=r3;if(r1>maxR)maxR=r1;if(r2>maxR)maxR=r2;if(r3>maxR)maxR=r3;minG=maxG=data[offsetPrev+1];var g1=data[offset-3],g2=data[offset+5],g3=data[offsetNext+1];if(g1<minG)minG=g1;if(g2<minG)minG=g2;if(g3<minG)minG=g3;if(g1>maxG)maxG=g1;if(g2>maxG)maxG=g2;if(g3>maxG)maxG=g3;minB=maxB=data[offsetPrev+2];var b1=data[offset-2],b2=data[offset+6],b3=data[offsetNext+2];if(b1<minB)minB=b1;if(b2<minB)minB=b2;if(b3<minB)minB=b3;if(b1>maxB)maxB=b1;if(b2>maxB)maxB=b2;if(b3>maxB)maxB=b3;if(data[offset]>maxR){data[offset]=maxR}else if(data[offset]<minR){data[offset]=minR}if(data[offset+1]>maxG){data[offset+1]=maxG}else if(data[offset+1]<minG){data[offset+1]=minG}if(data[offset+2]>maxB){data[offset+2]=maxB}else if(data[offset+2]<minB){data[offset+2]=minB}}while(--x)}while(--y);return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.resize={process:function(params){if(Pixastic.Client.hasCanvas()){var width=parseInt(params.options.width,10);var height=parseInt(params.options.height,10);var canvas=params.canvas;if(width<1)width=1;if(width<2)width=2;var copy=document.createElement("canvas");copy.width=width;copy.height=height;copy.getContext("2d").drawImage(canvas,0,0,width,height);canvas.width=width;canvas.height=height;canvas.getContext("2d").drawImage(copy,0,0);params.useData=false;return true}},checkSupport:function(){return Pixastic.Client.hasCanvas()}};Pixastic.Actions.rotate={process:function(params){if(Pixastic.Client.hasCanvas()){var canvas=params.canvas;var width=params.width;var height=params.height;var copy=document.createElement("canvas");copy.width=width;copy.height=height;copy.getContext("2d").drawImage(canvas,0,0,width,height);var angle=-parseFloat(params.options.angle)*Math.PI/180;var dimAngle=angle;if(dimAngle>Math.PI*.5)dimAngle=Math.PI-dimAngle;if(dimAngle<-Math.PI*.5)dimAngle=-Math.PI-dimAngle;var diag=Math.sqrt(width*width+height*height);var diagAngle1=Math.abs(dimAngle)-Math.abs(Math.atan2(height,width));var diagAngle2=Math.abs(dimAngle)+Math.abs(Math.atan2(height,width));var newWidth=Math.abs(Math.cos(diagAngle1)*diag);var newHeight=Math.abs(Math.sin(diagAngle2)*diag);canvas.width=newWidth;canvas.height=newHeight;var ctx=canvas.getContext("2d");ctx.translate(newWidth/2,newHeight/2);ctx.rotate(angle);ctx.drawImage(copy,-width/2,-height/2);params.useData=false;return true}},checkSupport:function(){return Pixastic.Client.hasCanvas()}};Pixastic.Actions.sepia={process:function(params){var mode=parseInt(params.options.mode,10)||0;if(mode<0)mode=0;if(mode>1)mode=1;if(Pixastic.Client.hasCanvasImageData()){var data=Pixastic.prepareData(params);var rect=params.options.rect;var w=rect.width;var h=rect.height;var w4=w*4;var y=h;do{var offsetY=(y-1)*w4;var x=w;do{var offset=offsetY+(x-1)*4;if(mode){var d=data[offset]*.299+data[offset+1]*.587+data[offset+2]*.114;var r=d+39;var g=d+14;var b=d-36}else{var or=data[offset];var og=data[offset+1];var ob=data[offset+2];var r=or*.393+og*.769+ob*.189;var g=or*.349+og*.686+ob*.168;var b=or*.272+og*.534+ob*.131}if(r<0)r=0;if(r>255)r=255;if(g<0)g=0;if(g>255)g=255;if(b<0)b=0;if(b>255)b=255;data[offset]=r;data[offset+1]=g;data[offset+2]=b}while(--x)}while(--y);return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.sharpen={process:function(params){var strength=0;if(typeof params.options.amount!="undefined")strength=parseFloat(params.options.amount)||0;if(strength<0)strength=0;if(strength>1)strength=1;if(Pixastic.Client.hasCanvasImageData()){var data=Pixastic.prepareData(params);var dataCopy=Pixastic.prepareData(params,true);var mul=15;var mulOther=1+3*strength;var kernel=[[0,-mulOther,0],[-mulOther,mul,-mulOther],[0,-mulOther,0]];var weight=0;for(var i=0;i<3;i++){for(var j=0;j<3;j++){weight+=kernel[i][j]}}weight=1/weight;var rect=params.options.rect;var w=rect.width;var h=rect.height;mul*=weight;mulOther*=weight;var w4=w*4;var y=h;do{var offsetY=(y-1)*w4;var nextY=y==h?y-1:y;var prevY=y==1?0:y-2;var offsetYPrev=prevY*w4;var offsetYNext=nextY*w4;var x=w;do{var offset=offsetY+(x*4-4);var offsetPrev=offsetYPrev+(x==1?0:x-2)*4;var offsetNext=offsetYNext+(x==w?x-1:x)*4;var r=(-dataCopy[offsetPrev]-dataCopy[offset-4]-dataCopy[offset+4]-dataCopy[offsetNext])*mulOther+dataCopy[offset]*mul;var g=(-dataCopy[offsetPrev+1]-dataCopy[offset-3]-dataCopy[offset+5]-dataCopy[offsetNext+1])*mulOther+dataCopy[offset+1]*mul;var b=(-dataCopy[offsetPrev+2]-dataCopy[offset-2]-dataCopy[offset+6]-dataCopy[offsetNext+2])*mulOther+dataCopy[offset+2]*mul;if(r<0)r=0;if(g<0)g=0;if(b<0)b=0;if(r>255)r=255;if(g>255)g=255;if(b>255)b=255;data[offset]=r;data[offset+1]=g;data[offset+2]=b}while(--x)}while(--y);return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.solarize={process:function(params){var useAverage=!!(params.options.average&&params.options.average!="false");if(Pixastic.Client.hasCanvasImageData()){var data=Pixastic.prepareData(params);var rect=params.options.rect;var w=rect.width;var h=rect.height;var w4=w*4;var y=h;do{var offsetY=(y-1)*w4;var x=w;do{var offset=offsetY+(x-1)*4;var r=data[offset];var g=data[offset+1];var b=data[offset+2];if(r>127)r=255-r;if(g>127)g=255-g;if(b>127)b=255-b;data[offset]=r;data[offset+1]=g;data[offset+2]=b}while(--x)}while(--y);return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.unsharpmask={process:function(params){var amount=parseFloat(params.options.amount)||0;var blurAmount=parseFloat(params.options.radius)||0;var threshold=parseFloat(params.options.threshold)||0;amount=Math.min(500,Math.max(0,amount))/2;blurAmount=Math.min(5,Math.max(0,blurAmount))/10;threshold=Math.min(255,Math.max(0,threshold));threshold--;var thresholdNeg=-threshold;amount*=.016;amount++;if(Pixastic.Client.hasCanvasImageData()){var rect=params.options.rect;var blurCanvas=document.createElement("canvas");blurCanvas.width=params.width;blurCanvas.height=params.height;var blurCtx=blurCanvas.getContext("2d");blurCtx.drawImage(params.canvas,0,0);var scale=2;var smallWidth=Math.round(params.width/scale);var smallHeight=Math.round(params.height/scale);var copy=document.createElement("canvas");copy.width=smallWidth;copy.height=smallHeight;var steps=Math.round(blurAmount*20);var copyCtx=copy.getContext("2d");for(var i=0;i<steps;i++){var scaledWidth=Math.max(1,Math.round(smallWidth-i));var scaledHeight=Math.max(1,Math.round(smallHeight-i));copyCtx.clearRect(0,0,smallWidth,smallHeight);copyCtx.drawImage(blurCanvas,0,0,params.width,params.height,0,0,scaledWidth,scaledHeight);blurCtx.clearRect(0,0,params.width,params.height);blurCtx.drawImage(copy,0,0,scaledWidth,scaledHeight,0,0,params.width,params.height)}var data=Pixastic.prepareData(params);var blurData=Pixastic.prepareData({canvas:blurCanvas,options:params.options});var w=rect.width;var h=rect.height;var w4=w*4;var y=h;do{var offsetY=(y-1)*w4;var x=w;do{var offset=offsetY+(x*4-4);var difR=data[offset]-blurData[offset];if(difR>threshold||difR<thresholdNeg){var blurR=blurData[offset];blurR=amount*difR+blurR;data[offset]=blurR>255?255:blurR<0?0:blurR}var difG=data[offset+1]-blurData[offset+1];if(difG>threshold||difG<thresholdNeg){var blurG=blurData[offset+1];blurG=amount*difG+blurG;data[offset+1]=blurG>255?255:blurG<0?0:blurG}var difB=data[offset+2]-blurData[offset+2];if(difB>threshold||difB<thresholdNeg){var blurB=blurData[offset+2];blurB=amount*difB+blurB;data[offset+2]=blurB>255?255:blurB<0?0:blurB}}while(--x)}while(--y);return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};var Base64={toBase64Table:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",base64Pad:"=",encode:function(data){"use strict";var result="",chrTable=Base64.toBase64Table.split(""),pad=Base64.base64Pad,length=data.length,i;for(i=0;i<length-2;i+=3){result+=chrTable[data[i]>>2];result+=chrTable[((data[i]&3)<<4)+(data[i+1]>>4)];result+=chrTable[((data[i+1]&15)<<2)+(data[i+2]>>6)];result+=chrTable[data[i+2]&63]}if(length%3){i=length-length%3;result+=chrTable[data[i]>>2];if(length%3===2){result+=chrTable[((data[i]&3)<<4)+(data[i+1]>>4)];result+=chrTable[(data[i+1]&15)<<2];result+=pad}else{result+=chrTable[(data[i]&3)<<4];result+=pad+pad}}return result},toBinaryTable:[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,0,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1],decode:function(data,offset){"use strict";offset=typeof offset!=="undefined"?offset:0;var binTable=Base64.toBinaryTable,pad=Base64.base64Pad,result,result_length,idx,i,c,padding,leftbits=0,leftdata=0,data_length=data.indexOf("=")-offset;if(data_length<0){data_length=data.length-offset}result_length=(data_length>>2)*3+Math.floor(data_length%4/1.5);result=new Array(result_length);for(idx=0,i=offset;i<data.length;i++){c=binTable[data.charCodeAt(i)&127];padding=data.charAt(i)===pad;if(c===-1){console.error("Illegal character code "+data.charCodeAt(i)+" at position "+i);continue}leftdata=leftdata<<6|c;leftbits+=6;if(leftbits>=8){leftbits-=8;if(!padding){result[idx++]=leftdata>>leftbits&255}leftdata&=(1<<leftbits)-1}}if(leftbits){throw{name:"Base64-Error",message:"Corrupted base64 string"}}return result},_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encodeStr:function(input){var output="";var chr1,chr2,chr3,enc1,enc2,enc3,enc4;var i=0;input=Base64._utf8_encode(input);while(i<input.length){chr1=input.charCodeAt(i++);chr2=input.charCodeAt(i++);chr3=input.charCodeAt(i++);enc1=chr1>>2;enc2=(chr1&3)<<4|chr2>>4;enc3=(chr2&15)<<2|chr3>>6;enc4=chr3&63;if(isNaN(chr2)){enc3=enc4=64}else if(isNaN(chr3)){enc4=64}output=output+this._keyStr.charAt(enc1)+this._keyStr.charAt(enc2)+this._keyStr.charAt(enc3)+this._keyStr.charAt(enc4)}return output},decodeStr:function(input){var output="";var chr1,chr2,chr3;var enc1,enc2,enc3,enc4;var i=0;input=input.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(i<input.length){enc1=this._keyStr.indexOf(input.charAt(i++));enc2=this._keyStr.indexOf(input.charAt(i++));enc3=this._keyStr.indexOf(input.charAt(i++));enc4=this._keyStr.indexOf(input.charAt(i++));chr1=enc1<<2|enc2>>4;chr2=(enc2&15)<<4|enc3>>2;chr3=(enc3&3)<<6|enc4;output=output+String.fromCharCode(chr1);if(enc3!=64){output=output+String.fromCharCode(chr2)}if(enc4!=64){output=output+String.fromCharCode(chr3)}}output=Base64._utf8_decode(output);return output},_utf8_encode:function(string){string=string.replace(/\r\n/g,"\n");var utftext="";for(var n=0;n<string.length;n++){var c=string.charCodeAt(n);if(c<128){utftext+=String.fromCharCode(c)}else if(c>127&&c<2048){utftext+=String.fromCharCode(c>>6|192);utftext+=String.fromCharCode(c&63|128)}else{utftext+=String.fromCharCode(c>>12|224);utftext+=String.fromCharCode(c>>6&63|128);utftext+=String.fromCharCode(c&63|128)}}return utftext},_utf8_decode:function(utftext){var string="";var i=0;var c=c1=c2=0;while(i<utftext.length){c=utftext.charCodeAt(i);if(c<128){string+=String.fromCharCode(c);i++}else if(c>191&&c<224){c2=utftext.charCodeAt(i+1);string+=String.fromCharCode((c&31)<<6|c2&63);i+=2}else{c2=utftext.charCodeAt(i+1);c3=utftext.charCodeAt(i+2);string+=String.fromCharCode((c&15)<<12|(c2&63)<<6|c3&63);i+=3}}return string}};if(!Array.prototype.map){Array.prototype.map=function(fun){var len=this.length>>>0;if(typeof fun!=="function"){throw new TypeError}var res=new Array(len);var thisp=arguments[1];for(var i=0;i<len;i++){if(i in this){res[i]=fun.call(thisp,this[i],i,this)}}return res}}function BigInteger(n,s){if(!(this instanceof BigInteger)){if(n instanceof BigInteger){return n}else if(typeof n==="undefined"){return BigInteger.ZERO}return BigInteger.parse(n)}n=n||[];while(n.length&&!n[n.length-1]){--n.length}this._d=n;this._s=n.length?s||1:0}BigInteger.base=1e7;BigInteger.base_log10=7;BigInteger.init=function(){BigInteger.ZERO=new BigInteger([],0);BigInteger.ONE=new BigInteger([1],1);BigInteger.M_ONE=new BigInteger(BigInteger.ONE._d,-1);BigInteger._0=BigInteger.ZERO;BigInteger._1=BigInteger.ONE;BigInteger.small=[BigInteger.ZERO,BigInteger.ONE,new BigInteger([2],1),new BigInteger([3],1),new BigInteger([4],1),new BigInteger([5],1),new BigInteger([6],1),new BigInteger([7],1),new BigInteger([8],1),new BigInteger([9],1),new BigInteger([10],1),new BigInteger([11],1),new BigInteger([12],1),new BigInteger([13],1),new BigInteger([14],1),new BigInteger([15],1),new BigInteger([16],1),new BigInteger([17],1),new BigInteger([18],1),new BigInteger([19],1),new BigInteger([20],1),new BigInteger([21],1),new BigInteger([22],1),new BigInteger([23],1),new BigInteger([24],1),new BigInteger([25],1),new BigInteger([26],1),new BigInteger([27],1),new BigInteger([28],1),new BigInteger([29],1),new BigInteger([30],1),new BigInteger([31],1),new BigInteger([32],1),new BigInteger([33],1),new BigInteger([34],1),new BigInteger([35],1),new BigInteger([36],1)]};BigInteger.init();BigInteger.digits="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");BigInteger.prototype.toString=function(base){base=+base||10;if(base<2||base>36){throw new Error("illegal radix "+base+".")}if(this._s===0){return"0"}if(base===10){var str=this._s<0?"-":"";str+=this._d[this._d.length-1].toString();for(var i=this._d.length-2;i>=0;i--){var group=this._d[i].toString();while(group.length<BigInteger.base_log10)group="0"+group;str+=group}return str}else{var numerals=BigInteger.digits;base=BigInteger.small[base];var sign=this._s;var n=this.abs();var digits=[];var digit;while(n._s!==0){var divmod=n.divRem(base);n=divmod[0];digit=divmod[1];digits.push(numerals[digit.valueOf()])}return(sign<0?"-":"")+digits.reverse().join("")}};BigInteger.radixRegex=[/^$/,/^$/,/^[01]*$/,/^[012]*$/,/^[0-3]*$/,/^[0-4]*$/,/^[0-5]*$/,/^[0-6]*$/,/^[0-7]*$/,/^[0-8]*$/,/^[0-9]*$/,/^[0-9aA]*$/,/^[0-9abAB]*$/,/^[0-9abcABC]*$/,/^[0-9a-dA-D]*$/,/^[0-9a-eA-E]*$/,/^[0-9a-fA-F]*$/,/^[0-9a-gA-G]*$/,/^[0-9a-hA-H]*$/,/^[0-9a-iA-I]*$/,/^[0-9a-jA-J]*$/,/^[0-9a-kA-K]*$/,/^[0-9a-lA-L]*$/,/^[0-9a-mA-M]*$/,/^[0-9a-nA-N]*$/,/^[0-9a-oA-O]*$/,/^[0-9a-pA-P]*$/,/^[0-9a-qA-Q]*$/,/^[0-9a-rA-R]*$/,/^[0-9a-sA-S]*$/,/^[0-9a-tA-T]*$/,/^[0-9a-uA-U]*$/,/^[0-9a-vA-V]*$/,/^[0-9a-wA-W]*$/,/^[0-9a-xA-X]*$/,/^[0-9a-yA-Y]*$/,/^[0-9a-zA-Z]*$/];BigInteger.parse=function(s,base){function expandExponential(str){str=str.replace(/\s*[*xX]\s*10\s*(\^|\*\*)\s*/,"e");return str.replace(/^([+\-])?(\d+)\.?(\d*)[eE]([+\-]?\d+)$/,function(x,s,n,f,c){c=+c;var l=c<0;var i=n.length+c;x=(l?n:f).length;c=(c=Math.abs(c))>=x?c-x+l:0;var z=new Array(c+1).join("0");var r=n+f;return(s||"")+(l?r=z+r:r+=z).substr(0,i+=l?z.length:0)+(i<r.length?"."+r.substr(i):"")})}s=s.toString();if(typeof base==="undefined"||+base===10){s=expandExponential(s)}var parts=/^([+\-]?)(0[xXcCbB])?([0-9A-Za-z]*)(?:\.\d*)?$/.exec(s);if(parts){var sign=parts[1]||"+";var baseSection=parts[2]||"";var digits=parts[3]||"";if(typeof base==="undefined"){if(baseSection==="0x"||baseSection==="0X"){base=16}else if(baseSection==="0c"||baseSection==="0C"){base=8}else if(baseSection==="0b"||baseSection==="0B"){base=2}else{base=10}}else if(base<2||base>36){throw new Error("Illegal radix "+base+".")}base=+base;if(!BigInteger.radixRegex[base].test(digits)){throw new Error("Bad digit for radix "+base)}digits=digits.replace(/^0+/,"").split("");if(digits.length===0){return BigInteger.ZERO}sign=sign==="-"?-1:1;if(base==10){var d=[];while(digits.length>=BigInteger.base_log10){d.push(parseInt(digits.splice(-BigInteger.base_log10).join(""),10))}d.push(parseInt(digits.join(""),10));return new BigInteger(d,sign)}if(base===BigInteger.base){return new BigInteger(digits.map(Number).reverse(),sign)}var d=BigInteger.ZERO;base=BigInteger.small[base];var small=BigInteger.small;for(var i=0;i<digits.length;i++){d=d.multiply(base).add(small[parseInt(digits[i],36)])}return new BigInteger(d._d,sign)}else{throw new Error("Invalid BigInteger format: "+s)}};BigInteger.prototype.add=function(n){if(this._s===0){return BigInteger(n)}n=BigInteger(n);if(n._s===0){return this}if(this._s!==n._s){n=n.negate();return this.subtract(n)}var a=this._d;var b=n._d;var al=a.length;var bl=b.length;var sum=new Array(Math.max(al,bl)+1);var size=Math.min(al,bl);var carry=0;var digit;for(var i=0;i<size;i++){digit=a[i]+b[i]+carry;sum[i]=digit%BigInteger.base;carry=digit/BigInteger.base|0}if(bl>al){a=b;al=bl}for(i=size;carry&&i<al;i++){digit=a[i]+carry;sum[i]=digit%BigInteger.base;carry=digit/BigInteger.base|0}if(carry){sum[i]=carry}for(;i<al;i++){sum[i]=a[i]}return new BigInteger(sum,this._s)};BigInteger.prototype.negate=function(){return new BigInteger(this._d,-this._s)};BigInteger.prototype.abs=function(){return this._s<0?this.negate():this};BigInteger.prototype.subtract=function(n){if(this._s===0){return BigInteger(n).negate()}n=BigInteger(n);if(n._s===0){return this}if(this._s!==n._s){n=n.negate();return this.add(n)}var m=this;var t;if(this._s<0){t=m;m=new BigInteger(n._d,1);n=new BigInteger(t._d,1)}var sign=m.compareAbs(n);if(sign===0){return BigInteger.ZERO}else if(sign<0){t=n;n=m;m=t}var a=m._d;var b=n._d;var al=a.length;var bl=b.length;var diff=new Array(al);var borrow=0;var i;var digit;for(i=0;i<bl;i++){digit=a[i]-borrow-b[i];if(digit<0){digit+=BigInteger.base;borrow=1}else{borrow=0}diff[i]=digit}for(i=bl;i<al;i++){digit=a[i]-borrow;if(digit<0){digit+=BigInteger.base}else{diff[i++]=digit;break}diff[i]=digit}for(;i<al;i++){diff[i]=a[i]}return new BigInteger(diff,sign)};(function(){function addOne(n,sign){var a=n._d;var sum=a.slice();var carry=true;var i=0;while(true){var digit=(a[i]||0)+1;sum[i]=digit%BigInteger.base;if(digit<=BigInteger.base-1){break}++i}return new BigInteger(sum,sign)}function subtractOne(n,sign){var a=n._d;var sum=a.slice();var borrow=true;var i=0;while(true){var digit=(a[i]||0)-1;if(digit<0){sum[i]=digit+BigInteger.base}else{sum[i]=digit;break}++i}return new BigInteger(sum,sign)}BigInteger.prototype.next=function(){switch(this._s){case 0:return BigInteger.ONE;case-1:return subtractOne(this,-1);default:return addOne(this,1)}};BigInteger.prototype.prev=function(){switch(this._s){case 0:return BigInteger.M_ONE;case-1:return addOne(this,-1);default:return subtractOne(this,1)}}})();BigInteger.prototype.compareAbs=function(n){if(this===n){return 0}if(!(n instanceof BigInteger)){if(!isFinite(n)){return isNaN(n)?n:-1}n=BigInteger(n)}if(this._s===0){return n._s!==0?-1:0}if(n._s===0){return 1}var l=this._d.length;var nl=n._d.length;if(l<nl){return-1}else if(l>nl){return 1}var a=this._d;var b=n._d;for(var i=l-1;i>=0;i--){if(a[i]!==b[i]){return a[i]<b[i]?-1:1}}return 0};BigInteger.prototype.compare=function(n){if(this===n){return 0}n=BigInteger(n);if(this._s===0){return-n._s}if(this._s===n._s){var cmp=this.compareAbs(n);return cmp*this._s}else{return this._s}};BigInteger.prototype.isUnit=function(){return this===BigInteger.ONE||this===BigInteger.M_ONE||this._d.length===1&&this._d[0]===1};BigInteger.prototype.multiply=function(n){if(this._s===0){return BigInteger.ZERO}n=BigInteger(n);if(n._s===0){return BigInteger.ZERO}if(this.isUnit()){if(this._s<0){return n.negate()}return n}if(n.isUnit()){if(n._s<0){return this.negate()}return this}if(this===n){return this.square()}var r=this._d.length>=n._d.length;var a=(r?this:n)._d;var b=(r?n:this)._d;var al=a.length;var bl=b.length;var pl=al+bl;var partial=new Array(pl);var i;for(i=0;i<pl;i++){partial[i]=0}for(i=0;i<bl;i++){var carry=0;var bi=b[i];var jlimit=al+i;var digit;for(var j=i;j<jlimit;j++){digit=partial[j]+bi*a[j-i]+carry;carry=digit/BigInteger.base|0;partial[j]=digit%BigInteger.base|0}if(carry){digit=partial[j]+carry;carry=digit/BigInteger.base|0;partial[j]=digit%BigInteger.base}}return new BigInteger(partial,this._s*n._s)};BigInteger.prototype.multiplySingleDigit=function(n){if(n===0||this._s===0){return BigInteger.ZERO}if(n===1){return this}var digit;if(this._d.length===1){digit=this._d[0]*n;if(digit>=BigInteger.base){return new BigInteger([digit%BigInteger.base|0,digit/BigInteger.base|0],1)}return new BigInteger([digit],1)}if(n===2){return this.add(this)}if(this.isUnit()){return new BigInteger([n],1)}var a=this._d;var al=a.length;var pl=al+1;var partial=new Array(pl);for(var i=0;i<pl;i++){partial[i]=0}var carry=0;for(var j=0;j<al;j++){digit=n*a[j]+carry;carry=digit/BigInteger.base|0;partial[j]=digit%BigInteger.base|0}if(carry){digit=carry;carry=digit/BigInteger.base|0;partial[j]=digit%BigInteger.base}return new BigInteger(partial,1)};BigInteger.prototype.square=function(){if(this._s===0){return BigInteger.ZERO}if(this.isUnit()){return BigInteger.ONE}var digits=this._d;var length=digits.length;var imult1=new Array(length+length+1);var product,carry,k;var i;for(i=0;i<length;i++){k=i*2;product=digits[i]*digits[i];carry=product/BigInteger.base|0;imult1[k]=product%BigInteger.base;imult1[k+1]=carry}for(i=0;i<length;i++){carry=0;k=i*2+1;for(var j=i+1;j<length;j++,k++){product=digits[j]*digits[i]*2+imult1[k]+carry;carry=product/BigInteger.base|0;imult1[k]=product%BigInteger.base}k=length+i;var digit=carry+imult1[k];carry=digit/BigInteger.base|0;imult1[k]=digit%BigInteger.base;imult1[k+1]+=carry}return new BigInteger(imult1,1)};BigInteger.prototype.quotient=function(n){return this.divRem(n)[0]};BigInteger.prototype.divide=BigInteger.prototype.quotient;BigInteger.prototype.remainder=function(n){return this.divRem(n)[1]};BigInteger.prototype.divRem=function(n){n=BigInteger(n);if(n._s===0){throw new Error("Divide by zero")}if(this._s===0){return[BigInteger.ZERO,BigInteger.ZERO]}if(n._d.length===1){return this.divRemSmall(n._s*n._d[0])}switch(this.compareAbs(n)){case 0:return[this._s===n._s?BigInteger.ONE:BigInteger.M_ONE,BigInteger.ZERO];case-1:return[BigInteger.ZERO,this]}var sign=this._s*n._s;var a=n.abs();var b_digits=this._d.slice();var digits=n._d.length;var max=b_digits.length;var quot=[];var guess;var part=new BigInteger([],1);part._s=1;while(b_digits.length){part._d.unshift(b_digits.pop());part=new BigInteger(part._d,1);if(part.compareAbs(n)<0){quot.push(0);continue}if(part._s===0){guess=0}else{var xlen=part._d.length,ylen=a._d.length;var highx=part._d[xlen-1]*BigInteger.base+part._d[xlen-2];var highy=a._d[ylen-1]*BigInteger.base+a._d[ylen-2];if(part._d.length>a._d.length){highx=(highx+1)*BigInteger.base}guess=Math.ceil(highx/highy)}do{var check=a.multiplySingleDigit(guess);if(check.compareAbs(part)<=0){break}guess--}while(guess);quot.push(guess);if(!guess){continue}var diff=part.subtract(check);part._d=diff._d.slice()}return[new BigInteger(quot.reverse(),sign),new BigInteger(part._d,this._s)]};BigInteger.prototype.divRemSmall=function(n){var r;n=+n;if(n===0){throw new Error("Divide by zero")}var n_s=n<0?-1:1;var sign=this._s*n_s;n=Math.abs(n);if(n<1||n>=BigInteger.base){throw new Error("Argument out of range")}if(this._s===0){return[BigInteger.ZERO,BigInteger.ZERO]}if(n===1||n===-1){return[sign===1?this.abs():new BigInteger(this._d,sign),BigInteger.ZERO]}if(this._d.length===1){var q=new BigInteger([this._d[0]/n|0],1);r=new BigInteger([this._d[0]%n|0],1);if(sign<0){q=q.negate()}if(this._s<0){r=r.negate()}return[q,r]}var digits=this._d.slice();var quot=new Array(digits.length);var part=0;var diff=0;var i=0;var guess;while(digits.length){part=part*BigInteger.base+digits[digits.length-1];if(part<n){quot[i++]=0;digits.pop();diff=BigInteger.base*diff+part;continue}if(part===0){guess=0}else{guess=part/n|0}var check=n*guess;diff=part-check;quot[i++]=guess;if(!guess){digits.pop();continue}digits.pop();part=diff}r=new BigInteger([diff],1);if(this._s<0){r=r.negate()}return[new BigInteger(quot.reverse(),sign),r]};BigInteger.prototype.isEven=function(){var digits=this._d;return this._s===0||digits.length===0||digits[0]%2===0};BigInteger.prototype.isOdd=function(){return!this.isEven()};BigInteger.prototype.sign=function(){return this._s};BigInteger.prototype.isPositive=function(){return this._s>0};BigInteger.prototype.isNegative=function(){return this._s<0};BigInteger.prototype.isZero=function(){return this._s===0};BigInteger.prototype.exp10=function(n){n=+n;if(n===0){return this}if(Math.abs(n)>Number(BigInteger.MAX_EXP)){throw new Error("exponent too large in BigInteger.exp10")}if(n>0){var k=new BigInteger(this._d.slice(),this._s);for(;n>=BigInteger.base_log10;n-=BigInteger.base_log10){k._d.unshift(0)}if(n==0)return k;k._s=1;k=k.multiplySingleDigit(Math.pow(10,n));return this._s<0?k.negate():k}else if(-n>=this._d.length*BigInteger.base_log10){return BigInteger.ZERO}else{var k=new BigInteger(this._d.slice(),this._s);for(n=-n;n>=BigInteger.base_log10;n-=BigInteger.base_log10){k._d.shift()}return n==0?k:k.divRemSmall(Math.pow(10,n))[0]}};BigInteger.prototype.pow=function(n){if(this.isUnit()){if(this._s>0){return this}else{return BigInteger(n).isOdd()?this:this.negate()}}n=BigInteger(n);if(n._s===0){return BigInteger.ONE}else if(n._s<0){if(this._s===0){throw new Error("Divide by zero")}else{return BigInteger.ZERO}}if(this._s===0){return BigInteger.ZERO}if(n.isUnit()){return this}if(n.compareAbs(BigInteger.MAX_EXP)>0){throw new Error("exponent too large in BigInteger.pow")}var x=this;var aux=BigInteger.ONE;var two=BigInteger.small[2];while(n.isPositive()){if(n.isOdd()){aux=aux.multiply(x);if(n.isUnit()){return aux}}x=x.square();n=n.quotient(two)}return aux};BigInteger.prototype.modPow=function(exponent,modulus){var result=BigInteger.ONE;var base=this;while(exponent.isPositive()){if(exponent.isOdd()){result=result.multiply(base).remainder(modulus)}exponent=exponent.quotient(BigInteger.small[2]);if(exponent.isPositive()){base=base.square().remainder(modulus)}}return result};BigInteger.prototype.log=function(){switch(this._s){case 0:return-Infinity;case-1:return NaN;default:}var l=this._d.length;if(l*BigInteger.base_log10<30){return Math.log(this.valueOf())}var N=Math.ceil(30/BigInteger.base_log10);var firstNdigits=this._d.slice(l-N);return Math.log(new BigInteger(firstNdigits,1).valueOf())+(l-N)*Math.log(BigInteger.base)};BigInteger.prototype.valueOf=function(){return parseInt(this.toString(),10);
};BigInteger.prototype.toJSValue=function(){return parseInt(this.toString(),10)};BigInteger.MAX_EXP=BigInteger(2147483647);(function(){function makeUnary(fn){return function(a){return fn.call(BigInteger(a))}}function makeBinary(fn){return function(a,b){return fn.call(BigInteger(a),BigInteger(b))}}function makeTrinary(fn){return function(a,b,c){return fn.call(BigInteger(a),BigInteger(b),BigInteger(c))}}(function(){var i,fn;var unary="toJSValue,isEven,isOdd,sign,isZero,isNegative,abs,isUnit,square,negate,isPositive,toString,next,prev,log".split(",");var binary="compare,remainder,divRem,subtract,add,quotient,divide,multiply,pow,compareAbs".split(",");var trinary=["modPow"];for(i=0;i<unary.length;i++){fn=unary[i];BigInteger[fn]=makeUnary(BigInteger.prototype[fn])}for(i=0;i<binary.length;i++){fn=binary[i];BigInteger[fn]=makeBinary(BigInteger.prototype[fn])}for(i=0;i<trinary.length;i++){fn=trinary[i];BigInteger[fn]=makeTrinary(BigInteger.prototype[fn])}BigInteger.exp10=function(x,n){return BigInteger(x).exp10(n)}})()})();if(typeof exports!=="undefined"){exports.BigInteger=BigInteger}var VirtualJoystick=function(opts){opts=opts||{};this._container=opts.container||document.body;this._stickEl=opts.stickElement||this._buildJoystickStick();this._baseEl=opts.baseElement||this._buildJoystickBase();this._mouseLeft=opts.mouseLeft||this._buildJoystickButton();this._mouseSupport="mouseSupport"in opts?opts.mouseSupport:false;this._range=opts.range||60;this._timer=null;this._callback="callback"in opts?opts.callback:false;this._callbackcontext="callbackcontext"in opts?opts.callbackcontext:this;this._callbackButton="callbackbutton"in opts?opts.callbackbutton:false;this._referenceItem=opts.referenceItem;this._container.style.position="relative";this._container.appendChild(this._baseEl);this._container.appendChild(this._mouseLeft);this._baseEl.style.position="absolute";this._baseEl.style.display="block";this._mouseLeft.style.position="absolute";this._mouseLeft.style.display="block";var jcnt=$(this._referenceItem);var baseTop=jcnt.height()-jcnt.offset().top-130;var baseLeft=20;var baseRight=20;this._baseEl.style.top=baseTop+"px";this._baseEl.style.left=baseLeft+"px";this._container.appendChild(this._stickEl);this._stickEl.style.position="absolute";this._stickEl.style.display="none";this._mouseLeft.style.top=baseTop+20+"px";this._mouseLeft.style.right=baseRight+"px";this._pressed=false;this._baseX=0;this._baseY=0;this._stickX=0;this._stickY=0;__bind=function(fn,me){return function(){return fn.apply(me,arguments)}};this._$onTouchStart=__bind(this._onTouchStart,this);this._$onTouchEnd=__bind(this._onTouchEnd,this);this._$onTouchMove=__bind(this._onTouchMove,this);this._$onTouchStartButton=__bind(this._onTouchStartButton,this);this._$onTouchEndButton=__bind(this._onTouchEndButton,this);this._baseEl.addEventListener("touchstart",this._$onTouchStart,false);this._mouseLeft.addEventListener("touchstart",this._$onTouchStartButton,false);this._mouseLeft.addEventListener("touchend",this._$onTouchEndButton,false);this._container.addEventListener("touchend",this._$onTouchEnd,false);this._container.addEventListener("touchmove",this._$onTouchMove,false);if(this._mouseSupport){this._$onMouseDown=__bind(this._onMouseDown,this);this._$onMouseUp=__bind(this._onMouseUp,this);this._$onMouseMove=__bind(this._onMouseMove,this);this._$onMouseDownButton=__bind(this._onMouseDownButton,this);this._$onMouseUpButton=__bind(this._onMouseUpButton,this);this._baseEl.addEventListener("mousedown",this._$onMouseDown,false);this._container.addEventListener("mouseup",this._$onMouseUp,false);this._mouseLeft.addEventListener("mousedown",this._$onTouchStartButton,false);this._mouseLeft.addEventListener("mouseup",this._$onTouchEndButton,false);this._container.addEventListener("mousemove",this._$onMouseMove,false)}};VirtualJoystick.prototype.destroy=function(){this._container.removeChild(this._baseEl);this._container.removeChild(this._stickEl);this._mouseLeft.removeEventListener("touchstart",this._$onTouchStartButton,false);this._mouseLeft.removeEventListener("touchend",this._$onTouchEndButton,false);this._container.removeChild(this._mouseLeft);this._container.removeEventListener("touchstart",this._$onTouchStart,false);this._container.removeEventListener("touchend",this._$onTouchEnd,false);this._container.removeEventListener("touchmove",this._$onTouchMove,false);if(this._mouseSupport){this._container.removeEventListener("mouseup",this._$onMouseUp,false);this._container.removeEventListener("mousedown",this._$onMouseDown,false);this._container.removeEventListener("mousemove",this._$onMouseMove,false)}};VirtualJoystick.touchScreenAvailable=function(){return"createTouch"in document?true:false};VirtualJoystick.prototype.deltaX=function(){return this._stickX-this._baseX};VirtualJoystick.prototype.deltaY=function(){return this._stickY-this._baseY};VirtualJoystick.prototype.up=function(){if(this._pressed===false)return false;var deltaX=this.deltaX();var deltaY=this.deltaY();if(deltaY>=0)return false;if(Math.abs(deltaY)<this._range&&Math.abs(deltaY)<Math.abs(deltaX)){return false}return true};VirtualJoystick.prototype.down=function(){if(this._pressed===false)return false;var deltaX=this.deltaX();var deltaY=this.deltaY();if(deltaY<=0)return false;if(Math.abs(deltaY)<this._range&&Math.abs(deltaY)<Math.abs(deltaX)){return false}return true};VirtualJoystick.prototype.right=function(){if(this._pressed===false)return false;var deltaX=this.deltaX();var deltaY=this.deltaY();if(deltaX<=0)return false;if(Math.abs(deltaX)<this._range&&Math.abs(deltaY)>Math.abs(deltaX)){return false}return true};VirtualJoystick.prototype.left=function(){if(this._pressed===false)return false;var deltaX=this.deltaX();var deltaY=this.deltaY();if(deltaX>=0)return false;if(Math.abs(deltaX)<this._range&&Math.abs(deltaY)>Math.abs(deltaX)){return false}return true};VirtualJoystick.prototype._onUp=function(){this._pressed=false;this._stickEl.style.display="none";this._baseX=this._baseY=0;this._stickX=this._stickY=0;this._eraseInterval()};VirtualJoystick.prototype._onDown=function(x,y){this._pressed=true;this._stickX=x;this._stickY=y;this._stickEl.style.display="";this._stickEl.style.left=this._stickX-this._stickEl.width/2+"px";this._stickEl.style.top=this._stickY-this._stickEl.height/2+"px";this._startInterval()};VirtualJoystick.prototype._onMove=function(x,y){if(this._pressed===true){this._stickX=x;this._stickY=y;this._stickEl.style.left=x-this._stickEl.width/2+"px";this._stickEl.style.top=y-this._stickEl.height/2+"px";this._startInterval()}};VirtualJoystick.prototype._startInterval=function(x,y){this._eraseInterval();var centerXBase=$(this._baseEl).offset().left+$(this._baseEl).width()/2;var centerXStick=$(this._stickEl).offset().left+$(this._stickEl).width()/2;this.offsetX=parseInt((centerXStick-centerXBase)/5);var centerYBase=$(this._baseEl).offset().top+$(this._baseEl).height()/2;var centerYStick=$(this._stickEl).offset().top+$(this._stickEl).height()/2;this.offsetY=parseInt((centerYStick-centerYBase)/5);if(this.offsetX>15){this.offsetX=15}if(this.offsetY>15){this.offsetY=15}var self=this;this._timer=setInterval(function(){if(self._callback){self._callback.call(self._callbackcontext,[self.offsetX,self.offsetY])}},10)};VirtualJoystick.prototype._eraseInterval=function(){if(this._timer){clearTimeout(this._timer);this._timer=null}};VirtualJoystick.prototype._onMouseUp=function(event){return this._onUp()};VirtualJoystick.prototype._onMouseDown=function(event){var x=event.pageX;var y=event.pageY;return this._onDown(x,y)};VirtualJoystick.prototype._onMouseMove=function(event){var x=event.pageX;var y=event.pageY;return this._onMove(x,y)};VirtualJoystick.prototype._onTouchStart=function(event){if(event.touches.length!=1)return;event.preventDefault();var x=event.touches[0].pageX;var y=event.touches[0].pageY;return this._onDown(x,y)};VirtualJoystick.prototype._onTouchEnd=function(event){event.preventDefault();return this._onUp()};VirtualJoystick.prototype._onTouchMove=function(event){if(event.touches&&event.touches.length!=1)return;event.preventDefault();var x=event.touches[0].pageX;var y=event.touches[0].pageY;return this._onMove(x,y)};VirtualJoystick.prototype._onTouchStartButton=function(event){if(event.touches&&event.touches.length!=1)return;event.preventDefault();this._callbackButton.call(this._callbackcontext,["down"])};VirtualJoystick.prototype._onTouchEndButton=function(event){event.preventDefault();this._callbackButton.call(this._callbackcontext,["up"])};VirtualJoystick.prototype._buildJoystickBase=function(){var canvas=document.createElement("canvas");canvas.style.zIndex=2;canvas.width=126;canvas.height=126;var ctx=canvas.getContext("2d");ctx.beginPath();ctx.strokeStyle="cyan";ctx.lineWidth=6;ctx.arc(canvas.width/2,canvas.width/2,40,0,Math.PI*2,true);ctx.stroke();ctx.beginPath();ctx.strokeStyle="cyan";ctx.lineWidth=2;ctx.arc(canvas.width/2,canvas.width/2,60,0,Math.PI*2,true);ctx.stroke();return canvas};VirtualJoystick.prototype._buildJoystickStick=function(){var canvas=document.createElement("canvas");canvas.style.zIndex=2;canvas.width=86;canvas.height=86;var ctx=canvas.getContext("2d");ctx.beginPath();ctx.strokeStyle="cyan";ctx.lineWidth=6;ctx.arc(canvas.width/2,canvas.width/2,40,0,Math.PI*2,true);ctx.stroke();return canvas};VirtualJoystick.prototype._buildJoystickButton=function(){var canvas=document.createElement("canvas");canvas.style.zIndex=2;canvas.width=86;canvas.height=86;var ctx=canvas.getContext("2d");ctx.beginPath();ctx.strokeStyle="green";ctx.lineWidth=6;ctx.arc(canvas.width/2,canvas.width/2,40,0,Math.PI*2,true);ctx.stroke();return canvas};var prettyPrint=function(){var util={el:function(type,attrs){var el=document.createElement(type),attr;attrs=util.merge({},attrs);if(attrs&&attrs.style){var styles=attrs.style;util.applyCSS(el,attrs.style);delete attrs.style}for(attr in attrs){if(attrs.hasOwnProperty(attr)){el[attr]=attrs[attr]}}return el},applyCSS:function(el,styles){for(var prop in styles){if(styles.hasOwnProperty(prop)){try{el.style[prop]=styles[prop]}catch(e){}}}},txt:function(t){return document.createTextNode(t)},row:function(cells,type,cellType){cellType=cellType||"td";var colSpan=util.count(cells,null)+1,tr=util.el("tr"),td,attrs={style:util.getStyles(cellType,type),colSpan:colSpan,onmouseover:function(){var tds=this.parentNode.childNodes;util.forEach(tds,function(cell){if(cell.nodeName.toLowerCase()!=="td"){return}util.applyCSS(cell,util.getStyles("td_hover",type))})},onmouseout:function(){var tds=this.parentNode.childNodes;util.forEach(tds,function(cell){if(cell.nodeName.toLowerCase()!=="td"){return}util.applyCSS(cell,util.getStyles("td",type))})}};util.forEach(cells,function(cell){if(cell===null){return}td=util.el(cellType,attrs);if(cell.nodeType){td.appendChild(cell)}else{td.innerHTML=util.shorten(cell.toString())}tr.appendChild(td)});return tr},hRow:function(cells,type){return util.row(cells,type,"th")},table:function(headings,type){headings=headings||[];var attrs={thead:{style:util.getStyles("thead",type)},tbody:{style:util.getStyles("tbody",type)},table:{style:util.getStyles("table",type)}},tbl=util.el("table",attrs.table),thead=util.el("thead",attrs.thead),tbody=util.el("tbody",attrs.tbody);if(headings.length){tbl.appendChild(thead);thead.appendChild(util.hRow(headings,type))}tbl.appendChild(tbody);return{node:tbl,tbody:tbody,thead:thead,appendChild:function(node){this.tbody.appendChild(node)},addRow:function(cells,_type,cellType){this.appendChild(util.row.call(util,cells,_type||type,cellType));return this}}},shorten:function(str){var max=40;str=str.replace(/^\s\s*|\s\s*$|\n/g,"");return str.length>max?str.substring(0,max-1)+"...":str},htmlentities:function(str){return str.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},merge:function(target,source){if(typeof target!=="object"){target={}}for(var property in source){if(source.hasOwnProperty(property)){var sourceProperty=source[property];if(typeof sourceProperty==="object"){target[property]=util.merge(target[property],sourceProperty);continue}target[property]=sourceProperty}}for(var a=2,l=arguments.length;a<l;a++){util.merge(target,arguments[a])}return target},count:function(arr,item){var count=0;for(var i=0,l=arr.length;i<l;i++){if(arr[i]===item){count++}}return count},thead:function(tbl){return tbl.getElementsByTagName("thead")[0]},forEach:function(arr,max,fn){if(!fn){fn=max}var len=arr.length,index=-1;while(++index<len){if(fn(arr[index],index,arr)===false){break}}return true},type:function(v){try{if(v===null){return"null"}if(v===undefined){return"undefined"}var oType=Object.prototype.toString.call(v).match(/\s(.+?)\]/)[1].toLowerCase();if(v.nodeType){if(v.nodeType===1){return"domelement"}return"domnode"}if(/^(string|number|array|regexp|function|date|boolean)$/.test(oType)){return oType}if(typeof v==="object"){return v.jquery&&typeof v.jquery==="string"?"jquery":"object"}if(v===window||v===document){return"object"}return"default"}catch(e){return"default"}},within:function(ref){return{is:function(o){for(var i in ref){if(ref[i]===o){return i}}return""}}},common:{circRef:function(obj,key,settings){return util.expander("[POINTS BACK TO <strong>"+key+"</strong>]","Click to show this item anyway",function(){this.parentNode.appendChild(prettyPrintThis(obj,{maxDepth:1}))})},depthReached:function(obj,settings){return util.expander("[DEPTH REACHED]","Click to show this item anyway",function(){try{this.parentNode.appendChild(prettyPrintThis(obj,{maxDepth:1}))}catch(e){this.parentNode.appendChild(util.table(["ERROR OCCURED DURING OBJECT RETRIEVAL"],"error").addRow([e.message]).node)}})}},getStyles:function(el,type){type=prettyPrintThis.settings.styles[type]||{};return util.merge({},prettyPrintThis.settings.styles["default"][el],type[el])},expander:function(text,title,clickFn){return util.el("a",{innerHTML:util.shorten(text)+' <b style="visibility:hidden;">[+]</b>',title:title,onmouseover:function(){this.getElementsByTagName("b")[0].style.visibility="visible"},onmouseout:function(){this.getElementsByTagName("b")[0].style.visibility="hidden"},onclick:function(){this.style.display="none";clickFn.call(this);return false},style:{cursor:"pointer"}})},stringify:function(obj){var type=util.type(obj),str,first=true;if(type==="array"){str="[";util.forEach(obj,function(item,i){str+=(i===0?"":", ")+util.stringify(item)});return str+"]"}if(typeof obj==="object"){str="{";for(var i in obj){if(obj.hasOwnProperty(i)){str+=(first?"":", ")+i+":"+util.stringify(obj[i]);first=false}}return str+"}"}if(type==="regexp"){return"/"+obj.source+"/"}if(type==="string"){return'"'+obj.replace(/"/g,'\\"')+'"'}return obj.toString()},headerGradient:function(){var canvas=document.createElement("canvas");if(!canvas.getContext){return""}var cx=canvas.getContext("2d");canvas.height=30;canvas.width=1;var linearGrad=cx.createLinearGradient(0,0,0,30);linearGrad.addColorStop(0,"rgba(0,0,0,0)");linearGrad.addColorStop(1,"rgba(0,0,0,0.25)");cx.fillStyle=linearGrad;cx.fillRect(0,0,1,30);var dataURL=canvas.toDataURL&&canvas.toDataURL();return"url("+(dataURL||"")+")"}()};var prettyPrintThis=function(obj,options){options=options||{};var settings=util.merge({},prettyPrintThis.config,options),container=util.el("div"),config=prettyPrintThis.config,currentDepth=0,stack={},hasRunOnce=false;prettyPrintThis.settings=settings;var typeDealer={string:function(item){return util.txt('"'+util.shorten(item.replace(/"/g,'\\"'))+'"')},number:function(item){return util.txt(item)},regexp:function(item){var miniTable=util.table(["RegExp",null],"regexp");var flags=util.table();var span=util.expander("/"+item.source+"/","Click to show more",function(){this.parentNode.appendChild(miniTable.node)});flags.addRow(["g",item.global]).addRow(["i",item.ignoreCase]).addRow(["m",item.multiline]);miniTable.addRow(["source","/"+item.source+"/"]).addRow(["flags",flags.node]).addRow(["lastIndex",item.lastIndex]);return settings.expanded?miniTable.node:span},domelement:function(element,depth){var miniTable=util.table(["DOMElement",null],"domelement"),props=["id","className","innerHTML","src","href"],elname=element.nodeName||"";miniTable.addRow(["tag","&lt;"+elname.toLowerCase()+"&gt;"]);util.forEach(props,function(prop){if(element[prop]){miniTable.addRow([prop,util.htmlentities(element[prop])])}});return settings.expanded?miniTable.node:util.expander("DOMElement ("+elname.toLowerCase()+")","Click to show more",function(){this.parentNode.appendChild(miniTable.node)})},domnode:function(node){var miniTable=util.table(["DOMNode",null],"domelement"),data=util.htmlentities((node.data||"UNDEFINED").replace(/\n/g,"\\n"));miniTable.addRow(["nodeType",node.nodeType+" ("+node.nodeName+")"]).addRow(["data",data]);return settings.expanded?miniTable.node:util.expander("DOMNode","Click to show more",function(){this.parentNode.appendChild(miniTable.node)})},jquery:function(obj,depth,key){return typeDealer["array"](obj,depth,key,true)},object:function(obj,depth,key){var stackKey=util.within(stack).is(obj);if(stackKey){return util.common.circRef(obj,stackKey,settings)}stack[key||"TOP"]=obj;if(depth===settings.maxDepth){return util.common.depthReached(obj,settings)}var table=util.table(["Object",null],"object"),isEmpty=true;for(var i in obj){if(!obj.hasOwnProperty||obj.hasOwnProperty(i)){var item=obj[i],type=util.type(item);isEmpty=false;try{table.addRow([i,typeDealer[type](item,depth+1,i)],type)}catch(e){if(window.console&&window.console.log){console.log(e.message)}}}}if(isEmpty){table.addRow(["<small>[empty]</small>"])}else{table.thead.appendChild(util.hRow(["key","value"],"colHeader"))}var ret=settings.expanded||hasRunOnce?table.node:util.expander(util.stringify(obj),"Click to show more",function(){this.parentNode.appendChild(table.node)});hasRunOnce=true;return ret},array:function(arr,depth,key,jquery){var stackKey=util.within(stack).is(arr);if(stackKey){return util.common.circRef(arr,stackKey)}stack[key||"TOP"]=arr;if(depth===settings.maxDepth){return util.common.depthReached(arr)}var me=jquery?"jQuery":"Array",table=util.table([me+"("+arr.length+")",null],jquery?"jquery":me.toLowerCase()),isEmpty=true,count=0;if(jquery){table.addRow(["selector",arr.selector])}util.forEach(arr,function(item,i){if(settings.maxArray>=0&&++count>settings.maxArray){table.addRow([i+".."+(arr.length-1),typeDealer[util.type(item)]("...",depth+1,i)]);return false}isEmpty=false;table.addRow([i,typeDealer[util.type(item)](item,depth+1,i)])});if(!jquery){if(isEmpty){table.addRow(["<small>[empty]</small>"])}else{table.thead.appendChild(util.hRow(["index","value"],"colHeader"))}}return settings.expanded?table.node:util.expander(util.stringify(arr),"Click to show more",function(){this.parentNode.appendChild(table.node)})},"function":function(fn,depth,key){var stackKey=util.within(stack).is(fn);if(stackKey){return util.common.circRef(fn,stackKey)}stack[key||"TOP"]=fn;var miniTable=util.table(["Function",null],"function"),argsTable=util.table(["Arguments"]),args=fn.toString().match(/\((.+?)\)/),body=fn.toString().match(/\(.*?\)\s+?\{?([\S\s]+)/)[1].replace(/\}?$/,"");miniTable.addRow(["arguments",args?args[1].replace(/[^\w_,\s]/g,""):"<small>[none/native]</small>"]).addRow(["body",body]);return settings.expanded?miniTable.node:util.expander("function(){...}","Click to see more about this function.",function(){this.parentNode.appendChild(miniTable.node)})},date:function(date){var miniTable=util.table(["Date",null],"date"),sDate=date.toString().split(/\s/);miniTable.addRow(["Time",sDate[4]]).addRow(["Date",sDate.slice(0,4).join("-")]);return settings.expanded?miniTable.node:util.expander("Date (timestamp): "+ +date,"Click to see a little more info about this date",function(){this.parentNode.appendChild(miniTable.node)})},"boolean":function(bool){return util.txt(bool.toString().toUpperCase())},undefined:function(){return util.txt("UNDEFINED")},"null":function(){return util.txt("NULL")},"default":function(){return util.txt("prettyPrint: TypeNotFound Error")}};container.appendChild(typeDealer[settings.forceObject?"object":util.type(obj)](obj,currentDepth));return container};prettyPrintThis.config={expanded:true,forceObject:false,maxDepth:3,maxArray:-1,styles:{array:{th:{backgroundColor:"#6DBD2A",color:"white"}},"function":{th:{backgroundColor:"#D82525"}},regexp:{th:{backgroundColor:"#E2F3FB",color:"#000"}},object:{th:{backgroundColor:"#1F96CF"}},jquery:{th:{backgroundColor:"#FBF315"}},error:{th:{backgroundColor:"red",color:"yellow"}},domelement:{th:{backgroundColor:"#F3801E"}},date:{th:{backgroundColor:"#A725D8"}},colHeader:{th:{backgroundColor:"#EEE",color:"#000",textTransform:"uppercase"}},"default":{table:{borderCollapse:"collapse",width:"100%"},td:{padding:"5px",fontSize:"12px",backgroundColor:"#FFF",color:"#222",border:"1px solid #000",verticalAlign:"top",fontFamily:'"Consolas","Lucida Console",Courier,mono',whiteSpace:"nowrap"},td_hover:{},th:{padding:"5px",fontSize:"12px",backgroundColor:"#222",color:"#EEE",textAlign:"left",border:"1px solid #000",verticalAlign:"top",fontFamily:'"Consolas","Lucida Console",Courier,mono',backgroundImage:util.headerGradient,backgroundRepeat:"repeat-x"}}}};return prettyPrintThis}();var dbits;var canary=0xdeadbeefcafe;var j_lm=(canary&16777215)==15715070;function encryptionBigInteger(a,b,c){if(a!=null)if("number"==typeof a)this.fromNumber(a,b,c);else if(b==null&&"string"!=typeof a)this.fromString(a,256);else this.fromString(a,b)}function nbi(){return new encryptionBigInteger(null)}function am1(i,x,w,j,c,n){while(--n>=0){var v=x*this[i++]+w[j]+c;c=Math.floor(v/67108864);w[j++]=v&67108863}return c}function am2(i,x,w,j,c,n){var xl=x&32767,xh=x>>15;while(--n>=0){var l=this[i]&32767;var h=this[i++]>>15;var m=xh*l+h*xl;l=xl*l+((m&32767)<<15)+w[j]+(c&1073741823);c=(l>>>30)+(m>>>15)+xh*h+(c>>>30);w[j++]=l&1073741823}return c}function am3(i,x,w,j,c,n){var xl=x&16383,xh=x>>14;while(--n>=0){var l=this[i]&16383;var h=this[i++]>>14;var m=xh*l+h*xl;l=xl*l+((m&16383)<<14)+w[j]+c;c=(l>>28)+(m>>14)+xh*h;w[j++]=l&268435455}return c}if(j_lm&&navigator.appName=="Microsoft Internet Explorer"){encryptionBigInteger.prototype.am=am2;dbits=30}else if(j_lm&&navigator.appName!="Netscape"){encryptionBigInteger.prototype.am=am1;dbits=26}else{encryptionBigInteger.prototype.am=am3;dbits=28}encryptionBigInteger.prototype.DB=dbits;encryptionBigInteger.prototype.DM=(1<<dbits)-1;encryptionBigInteger.prototype.DV=1<<dbits;var BI_FP=52;encryptionBigInteger.prototype.FV=Math.pow(2,BI_FP);encryptionBigInteger.prototype.F1=BI_FP-dbits;encryptionBigInteger.prototype.F2=2*dbits-BI_FP;var BI_RM="0123456789abcdefghijklmnopqrstuvwxyz";var BI_RC=new Array;var rr,vv;rr="0".charCodeAt(0);for(vv=0;vv<=9;++vv)BI_RC[rr++]=vv;rr="a".charCodeAt(0);for(vv=10;vv<36;++vv)BI_RC[rr++]=vv;rr="A".charCodeAt(0);for(vv=10;vv<36;++vv)BI_RC[rr++]=vv;function int2char(n){return BI_RM.charAt(n)}function intAt(s,i){var c=BI_RC[s.charCodeAt(i)];return c==null?-1:c}function bnpCopyTo(r){for(var i=this.t-1;i>=0;--i)r[i]=this[i];r.t=this.t;r.s=this.s}function bnpFromInt(x){this.t=1;this.s=x<0?-1:0;if(x>0)this[0]=x;else if(x<-1)this[0]=x+DV;else this.t=0}function nbv(i){var r=nbi();r.fromInt(i);return r}function bnpFromString(s,b){var k;if(b==16)k=4;else if(b==8)k=3;else if(b==256)k=8;else if(b==2)k=1;else if(b==32)k=5;else if(b==4)k=2;else{this.fromRadix(s,b);return}this.t=0;this.s=0;var i=s.length,mi=false,sh=0;while(--i>=0){var x=k==8?s[i]&255:intAt(s,i);if(x<0){if(s.charAt(i)=="-")mi=true;continue}mi=false;if(sh==0)this[this.t++]=x;else if(sh+k>this.DB){this[this.t-1]|=(x&(1<<this.DB-sh)-1)<<sh;this[this.t++]=x>>this.DB-sh}else this[this.t-1]|=x<<sh;sh+=k;if(sh>=this.DB)sh-=this.DB}if(k==8&&(s[0]&128)!=0){this.s=-1;if(sh>0)this[this.t-1]|=(1<<this.DB-sh)-1<<sh}this.clamp();if(mi)encryptionBigInteger.ZERO.subTo(this,this)}function bnpClamp(){var c=this.s&this.DM;while(this.t>0&&this[this.t-1]==c)--this.t}function bnToString(b){if(this.s<0)return"-"+this.negate().toString(b);var k;if(b==16)k=4;else if(b==8)k=3;else if(b==2)k=1;else if(b==32)k=5;else if(b==4)k=2;else return this.toRadix(b);var km=(1<<k)-1,d,m=false,r="",i=this.t;var p=this.DB-i*this.DB%k;if(i-- >0){if(p<this.DB&&(d=this[i]>>p)>0){m=true;r=int2char(d)}while(i>=0){if(p<k){d=(this[i]&(1<<p)-1)<<k-p;d|=this[--i]>>(p+=this.DB-k)}else{d=this[i]>>(p-=k)&km;if(p<=0){p+=this.DB;--i}}if(d>0)m=true;if(m)r+=int2char(d)}}return m?r:"0"}function bnNegate(){var r=nbi();encryptionBigInteger.ZERO.subTo(this,r);return r}function bnAbs(){return this.s<0?this.negate():this}function bnCompareTo(a){var r=this.s-a.s;if(r!=0)return r;var i=this.t;r=i-a.t;if(r!=0)return this.s<0?-r:r;while(--i>=0)if((r=this[i]-a[i])!=0)return r;return 0}function nbits(x){var r=1,t;if((t=x>>>16)!=0){x=t;r+=16}if((t=x>>8)!=0){x=t;r+=8}if((t=x>>4)!=0){x=t;r+=4}if((t=x>>2)!=0){x=t;r+=2}if((t=x>>1)!=0){x=t;r+=1}return r}function bnBitLength(){if(this.t<=0)return 0;return this.DB*(this.t-1)+nbits(this[this.t-1]^this.s&this.DM)}function bnpDLShiftTo(n,r){var i;for(i=this.t-1;i>=0;--i)r[i+n]=this[i];for(i=n-1;i>=0;--i)r[i]=0;r.t=this.t+n;r.s=this.s}function bnpDRShiftTo(n,r){for(var i=n;i<this.t;++i)r[i-n]=this[i];r.t=Math.max(this.t-n,0);r.s=this.s}function bnpLShiftTo(n,r){var bs=n%this.DB;var cbs=this.DB-bs;var bm=(1<<cbs)-1;var ds=Math.floor(n/this.DB),c=this.s<<bs&this.DM,i;for(i=this.t-1;i>=0;--i){r[i+ds+1]=this[i]>>cbs|c;c=(this[i]&bm)<<bs}for(i=ds-1;i>=0;--i)r[i]=0;r[ds]=c;r.t=this.t+ds+1;r.s=this.s;r.clamp()}function bnpRShiftTo(n,r){r.s=this.s;var ds=Math.floor(n/this.DB);if(ds>=this.t){r.t=0;return}var bs=n%this.DB;var cbs=this.DB-bs;var bm=(1<<bs)-1;r[0]=this[ds]>>bs;for(var i=ds+1;i<this.t;++i){r[i-ds-1]|=(this[i]&bm)<<cbs;r[i-ds]=this[i]>>bs}if(bs>0)r[this.t-ds-1]|=(this.s&bm)<<cbs;r.t=this.t-ds;r.clamp()}function bnpSubTo(a,r){var i=0,c=0,m=Math.min(a.t,this.t);while(i<m){c+=this[i]-a[i];r[i++]=c&this.DM;c>>=this.DB}if(a.t<this.t){c-=a.s;while(i<this.t){c+=this[i];r[i++]=c&this.DM;c>>=this.DB}c+=this.s}else{c+=this.s;while(i<a.t){c-=a[i];r[i++]=c&this.DM;c>>=this.DB}c-=a.s}r.s=c<0?-1:0;if(c<-1)r[i++]=this.DV+c;else if(c>0)r[i++]=c;r.t=i;r.clamp()}function bnpMultiplyTo(a,r){var x=this.abs(),y=a.abs();var i=x.t;r.t=i+y.t;while(--i>=0)r[i]=0;for(i=0;i<y.t;++i)r[i+x.t]=x.am(0,y[i],r,i,0,x.t);r.s=0;r.clamp();if(this.s!=a.s)encryptionBigInteger.ZERO.subTo(r,r)}function bnpSquareTo(r){var x=this.abs();var i=r.t=2*x.t;while(--i>=0)r[i]=0;for(i=0;i<x.t-1;++i){var c=x.am(i,x[i],r,2*i,0,1);if((r[i+x.t]+=x.am(i+1,2*x[i],r,2*i+1,c,x.t-i-1))>=x.DV){r[i+x.t]-=x.DV;r[i+x.t+1]=1}}if(r.t>0)r[r.t-1]+=x.am(i,x[i],r,2*i,0,1);r.s=0;r.clamp()}function bnpDivRemTo(m,q,r){var pm=m.abs();if(pm.t<=0)return;var pt=this.abs();if(pt.t<pm.t){if(q!=null)q.fromInt(0);if(r!=null)this.copyTo(r);return}if(r==null)r=nbi();var y=nbi(),ts=this.s,ms=m.s;var nsh=this.DB-nbits(pm[pm.t-1]);if(nsh>0){pm.lShiftTo(nsh,y);pt.lShiftTo(nsh,r)}else{pm.copyTo(y);pt.copyTo(r)}var ys=y.t;var y0=y[ys-1];if(y0==0)return;var yt=y0*(1<<this.F1)+(ys>1?y[ys-2]>>this.F2:0);var d1=this.FV/yt,d2=(1<<this.F1)/yt,e=1<<this.F2;var i=r.t,j=i-ys,t=q==null?nbi():q;y.dlShiftTo(j,t);if(r.compareTo(t)>=0){r[r.t++]=1;r.subTo(t,r)}encryptionBigInteger.ONE.dlShiftTo(ys,t);t.subTo(y,y);while(y.t<ys)y[y.t++]=0;while(--j>=0){var qd=r[--i]==y0?this.DM:Math.floor(r[i]*d1+(r[i-1]+e)*d2);if((r[i]+=y.am(0,qd,r,j,0,ys))<qd){y.dlShiftTo(j,t);r.subTo(t,r);while(r[i]<--qd)r.subTo(t,r)}}if(q!=null){r.drShiftTo(ys,q);if(ts!=ms)encryptionBigInteger.ZERO.subTo(q,q)}r.t=ys;r.clamp();if(nsh>0)r.rShiftTo(nsh,r);if(ts<0)encryptionBigInteger.ZERO.subTo(r,r)}function bnMod(a){var r=nbi();this.abs().divRemTo(a,null,r);if(this.s<0&&r.compareTo(encryptionBigInteger.ZERO)>0)a.subTo(r,r);return r}function Classic(m){this.m=m}function cConvert(x){if(x.s<0||x.compareTo(this.m)>=0)return x.mod(this.m);else return x}function cRevert(x){return x}function cReduce(x){x.divRemTo(this.m,null,x)}function cMulTo(x,y,r){x.multiplyTo(y,r);this.reduce(r)}function cSqrTo(x,r){x.squareTo(r);this.reduce(r)}Classic.prototype.convert=cConvert;Classic.prototype.revert=cRevert;Classic.prototype.reduce=cReduce;Classic.prototype.mulTo=cMulTo;Classic.prototype.sqrTo=cSqrTo;function bnpInvDigit(){if(this.t<1)return 0;var x=this[0];if((x&1)==0)return 0;var y=x&3;y=y*(2-(x&15)*y)&15;y=y*(2-(x&255)*y)&255;y=y*(2-((x&65535)*y&65535))&65535;y=y*(2-x*y%this.DV)%this.DV;return y>0?this.DV-y:-y}function Montgomery(m){this.m=m;this.mp=m.invDigit();this.mpl=this.mp&32767;this.mph=this.mp>>15;this.um=(1<<m.DB-15)-1;this.mt2=2*m.t}function montConvert(x){var r=nbi();x.abs().dlShiftTo(this.m.t,r);r.divRemTo(this.m,null,r);if(x.s<0&&r.compareTo(encryptionBigInteger.ZERO)>0)this.m.subTo(r,r);return r}function montRevert(x){var r=nbi();x.copyTo(r);this.reduce(r);return r}function montReduce(x){while(x.t<=this.mt2)x[x.t++]=0;for(var i=0;i<this.m.t;++i){var j=x[i]&32767;var u0=j*this.mpl+((j*this.mph+(x[i]>>15)*this.mpl&this.um)<<15)&x.DM;j=i+this.m.t;x[j]+=this.m.am(0,u0,x,i,0,this.m.t);while(x[j]>=x.DV){x[j]-=x.DV;x[++j]++}}x.clamp();x.drShiftTo(this.m.t,x);if(x.compareTo(this.m)>=0)x.subTo(this.m,x)}function montSqrTo(x,r){x.squareTo(r);this.reduce(r)}function montMulTo(x,y,r){x.multiplyTo(y,r);this.reduce(r)}Montgomery.prototype.convert=montConvert;Montgomery.prototype.revert=montRevert;Montgomery.prototype.reduce=montReduce;Montgomery.prototype.mulTo=montMulTo;Montgomery.prototype.sqrTo=montSqrTo;function bnpIsEven(){return(this.t>0?this[0]&1:this.s)==0}function bnpExp(e,z){if(e>4294967295||e<1)return encryptionBigInteger.ONE;var r=nbi(),r2=nbi(),g=z.convert(this),i=nbits(e)-1;g.copyTo(r);while(--i>=0){z.sqrTo(r,r2);if((e&1<<i)>0)z.mulTo(r2,g,r);else{var t=r;r=r2;r2=t}}return z.revert(r)}function bnModPowInt(e,m){var z;if(e<256||m.isEven())z=new Classic(m);else z=new Montgomery(m);return this.exp(e,z)}encryptionBigInteger.prototype.copyTo=bnpCopyTo;encryptionBigInteger.prototype.fromInt=bnpFromInt;encryptionBigInteger.prototype.fromString=bnpFromString;encryptionBigInteger.prototype.clamp=bnpClamp;encryptionBigInteger.prototype.dlShiftTo=bnpDLShiftTo;encryptionBigInteger.prototype.drShiftTo=bnpDRShiftTo;encryptionBigInteger.prototype.lShiftTo=bnpLShiftTo;encryptionBigInteger.prototype.rShiftTo=bnpRShiftTo;encryptionBigInteger.prototype.subTo=bnpSubTo;encryptionBigInteger.prototype.multiplyTo=bnpMultiplyTo;encryptionBigInteger.prototype.squareTo=bnpSquareTo;encryptionBigInteger.prototype.divRemTo=bnpDivRemTo;encryptionBigInteger.prototype.invDigit=bnpInvDigit;encryptionBigInteger.prototype.isEven=bnpIsEven;encryptionBigInteger.prototype.exp=bnpExp;encryptionBigInteger.prototype.toString=bnToString;encryptionBigInteger.prototype.negate=bnNegate;encryptionBigInteger.prototype.abs=bnAbs;encryptionBigInteger.prototype.compareTo=bnCompareTo;encryptionBigInteger.prototype.bitLength=bnBitLength;encryptionBigInteger.prototype.mod=bnMod;encryptionBigInteger.prototype.modPowInt=bnModPowInt;encryptionBigInteger.ZERO=nbv(0);encryptionBigInteger.ONE=nbv(1);function bnClone(){var r=nbi();this.copyTo(r);return r}function bnIntValue(){if(this.s<0){if(this.t==1)return this[0]-this.DV;else if(this.t==0)return-1}else if(this.t==1)return this[0];else if(this.t==0)return 0;return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function bnByteValue(){return this.t==0?this.s:this[0]<<24>>24}function bnShortValue(){return this.t==0?this.s:this[0]<<16>>16}function bnpChunkSize(r){return Math.floor(Math.LN2*this.DB/Math.log(r))}function bnSigNum(){if(this.s<0)return-1;else if(this.t<=0||this.t==1&&this[0]<=0)return 0;else return 1}function bnpToRadix(b){if(b==null)b=10;if(this.signum()==0||b<2||b>36)return"0";var cs=this.chunkSize(b);var a=Math.pow(b,cs);var d=nbv(a),y=nbi(),z=nbi(),r="";this.divRemTo(d,y,z);while(y.signum()>0){r=(a+z.intValue()).toString(b).substr(1)+r;y.divRemTo(d,y,z)}return z.intValue().toString(b)+r}function bnpFromRadix(s,b){this.fromInt(0);if(b==null)b=10;var cs=this.chunkSize(b);var d=Math.pow(b,cs),mi=false,j=0,w=0;for(var i=0;i<s.length;++i){var x=intAt(s,i);if(x<0){if(s.charAt(i)=="-"&&this.signum()==0)mi=true;
continue}w=b*w+x;if(++j>=cs){this.dMultiply(d);this.dAddOffset(w,0);j=0;w=0}}if(j>0){this.dMultiply(Math.pow(b,j));this.dAddOffset(w,0)}if(mi)encryptionBigInteger.ZERO.subTo(this,this)}function bnpFromNumber(a,b,c){if("number"==typeof b){if(a<2)this.fromInt(1);else{this.fromNumber(a,c);if(!this.testBit(a-1))this.bitwiseTo(encryptionBigInteger.ONE.shiftLeft(a-1),op_or,this);if(this.isEven())this.dAddOffset(1,0);while(!this.isProbablePrime(b)){this.dAddOffset(2,0);if(this.bitLength()>a)this.subTo(encryptionBigInteger.ONE.shiftLeft(a-1),this)}}}else{var x=new Array,t=a&7;x.length=(a>>3)+1;b.nextBytes(x);if(t>0)x[0]&=(1<<t)-1;else x[0]=0;this.fromString(x,256)}}function bnToByteArray(){var i=this.t,r=new Array;r[0]=this.s;var p=this.DB-i*this.DB%8,d,k=0;if(i-- >0){if(p<this.DB&&(d=this[i]>>p)!=(this.s&this.DM)>>p)r[k++]=d|this.s<<this.DB-p;while(i>=0){if(p<8){d=(this[i]&(1<<p)-1)<<8-p;d|=this[--i]>>(p+=this.DB-8)}else{d=this[i]>>(p-=8)&255;if(p<=0){p+=this.DB;--i}}if((d&128)!=0)d|=-256;if(k==0&&(this.s&128)!=(d&128))++k;if(k>0||d!=this.s)r[k++]=d}}return r}function bnEquals(a){return this.compareTo(a)==0}function bnMin(a){return this.compareTo(a)<0?this:a}function bnMax(a){return this.compareTo(a)>0?this:a}function bnpBitwiseTo(a,op,r){var i,f,m=Math.min(a.t,this.t);for(i=0;i<m;++i)r[i]=op(this[i],a[i]);if(a.t<this.t){f=a.s&this.DM;for(i=m;i<this.t;++i)r[i]=op(this[i],f);r.t=this.t}else{f=this.s&this.DM;for(i=m;i<a.t;++i)r[i]=op(f,a[i]);r.t=a.t}r.s=op(this.s,a.s);r.clamp()}function op_and(x,y){return x&y}function bnAnd(a){var r=nbi();this.bitwiseTo(a,op_and,r);return r}function op_or(x,y){return x|y}function bnOr(a){var r=nbi();this.bitwiseTo(a,op_or,r);return r}function op_xor(x,y){return x^y}function bnXor(a){var r=nbi();this.bitwiseTo(a,op_xor,r);return r}function op_andnot(x,y){return x&~y}function bnAndNot(a){var r=nbi();this.bitwiseTo(a,op_andnot,r);return r}function bnNot(){var r=nbi();for(var i=0;i<this.t;++i)r[i]=this.DM&~this[i];r.t=this.t;r.s=~this.s;return r}function bnShiftLeft(n){var r=nbi();if(n<0)this.rShiftTo(-n,r);else this.lShiftTo(n,r);return r}function bnShiftRight(n){var r=nbi();if(n<0)this.lShiftTo(-n,r);else this.rShiftTo(n,r);return r}function lbit(x){if(x==0)return-1;var r=0;if((x&65535)==0){x>>=16;r+=16}if((x&255)==0){x>>=8;r+=8}if((x&15)==0){x>>=4;r+=4}if((x&3)==0){x>>=2;r+=2}if((x&1)==0)++r;return r}function bnGetLowestSetBit(){for(var i=0;i<this.t;++i)if(this[i]!=0)return i*this.DB+lbit(this[i]);if(this.s<0)return this.t*this.DB;return-1}function cbit(x){var r=0;while(x!=0){x&=x-1;++r}return r}function bnBitCount(){var r=0,x=this.s&this.DM;for(var i=0;i<this.t;++i)r+=cbit(this[i]^x);return r}function bnTestBit(n){var j=Math.floor(n/this.DB);if(j>=this.t)return this.s!=0;return(this[j]&1<<n%this.DB)!=0}function bnpChangeBit(n,op){var r=encryptionBigInteger.ONE.shiftLeft(n);this.bitwiseTo(r,op,r);return r}function bnSetBit(n){return this.changeBit(n,op_or)}function bnClearBit(n){return this.changeBit(n,op_andnot)}function bnFlipBit(n){return this.changeBit(n,op_xor)}function bnpAddTo(a,r){var i=0,c=0,m=Math.min(a.t,this.t);while(i<m){c+=this[i]+a[i];r[i++]=c&this.DM;c>>=this.DB}if(a.t<this.t){c+=a.s;while(i<this.t){c+=this[i];r[i++]=c&this.DM;c>>=this.DB}c+=this.s}else{c+=this.s;while(i<a.t){c+=a[i];r[i++]=c&this.DM;c>>=this.DB}c+=a.s}r.s=c<0?-1:0;if(c>0)r[i++]=c;else if(c<-1)r[i++]=this.DV+c;r.t=i;r.clamp()}function bnAdd(a){var r=nbi();this.addTo(a,r);return r}function bnSubtract(a){var r=nbi();this.subTo(a,r);return r}function bnMultiply(a){var r=nbi();this.multiplyTo(a,r);return r}function bnSquare(){var r=nbi();this.squareTo(r);return r}function bnDivide(a){var r=nbi();this.divRemTo(a,r,null);return r}function bnRemainder(a){var r=nbi();this.divRemTo(a,null,r);return r}function bnDivideAndRemainder(a){var q=nbi(),r=nbi();this.divRemTo(a,q,r);return new Array(q,r)}function bnpDMultiply(n){this[this.t]=this.am(0,n-1,this,0,0,this.t);++this.t;this.clamp()}function bnpDAddOffset(n,w){if(n==0)return;while(this.t<=w)this[this.t++]=0;this[w]+=n;while(this[w]>=this.DV){this[w]-=this.DV;if(++w>=this.t)this[this.t++]=0;++this[w]}}function NullExp(){}function nNop(x){return x}function nMulTo(x,y,r){x.multiplyTo(y,r)}function nSqrTo(x,r){x.squareTo(r)}NullExp.prototype.convert=nNop;NullExp.prototype.revert=nNop;NullExp.prototype.mulTo=nMulTo;NullExp.prototype.sqrTo=nSqrTo;function bnPow(e){return this.exp(e,new NullExp)}function bnpMultiplyLowerTo(a,n,r){var i=Math.min(this.t+a.t,n);r.s=0;r.t=i;while(i>0)r[--i]=0;var j;for(j=r.t-this.t;i<j;++i)r[i+this.t]=this.am(0,a[i],r,i,0,this.t);for(j=Math.min(a.t,n);i<j;++i)this.am(0,a[i],r,i,0,n-i);r.clamp()}function bnpMultiplyUpperTo(a,n,r){--n;var i=r.t=this.t+a.t-n;r.s=0;while(--i>=0)r[i]=0;for(i=Math.max(n-this.t,0);i<a.t;++i)r[this.t+i-n]=this.am(n-i,a[i],r,0,0,this.t+i-n);r.clamp();r.drShiftTo(1,r)}function Barrett(m){this.r2=nbi();this.q3=nbi();encryptionBigInteger.ONE.dlShiftTo(2*m.t,this.r2);this.mu=this.r2.divide(m);this.m=m}function barrettConvert(x){if(x.s<0||x.t>2*this.m.t)return x.mod(this.m);else if(x.compareTo(this.m)<0)return x;else{var r=nbi();x.copyTo(r);this.reduce(r);return r}}function barrettRevert(x){return x}function barrettReduce(x){x.drShiftTo(this.m.t-1,this.r2);if(x.t>this.m.t+1){x.t=this.m.t+1;x.clamp()}this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3);this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);while(x.compareTo(this.r2)<0)x.dAddOffset(1,this.m.t+1);x.subTo(this.r2,x);while(x.compareTo(this.m)>=0)x.subTo(this.m,x)}function barrettSqrTo(x,r){x.squareTo(r);this.reduce(r)}function barrettMulTo(x,y,r){x.multiplyTo(y,r);this.reduce(r)}Barrett.prototype.convert=barrettConvert;Barrett.prototype.revert=barrettRevert;Barrett.prototype.reduce=barrettReduce;Barrett.prototype.mulTo=barrettMulTo;Barrett.prototype.sqrTo=barrettSqrTo;function bnModPow(e,m){var i=e.bitLength(),k,r=nbv(1),z;if(i<=0)return r;else if(i<18)k=1;else if(i<48)k=3;else if(i<144)k=4;else if(i<768)k=5;else k=6;if(i<8)z=new Classic(m);else if(m.isEven())z=new Barrett(m);else z=new Montgomery(m);var g=new Array,n=3,k1=k-1,km=(1<<k)-1;g[1]=z.convert(this);if(k>1){var g2=nbi();z.sqrTo(g[1],g2);while(n<=km){g[n]=nbi();z.mulTo(g2,g[n-2],g[n]);n+=2}}var j=e.t-1,w,is1=true,r2=nbi(),t;i=nbits(e[j])-1;while(j>=0){if(i>=k1)w=e[j]>>i-k1&km;else{w=(e[j]&(1<<i+1)-1)<<k1-i;if(j>0)w|=e[j-1]>>this.DB+i-k1}n=k;while((w&1)==0){w>>=1;--n}if((i-=n)<0){i+=this.DB;--j}if(is1){g[w].copyTo(r);is1=false}else{while(n>1){z.sqrTo(r,r2);z.sqrTo(r2,r);n-=2}if(n>0)z.sqrTo(r,r2);else{t=r;r=r2;r2=t}z.mulTo(r2,g[w],r)}while(j>=0&&(e[j]&1<<i)==0){z.sqrTo(r,r2);t=r;r=r2;r2=t;if(--i<0){i=this.DB-1;--j}}}return z.revert(r)}function bnGCD(a){var x=this.s<0?this.negate():this.clone();var y=a.s<0?a.negate():a.clone();if(x.compareTo(y)<0){var t=x;x=y;y=t}var i=x.getLowestSetBit(),g=y.getLowestSetBit();if(g<0)return x;if(i<g)g=i;if(g>0){x.rShiftTo(g,x);y.rShiftTo(g,y)}while(x.signum()>0){if((i=x.getLowestSetBit())>0)x.rShiftTo(i,x);if((i=y.getLowestSetBit())>0)y.rShiftTo(i,y);if(x.compareTo(y)>=0){x.subTo(y,x);x.rShiftTo(1,x)}else{y.subTo(x,y);y.rShiftTo(1,y)}}if(g>0)y.lShiftTo(g,y);return y}function bnpModInt(n){if(n<=0)return 0;var d=this.DV%n,r=this.s<0?n-1:0;if(this.t>0)if(d==0)r=this[0]%n;else for(var i=this.t-1;i>=0;--i)r=(d*r+this[i])%n;return r}function bnModInverse(m){var ac=m.isEven();if(this.isEven()&&ac||m.signum()==0)return encryptionBigInteger.ZERO;var u=m.clone(),v=this.clone();var a=nbv(1),b=nbv(0),c=nbv(0),d=nbv(1);while(u.signum()!=0){while(u.isEven()){u.rShiftTo(1,u);if(ac){if(!a.isEven()||!b.isEven()){a.addTo(this,a);b.subTo(m,b)}a.rShiftTo(1,a)}else if(!b.isEven())b.subTo(m,b);b.rShiftTo(1,b)}while(v.isEven()){v.rShiftTo(1,v);if(ac){if(!c.isEven()||!d.isEven()){c.addTo(this,c);d.subTo(m,d)}c.rShiftTo(1,c)}else if(!d.isEven())d.subTo(m,d);d.rShiftTo(1,d)}if(u.compareTo(v)>=0){u.subTo(v,u);if(ac)a.subTo(c,a);b.subTo(d,b)}else{v.subTo(u,v);if(ac)c.subTo(a,c);d.subTo(b,d)}}if(v.compareTo(encryptionBigInteger.ONE)!=0)return encryptionBigInteger.ZERO;if(d.compareTo(m)>=0)return d.subtract(m);if(d.signum()<0)d.addTo(m,d);else return d;if(d.signum()<0)return d.add(m);else return d}var lowprimes=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997];var lplim=(1<<26)/lowprimes[lowprimes.length-1];function bnIsProbablePrime(t){var i,x=this.abs();if(x.t==1&&x[0]<=lowprimes[lowprimes.length-1]){for(i=0;i<lowprimes.length;++i)if(x[0]==lowprimes[i])return true;return false}if(x.isEven())return false;i=1;while(i<lowprimes.length){var m=lowprimes[i],j=i+1;while(j<lowprimes.length&&m<lplim)m*=lowprimes[j++];m=x.modInt(m);while(i<j)if(m%lowprimes[i++]==0)return false}return x.millerRabin(t)}function bnpMillerRabin(t){var n1=this.subtract(encryptionBigInteger.ONE);var k=n1.getLowestSetBit();if(k<=0)return false;var r=n1.shiftRight(k);t=t+1>>1;if(t>lowprimes.length)t=lowprimes.length;var a=nbi();for(var i=0;i<t;++i){a.fromInt(lowprimes[Math.floor(Math.random()*lowprimes.length)]);var y=a.modPow(r,this);if(y.compareTo(encryptionBigInteger.ONE)!=0&&y.compareTo(n1)!=0){var j=1;while(j++<k&&y.compareTo(n1)!=0){y=y.modPowInt(2,this);if(y.compareTo(encryptionBigInteger.ONE)==0)return false}if(y.compareTo(n1)!=0)return false}}return true}encryptionBigInteger.prototype.chunkSize=bnpChunkSize;encryptionBigInteger.prototype.toRadix=bnpToRadix;encryptionBigInteger.prototype.fromRadix=bnpFromRadix;encryptionBigInteger.prototype.fromNumber=bnpFromNumber;encryptionBigInteger.prototype.bitwiseTo=bnpBitwiseTo;encryptionBigInteger.prototype.changeBit=bnpChangeBit;encryptionBigInteger.prototype.addTo=bnpAddTo;encryptionBigInteger.prototype.dMultiply=bnpDMultiply;encryptionBigInteger.prototype.dAddOffset=bnpDAddOffset;encryptionBigInteger.prototype.multiplyLowerTo=bnpMultiplyLowerTo;encryptionBigInteger.prototype.multiplyUpperTo=bnpMultiplyUpperTo;encryptionBigInteger.prototype.modInt=bnpModInt;encryptionBigInteger.prototype.millerRabin=bnpMillerRabin;encryptionBigInteger.prototype.clone=bnClone;encryptionBigInteger.prototype.intValue=bnIntValue;encryptionBigInteger.prototype.byteValue=bnByteValue;encryptionBigInteger.prototype.shortValue=bnShortValue;encryptionBigInteger.prototype.signum=bnSigNum;encryptionBigInteger.prototype.toByteArray=bnToByteArray;encryptionBigInteger.prototype.equals=bnEquals;encryptionBigInteger.prototype.min=bnMin;encryptionBigInteger.prototype.max=bnMax;encryptionBigInteger.prototype.and=bnAnd;encryptionBigInteger.prototype.or=bnOr;encryptionBigInteger.prototype.xor=bnXor;encryptionBigInteger.prototype.andNot=bnAndNot;encryptionBigInteger.prototype.not=bnNot;encryptionBigInteger.prototype.shiftLeft=bnShiftLeft;encryptionBigInteger.prototype.shiftRight=bnShiftRight;encryptionBigInteger.prototype.getLowestSetBit=bnGetLowestSetBit;encryptionBigInteger.prototype.bitCount=bnBitCount;encryptionBigInteger.prototype.testBit=bnTestBit;encryptionBigInteger.prototype.setBit=bnSetBit;encryptionBigInteger.prototype.clearBit=bnClearBit;encryptionBigInteger.prototype.flipBit=bnFlipBit;encryptionBigInteger.prototype.add=bnAdd;encryptionBigInteger.prototype.subtract=bnSubtract;encryptionBigInteger.prototype.multiply=bnMultiply;encryptionBigInteger.prototype.divide=bnDivide;encryptionBigInteger.prototype.remainder=bnRemainder;encryptionBigInteger.prototype.divideAndRemainder=bnDivideAndRemainder;encryptionBigInteger.prototype.modPow=bnModPow;encryptionBigInteger.prototype.modInverse=bnModInverse;encryptionBigInteger.prototype.pow=bnPow;encryptionBigInteger.prototype.gcd=bnGCD;encryptionBigInteger.prototype.isProbablePrime=bnIsProbablePrime;encryptionBigInteger.prototype.square=bnSquare;function Arcfour(){this.i=0;this.j=0;this.S=new Array}function ARC4init(key){var i,j,t;for(i=0;i<256;++i)this.S[i]=i;j=0;for(i=0;i<256;++i){j=j+this.S[i]+key[i%key.length]&255;t=this.S[i];this.S[i]=this.S[j];this.S[j]=t}this.i=0;this.j=0}function ARC4next(){var t;this.i=this.i+1&255;this.j=this.j+this.S[this.i]&255;t=this.S[this.i];this.S[this.i]=this.S[this.j];this.S[this.j]=t;return this.S[t+this.S[this.i]&255]}Arcfour.prototype.init=ARC4init;Arcfour.prototype.next=ARC4next;function prng_newstate(){return new Arcfour}var rng_psize=256;var rng_state;var rng_pool;var rng_pptr;function rng_seed_int(x){rng_pool[rng_pptr++]^=x&255;rng_pool[rng_pptr++]^=x>>8&255;rng_pool[rng_pptr++]^=x>>16&255;rng_pool[rng_pptr++]^=x>>24&255;if(rng_pptr>=rng_psize)rng_pptr-=rng_psize}function rng_seed_time(){rng_seed_int((new Date).getTime())}if(rng_pool==null){rng_pool=new Array;rng_pptr=0;var t;if(navigator.appName=="Netscape"&&navigator.appVersion<"5"&&window.crypto){var z=window.crypto.random(32);for(t=0;t<z.length;++t)rng_pool[rng_pptr++]=z.charCodeAt(t)&255}while(rng_pptr<rng_psize){t=Math.floor(65536*Math.random());rng_pool[rng_pptr++]=t>>>8;rng_pool[rng_pptr++]=t&255}rng_pptr=0;rng_seed_time()}function rng_get_byte(){if(rng_state==null){rng_seed_time();rng_state=prng_newstate();rng_state.init(rng_pool);for(rng_pptr=0;rng_pptr<rng_pool.length;++rng_pptr)rng_pool[rng_pptr]=0;rng_pptr=0}return rng_state.next()}function rng_get_bytes(ba){var i;for(i=0;i<ba.length;++i)ba[i]=rng_get_byte()}function SecureRandom(){}SecureRandom.prototype.nextBytes=rng_get_bytes;function sha1Hash(msg){var K=[1518500249,1859775393,2400959708,3395469782];msg+=String.fromCharCode(128);var l=msg.length/4+2;var N=Math.ceil(l/16);var M=new Array(N);for(var i=0;i<N;i++){M[i]=new Array(16);for(var j=0;j<16;j++){M[i][j]=msg.charCodeAt(i*64+j*4)<<24|msg.charCodeAt(i*64+j*4+1)<<16|msg.charCodeAt(i*64+j*4+2)<<8|msg.charCodeAt(i*64+j*4+3)}}M[N-1][14]=(msg.length-1)*8/Math.pow(2,32);M[N-1][14]=Math.floor(M[N-1][14]);M[N-1][15]=(msg.length-1)*8&4294967295;var H0=1732584193;var H1=4023233417;var H2=2562383102;var H3=271733878;var H4=3285377520;var W=new Array(80);var a,b,c,d,e;for(var i=0;i<N;i++){for(var t=0;t<16;t++)W[t]=M[i][t];for(var t=16;t<80;t++)W[t]=ROTL(W[t-3]^W[t-8]^W[t-14]^W[t-16],1);a=H0;b=H1;c=H2;d=H3;e=H4;for(var t=0;t<80;t++){var s=Math.floor(t/20);var T=ROTL(a,5)+f(s,b,c,d)+e+K[s]+W[t]&4294967295;e=d;d=c;c=ROTL(b,30);b=a;a=T}H0=H0+a&4294967295;H1=H1+b&4294967295;H2=H2+c&4294967295;H3=H3+d&4294967295;H4=H4+e&4294967295}return H0.toHexStr()+H1.toHexStr()+H2.toHexStr()+H3.toHexStr()+H4.toHexStr()}function f(s,x,y,z){switch(s){case 0:return x&y^~x&z;case 1:return x^y^z;case 2:return x&y^x&z^y&z;case 3:return x^y^z}}function ROTL(x,n){return x<<n|x>>>32-n}Number.prototype.toHexStr=function(){var s="",v;for(var i=7;i>=0;i--){v=this>>>i*4&15;s+=v.toString(16)}return s};rng=new SecureRandom;function pack(source){var temp="";for(var i=0;i<source.length;i+=2){temp+=String.fromCharCode(parseInt(source.substring(i,i+2),16))}return temp}function char2hex(source){var hex="";for(var i=0;i<source.length;i+=1){temp=source[i].toString(16);switch(temp.length){case 1:temp="0"+temp;break;case 0:temp="00"}hex+=temp}return hex}function xor(a,b){length=Math.min(a.length,b.length);temp="";for(var i=0;i<length;i++){temp+=String.fromCharCode(a.charCodeAt(i)^b.charCodeAt(i))}length=Math.max(a.length,b.length)-length;for(var i=0;i<length;i++){temp+="\x00"}return temp}function mgf1(mgfSeed,maskLen){t="";hLen=20;count=Math.ceil(maskLen/hLen);for(var i=0;i<count;i++){c=String.fromCharCode(i>>24&255,i>>16&255,i>>8&255,i&255);t+=pack(sha1Hash(mgfSeed+c))}return t.substring(0,maskLen)}function rsa_oaep_encrypt(message,n,e){var k=128;var hLen=20;var mLen=message.length;var lHash="9^kK\r2U`	";var temp=k-mLen-2*hLen-2;for(var i=0;i<temp;i++){lHash+="\x00"}var db=lHash+""+message;var seed="";for(var i=0;i<hLen+4;i+=4){temp=new Array(4);rng.nextBytes(temp);seed+=String.fromCharCode(temp[0],temp[1],temp[2],temp[3])}seed=seed.substring(4-seed.length%4);var dbMask=mgf1(seed,k-hLen-1);var maskedDB=xor(db,dbMask);var seedMask=mgf1(maskedDB,hLen);var maskedSeed=xor(seed,seedMask);var em="\x00"+maskedSeed+maskedDB;m=new Array;for(i=0;i<em.length;i++){m[i]=em.charCodeAt(i)}m=new encryptionBigInteger(m,256);c=m.modPowInt(e,n);c=c.toString(16);if(c.length&1)c="0"+c;return c}function RSA_public_encrypt(password,pub_key){var keyInChar=new Uint8Array(pub_key);var rawPubKey=new Array(129);for(var i=0;i<129;i++)rawPubKey[i]=keyInChar[28+i];var n=new encryptionBigInteger(rawPubKey);var e=new encryptionBigInteger("010001",16);var hexRsa=rsa_oaep_encrypt(password+String.fromCharCode(0),n,e);return hexRsa}var SWCanvas=function(canvas){this.arr=new ArrayBuffer(canvas.width*canvas.height*4);this.arr32=new Uint32Array(this.arr);this.arr8=new Uint8ClampedArray(this.arr);this.canvas=canvas;this.width=this.canvas.width;this.height=this.canvas.height};SWCanvas.prototype.putImageData=function(imgData,x,y){var srcArr=imgData.data.buffer;var w=imgData.width;var pos=imgData.height;var tmp;var canvasWidth=this.width;var tmpArr;while(pos--){tmp=(y+pos)*canvasWidth+x;tmpArr=new Uint32Array(srcArr,w*pos*4,w);this.arr32.set(tmpArr,tmp)}};SWCanvas.prototype.getImageData=function(x,y,width,height){var result=new Uint32Array(width*height);var arr=this.arr32;var pos=height;var tmp;var canvasWidth=this.width;while(pos--){tmp=(y+pos)*canvasWidth+x;var line=arr.subarray(tmp,tmp+width);result.set(line,width*pos)}return new ImageData(new Uint8ClampedArray(result.buffer),width,height)};SWCanvas.prototype.fillRect=function(r,g,b,x,y,width,height){var line=new Uint32Array(width);var color32=4278190080|r|g<<8|b<<16;var canvasWidth=this.width;var w=width;while(w--){line[w]=color32}var tmp;while(height--){tmp=(y+height)*canvasWidth+x;this.arr32.set(line,tmp)}};SWCanvas.prototype.flushBack=function(){var arr8=this.canvas.getContext("2d").getImageData(0,0,this.width,this.height).data;this.arr8.set(arr8)};SWCanvas.prototype.flush=function(){var imgData=new ImageData(this.arr8,this.width,this.height);this.canvas.getContext("2d").putImageData(imgData,0,0)};!function(name,definition){if(typeof module!="undefined"&&module.exports)module.exports["browser"]=definition();else this[name]=definition()}("bowser",function(){var t=true;function detect(ua){function getFirstMatch(regex){var match=ua.match(regex);return match&&match.length>1&&match[1]||""}var iosdevice=getFirstMatch(/(ipod|iphone|ipad)/i).toLowerCase(),likeAndroid=/like android/i.test(ua),android=!likeAndroid&&/android/i.test(ua),versionIdentifier=getFirstMatch(/version\/(\d+(\.\d+)?)/i),tablet=/tablet/i.test(ua),mobile=!tablet&&/[^-]mobi/i.test(ua),result;if(/opera|opr/i.test(ua)){result={name:"Opera",opera:t,version:versionIdentifier||getFirstMatch(/(?:opera|opr)[\s\/](\d+(\.\d+)?)/i)}}else if(/windows phone/i.test(ua)){result={name:"Windows Phone",windowsphone:t,msie:t,version:getFirstMatch(/iemobile\/(\d+(\.\d+)?)/i)}}else if(/msie|trident/i.test(ua)){result={name:"Internet Explorer",msie:t,version:getFirstMatch(/(?:msie |rv:)(\d+(\.\d+)?)/i)}}else if(/chrome|crios|crmo/i.test(ua)){result={name:"Chrome",chrome:t,version:getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}}else if(iosdevice){result={name:iosdevice=="iphone"?"iPhone":iosdevice=="ipad"?"iPad":"iPod"};if(versionIdentifier){result.version=versionIdentifier}}else if(/sailfish/i.test(ua)){result={name:"Sailfish",sailfish:t,version:getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}}else if(/seamonkey\//i.test(ua)){result={name:"SeaMonkey",seamonkey:t,version:getFirstMatch(/seamonkey\/(\d+(\.\d+)?)/i)}}else if(/firefox|iceweasel/i.test(ua)){result={name:"Firefox",firefox:t,version:getFirstMatch(/(?:firefox|iceweasel)[ \/](\d+(\.\d+)?)/i)};if(/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(ua)){result.firefoxos=t}}else if(/silk/i.test(ua)){result={name:"Amazon Silk",silk:t,version:getFirstMatch(/silk\/(\d+(\.\d+)?)/i)}}else if(android){result={name:"Android",version:versionIdentifier}}else if(/phantom/i.test(ua)){result={name:"PhantomJS",phantom:t,version:getFirstMatch(/phantomjs\/(\d+(\.\d+)?)/i)}}else if(/blackberry|\bbb\d+/i.test(ua)||/rim\stablet/i.test(ua)){result={name:"BlackBerry",blackberry:t,version:versionIdentifier||getFirstMatch(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}}else if(/(web|hpw)os/i.test(ua)){result={name:"WebOS",webos:t,version:versionIdentifier||getFirstMatch(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)};/touchpad\//i.test(ua)&&(result.touchpad=t)}else if(/bada/i.test(ua)){result={name:"Bada",bada:t,version:getFirstMatch(/dolfin\/(\d+(\.\d+)?)/i)}}else if(/tizen/i.test(ua)){result={name:"Tizen",tizen:t,version:getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||versionIdentifier}}else if(/safari/i.test(ua)){result={name:"Safari",safari:t,version:versionIdentifier}}else result={};if(/(apple)?webkit/i.test(ua)){result.name=result.name||"Webkit";result.webkit=t;if(!result.version&&versionIdentifier){result.version=versionIdentifier}}else if(!result.opera&&/gecko\//i.test(ua)){result.name=result.name||"Gecko";result.gecko=t;result.version=result.version||getFirstMatch(/gecko\/(\d+(\.\d+)?)/i)}if(android||result.silk){result.android=t}else if(iosdevice){result[iosdevice]=t;result.ios=t}var osVersion="";if(iosdevice){osVersion=getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i);osVersion=osVersion.replace(/[_\s]/g,".")}else if(android){osVersion=getFirstMatch(/android[ \/-](\d+(\.\d+)*)/i)}else if(result.windowsphone){osVersion=getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i)}else if(result.webos){osVersion=getFirstMatch(/(?:web|hpw)os\/(\d+(\.\d+)*)/i)}else if(result.blackberry){osVersion=getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i)}else if(result.bada){osVersion=getFirstMatch(/bada\/(\d+(\.\d+)*)/i)}else if(result.tizen){osVersion=getFirstMatch(/tizen[\/\s](\d+(\.\d+)*)/i)}if(osVersion){result.osversion=osVersion}var osMajorVersion=osVersion.split(".")[0];if(tablet||iosdevice=="ipad"||android&&(osMajorVersion==3||osMajorVersion==4&&!mobile)||result.silk){result.tablet=t}else if(mobile||iosdevice=="iphone"||iosdevice=="ipod"||android||result.blackberry||result.webos||result.bada){result.mobile=t}if(result.msie&&result.version>=9||result.chrome&&result.version>=20||result.firefox&&result.version>=10||result.safari&&result.version>=5||result.opera&&result.version>=10||result.ios&&result.osversion&&result.osversion.split(".")[0]>=6){result.a=t}else if(result.msie&&result.version<9||result.chrome&&result.version<20||result.firefox&&result.version<10||result.safari&&result.version<5||result.opera&&result.version<10||result.ios&&result.osversion&&result.osversion.split(".")[0]<6){result.c=t}else result.x=t;return result}var bowser=detect(typeof navigator!=="undefined"?navigator.userAgent:"");bowser._detect=detect;if(!window["bowser"]){window["bowser"]=bowser}return bowser});if(typeof module!=="undefined"&&module.exports){jQuery=$={isArray:function(obj){return Object.prototype.toString.apply(obj)==="[object Array]"},isPlainObject:function(obj){var key;if(!obj||jQuery.type(obj)!=="object"||obj.nodeType||jQuery.isWindow(obj)){return false}if(obj.constructor&&!core_hasOwn.call(obj,"constructor")&&!core_hasOwn.call(obj.constructor.prototype,"isPrototypeOf")){return false}for(key in obj){}return key===undefined||core_hasOwn.call(obj,key)},extend:function(){var options,name,src,copy,copyIsArray,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=false;if(typeof target==="boolean"){deep=target;target=arguments[1]||{};i=2}if(length===i){target=this;--i}for(;i<length;i++){if((options=arguments[i])!=null){for(name in options){src=target[name];copy=options[name];if(target===copy){continue}if(deep&&copy&&(this.isPlainObject(copy)||(copyIsArray=this.isArray(copy)))){if(copyIsArray){copyIsArray=false;clone=src&&this.isArray(src)?src:[]}else{clone=src&&this.isPlainObject(src)?src:{}}target[name]=this.extend(deep,clone,copy)}else if(copy!==undefined){target[name]=copy}}}}return target}}}$.extend({spcExtend:function(obj){var f=function(c){if(typeof this["init"]!=="undefined"){this.init(c||{})}};f.prototype.superInit=obj.init;var args=[];args.push(f.prototype);var length=arguments.length;for(var i=0;i<length;i++){args.push(arguments[i])}$.extend.apply($,args);return f}});$.extend(String.prototype,{lpad:function(padString,length){var str=this;while(str.length<length)str=padString+str;return str},rpad:function(padString,length){var str=this;while(str.length<length)str=str+padString;return str}});wdi={};wdi.DomainObject={};wdi.RawMessage=$.spcExtend(wdi.DomainObject,{status:null,data:null,init:function(c){this.status=c.status;this.data=c.data}});wdi.RawSpiceMessage=$.spcExtend(wdi.DomainObject,{header:null,body:null,channel:null,set:function(header,body,channel){this.header=header;this.body=body;this.channel=channel}});wdi.SpiceMessage=$.spcExtend(wdi.DomainObject,{messageType:null,args:null,channel:null,init:function(c){this.channel=c.channel;this.messageType=c.messageType;this.args=c.args}});wdi.EventObject=$.spcExtend(wdi.DomainObject,{events:null,init:function(){this.eyeEvents={}},getListenersLength:function(eventName){if(this.eyeEvents[eventName]==undefined){this.eyeEvents[eventName]=[]}return this.eyeEvents[eventName].length},addListener:function(eventName,fn,scope){scope=scope||this;if(this.eyeEvents[eventName]==undefined){this.eyeEvents[eventName]=[]}this.eyeEvents[eventName].push({fn:fn,scope:scope})},removeEvent:function(eventName){this.eyeEvents[eventName]=undefined},clearEvents:function(){this.eyeEvents={}},fire:function(eventName,params){var listeners=this.eyeEvents[eventName];if(listeners){var size=listeners.length;while(size--){listeners[size].fn.call(listeners[size].scope,params)}}}});wdi.CHANNEL_STATUS={disconnected:-1,idle:0,establishing:1,established:2};wdi.Debug={debug:false,log:function(variable_list_of_args){if(this.debug){console.log.apply(console,Array.prototype.slice.call(arguments))}},warn:function(variable_list_of_args){console.warn.apply(console,Array.prototype.slice.call(arguments))},info:function(variable_list_of_args){if(this.debug){console.info.apply(console,Array.prototype.slice.call(arguments))}},error:function(variable_list_of_args){console.error.apply(console,Array.prototype.slice.call(arguments))}};wdi.Utils={generateWebSocketUrl:function(protocol,host,port,destHost,destPort,type,destInfoToken){if(!destHost||!destPort){url=protocol+"://"+host+":"+port+"/websockify/destInfoToken/"+destInfoToken+"/type/"+type}else{url=protocol+"://"+host+":"+port+"/websockify/host/"+destHost+"/port/"+destPort+"/type/"+type}return url}};wdi.postMessageW3CCompilant=typeof window!=="undefined"&&window["bowser"]&&!(window["bowser"]["msie"]&&window["bowser"]["version"]>=10);wdi.Exception=$.spcExtend(wdi.DomainObject,{errorCode:null,message:null,init:function(c){this.message=c.message||"";this.errorCode=c.errorCode||0}});try{new ImageData(1,1)}catch(e){if(typeof window!=="undefined"){window.ImageData=function(arr,width,height){var canvas=document.createElement("canvas");var context=canvas.getContext("2d");var imgData=context.createImageData(width,height);imgData.data.set(arr);return imgData}}}wdi.bppMask=[];wdi.bppMask[1]=[128,64,32,16,8,4,2,1];wdi.bppMask[4]=[240,15];wdi.bppMask[8]=[255];wdi.SeamlessIntegration=true;wdi.Debug.debug=false;wdi.exceptionHandling=true;wdi.IntegrationBenchmarkEnabled=false;wdi.useWorkers=true;wdi.logOperations=false;wdi.Flipper={flip:function(sourceImg){return this._handMadeFlip(sourceImg)},_handMadeFlip:function(sourceImg){var newCanvas=document.createElement("canvas");newCanvas.width=sourceImg.width;newCanvas.height=sourceImg.height;var ctx=newCanvas.getContext("2d");ctx.save();ctx.scale(1,-1);ctx.drawImage(sourceImg,0,-sourceImg.height);ctx.restore();return newCanvas}};wdi.CollisionDetector={thereIsBoxCollision:function(baseBox,queueBox){if(baseBox.bottom<queueBox.top)return false;if(baseBox.top>queueBox.bottom)return false;if(baseBox.right<queueBox.left)return false;return baseBox.left<queueBox.right}};wdi.GlobalPool={pools:{},retained:null,init:function(){this.retained={};var self=this;this.pools["ViewQueue"]=new wdi.GenericObjectPool([function(){return new wdi.ViewQueue},function(obj,index){obj.poolIndex=index;obj.setData([])}]);this.pools["RawSpiceMessage"]=new wdi.GenericObjectPool([function(){return new wdi.RawSpiceMessage},function(obj,index){obj.poolIndex=index;obj.set(null,null,null)}]);this.retained["Image"]=[];this.pools["Image"]=new wdi.GenericObjectPool([function(){return new Image},function(obj,index){obj.poolIndex=index;obj.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";obj.onload=null;obj.keepAlive=false;self.retained["Image"][index]=obj}]);this.retained["Canvas"]=[];this.pools["Canvas"]=new wdi.GenericObjectPool([function(){return self.createCanvas()},function(obj,index){obj.keepAlive=false;obj.poolIndex=index;self.retained["Canvas"][index]=obj}])},createCanvas:function(){return $("<canvas/>")[0]},create:function(objectType){return this.pools[objectType].create()},discard:function(objectType,obj){if(this.retained.hasOwnProperty(objectType)){delete this.retained[objectType][obj.poolIndex]}return this.pools[objectType].discard(obj.poolIndex)},cleanPool:function(objectType){if(this.retained.hasOwnProperty(objectType)){var pool=this.pools[objectType];for(var i in this.retained[objectType]){if(pool.discard(this.retained[objectType][i].poolIndex)){delete this.retained[objectType][i]}}}else{wdi.Debug.error("GlobalPool: cleanPool called with invalid objectType: ",objectType)}}};wdi.GenericObjectPool=$.spcExtend(wdi.EventObject.prototype,{expandFactor:.2,expandMinUnits:16,elems:null,freeElems:null,allocator:null,resetor:null,init:function(params){var allocator=params[0];var resetor=params[1];this.allocator=allocator;this.resetor=resetor;this.elems=[this.allocator()];this.freeElems=[0]},create:function(){if(!this.freeElems.length){this.expand()}var index=this.freeElems.pop();var elem=this.elems[index];this.resetor(elem,index);return elem},length:function(){return this.elems.length-this.freeElems.length},expand:function(){var oldSize=this.elems.length;var growth=Math.ceil(this.elems.length*this.expandFactor);if(growth<this.expandMinUnits){growth=this.expandMinUnits}this.elems.length=this.elems.length+growth;for(var i=oldSize;i<this.elems.length;i++){this.elems[i]=this.allocator();this.freeElems.push(i)}},discard:function(n){if(this.freeElems.indexOf(n)>=0){throw"GeneircObjectPool: Double-free for element index: "+n}if(this.elems[n].keepAlive){return false}this.freeElems.push(n);return true},get:function(n){return this.elems[n]}});wdi.AsyncConsumer=$.spcExtend(wdi.EventObject.prototype,{worker:null,task:null,packetWorkerIdentifier:null,imageProperties:null,init:function(c){this.superInit();this.worker=c.AsyncWorker||new wdi.AsyncWorker({script:"application/WorkerProcess.js"});this.packetWorkerIdentifier=c.packetWorkerIdentifier||new wdi.PacketWorkerIdentifier},consume:function(task){this.task=task;var message=task.message;var imageProperties;var intercept=this.packetWorkerIdentifier.shouldUseWorker(message);if(intercept==wdi.PacketWorkerIdentifier.processingType.DECOMPRESS){imageProperties=this.packetWorkerIdentifier.getImageProperties(message);this.imageProperties=imageProperties;if(imageProperties&&(imageProperties.descriptor.type!=wdi.SpiceImageType.SPICE_IMAGE_TYPE_LZ_RGB&&imageProperties.descriptor.type!=wdi.SpiceImageType.SPICE_IMAGE_TYPE_QUIC)){intercept=0}else if(!imageProperties){intercept=0}}if(intercept===0){this.taskDone();return}var data;var descriptor;var opaque;var brush;var ret;var arr;var u8;if(intercept==wdi.PacketWorkerIdentifier.processingType.DECOMPRESS){data=imageProperties.data;descriptor=imageProperties.descriptor;opaque=imageProperties.opaque;
brush=imageProperties.brush;if(descriptor.type===wdi.SpiceImageType.SPICE_IMAGE_TYPE_LZ_RGB){var header=null;if(!brush){var headerData=data.subarray(0,32).toJSArray();data=data.subarray(32);header=wdi.LZSS.demarshall_rgb(headerData)}else{header=wdi.LZSS.demarshall_rgb(data)}arr=new ArrayBuffer(data.length+16);u8=new Uint8Array(arr);u8[0]=1;u8[1]=opaque;u8[2]=header.type;u8[3]=header.top_down;var number=header.width*header.height*4;for(var i=0;i<4;i++){u8[4+i]=number&255;number=number>>8}var view=new DataView(arr);view.setUint32(8,header.width);view.setUint32(12,header.height);u8.set(data,16);this.worker.run(arr,this._workerCompleted,{type:"lz",top_down:header.top_down,opaque:opaque},this)}else if(descriptor.type===wdi.SpiceImageType.SPICE_IMAGE_TYPE_QUIC){var adata=new ArrayBuffer(data.length+4);var view=new Uint8Array(adata);view.set(data,4);view[1]=opaque?1:0;view[0]=0;this.worker.run(adata,this._workerCompleted,{type:"quic"},this)}}else if(intercept==wdi.PacketWorkerIdentifier.processingType.PROCESSVIDEO){data=this.packetWorkerIdentifier.getVideoData(message);arr=new ArrayBuffer(data.length+4);u8=new Uint8Array(arr);u8[0]=2;u8[1]=0;u8[2]=0;u8[3]=0;u8.set(data,4);this.worker.run(arr,function(buf,params){message.args.data=buf;this.taskDone()},null,this)}},_workerCompleted:function(buf,options){if(!buf){this.taskDone();return}var descriptor=this.imageProperties.descriptor;var u8=new Uint8ClampedArray(buf);var source_img=new ImageData(u8,descriptor.width,descriptor.height);var myImage=source_img;if(options.type==="lz"){var top_down=options.top_down;var opaque=options.opaque;if(!top_down&&!opaque){myImage=wdi.graphics.getImageFromData(source_img,true);myImage=wdi.RasterOperation.flip(myImage)}}descriptor.originalType=descriptor.type;descriptor.type=wdi.SpiceImageType.SPICE_IMAGE_TYPE_CANVAS;if(this.task.message.messageType===wdi.SpiceVars.SPICE_MSG_DISPLAY_DRAW_FILL){this.task.message.args.brush.pattern.imageData=myImage;this.task.message.args.brush.pattern.image.type=wdi.SpiceImageType.SPICE_IMAGE_TYPE_CANVAS}else{this.task.message.args.image.data=myImage}this.taskDone()},taskDone:function(){this.task.state=1;this.fire("done",this)},dispose:function(){this.worker.dispose()}});wdi.AsyncWorker=$.spcExtend(wdi.EventObject.prototype,{worker:null,fn:null,scope:null,params:null,init:function(c){this.superInit();this.worker=new Worker(c.script);var self=this;this.worker.addEventListener("message",function(oEvent){self.fn.call(self.scope,oEvent.data,self.params)})},run:function(data,fn,params,scope){this.fn=fn;this.scope=scope;this.params=params;if(wdi.postMessageW3CCompilant){this.worker.postMessage(data,[data])}else{this.worker.postMessage(data)}},dispose:function(){this.worker.terminate()}});wdi.PacketWorkerIdentifier=$.spcExtend(wdi.EventObject.prototype,{init:function(c){},shouldUseWorker:function(message){switch(message.messageType){case wdi.SpiceVars.SPICE_MSG_DISPLAY_DRAW_COPY:return wdi.PacketWorkerIdentifier.processingType.DECOMPRESS;case wdi.SpiceVars.SPICE_MSG_DISPLAY_DRAW_FILL:var brush=message.args.brush;if(brush.type===wdi.SpiceBrushType.SPICE_BRUSH_TYPE_PATTERN){return wdi.PacketWorkerIdentifier.processingType.DECOMPRESS}break;case wdi.SpiceVars.SPICE_MSG_DISPLAY_DRAW_ALPHA_BLEND:return wdi.PacketWorkerIdentifier.processingType.DECOMPRESS;case wdi.SpiceVars.SPICE_MSG_DISPLAY_DRAW_BLEND:return wdi.PacketWorkerIdentifier.processingType.DECOMPRESS;case wdi.SpiceVars.SPICE_MSG_DISPLAY_DRAW_TRANSPARENT:return wdi.PacketWorkerIdentifier.processingType.DECOMPRESS}return 0},getImageProperties:function(message){var props={data:null,descriptor:null,opaque:true,brush:null};switch(message.messageType){case wdi.SpiceVars.SPICE_MSG_DISPLAY_DRAW_COPY:props.descriptor=message.args.image.imageDescriptor;props.data=message.args.image.data;break;case wdi.SpiceVars.SPICE_MSG_DISPLAY_DRAW_FILL:props.brush=message.args.brush;if(props.brush.type===wdi.SpiceBrushType.SPICE_BRUSH_TYPE_PATTERN){props.descriptor=props.brush.pattern.image;props.data=props.brush.pattern.imageData}else{return false}break;case wdi.SpiceVars.SPICE_MSG_DISPLAY_DRAW_ALPHA_BLEND:case wdi.SpiceVars.SPICE_MSG_DISPLAY_DRAW_BLEND:case wdi.SpiceVars.SPICE_MSG_DISPLAY_DRAW_TRANSPARENT:props.data=message.args.image.data;props.descriptor=message.args.image.imageDescriptor;props.opaque=false;break;default:wdi.Debug.log("PacketWorkerIdentifier: Unknown Packet in getImageProperties");return false}return props},getVideoData:function(message){if(message.messageType!==wdi.SpiceVars.SPICE_MSG_DISPLAY_STREAM_DATA){wdi.Debug.log("PacketWOrkerIdentifier: Invalid packet in getVideoData");return false}return message.args.data}});wdi.PacketWorkerIdentifier.processingType={};wdi.PacketWorkerIdentifier.processingType.DECOMPRESS=1;wdi.PacketWorkerIdentifier.processingType.PROCESSVIDEO=2;wdi.SpiceObject={properties:{},bytesToString:function(bytes,nbytes){var result="";var numBytes=nbytes||bytes.length;for(var i=0;i<numBytes;i++){result+=String.fromCharCode(bytes.shift())}return result},bytesToURI:function(data){var blob=new Blob([data],{type:"image/jpeg"});return URL.createObjectURL(blob)},bytesToStringBE:function(bytes,nbytes){var result="";var numBytes=nbytes||bytes.length;for(var i=numBytes;i>=0;i--){result+=String.fromCharCode(bytes[i])}return result},bytesToInt8:function(bytes){return bytes.shift()},bytesToInt8NoAllocate:function(bytes){var data=bytes.getByte(0);bytes.eatBytes(1);return data},bytesToInt16:function(bytes){var low=bytes.shift();var high=bytes.shift();return high*Math.pow(16,2)+low},bytesToInt16BE:function(bytes){var high=bytes.shift();var low=bytes.shift();return high*Math.pow(16,2)+low},bytesToInt32:function(bytes){var low=wdi.SpiceObject.bytesToInt16(bytes);var high=wdi.SpiceObject.bytesToInt16(bytes);return high*Math.pow(16,4)+low},bytesToInt16NoAllocate:function(bytes){var low=bytes.getByte(0);var high=bytes.getByte(1);bytes.eatBytes(2);return high*Math.pow(16,2)+low},bytesToInt32NoAllocate:function(bytes){var low=wdi.SpiceObject.bytesToInt16NoAllocate(bytes);var high=wdi.SpiceObject.bytesToInt16NoAllocate(bytes);return high*Math.pow(16,4)+low},bytesToInt32BE:function(bytes){var high=wdi.SpiceObject.bytesToInt16BE(bytes);var low=wdi.SpiceObject.bytesToInt16BE(bytes);return high*Math.pow(16,4)+low},bytesToInt64:function(bytes){var low=wdi.SpiceObject.bytesToInt32(bytes).toString(2).lpad("0",32);var high=wdi.SpiceObject.bytesToInt32(bytes).toString(2).lpad("0",32);return BigInteger.parse(high+low,2)},bytesToInt64NoAllocate:function(bytes){var low=wdi.SpiceObject.bytesToInt32NoAllocate(bytes).toString(2).lpad("0",32);var high=wdi.SpiceObject.bytesToInt32NoAllocate(bytes).toString(2).lpad("0",32);return BigInteger.parse(high+low,2)},bytesToInt64BE:function(bytes){var high=wdi.SpiceObject.bytesToInt32BE(bytes).toString(2).lpad("0",32);var low=wdi.SpiceObject.bytesToInt32BE(bytes).toString(2).lpad("0",32);return BigInteger.parse(high+low,2)},bytesToArray:function(arr,blockSize,nblocks,endian){var length=arr.length;var numBlocks=nblocks||length;var endianness=endian||"LE";var numbers=[];var f=null;switch(blockSize){case 8:f=wdi.SpiceObject.bytesToInt8;break;case 16:endianness=="LE"?f=wdi.SpiceObject.bytesToInt16:f=wdi.SpiceObject.bytesToInt16BE;break;case 32:endianness=="LE"?f=wdi.SpiceObject.bytesToInt32:f=wdi.SpiceObject.bytesToInt32BE;break;case 64:endianness=="LE"?f=wdi.SpiceObject.bytesToInt64:f=wdi.SpiceObject.bytesToInt64BE;break;default:throw new Exception("Not supported number of bits",1);return false}for(var i=0;i<numBlocks;i++){numbers=numbers.concat(f(arr))}return numbers},int32ToDouble:function(number){var sInt=wdi.SpiceObject.unsignedToSigned(number>>4);var decimals=(number&15)/15;var result=decimals+sInt;return result},unsignedToSigned:function(number,stride){var maxBit=Math.pow(2,stride)-1;if(number&Math.pow(2,stride-1)){number=-1*(maxBit-number)}return number},arrayToBytes:function(arr,blockSize,nblocks){var length=arr.length;var numBlocks=nblocks||length;var f=null;var rawData=[];switch(blockSize){case 8:f=wdi.SpiceObject.numberTo8;break;case 16:f=wdi.SpiceObject.numberTo16;break;case 32:f=wdi.SpiceObject.numberTo32;break;case 64:f=wdi.SpiceObject.numberTo64;break;default:throw new Exception("Not supported number of bits",1);return false}for(var i=0;i<numBlocks;i++){if(i<=length){rawData=rawData.concat(f(arr[i]))}else{rawData.push(0)}}return rawData},stringToBytes:function(string){var length=string.length;var rawData=[];for(var i=0;i<length;i++){rawData.push(string.charCodeAt(i))}return rawData},stringHexToBytes:function(string){var length=string.length;var rawData=[];for(var i=0;i<length;i+=2){rawData.push(parseInt(string[i]+string[i+1],16))}return rawData},stringBinaryToBytes:function(string,blocksize){string=string.lpad("0",blocksize);var rawData=[];for(var i=blocksize;i>=8;i-=8){rawData=rawData.concat(parseInt(string.substr(i-8,8),2))}return rawData},stringToBytesPadding:function(string,size){var rawData=[];var strsize=string.length;for(var i=0;i<size;i++){if(size>strsize-1){rawData.push(0)}else{rawData.push(string.charCodeAt(i))}}return rawData},numberTo64:function(biginteger){var tmp=this.numberTo32((biginteger&0x10000000000000000)>>32);var tmp2=this.numberTo32(biginteger&4294967295);var rawData=tmp2.concat(tmp);return rawData},numberTo32:function(number){var rawData=new Array(3);for(var i=0;i<4;i++){rawData[i]=number&255;number=number>>8}return rawData},numberTo16:function(number){var rawData=new Array(1);for(var i=0;i<2;i++){rawData[i]=number&255;number=number>>8}return rawData},numberTo8:function(number){return[number&255]},getMessageProperties:function(){return this.properties},getMessageProperty:function(propName,defaultValue){if(this.properties.hasOwnProperty(propName)){return this.properties[propName]}else{return defaultValue}}};wdi.SpiceDataHeader=$.spcExtend(wdi.SpiceObject,{objectSize:6,init:function(c){c?this.setContent(c):false},setContent:function(c){this.type=c.type;this.size=c.size},marshall:function(){this.rawData=[];this.rawData=this.rawData.concat(this.numberTo16(this.type),this.numberTo32(this.size));return this.rawData},demarshall:function(queue){this.type=this.bytesToInt16NoAllocate(queue);this.size=this.bytesToInt32NoAllocate(queue);return this}});wdi.SpiceLinkAuthMechanism=$.spcExtend(wdi.SpiceObject,{objectSize:4,init:function(c){c?this.setContent(c):false},setContent:function(c){this.auth_mechanism=c.auth_mechanism},marshall:function(){this.rawData=[];this.rawData=this.rawData.concat(this.numberTo32(this.auth_mechanism));return this.rawData},demarshall:function(queue){this.expectedSize=arguments[1]||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.auth_mechanism=this.bytesToInt32NoAllocate(queue);"customDemarshall"in this?this.customDemarshall(queue):false;return this}});wdi.SpiceLinkReply=$.spcExtend(wdi.SpiceObject,{objectSize:178,init:function(c){c?this.setContent(c):false},setContent:function(c){this.error=c.error;this.pub_key=c.pub_key;this.num_common_caps=c.num_common_caps;this.num_channel_caps=c.num_channel_caps;this.caps_offset=c.caps_offset},marshall:function(){this.rawData=[];this.rawData=this.rawData.concat(this.numberTo32(this.error),this.arrayToBytes(this.pub_key,8),this.numberTo32(this.num_common_caps),this.numberTo32(this.num_channel_caps),this.numberTo32(this.caps_offset));return this.rawData},demarshall:function(queue){this.expectedSize=arguments[1]||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.error=this.bytesToInt32NoAllocate(queue);this.pub_key=this.bytesToArray(queue.shift(this.expectedSize),8);this.num_common_caps=this.bytesToInt32NoAllocate(queue);this.num_channel_caps=this.bytesToInt32NoAllocate(queue);this.caps_offset=this.bytesToInt32NoAllocate(queue);"customDemarshall"in this?this.customDemarshall(queue):false;return this}});wdi.SpiceLinkEncryptedTicket=$.spcExtend(wdi.SpiceObject,{objectSize:128,init:function(c){c?this.setContent(c):false},setContent:function(c){this.encrypted_data=c.encrypted_data},marshall:function(){this.rawData=[];this.rawData=this.rawData.concat(this.stringToBytes(this.encrypted_data,8));return this.rawData},demarshall:function(queue){this.expectedSize=arguments[1]||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.encrypted_data=this.bytesToArray(queue.shift(this.expectedSize),8);"customDemarshall"in this?this.customDemarshall(queue):false;return this}});wdi.SpiceLinkMess=$.spcExtend(wdi.SpiceObject,{objectSize:18,init:function(c){c?this.setContent(c):false},setContent:function(c){this.connection_id=c.connection_id;this.channel_type=c.channel_type;this.channel_id=c.channel_id;this.num_common_caps=c.num_common_caps;this.num_channel_caps=c.num_channel_caps;this.caps_offset=c.caps_offset;this.common_caps=c.common_caps;this.channel_caps=c.channel_caps},marshall:function(){this.rawData=[];this.rawData=this.rawData.concat(this.numberTo32(this.connection_id),this.numberTo8(this.channel_type),this.numberTo8(this.channel_id),this.numberTo32(this.num_common_caps),this.numberTo32(this.num_channel_caps),this.numberTo32(this.caps_offset));if(this.num_common_caps>0){this.rawData=this.rawData.concat(this.numberTo32(this.common_caps))}if(this.num_channel_caps>0){this.rawData=this.rawData.concat(this.numberTo32(this.channel_caps))}return this.rawData},demarshall:function(queue){this.expectedSize=arguments[1]||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.connection_id=this.bytesToInt32NoAllocate(queue);this.channel_type=this.bytesToInt8NoAllocate(queue);this.channel_id=this.bytesToInt8NoAllocate(queue);this.num_common_caps=this.bytesToInt32NoAllocate(queue);this.num_channel_caps=this.bytesToInt32NoAllocate(queue);this.caps_offset=this.bytesToInt32NoAllocate(queue);"customDemarshall"in this?this.customDemarshall(queue):false;return this}});wdi.SpiceLinkHeader=$.spcExtend(wdi.SpiceObject,{objectSize:16,init:function(c){c?this.setContent(c):false},setContent:function(c){this.magic=c.magic;this.major_version=c.major_version;this.minor_version=c.minor_version;this.size=c.size},marshall:function(){this.rawData=[];this.rawData=this.rawData.concat(this.numberTo32(this.magic),this.numberTo32(this.major_version),this.numberTo32(this.minor_version),this.numberTo32(this.size));return this.rawData},demarshall:function(queue){this.expectedSize=arguments[1]||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.magic=this.bytesToInt32NoAllocate(queue);this.major_version=this.bytesToInt32NoAllocate(queue);this.minor_version=this.bytesToInt32NoAllocate(queue);this.size=this.bytesToInt32NoAllocate(queue);"customDemarshall"in this?this.customDemarshall(queue):false;return this}});wdi.RedMigrateData=$.spcExtend(wdi.SpiceObject,{objectSize:0,init:function(c){c?this.setContent(c):false},setContent:function(c){this.vector=c.vector},marshall:function(){this.rawData=[];this.rawData=this.rawData.concat(this.arrayToBytes(this.vector,8));return this.rawData},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.vector=this.bytesToArray(queue.shift(this.expectedSize),8);return this}});wdi.RedMainInit=$.spcExtend(wdi.SpiceObject,{objectSize:32,init:function(c){c?this.setContent(c):false},setContent:function(c){this.session_id=c.session_id;this.display_channels_hint=c.display_channels_hint;this.supported_mouse_modes=c.supported_mouse_modes;this.current_mouse_mode=c.current_mouse_mode;this.agent_connected=c.agent_connected;this.agent_tokens=c.agent_tokens;this.multi_media_time=c.multi_media_time;this.ram_hint=c.ram_hint},marshall:function(){this.rawData=[];this.rawData=this.rawData.concat(this.numberTo32(this.session_id),this.numberTo32(this.display_channels_hint),this.numberTo32(this.supported_mouse_modes),this.numberTo32(this.current_mouse_mode),this.numberTo32(this.agent_connected),this.numberTo32(this.agent_tokens),this.numberTo32(this.multi_media_time),this.numberTo32(this.ram_hint));return this.rawData},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.session_id=this.bytesToInt32NoAllocate(queue);this.display_channels_hint=this.bytesToInt32NoAllocate(queue);this.supported_mouse_modes=this.bytesToInt32NoAllocate(queue);this.current_mouse_mode=this.bytesToInt32NoAllocate(queue);this.agent_connected=this.bytesToInt32NoAllocate(queue);this.agent_tokens=this.bytesToInt32NoAllocate(queue);this.multi_media_time=this.bytesToInt32NoAllocate(queue);this.ram_hint=this.bytesToInt32NoAllocate(queue);return this}});wdi.SpiceMsgMainAgentConnected=$.spcExtend(wdi.SpiceObject,{objectSize:0,init:function(c){c?this.setContent(c):false},setContent:function(c){},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});return this}});wdi.SpiceChannelsList=$.spcExtend(wdi.SpiceObject,{objectSize:4,init:function(c){c?this.setContent(c):false},setContent:function(c){this.num_of_channels=c.num_of_channels;this.channels=c.channels},marshall:function(){this.rawData=[];this.rawData=this.rawData.concat(this.numberTo32(this.num_of_channels),this.arrayToBytes(this.channels,16));return this.rawData},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.num_of_channels=this.bytesToInt32NoAllocate(queue);this.channels=this.bytesToArray(queue.shift(this.expectedSize),16);return this}});wdi.RedSetAck=$.spcExtend(wdi.SpiceObject,{objectSize:8,init:function(c){c?this.setContent(c):false},setContent:function(c){this.generation=c.generation;this.window=c.window},marshall:function(){this.rawData=[];this.rawData=this.rawData.concat(this.numberTo32(this.generation),this.numberTo32(this.window));return this.rawData},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.generation=this.bytesToInt32NoAllocate(queue);this.window=this.bytesToInt32NoAllocate(queue);return this}});wdi.RedPing=$.spcExtend(wdi.SpiceObject,{objectSize:12,init:function(c){c?this.setContent(c):false},setContent:function(c){this.id=c.id;this.time=c.time},marshall:function(){this.rawData=[];this.rawData=this.rawData.concat(this.numberTo32(this.id),this.numberTo64(this.time));return this.rawData},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.id=this.bytesToInt32NoAllocate(queue);this.time=this.bytesToInt64NoAllocate(queue);if(this.expectedSize>12){queue.shift(this.expectedSize-12)}return this}});wdi.RedMigrate=$.spcExtend(wdi.SpiceObject,{objectSize:4,init:function(c){c?this.setContent(c):false},setContent:function(c){this.flags=c.flags},marshall:function(){this.rawData=[];this.rawData=this.rawData.concat(this.numberTo32(this.flags));return this.rawData},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.flags=this.bytesToInt32NoAllocate(queue);return this}});wdi.RedWaitForChannel=$.spcExtend(wdi.SpiceObject,{objectSize:10,init:function(c){c?this.setContent(c):false},setContent:function(c){this.type=c.type;this.id=c.id;this.serial=c.serial},marshall:function(){this.rawData=[];this.rawData=this.rawData.concat(this.numberTo8(this.type),this.numberTo8(this.id),this.numberTo64(this.serial));return this.rawData},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.type=this.bytesToInt8NoAllocate(queue);this.id=this.bytesToInt8NoAllocate(queue);this.serial=this.bytesToInt64NoAllocate(queue);return this}});wdi.RedWaitForChannels=$.spcExtend(wdi.SpiceObject,{objectSize:1,init:function(c){c?this.setContent(c):false},setContent:function(c){this.wait_count=c.wait_count;this.wait_list=c.wait_list},marshall:function(){this.rawData=[];this.rawData=this.rawData.concat(this.numberTo8(this.wait_count),this.arrayToBytes(this.wait_list,8));return this.rawData},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.wait_count=this.bytesToInt8NoAllocate(queue);this.wait_list=this.bytesToArray(queue.shift(this.expectedSize),8);return this}});wdi.RedDisconnect=$.spcExtend(wdi.SpiceObject,{objectSize:12,init:function(c){c?this.setContent(c):false},setContent:function(c){this.time_stamp=c.time_stamp;this.reason=c.reason},marshall:function(){this.rawData=[];this.rawData=this.rawData.concat(this.numberTo64(this.time_stamp),this.numberTo32(this.reason));return this.rawData},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.time_stamp=this.bytesToInt64NoAllocate(queue);this.reason=this.bytesToInt32NoAllocate(queue);return this}});wdi.RedMigrationBegin=$.spcExtend(wdi.SpiceObject,{objectSize:4,init:function(c){c?this.setContent(c):false},setContent:function(c){this.port=c.port;this.sport=c.sport;this.host_name=c.host_name},marshall:function(){this.rawData=[];this.rawData=this.rawData.concat(this.numberTo16(this.port),this.numberTo16(this.sport),this.arrayToBytes(this.host_name,8));return this.rawData},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.port=this.bytesToInt16NoAllocate(queue);this.sport=this.bytesToInt16NoAllocate(queue);this.host_name=this.bytesToArray(queue.shift(this.expectedSize),8);return this}});wdi.RedNotify=$.spcExtend(wdi.SpiceObject,{objectSize:25,init:function(c){c?this.setContent(c):false},setContent:function(c){this.time_stamp=c.time_stamp;this.severity=c.severity;this.visibility=c.visibility;this.what=c.what;this.message_len=c.message_len;this.message=c.message;this.zero=c.zero},marshall:function(){this.rawData=[];this.rawData=this.rawData.concat(this.numberTo64(this.time_stamp),this.numberTo32(this.severity),this.numberTo32(this.visibility),this.numberTo32(this.what),this.numberTo32(this.message_len),this.arrayToBytes(this.message,8),this.numberTo8(this.zero));return this.rawData},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.time_stamp=this.bytesToInt64NoAllocate(queue);this.severity=this.bytesToInt32NoAllocate(queue);this.visibility=this.bytesToInt32NoAllocate(queue);this.what=this.bytesToInt32NoAllocate(queue);this.message_len=this.bytesToInt32NoAllocate(queue);this.message=this.bytesToString(queue.shift(this.message_len));this.zero=this.bytesToInt8NoAllocate(queue);return this}});wdi.RedMode=$.spcExtend(wdi.SpiceObject,{objectSize:12,init:function(c){c?this.setContent(c):false},setContent:function(c){this.width=c.width;this.height=c.height;this.depth=c.depth},marshall:function(){this.rawData=[];this.rawData=this.rawData.concat(this.numberTo32(this.width),this.numberTo32(this.height),this.numberTo32(this.depth));return this.rawData},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.width=this.bytesToInt32NoAllocate(queue);this.height=this.bytesToInt32NoAllocate(queue);this.depth=this.bytesToInt32NoAllocate(queue);return this}});wdi.SpiceCDisplayInit=$.spcExtend(wdi.SpiceObject,{objectSize:14,init:function(c){c?this.setContent(c):false},setContent:function(c){this.pixmap_cache_id=c.pixmap_cache_id;this.pixmap_cache_size=c.pixmap_cache_size;this.glz_dictionary_id=c.glz_dictionary_id;this.glz_dictionary_window_size=c.glz_dictionary_window_size},marshall:function(){this.rawData=[];this.rawData=this.rawData.concat(this.numberTo8(this.pixmap_cache_id),this.numberTo32(this.pixmap_cache_size),this.numberTo32(0),this.numberTo8(this.glz_dictionary_id),this.numberTo32(this.glz_dictionary_window_size));return this.rawData},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.pixmap_cache_id=this.bytesToInt8NoAllocate(queue);this.pixmap_cache_size=this.bytesToInt64NoAllocate(queue);this.glz_dictionary_id=this.bytesToInt8NoAllocate(queue);this.glz_dictionary_window_size=this.bytesToInt32NoAllocate(queue);return this}});wdi.SpiceSurfaceDestroy=$.spcExtend(wdi.SpiceObject,{objectSize:4,init:function(c){c?this.setContent(c):false},setContent:function(c){this.surface_id=c.surface_id},marshall:function(){this.rawData=[];this.rawData=this.rawData.concat(this.numberTo32(this.surface_id));return this.rawData},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.surface_id=this.bytesToInt32NoAllocate(queue);return this}});wdi.SpiceSurface=$.spcExtend(wdi.SpiceObject,{objectSize:20,init:function(c){c?this.setContent(c):false},setContent:function(c){this.surface_id=c.surface_id;this.width=c.width;this.height=c.height;this.format=c.format;this.flags=c.flags},marshall:function(){this.rawData=[];this.rawData=this.rawData.concat(this.numberTo32(this.surface_id),this.numberTo32(this.width),this.numberTo32(this.height),this.numberTo32(this.format),this.numberTo32(this.flags));return this.rawData},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.surface_id=this.bytesToInt32NoAllocate(queue);this.width=this.bytesToInt32NoAllocate(queue);this.height=this.bytesToInt32NoAllocate(queue);this.format=this.bytesToInt32NoAllocate(queue);this.flags=this.bytesToInt32NoAllocate(queue);return this}});wdi.SpicePath=$.spcExtend(wdi.SpiceObject,{objectSize:4,marshall:function(){},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});var num=this.num_segments=this.bytesToInt32NoAllocate(queue);this.segments=[];for(var i=0;i<num;i++){this.segments[i]=(new wdi.SpicePathSeg).demarshall(queue)}return this}});wdi.SpicePathSeg=$.spcExtend(wdi.SpiceObject,{objectSize:8,marshall:function(){},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.flags=this.bytesToInt8NoAllocate(queue);var count=this.count=this.bytesToInt32NoAllocate(queue);this.points=[];for(var i=0;i<count;i++){this.points[i]=(new wdi.SpicePointFix).demarshall(queue)}return this}});wdi.SpicePoint=$.spcExtend(wdi.SpiceObject,{objectSize:8,init:function(c){c?this.setContent(c):false},setContent:function(c){this.x=c.x;this.y=c.y},marshall:function(){this.rawData=[];this.rawData=this.rawData.concat(this.numberTo32(this.x),this.numberTo32(this.y));return this.rawData},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.x=this.unsignedToSigned(this.bytesToInt32(queue.shift(4)),32);this.y=this.unsignedToSigned(this.bytesToInt32(queue.shift(4)),32);return this}});wdi.SpicePoint16=$.spcExtend(wdi.SpiceObject,{objectSize:4,init:function(c){c?this.setContent(c):false},setContent:function(c){this.x=c.x;this.y=c.y},marshall:function(){this.rawData=[];this.rawData=this.rawData.concat(this.numberTo16(this.x),this.numberTo16(this.y));return this.rawData},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.x=this.bytesToInt16NoAllocate(queue);this.y=this.bytesToInt16NoAllocate(queue);return this}});wdi.SpicePointFix=$.spcExtend(wdi.SpiceObject,{objectSize:8,init:function(c){c?this.setContent(c):false},setContent:function(c){this.x=c.hasOwnProperty("x")?c.x:0;this.y=c.hasOwnProperty("y")?c.y:0},marshall:function(){this.rawData=[];this.rawData=this.rawData.concat(this.numberTo32(this.x),this.numberTo32(this.y));return this.rawData},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.x=this.int32ToDouble(this.bytesToInt32(queue.shift(4)),32);this.y=this.int32ToDouble(this.bytesToInt32(queue.shift(4)),32);return this}});wdi.SpiceRect=$.spcExtend(wdi.SpiceObject,{objectSize:16,init:function(c){c?this.setContent(c):false},setContent:function(c){this.top=c.top;this.left=c.left;this.bottom=c.bottom;this.right=c.right},marshall:function(){this.rawData=[];this.rawData=this.rawData.concat(this.numberTo32(this.top),this.numberTo32(this.left),this.numberTo32(this.bottom),this.numberTo32(this.right));return this.rawData},demarshall:function(queue,expSize){this.top=this.bytesToInt32NoAllocate(queue);this.left=this.bytesToInt32NoAllocate(queue);this.bottom=this.bytesToInt32NoAllocate(queue);this.right=this.bytesToInt32NoAllocate(queue);return this}});wdi.SpiceClipRects=$.spcExtend(wdi.SpiceObject,{objectSize:4,init:function(c){c?this.setContent(c):false},setContent:function(c){this.num_rects=c.num_rects},marshall:function(){this.rawData=[];this.rawData=this.rawData.concat(this.numberTo32(this.num_rects));for(var i=0;i<this.num_rects;i++){this.rawData=this.rawData.concat(this.rects[i].marshall())}return this.rawData},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.num_rects=this.bytesToInt32NoAllocate(queue);if(this.num_rects>0){this.rects=[];for(var i=0;i<this.num_rects;i++){this.rects[i]=(new wdi.SpiceRect).demarshall(queue)}}return this}});wdi.SpiceClip=$.spcExtend(wdi.SpiceObject,{objectSize:1,init:function(c){c?this.setContent(c):false},setContent:function(c){this.type=c.type},marshall:function(){this.rawData=[];this.rawData=this.rawData.concat(this.numberTo8(this.type));if(this.type==wdi.SpiceClipType.SPICE_CLIP_TYPE_RECTS){this.rawData=this.rawData.concat(this.rects.marshall())}return this.rawData},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.type=this.bytesToInt8NoAllocate(queue);if(this.type==wdi.SpiceClipType.SPICE_CLIP_TYPE_RECTS){this.rects=(new wdi.SpiceClipRects).demarshall(queue)}return this}});wdi.SpiceDisplayBase=$.spcExtend(wdi.SpiceObject,{objectSize:4,init:function(c){c?this.setContent(c):false;
},setContent:function(c){this.surface_id=c.surface_id},marshall:function(){this.rawData=[];this.rawData=this.rawData.concat(this.numberTo32(this.surface_id),this.box.marshall(),this.clip.marshall());return this.rawData},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.surface_id=this.bytesToInt32NoAllocate(queue);this.box=(new wdi.SpiceRect).demarshall(queue);this.clip=(new wdi.SpiceClip).demarshall(queue);return this}});wdi.SpiceQMask=$.spcExtend(wdi.SpiceObject,{objectSize:4,init:function(c){c?this.setContent(c):false},setContent:function(c){},marshall:function(){var rawData=[];rawData=rawData.concat(this.numberTo8(this.flags),this.pos.marshall(),this.numberTo32(this.offset));if(this.offset){rawData=rawData.concat(this.image.marshall())}return rawData},demarshall:function(queue,expSize){queue.eatBytes(13)}});wdi.SpiceImageDescriptor=$.spcExtend(wdi.SpiceObject,{objectSize:18,init:function(c){c?this.setContent(c):false},setContent:function(c){},marshall:function(){var rawData=[];rawData=rawData.concat(this.numberTo64(this.id),this.numberTo8(this.type),this.numberTo8(this.flags),this.numberTo32(this.width),this.numberTo32(this.height));return rawData},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});var id=this.bytesToInt32NoAllocate(queue);this.id=id.toString(16)+this.bytesToInt32NoAllocate(queue).toString(16);this.type=this.bytesToInt8NoAllocate(queue);this.flags=this.bytesToInt8NoAllocate(queue);this.width=this.bytesToInt32NoAllocate(queue);this.height=this.bytesToInt32NoAllocate(queue);this.offset=queue.getPosition();return this}});wdi.SpiceImage=$.spcExtend(wdi.SpiceObject,{objectSize:1,init:function(c){c?this.setContent(c):false},setContent:function(c){},marshall:function(){var rawData=[];rawData=rawData.concat(this.imageDescriptor.marshall(),this.data);return rawData},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.imageDescriptor=(new wdi.SpiceImageDescriptor).demarshall(queue);this.data=queue.getRawData();return this}});wdi.SpiceDrawCopy=$.spcExtend(wdi.SpiceObject,{objectSize:4,properties:{overWriteScreenArea:true},init:function(c){c?this.setContent(c):false},setContent:function(c){this.offset=c.offset},marshall:function(){this.rawData=[];this.rawData=this.rawData.concat(this.base.marshall(),this.numberTo32(this.offset),this.src_area.marshall(),this.numberTo16(this.rop_descriptor),this.numberTo8(this.scale_mode),this.mask.marshall(),this.image.marshall());return this.rawData},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.base=(new wdi.SpiceDisplayBase).demarshall(queue);this.offset=this.bytesToInt32NoAllocate(queue);this.src_area=(new wdi.SpiceRect).demarshall(queue);this.rop_descriptor=this.bytesToInt16NoAllocate(queue);this.scale_mode=this.bytesToInt8NoAllocate(queue);this.mask=(new wdi.SpiceQMask).demarshall(queue);if(queue.getPosition()==this.offset){this.image=(new wdi.SpiceImage).demarshall(queue)}else{var qdata=new wdi.ViewQueue;qdata.setData(queue.getDataOffset(this.offset));this.image=(new wdi.SpiceImage).demarshall(qdata)}return this}});wdi.drawBlend=$.spcExtend(wdi.SpiceObject,{objectSize:4,init:function(c){c?this.setContent(c):false},setContent:function(c){this.base=c.base;this.alpha_flags=c.alpha_flags;this.alpha=c.alpha;this.offset=c.offset;this.src_area=c.src_area},marshall:function(){var rawData=[];rawData=rawData.concat(this.base.marshall(),this.numberTo32(this.offset),this.src_area.marshall(),this.numberTo16(this.rop_descriptor),this.numberTo8(this.flags),this.mask.marshall(),this.image.marshall());return rawData},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.base=(new wdi.SpiceDisplayBase).demarshall(queue);this.offset=this.bytesToInt32NoAllocate(queue);this.src_area=(new wdi.SpiceRect).demarshall(queue);this.rop_descriptor=this.bytesToInt16NoAllocate(queue);this.flags=this.bytesToInt8NoAllocate(queue);this.mask=(new wdi.SpiceQMask).demarshall(queue);this.image=(new wdi.SpiceImage).demarshall(queue);return this}});wdi.drawAlphaBlend=$.spcExtend(wdi.SpiceObject,{objectSize:4,init:function(c){c?this.setContent(c):false},setContent:function(c){this.base=c.base;this.alpha_flags=c.alpha_flags;this.alpha=c.alpha;this.offset=c.offset;this.src_area=c.src_area},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.base=(new wdi.SpiceDisplayBase).demarshall(queue);this.alpha_flags=this.bytesToInt8NoAllocate(queue);this.alpha=this.bytesToInt8NoAllocate(queue);this.offset=this.bytesToInt32NoAllocate(queue);this.src_area=(new wdi.SpiceRect).demarshall(queue);this.image=(new wdi.SpiceImage).demarshall(queue);return this}});wdi.drawTransparent=$.spcExtend(wdi.SpiceObject,{objectSize:4,init:function(c){c?this.setContent(c):false},setContent:function(c){},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.base=(new wdi.SpiceDisplayBase).demarshall(queue);this.offset=this.bytesToInt32NoAllocate(queue);this.src_area=(new wdi.SpiceRect).demarshall(queue);this.transparent_color=(new wdi.SpiceColor).demarshall(queue);this.transparent_true_color=(new wdi.SpiceColor).demarshall(queue);this.image=(new wdi.SpiceImage).demarshall(queue);return this}});wdi.SpiceCopyBits=$.spcExtend(wdi.SpiceObject,{objectSize:4,init:function(c){c?this.setContent(c):false},setContent:function(c){this.offset=c.offset},marshall:function(){var rawData=[];rawData=rawData.concat(this.base.marshall(),this.src_position.marshall());return rawData},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.base=(new wdi.SpiceDisplayBase).demarshall(queue);this.src_position=(new wdi.SpicePoint).demarshall(queue);return this}});wdi.SpiceImageLZRGB=$.spcExtend(wdi.SpiceObject,{objectSize:32,init:function(c){c?this.setContent(c):false},setContent:function(c){},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.length=this.bytesToInt32BE(queue.shift(4));this.magic=this.bytesToStringBE(queue.shift(4));this.version=this.bytesToInt32BE(queue.shift(4));this.type=this.bytesToInt32BE(queue.shift(4));this.width=this.bytesToInt32BE(queue.shift(4));this.height=this.bytesToInt32BE(queue.shift(4));this.stride=this.bytesToInt32BE(queue.shift(4));this.top_down=this.bytesToInt32BE(queue.shift(4));this.data=queue.shift(this.length);return this}});wdi.SpiceMouseModeRequest=$.spcExtend(wdi.SpiceObject,{objectSize:4,init:function(c){c?this.setContent(c):false},setContent:function(c){this.request_mode=c.request_mode},marshall:function(){this.rawData=[];this.rawData=this.rawData.concat(this.numberTo32(this.request_mode));return this.rawData},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.request_mode=this.bytesToInt32NoAllocate(queue);return this}});wdi.SpiceMouseMode=$.spcExtend(wdi.SpiceObject,{objectSize:4,init:function(c){c?this.setContent(c):false},setContent:function(c){this.supported_modes=c.supported_modes;this.current_mode=c.current_mode},marshall:function(){this.rawData=[];this.rawData=this.rawData.concat(this.numberTo32(this.supported_modes),this.numberTo32(this.current_mode));return this.rawData},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)return;this.supported_modes=this.bytesToInt16NoAllocate(queue);this.current_mode=this.bytesToInt16NoAllocate(queue);return this}});wdi.RedcMousePress=$.spcExtend(wdi.SpiceObject,{objectSize:3,init:function(c){c?this.setContent(c):false},setContent:function(c){this.button_id=c.button_id;this.buttons_state=c.buttons_state},marshall:function(){this.rawData=[];this.rawData=this.rawData.concat(this.numberTo8(this.button_id),this.numberTo16(this.buttons_state));return this.rawData},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.button_id=this.bytesToInt8NoAllocate(queue);this.buttons_state=this.bytesToInt16NoAllocate(queue);return this}});wdi.RedcMousePosition=$.spcExtend(wdi.SpiceObject,{objectSize:11,init:function(c){c?this.setContent(c):false},setContent:function(c){this.x=c.x;this.y=c.y;this.buttons_state=c.buttons_state;this.display_id=c.display_id},marshall:function(){this.rawData=[];this.rawData=this.rawData.concat(this.numberTo32(this.x),this.numberTo32(this.y),this.numberTo16(this.buttons_state),this.numberTo8(this.display_id));return this.rawData},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.x=this.bytesToInt32NoAllocate(queue);this.y=this.bytesToInt32NoAllocate(queue);this.buttons_state=this.bytesToInt16NoAllocate(queue);this.display_id=this.bytesToInt8NoAllocate(queue);return this}});wdi.RedcMouseMotion=$.spcExtend(wdi.SpiceObject,{objectSize:10,init:function(c){c?this.setContent(c):false},setContent:function(c){this.x=c.x;this.y=c.y;this.buttons_state=c.buttons_state},marshall:function(){this.rawData=[];this.rawData=this.rawData.concat(this.numberTo32(this.x),this.numberTo32(this.y),this.numberTo16(this.buttons_state));return this.rawData},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.x=this.bytesToInt32NoAllocate(queue);this.y=this.bytesToInt32NoAllocate(queue);this.buttons_state=this.bytesToInt16NoAllocate(queue);return this}});wdi.SpiceBrush=$.spcExtend(wdi.SpiceObject,{objectSize:8,init:function(c){c?this.setContent(c):false},setContent:function(c){this.type=c.type;this.color=c.color},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.type=this.bytesToInt8NoAllocate(queue);if(this.type==wdi.SpiceBrushType.SPICE_BRUSH_TYPE_PATTERN){this.pattern=(new wdi.SpicePattern).demarshall(queue)}else if(this.type==wdi.SpiceBrushType.SPICE_BRUSH_TYPE_SOLID){this.color=(new wdi.SpiceColor).demarshall(queue)}return this}});wdi.SpiceColor=$.spcExtend(wdi.SpiceObject,{objectSize:4,init:function(c){c?this.setContent(c):false},setContent:function(c){},marshall:function(){return[this.r,this.g,this.b]},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.data=this.bytesToInt32(queue.shift(4))&16777215;this.r=this.data>>16;this.g=this.data>>8&255;this.b=this.data&255;this.html_color="rgb("+this.r+", "+this.g+", "+this.b+")";var r=this.r.toString(16);var g=this.g.toString(16);var b=this.b.toString(16);if(r.length<2){r="0"+r}if(g.length<2){g="0"+g}if(b.length<2){b="0"+b}this.simple_html_color="#"+r+g+b;return this}});wdi.RgbaColor=$.spcExtend(wdi.SpiceObject,{objectSize:4,init:function(c){c?this.setContent(c):false},setContent:function(c){},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.data=this.bytesToInt32(queue.shift(4))&4294967295;this.a=this.data>>>24;this.r=this.data>>>16&255;this.g=this.data>>>8&255;this.b=this.data&255;this.html_color="rgb("+this.r+", "+this.g+", "+this.b+")";return this}});wdi.SpicePattern=$.spcExtend(wdi.SpiceObject,{objectSize:12,init:function(c){c?this.setContent(c):false},setContent:function(c){},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.offset=this.bytesToInt32NoAllocate(queue);this.point=(new wdi.SpicePoint).demarshall(queue);var qdata=new wdi.ViewQueue;qdata.setData(queue.getDataOffset(this.offset));this.image=(new wdi.SpiceImage).demarshall(qdata);return this}});wdi.SpiceDrawFill=$.spcExtend(wdi.SpiceObject,{objectSize:4,properties:{overWriteScreenArea:true},init:function(c){c?this.setContent(c):false},setContent:function(c){this.offset=c.offset},marshall:function(){this.rawData=[];this.rawData=this.rawData.concat(this.numberTo32(this.offset));return this.rawData},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.base=(new wdi.SpiceDisplayBase).demarshall(queue);this.brush=(new wdi.SpiceBrush).demarshall(queue);this.rop_descriptor=this.bytesToInt16NoAllocate(queue);this.mask=(new wdi.SpiceQMask).demarshall(queue);if(this.brush.type==wdi.SpiceBrushType.SPICE_BRUSH_TYPE_PATTERN){this.brush.pattern.image=(new wdi.SpiceImageDescriptor).demarshall(queue);this.brush.pattern.imageData=queue.getData()}return this}});wdi.SpiceDrawRop3=$.spcExtend(wdi.SpiceObject,{objectSize:4,marshall:function(){var rawData=[];rawData=rawData.concat(this.base.marshall(),this.numberTo32(this.offset),this.src_area.marshall(),this.brush.marshall(),this.numberTo8(this.rop_descriptor),this.numberTo8(this.scale_mode),this.mask.marshall(),this.src_image.marshall());if(this.brush.type==wdi.SpiceBrushType.SPICE_BRUSH_TYPE_PATTERN){rawData=rawData.concat(this.brush.pattern.image.marshall(),this.brush.pattern.imageData)}return rawData},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.base=(new wdi.SpiceDisplayBase).demarshall(queue);this.offset=this.bytesToInt32NoAllocate(queue);this.src_area=(new wdi.SpiceRect).demarshall(queue);this.brush=(new wdi.SpiceBrush).demarshall(queue);this.rop_descriptor=this.bytesToInt8NoAllocate(queue);this.scale_mode=this.bytesToInt8NoAllocate(queue);this.mask=(new wdi.SpiceQMask).demarshall(queue);this.src_image=(new wdi.SpiceImage).demarshall(queue);if(this.brush.type==wdi.SpiceBrushType.SPICE_BRUSH_TYPE_PATTERN){this.brush.pattern.image=(new wdi.SpiceImageDescriptor).demarshall(queue);this.brush.pattern.imageData=queue.getData()}return this}});wdi.SpiceDrawBlackness=$.spcExtend(wdi.SpiceObject,{objectSize:4,init:function(c){c?this.setContent(c):false},setContent:function(c){this.offset=c.offset},marshall:function(){var rawData=[];rawData=rawData.concat(this.base.marshall(),this.mask.marshall());return rawData},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.base=(new wdi.SpiceDisplayBase).demarshall(queue);this.mask=(new wdi.SpiceQMask).demarshall(queue);return this}});wdi.SpiceDrawWhiteness=$.spcExtend(wdi.SpiceObject,{objectSize:4,init:function(c){c?this.setContent(c):false},setContent:function(c){this.offset=c.offset},marshall:function(){var rawData=[];rawData=rawData.concat(this.base.marshall(),this.mask.marshall());return rawData},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.base=(new wdi.SpiceDisplayBase).demarshall(queue);this.mask=(new wdi.SpiceQMask).demarshall(queue);return this}});wdi.SpiceScanCode=$.spcExtend(wdi.SpiceObject,{objectSize:1,init:function(c){c?this.setContent(c):false},setContent:function(scanCode){this.code=scanCode||0;this.zero=0},marshall:function(){this.rawData=[];this.rawData=this.rawData.concat(this.arrayToBytes(this.code,8),this.numberTo8(this.zero));return this.rawData},demarshall:function(queue,expSize){return this},getCode:function(){return this.code}});wdi.RedCursorInit=$.spcExtend(wdi.SpiceObject,{objectSize:9,marshall:function(){},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.position=(new wdi.SpicePoint16).demarshall(queue);this.trail_length=this.bytesToInt16NoAllocate(queue);this.trail_frequency=this.bytesToInt16NoAllocate(queue);this.visible=this.bytesToInt8NoAllocate(queue);this.cursor=(new wdi.RedCursor).demarshall(queue);return this}});wdi.RedCursor=$.spcExtend(wdi.SpiceObject,{objectSize:2,marshall:function(){this.rawData=[];this.rawData=this.rawData.concat(this.numberTo16(this.flags));if(!(this.flags&1)){this.rawData=this.rawData.concat(this.header.marshall(),this.data)}return this.rawData},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.flags=this.bytesToInt16NoAllocate(queue);this.header=null;this.data=null;if(!(this.flags&1)){this.header=(new wdi.RedCursorHeader).demarshall(queue);this.data=queue.getData()}return this}});wdi.RedCursorHeader=$.spcExtend(wdi.SpiceObject,{objectSize:17,marshall:function(){this.rawData=[];this.rawData=this.rawData.concat(this.numberTo64(this.unique),this.numberTo8(this.type),this.numberTo16(this.width),this.numberTo16(this.height),this.numberTo16(this.hot_spot_x),this.numberTo16(this.hot_spot_y));return this.rawData},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.unique=this.bytesToInt64NoAllocate(queue);this.type=this.bytesToInt8NoAllocate(queue);this.width=this.bytesToInt16NoAllocate(queue);this.height=this.bytesToInt16NoAllocate(queue);this.hot_spot_x=this.bytesToInt16NoAllocate(queue);this.hot_spot_y=this.bytesToInt16NoAllocate(queue);return this}});wdi.RedCursorSet=$.spcExtend(wdi.SpiceObject,{objectSize:5,marshall:function(){this.rawData=[];this.rawData=this.rawData.concat(this.position.marshall(),this.numberTo8(this.visible),this.cursor.marshall());return this.rawData},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.position=(new wdi.SpicePoint16).demarshall(queue);this.visible=this.bytesToInt8NoAllocate(queue);this.cursor=(new wdi.RedCursor).demarshall(queue);return this}});wdi.RasterGlyph=$.spcExtend(wdi.SpiceObject,{objectSize:20,marshall:function(){},demarshall:function(queue,flags,numGlyphs){var bpp=flags==1?1:flags*2;var result=[];for(var i=0;i<numGlyphs;i++){result[i]={};result[i].render_pos=(new wdi.SpicePoint).demarshall(queue);result[i].glyph_origin=(new wdi.SpicePoint).demarshall(queue);result[i].width=this.bytesToInt16NoAllocate(queue);result[i].height=this.bytesToInt16NoAllocate(queue);result[i].data=queue.shift(result[i].height*Math.ceil(result[i].width*bpp/8))}return result}});wdi.GlyphString=$.spcExtend(wdi.SpiceObject,{objectSize:3,marshall:function(){},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.len=this.bytesToInt16NoAllocate(queue);this.flags=this.bytesToInt8NoAllocate(queue);this.raster_glyph=(new wdi.RasterGlyph).demarshall(queue,this.flags,this.len);return this}});wdi.SpiceDrawText=$.spcExtend(wdi.SpiceObject,{objectSize:8,init:function(c){c?this.setContent(c):false},setContent:function(c){},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.base=(new wdi.SpiceDisplayBase).demarshall(queue);this.offset=this.bytesToInt32NoAllocate(queue);this.back_area=(new wdi.SpiceRect).demarshall(queue);this.fore_brush=(new wdi.SpiceBrush).demarshall(queue);this.back_brush=(new wdi.SpiceBrush).demarshall(queue);this.fore_mode=this.bytesToInt16NoAllocate(queue);this.back_mode=this.bytesToInt16NoAllocate(queue);this.glyph_string=(new wdi.GlyphString).demarshall(queue);return this}});wdi.SpiceLineAttr=$.spcExtend(wdi.SpiceObject,{objectSize:8,marshall:function(){},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.flags=this.bytesToInt8NoAllocate(queue);if(this.flags){this.style_nseg=this.bytesToInt8NoAllocate(queue);this.style=this.int32ToDouble(this.bytesToInt32(queue.shift(4)))}return this}});wdi.SpiceStroke=$.spcExtend(wdi.SpiceObject,{objectSize:8,init:function(c){c?this.setContent(c):false},setContent:function(c){},marshall:function(){},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.base=(new wdi.SpiceDisplayBase).demarshall(queue);this.offset=this.bytesToInt32NoAllocate(queue);this.attr=(new wdi.SpiceLineAttr).demarshall(queue);this.brush=(new wdi.SpiceBrush).demarshall(queue);this.fore_mode=this.bytesToInt16NoAllocate(queue);this.back_mode=this.bytesToInt16NoAllocate(queue);this.path=(new wdi.SpicePath).demarshall(queue);return this}});wdi.SpiceDrawInvers=$.spcExtend(wdi.SpiceObject,{objectSize:8,init:function(c){c?this.setContent(c):false},setContent:function(c){},marshall:function(){var rawData=[];rawData=rawData.concat(this.base.marshall(),this.mask.marshall());return rawData},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.base=(new wdi.SpiceDisplayBase).demarshall(queue);this.mask=(new wdi.SpiceQMask).demarshall(queue);return this}});wdi.SpiceStreamCreate=$.spcExtend(wdi.SpiceObject,{objectSize:8,init:function(c){c?this.setContent(c):false},setContent:function(c){},marshall:function(){var rawData=[];rawData.concat(this.numberTo32(this.surface_id),this.numberTo32(this.id),this.numberTo8(this.flags),this.numberTo8(this.codec),this.numberTo64(this.stamp),this.numberTo32(this.stream_width),this.numberTo32(this.stream_height),this.numberTo32(this.src_width),this.numberTo32(this.src_height),this.rect.marshall(),this.clip.marshall());return rawData},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.surface_id=this.bytesToInt32NoAllocate(queue);this.id=this.bytesToInt32NoAllocate(queue);this.flags=this.bytesToInt8NoAllocate(queue);this.codec=this.bytesToInt8NoAllocate(queue);this.stamp=this.bytesToInt64NoAllocate(queue);this.stream_width=this.bytesToInt32NoAllocate(queue);this.stream_height=this.bytesToInt32NoAllocate(queue);this.src_width=this.bytesToInt32NoAllocate(queue);this.src_height=this.bytesToInt32NoAllocate(queue);this.rect=(new wdi.SpiceRect).demarshall(queue);this.clip=(new wdi.SpiceClip).demarshall(queue);return this}});wdi.SpiceStreamDestroy=$.spcExtend(wdi.SpiceObject,{objectSize:4,init:function(c){c?this.setContent(c):false},setContent:function(c){},marshall:function(){var rawData=[];rawData=rawData.concat(this.numberTo32(this.surface_id),this.numberTo32(this.id));return rawData},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.surface_id=this.bytesToInt32NoAllocate(queue);this.id=this.bytesToInt32NoAllocate(queue);return this}});wdi.SpiceStreamData=$.spcExtend(wdi.SpiceObject,{objectSize:8,init:function(c){c?this.setContent(c):false},setContent:function(c){},marshall:function(){var rawData=[];rawData=rawData.concat(this.numberTo32(this.id),this.numberTo32(this.multi_media_type),this.numberTo32(this.data_size),this.data);return rawData},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.id=this.bytesToInt32NoAllocate(queue);this.multi_media_type=this.bytesToInt32NoAllocate(queue);this.data_size=this.bytesToInt32NoAllocate(queue);this.data=queue.getRawData();return this}});wdi.SpiceStreamClip=$.spcExtend(wdi.SpiceObject,{objectSize:4,init:function(c){c?this.setContent(c):false},setContent:function(c){},marshall:function(){var rawData=[];rawData=rawData.concat(this.numberTo32(this.id),this.clip.marshall());return rawData},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.id=this.bytesToInt32NoAllocate(queue);this.clip=(new wdi.SpiceClip).demarshall(queue);return this}});wdi.SpiceResourceList=$.spcExtend(wdi.SpiceObject,{objectSize:2,init:function(c){c?this.setContent(c):false},setContent:function(c){},marshall:function(){var rawData=[];for(var i=0;i<this.num_items;i++){rawData=rawData.concat(this.numberTo8(this.items[i].type),this.numberTo64(this.items[i].id))}return rawData},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.num_items=this.bytesToInt16NoAllocate(queue);this.items=[];for(var i=0;i<this.num_items;i++){this.items[i]={type:this.bytesToInt8(queue.shift(1)),id:this.bytesToInt64(queue.shift(8))}}return this}});wdi.SpiceMsgMainAgentTokens=$.spcExtend(wdi.SpiceObject,{objectSize:4,init:function(c){c?this.setContent(c):false},setContent:function(c){this.num_tokens=c.num_tokens},marshall:function(){this.rawData=[];this.rawData=this.rawData.concat(this.numberTo32(this.num_tokens));return this.rawData},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.num_tokens=this.bytesToInt32NoAllocate(queue);return this}});wdi.SpiceMsgMainAgentDisconnected=$.spcExtend(wdi.SpiceObject,{objectSize:4,init:function(c){c?this.setContent(c):false},setContent:function(c){this.error=c.error},marshall:function(){this.rawData=[];this.rawData=this.rawData.concat(this.numberTo32(this.error));return this.rawData},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.error=this.bytesToInt32NoAllocate(queue);return this}});wdi.SpiceMsgMainAgentData=$.spcExtend(wdi.SpiceObject,{objectSize:4,init:function(c){c?this.setContent(c):false},setContent:function(c){this.agentMessage=c.agentMessage},marshall:function(){this.rawData=[];this.rawData=this.rawData.concat(this.agentMessage.marshall());return this.rawData},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.agentMessage=(new wdi.VDAgentMessage).demarshall(queue);return this}});wdi.VDIChunkHeader=$.spcExtend(wdi.SpiceObject,{objectSize:8,init:function(c){c?this.setContent(c):false},setContent:function(c){this.port=c.port;this.size=c.size;this.packet=c.packet},marshall:function(){this.rawData=[];var data=this.packet.marshall();this.rawData=this.rawData.concat(this.numberTo32(this.port),this.numberTo32(data.length),data);return this.rawData},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});return this}});wdi.VDAgentMessage=$.spcExtend(wdi.SpiceObject,{objectSize:20,init:function(c){c?this.setContent(c):false},setContent:function(c){this.protocol=c.protocol;this.type=c.type;this.opaque=c.opaque;this.size=c.size;this.data=c.data},marshall:function(){this.rawData=[];var data=this.data.marshall();this.rawData=this.rawData.concat(this.numberTo32(this.protocol),this.numberTo32(this.type),this.numberTo64(this.opaque),this.numberTo32(data.length),data);return this.rawData},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.protocol=this.bytesToInt32NoAllocate(queue);this.type=this.bytesToInt32NoAllocate(queue);this.opaque=this.bytesToInt64NoAllocate(queue);this.size=this.bytesToInt32NoAllocate(queue);if(this.type==wdi.AgentMessageTypes.VD_AGENT_GET_WINDOWS_LIST){var str=this.bytesToString(queue.shift(queue.length));if(str=="change"){this.window_list=str}else{this.window_list=jQuery.parseJSON(str)}}else if(this.type==wdi.AgentMessageTypes.VD_AGENT_ANNOUNCE_CAPABILITIES){this.caps=(new wdi.VDAgentAnnounceCapabilities).demarshall(queue)}else if(this.type==wdi.AgentMessageTypes.VD_AGENT_CLIPBOARD_GRAB){if(queue.getLength()==0){this.clipboardType=wdi.ClipBoardTypes.VD_AGENT_CLIPBOARD_NONE}else{this.clipboardType=this.bytesToInt32NoAllocate(queue)}}else if(this.type==wdi.AgentMessageTypes.VD_AGENT_CLIPBOARD){this.clipboardType=this.bytesToInt32NoAllocate(queue);this.clipboardData=this.bytesToString(queue.shift(queue.length))}return this}});wdi.VDAgentHwndWindow=$.spcExtend(wdi.SpiceObject,{objectSize:4,init:function(c){c?this.setContent(c):false},setContent:function(c){this.hwnd=c.hwnd},marshall:function(){this.rawData=[];this.rawData=this.rawData.concat(this.numberTo32(this.hwnd));return this.rawData},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});return this}});wdi.VDAgentMoveWindow=$.spcExtend(wdi.SpiceObject,{objectSize:12,init:function(c){c?this.setContent(c):false},setContent:function(c){this.hwnd=c.hwnd;this.x=c.x;this.y=c.y},marshall:function(){this.rawData=[];this.rawData=this.rawData.concat(this.numberTo32(this.hwnd),this.numberTo32(this.x),this.numberTo32(this.y));return this.rawData},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});return this}});wdi.VDAgentResizeWindow=$.spcExtend(wdi.SpiceObject,{objectSize:12,init:function(c){c?this.setContent(c):false},setContent:function(c){this.hwnd=c.hwnd;this.width=c.width;this.height=c.height},marshall:function(){this.rawData=[];this.rawData=this.rawData.concat(this.numberTo32(this.hwnd),this.numberTo32(this.width),this.numberTo32(this.height));
return this.rawData},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});return this}});wdi.VDAgentMonitorsConfig=$.spcExtend(wdi.SpiceObject,{objectSize:8,init:function(c){c?this.setContent(c):false},setContent:function(c){this.num_of_monitors=c.num_of_monitors;this.flags=c.flags;this.data=c.data},marshall:function(){this.rawData=[];this.rawData=this.rawData.concat(this.numberTo32(this.num_of_monitors),this.numberTo32(this.flags),this.data.marshall());return this.rawData},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});return this}});wdi.VDAgentMonConfig=$.spcExtend(wdi.SpiceObject,{objectSize:20,init:function(c){c?this.setContent(c):false},setContent:function(c){this.height=c.height;this.width=c.width;this.depth=c.depth;this.x=c.x;this.y=c.y},marshall:function(){this.rawData=[];this.rawData=this.rawData.concat(this.numberTo32(this.height),this.numberTo32(this.width),this.numberTo32(this.depth),this.numberTo32(this.x),this.numberTo32(this.y));return this.rawData},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});return this}});wdi.VDAgentAnnounceCapabilities=$.spcExtend(wdi.SpiceObject,{objectSize:8,init:function(c){c?this.setContent(c):false},setContent:function(c){this.request=c.request;this.caps=c.caps},marshall:function(){this.rawData=[];this.rawData=this.rawData.concat(this.numberTo32(this.request),this.numberTo32(this.caps));return this.rawData},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.request=this.bytesToInt32NoAllocate(queue);this.caps=this.bytesToInt32NoAllocate(queue);return this}});wdi.VDAgentExecuteCommand=$.spcExtend(wdi.SpiceObject,{objectSize:4,init:function(c){c?this.setContent(c):false},setContent:function(c){this.size=c.size;this.data=c.data},marshall:function(){this.rawData=[];this.rawData=this.rawData.concat(this.numberTo32(this.size),this.stringToBytes(this.data));return this.rawData},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});return this}});wdi.VDAgentClipboardRequest=$.spcExtend(wdi.SpiceObject,{objectSize:4,init:function(c){c?this.setContent(c):false},setContent:function(c){this.type=c.type},marshall:function(){this.rawData=[];this.rawData=this.rawData.concat(this.numberTo32(this.type));return this.rawData},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.type=this.bytesToInt32NoAllocate(queue);return this}});wdi.VDAgentClipboardGrab=$.spcExtend(wdi.SpiceObject,{objectSize:4,init:function(c){c?this.setContent(c):false},setContent:function(c){this.types=c.types},marshall:function(){this.rawData=[];this.rawData=this.rawData.concat(this.numberTo32(this.types));return this.rawData},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.types=this.bytesToInt32NoAllocate(queue);return this}});wdi.VDAgentClipboard=$.spcExtend(wdi.SpiceObject,{objectSize:6,init:function(c){c?this.setContent(c):false},setContent:function(c){this.type=c.type;this.data=c.data},marshall:function(){this.rawData=[];this.rawData=this.rawData.concat(this.numberTo32(this.type),this.stringToBytes(this.data));return this.rawData},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.type=this.bytesToInt32NoAllocate(queue);this.data=queue.getData();return this}});wdi.PlaybackMode=$.spcExtend(wdi.SpiceObject,{objectSize:6,init:function(c){c?this.setContent(c):false},setContent:function(c){this.multimedia_time=c.multimedia_time;this.audio_data_mode=c.audio_data_mode;this.data=c.data},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.multimedia_time=this.bytesToInt32NoAllocate(queue);this.audio_data_mode=this.bytesToInt16NoAllocate(queue);this.data=queue.getData();return this}});wdi.PlaybackStart=$.spcExtend(wdi.SpiceObject,{objectSize:14,init:function(c){c?this.setContent(c):false},setContent:function(c){this.channels=c.channels;this.format=c.format;this.frequency=c.frequency;this.time=c.time},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.channels=this.bytesToInt32NoAllocate(queue);this.format=this.bytesToInt16NoAllocate(queue);this.frequency=this.bytesToInt32NoAllocate(queue);this.time=this.bytesToInt32NoAllocate(queue);return this}});wdi.PlaybackData=$.spcExtend(wdi.SpiceObject,{objectSize:4,init:function(c){c?this.setContent(c):false},setContent:function(c){this.multimedia_time=c.multimedia_time;this.data=c.data},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.multimedia_time=this.bytesToInt32NoAllocate(queue);this.data=queue.getData();return this}});wdi.MainMultiMediaTime=$.spcExtend(wdi.SpiceObject,{objectSize:4,init:function(c){c?this.setContent(c):false},setContent:function(c){this.multimedia_time=c.multimedia_time},marshall:function(){},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.multimedia_time=this.bytesToInt32NoAllocate(queue);return this}});wdi.PlaybackStop=$.spcExtend(wdi.SpiceObject,{objectSize:0,demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});return this}});wdi.MainMChannelsList=$.spcExtend(wdi.SpiceObject,{objectSize:4,init:function(c){c?this.setContent(c):false},setContent:function(c){this.num_of_channels=c.num_of_channels},marshall:function(){},demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});this.num_of_channels=this.bytesToInt32NoAllocate(queue);this.channels=[];var type=null;var id=null;for(var i=0;i<this.num_of_channels;i++){type=this.bytesToInt8NoAllocate(queue);id=this.bytesToInt8NoAllocate(queue);this.channels.push(type)}return this}});wdi.SpiceDisplayInvalidAllPalettes=$.spcExtend(wdi.SpiceObject,{objectSize:0,demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});return this}});wdi.SpiceDisplayMark=$.spcExtend(wdi.SpiceObject,{objectSize:0,demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});return this}});wdi.SpiceDisplayReset=$.spcExtend(wdi.SpiceObject,{objectSize:0,demarshall:function(queue,expSize){this.expectedSize=expSize||this.objectSize;if(queue.getLength()<this.expectedSize)throw new wdi.Exception({message:"Not enough queue to read",errorCode:3});return this}});wdi.SpicePubkeyType={SPICE_PUBKEY_TYPE_INVALID:0,SPICE_PUBKEY_TYPE_RSA:1,SPICE_PUBKEY_TYPE_RSA2:2,SPICE_PUBKEY_TYPE_DSA:3,SPICE_PUBKEY_TYPE_DSA1:4,SPICE_PUBKEY_TYPE_DSA2:5,SPICE_PUBKEY_TYPE_DSA3:6,SPICE_PUBKEY_TYPE_DSA4:7,SPICE_PUBKEY_TYPE_DH:8,SPICE_PUBKEY_TYPE_EC:9,SPICE_PUBKEY_TYPE_ENUM_END:10};wdi.SpiceWarnCode={SPICE_WARN_GENERAL:0,SPICE_WARN_CODE_ENUM_END:1};wdi.SpiceLineFlags={SPICE_LINE_FLAGS_START_WITH_GAP:4,SPICE_LINE_FLAGS_STYLED:8,SPICE_LINE_FLAGS_MASK:12};wdi.SpiceNotifyVisibility={SPICE_NOTIFY_VISIBILITY_LOW:0,SPICE_NOTIFY_VISIBILITY_MEDIUM:1,SPICE_NOTIFY_VISIBILITY_HIGH:2,SPICE_NOTIFY_VISIBILITY_ENUM_END:3};wdi.SpiceVars={SPICE_MSGC_ACK_SYNC:1,SPICE_MSGC_ACK:2,SPICE_MSGC_PONG:3,SPICE_MSGC_MIGRATE_FLUSH_MARK:4,SPICE_MSGC_MIGRATE_DATA:5,SPICE_MSGC_DISCONNECTING:6,SPICE_MSGC_DISPLAY_INIT:101,SPICE_MSGC_END_DISPLAY:102,SPICE_CHANNEL_MAIN:1,SPICE_CHANNEL_DISPLAY:2,SPICE_CHANNEL_INPUTS:3,SPICE_CHANNEL_CURSOR:4,SPICE_CHANNEL_PLAYBACK:5,SPICE_CHANNEL_RECORD:6,SPICE_CHANNEL_TUNNEL:7,SPICE_CHANNEL_SMARTCARD:8,SPICE_CHANNEL_USBREDIR:9,SPICE_END_CHANNEL:10,SPICE_MSG_MIGRATE:1,SPICE_MSG_MIGRATE_DATA:2,SPICE_MSG_SET_ACK:3,SPICE_MSG_PING:4,SPICE_MSG_WAIT_FOR_CHANNELS:5,SPICE_MSG_DISCONNECTING:6,SPICE_MSG_NOTIFY:7,SPICE_MSG_LIST:8,SPICE_MSGC_MAIN_CLIENT_INFO:101,SPICE_MSGC_MAIN_MIGRATE_CONNECTED:102,SPICE_MSGC_MAIN_MIGRATE_CONNECT_ERROR:103,SPICE_MSGC_MAIN_ATTACH_CHANNELS:104,SPICE_MSGC_MAIN_MOUSE_MODE_REQUEST:105,SPICE_MSGC_MAIN_AGENT_START:106,SPICE_MSGC_MAIN_AGENT_DATA:107,SPICE_MSGC_MAIN_AGENT_TOKEN:108,SPICE_MSGC_MAIN_MIGRATE_END:109,SPICE_MSGC_END_MAIN:110,SPICE_MSG_DISPLAY_MODE:101,SPICE_MSG_DISPLAY_MARK:102,SPICE_MSG_DISPLAY_RESET:103,SPICE_MSG_DISPLAY_COPY_BITS:104,SPICE_MSG_DISPLAY_INVAL_LIST:105,SPICE_MSG_DISPLAY_INVAL_ALL_PIXMAPS:106,SPICE_MSG_DISPLAY_INVAL_PALETTE:107,SPICE_MSG_DISPLAY_INVAL_ALL_PALETTES:108,SPICE_MSG_DISPLAY_STREAM_CREATE:122,SPICE_MSG_DISPLAY_STREAM_DATA:123,SPICE_MSG_DISPLAY_STREAM_CLIP:124,SPICE_MSG_DISPLAY_STREAM_DESTROY:125,SPICE_MSG_DISPLAY_STREAM_DESTROY_ALL:126,SPICE_MSG_DISPLAY_DRAW_FILL:302,SPICE_MSG_DISPLAY_DRAW_OPAQUE:303,SPICE_MSG_DISPLAY_DRAW_COPY:304,SPICE_MSG_DISPLAY_DRAW_BLEND:305,SPICE_MSG_DISPLAY_DRAW_BLACKNESS:306,SPICE_MSG_DISPLAY_DRAW_WHITENESS:307,SPICE_MSG_DISPLAY_DRAW_INVERS:308,SPICE_MSG_DISPLAY_DRAW_ROP3:309,SPICE_MSG_DISPLAY_DRAW_STROKE:310,SPICE_MSG_DISPLAY_DRAW_TEXT:311,SPICE_MSG_DISPLAY_DRAW_TRANSPARENT:312,SPICE_MSG_DISPLAY_DRAW_ALPHA_BLEND:313,SPICE_MSG_DISPLAY_SURFACE_CREATE:314,SPICE_MSG_DISPLAY_SURFACE_DESTROY:315,SPICE_MSG_END_DISPLAY:316,SPICE_MSG_INPUTS_INIT:101,SPICE_MSG_INPUTS_KEY_MODIFIERS:102,SPICE_MSG_INPUTS_MOUSE_MOTION_ACK:111,SPICE_MSG_END_INPUTS:112,SPICE_MSGC_INPUTS_KEY_DOWN:101,SPICE_MSGC_INPUTS_KEY_UP:102,SPICE_MSGC_INPUTS_KEY_MODIFIERS:103,SPICE_MSGC_INPUTS_MOUSE_MOTION:111,SPICE_MSGC_INPUTS_MOUSE_POSITION:112,SPICE_MSGC_INPUTS_MOUSE_PRESS:113,SPICE_MSGC_INPUTS_MOUSE_RELEASE:114,SPICE_MSGC_END_INPUTS:115,SPICE_MSG_CURSOR_INIT:101,SPICE_MSG_CURSOR_RESET:102,SPICE_MSG_CURSOR_SET:103,SPICE_MSG_CURSOR_MOVE:104,SPICE_MSG_CURSOR_HIDE:105,SPICE_MSG_CURSOR_TRAIL:106,SPICE_MSG_CURSOR_INVAL_ONE:107,SPICE_MSG_CURSOR_INVAL_ALL:108,SPICE_MSG_END_CURSOR:109,SPICE_MSG_RECORD_START:101,SPICE_MSG_RECORD_STOP:102,SPICE_MSG_RECORD_VOLUME:103,SPICE_MSG_RECORD_MUTE:104,SPICE_MSG_END_RECORD:105,SPICE_MSGC_SMARTCARD_DATA:101,SPICE_MSGC_END_SMARTCARD:102,SPICE_MSGC_SPICEVMC_DATA:101,SPICE_MSGC_END_SPICEVMC:102,SPICE_MSG_MAIN_MIGRATE_BEGIN:101,SPICE_MSG_MAIN_MIGRATE_CANCEL:102,SPICE_MSG_MAIN_INIT:103,SPICE_MSG_MAIN_CHANNELS_LIST:104,SPICE_MSG_MAIN_MOUSE_MODE:105,SPICE_MSG_MAIN_MULTI_MEDIA_TIME:106,SPICE_MSG_MAIN_AGENT_CONNECTED:107,SPICE_MSG_MAIN_AGENT_DISCONNECTED:108,SPICE_MSG_MAIN_AGENT_DATA:109,SPICE_MSG_MAIN_AGENT_TOKEN:110,SPICE_MSG_MAIN_MIGRATE_SWITCH_HOST:111,SPICE_MSG_MAIN_MIGRATE_END:112,SPICE_MSG_END_MAIN:113,SPICE_MSG_PLAYBACK_DATA:101,SPICE_MSG_PLAYBACK_MODE:102,SPICE_MSG_PLAYBACK_START:103,SPICE_MSG_PLAYBACK_STOP:104,SPICE_MSG_PLAYBACK_VOLUME:105,SPICE_MSG_PLAYBACK_MUTE:106,SPICE_MSG_END_PLAYBACK:107,SPICE_MSGC_RECORD_DATA:101,SPICE_MSGC_RECORD_MODE:102,SPICE_MSGC_RECORD_START_MARK:103,SPICE_MSGC_END_RECORD:104,SPICE_MSG_TUNNEL_INIT:101,SPICE_MSG_TUNNEL_SERVICE_IP_MAP:102,SPICE_MSG_TUNNEL_SOCKET_OPEN:103,SPICE_MSG_TUNNEL_SOCKET_FIN:104,SPICE_MSG_TUNNEL_SOCKET_CLOSE:105,SPICE_MSG_TUNNEL_SOCKET_DATA:106,SPICE_MSG_TUNNEL_SOCKET_CLOSED_ACK:107,SPICE_MSG_TUNNEL_SOCKET_TOKEN:108,SPICE_MSG_END_TUNNEL:109,SPICE_MSGC_TUNNEL_SERVICE_ADD:101,SPICE_MSGC_TUNNEL_SERVICE_REMOVE:102,SPICE_MSGC_TUNNEL_SOCKET_OPEN_ACK:103,SPICE_MSGC_TUNNEL_SOCKET_OPEN_NACK:104,SPICE_MSGC_TUNNEL_SOCKET_FIN:105,SPICE_MSGC_TUNNEL_SOCKET_CLOSED:106,SPICE_MSGC_TUNNEL_SOCKET_CLOSED_ACK:107,SPICE_MSGC_TUNNEL_SOCKET_DATA:108,SPICE_MSGC_TUNNEL_SOCKET_TOKEN:109,SPICE_MSGC_END_TUNNEL:110,SPICE_MSG_SMARTCARD_DATA:101,SPICE_MSG_END_SMARTCARD:102,SPICE_MSG_SPICEVMC_DATA:101,SPICE_MSG_END_SPICEVMC:102,SPICE_COMMON_CAP_PROTOCOL_AUTH_SELECTION:0,SPICE_COMMON_CAP_AUTH_SPICE:1,SPICE_COMMON_CAP_AUTH_SASL:2,SPICE_COMMON_CAP_MINI_HEADER:3,SPICE_PLAYBACK_CAP_CELT_0_5_1:0,SPICE_PLAYBACK_CAP_VOLUME:1,SPICE_RECORD_CAP_CELT_0_5_1:0,SPICE_RECORD_CAP_VOLUME:1,SPICE_MAIN_CAP_SEMI_SEAMLESS_MIGRATE:0};wdi.SpiceTunnelServiceType={SPICE_TUNNEL_SERVICE_TYPE_INVALID:0,SPICE_TUNNEL_SERVICE_TYPE_GENERIC:1,SPICE_TUNNEL_SERVICE_TYPE_IPP:2,SPICE_TUNNEL_SERVICE_TYPE_ENUM_END:3};wdi.SpiceJpegAlphaFlags={SPICE_JPEG_ALPHA_FLAGS_TOP_DOWN:1,SPICE_JPEG_ALPHA_FLAGS_MASK:1};wdi.SpiceMaskFlags={SPICE_MASK_FLAGS_INVERS:1,SPICE_MASK_FLAGS_MASK:1};wdi.SpiceCursorType={SPICE_CURSOR_TYPE_ALPHA:0,SPICE_CURSOR_TYPE_MONO:1,SPICE_CURSOR_TYPE_COLOR4:2,SPICE_CURSOR_TYPE_COLOR8:3,SPICE_CURSOR_TYPE_COLOR16:4,SPICE_CURSOR_TYPE_COLOR24:5,SPICE_CURSOR_TYPE_COLOR32:6,SPICE_CURSOR_TYPE_ENUM_END:7,SPICE_CURSOR_TYPE_URL:8};wdi.SpiceImageFlags={SPICE_IMAGE_FLAGS_CACHE_ME:1,SPICE_IMAGE_FLAGS_HIGH_BITS_SET:2,SPICE_IMAGE_FLAGS_CACHE_REPLACE_ME:4,SPICE_IMAGE_FLAGS_MASK:7};wdi.SpiceAudioDataMode={SPICE_AUDIO_DATA_MODE_INVALID:0,SPICE_AUDIO_DATA_MODE_RAW:1,SPICE_AUDIO_DATA_MODE_CELT_0_5_1:2,SPICE_AUDIO_DATA_MODE_ENUM_END:3};wdi.SpiceAudioFmt={SPICE_AUDIO_FMT_INVALID:0,SPICE_AUDIO_FMT_S16:1,SPICE_AUDIO_FMT_ENUM_END:2};wdi.SpiceBitmapFmt={SPICE_BITMAP_FMT_INVALID:0,SPICE_BITMAP_FMT_1BIT_LE:1,SPICE_BITMAP_FMT_1BIT_BE:2,SPICE_BITMAP_FMT_4BIT_LE:3,SPICE_BITMAP_FMT_4BIT_BE:4,SPICE_BITMAP_FMT_8BIT:5,SPICE_BITMAP_FMT_16BIT:6,SPICE_BITMAP_FMT_24BIT:7,SPICE_BITMAP_FMT_32BIT:8,SPICE_BITMAP_FMT_RGBA:9,SPICE_BITMAP_FMT_ENUM_END:10};wdi.SpiceStreamFlags={SPICE_STREAM_FLAGS_TOP_DOWN:1,SPICE_STREAM_FLAGS_MASK:1};wdi.SpiceTunnelIpType={SPICE_TUNNEL_IP_TYPE_INVALID:0,SPICE_TUNNEL_IP_TYPE_IPv4:1,SPICE_TUNNEL_IP_TYPE_ENUM_END:2};wdi.SpiceBitmapFlags={SPICE_BITMAP_FLAGS_PAL_CACHE_ME:1,SPICE_BITMAP_FLAGS_PAL_FROM_CACHE:2,SPICE_BITMAP_FLAGS_TOP_DOWN:4,SPICE_BITMAP_FLAGS_MASK:7};wdi.SpiceStringFlags={SPICE_STRING_FLAGS_RASTER_A1:1,SPICE_STRING_FLAGS_RASTER_A4:2,SPICE_STRING_FLAGS_RASTER_A8:4,SPICE_STRING_FLAGS_RASTER_TOP_DOWN:8,SPICE_STRING_FLAGS_MASK:15};wdi.SpiceSurfaceFmt={SPICE_SURFACE_FMT_INVALID:0,SPICE_SURFACE_FMT_1_A:1,SPICE_SURFACE_FMT_8_A:8,SPICE_SURFACE_FMT_16_555:16,SPICE_SURFACE_FMT_32_xRGB:32,SPICE_SURFACE_FMT_16_565:80,SPICE_SURFACE_FMT_32_ARGB:96,SPICE_SURFACE_FMT_ENUM_END:97};wdi.SpiceCursorFlags={SPICE_CURSOR_FLAGS_NONE:1,SPICE_CURSOR_FLAGS_CACHE_ME:2,SPICE_CURSOR_FLAGS_FROM_CACHE:4,SPICE_CURSOR_FLAGS_MASK:7};wdi.SpiceLinkErr={SPICE_LINK_ERR_OK:0,SPICE_LINK_ERR_ERROR:1,SPICE_LINK_ERR_INVALID_MAGIC:2,SPICE_LINK_ERR_INVALID_DATA:3,SPICE_LINK_ERR_VERSION_MISMATCH:4,SPICE_LINK_ERR_NEED_SECURED:5,SPICE_LINK_ERR_NEED_UNSECURED:6,SPICE_LINK_ERR_PERMISSION_DENIED:7,SPICE_LINK_ERR_BAD_CONNECTION_ID:8,SPICE_LINK_ERR_CHANNEL_NOT_AVAILABLE:9,SPICE_LINK_ERR_ENUM_END:10};wdi.SpiceNotifySeverity={SPICE_NOTIFY_SEVERITY_INFO:0,SPICE_NOTIFY_SEVERITY_WARN:1,SPICE_NOTIFY_SEVERITY_ERROR:2,SPICE_NOTIFY_SEVERITY_ENUM_END:3};wdi.SpiceBrushType={SPICE_BRUSH_TYPE_NONE:0,SPICE_BRUSH_TYPE_SOLID:1,SPICE_BRUSH_TYPE_PATTERN:2,SPICE_BRUSH_TYPE_ENUM_END:3};wdi.SpiceAlphaFlags={SPICE_ALPHA_FLAGS_DEST_HAS_ALPHA:1,SPICE_ALPHA_FLAGS_SRC_SURFACE_HAS_ALPHA:2,SPICE_ALPHA_FLAGS_MASK:3};wdi.SpiceSurfaceFlags={SPICE_SURFACE_FLAGS_PRIMARY:1,SPICE_SURFACE_FLAGS_MASK:1};wdi.QuicImageType={QUIC_IMAGE_TYPE_INVALID:0,QUIC_IMAGE_TYPE_GRAY:1,QUIC_IMAGE_TYPE_RGB16:2,QUIC_IMAGE_TYPE_RGB24:3,QUIC_IMAGE_TYPE_RGB32:4,QUIC_IMAGE_TYPE_RGBA:5};wdi.SpiceImageType={SPICE_IMAGE_TYPE_BITMAP:0,SPICE_IMAGE_TYPE_QUIC:1,SPICE_IMAGE_TYPE_RESERVED:2,SPICE_IMAGE_TYPE_LZ_PLT:100,SPICE_IMAGE_TYPE_LZ_RGB:101,SPICE_IMAGE_TYPE_GLZ_RGB:102,SPICE_IMAGE_TYPE_FROM_CACHE:103,SPICE_IMAGE_TYPE_SURFACE:104,SPICE_IMAGE_TYPE_JPEG:105,SPICE_IMAGE_TYPE_FROM_CACHE_LOSSLESS:106,SPICE_IMAGE_TYPE_ZLIB_GLZ_RGB:107,SPICE_IMAGE_TYPE_JPEG_ALPHA:108,SPICE_IMAGE_TYPE_CANVAS:109,SPICE_IMAGE_TYPE_PNG:110,SPICE_IMAGE_TYPE_ENUM_END:111};wdi.SpiceImageScaleMode={SPICE_IMAGE_SCALE_MODE_INTERPOLATE:0,SPICE_IMAGE_SCALE_MODE_NEAREST:1,SPICE_IMAGE_SCALE_MODE_ENUM_END:2};wdi.SpiceResourceType={SPICE_RES_TYPE_INVALID:0,SPICE_RES_TYPE_PIXMAP:1,SPICE_RESOURCE_TYPE_ENUM_END:2};wdi.SpicePathFlags={SPICE_PATH_BEGIN:1,SPICE_PATH_END:2,SPICE_PATH_CLOSE:8,SPICE_PATH_BEZIER:16,SPICE_PATH_FLAGS_MASK:27};wdi.SpiceVideoCodecType={SPICE_VIDEO_CODEC_TYPE_MJPEG:1,SPICE_VIDEO_CODEC_TYPE_ENUM_END:2};wdi.SpiceRopd={SPICE_ROPD_INVERS_SRC:1,SPICE_ROPD_INVERS_BRUSH:2,SPICE_ROPD_INVERS_DEST:4,SPICE_ROPD_OP_PUT:8,SPICE_ROPD_OP_OR:16,SPICE_ROPD_OP_AND:32,SPICE_ROPD_OP_XOR:64,SPICE_ROPD_OP_BLACKNESS:128,SPICE_ROPD_OP_WHITENESS:256,SPICE_ROPD_OP_INVERS:512,SPICE_ROPD_INVERS_RES:1024,SPICE_ROPD_MASK:2047};wdi.SpiceMigrateFlags={SPICE_MIGRATE_NEED_FLUSH:1,SPICE_MIGRATE_NEED_DATA_TRANSFER:2,SPICE_MIGRATE_FLAGS_MASK:3};wdi.SpiceKeyboardModifierFlags={SPICE_KEYBOARD_MODIFIER_FLAGS_SCROLL_LOCK:1,SPICE_KEYBOARD_MODIFIER_FLAGS_NUM_LOCK:2,SPICE_KEYBOARD_MODIFIER_FLAGS_CAPS_LOCK:4,SPICE_KEYBOARD_MODIFIER_FLAGS_MASK:7};wdi.SpiceInfoCode={SPICE_INFO_GENERAL:0,SPICE_INFO_CODE_ENUM_END:1};wdi.SpiceMouseButton={SPICE_MOUSE_BUTTON_INVALID:0,SPICE_MOUSE_BUTTON_LEFT:1,SPICE_MOUSE_BUTTON_MIDDLE:2,SPICE_MOUSE_BUTTON_RIGHT:3,SPICE_MOUSE_BUTTON_UP:4,SPICE_MOUSE_BUTTON_DOWN:5,SPICE_MOUSE_BUTTON_ENUM_END:6};wdi.SpiceClipType={SPICE_CLIP_TYPE_NONE:0,SPICE_CLIP_TYPE_RECTS:1,SPICE_CLIP_TYPE_ENUM_END:2};wdi.SpiceMouseButtonMask={SPICE_MOUSE_BUTTON_MASK_LEFT:1,SPICE_MOUSE_BUTTON_MASK_MIDDLE:2,SPICE_MOUSE_BUTTON_MASK_RIGHT:4,SPICE_MOUSE_BUTTON_MASK_MASK:7};wdi.SpiceMouseModeTypes={SPICE_MOUSE_MODE_SERVER:1,SPICE_MOUSE_MODE_CLIENT:2,SPICE_MOUSE_MODE_MASK:3};wdi.AgentCaps={VD_AGENT_CAP_MOUSE_STATE:0,VD_AGENT_CAP_MONITORS_CONFIG:1,VD_AGENT_CAP_REPLY:2,VD_AGENT_CAP_CLIPBOARD:3,VD_AGENT_CAP_DISPLAY_CONFIG:4,VD_AGENT_CAP_CLIPBOARD_BY_DEMAND:5,VD_AGENT_CAP_CLIPBOARD_SELECTION:6};wdi.AgentMessageTypes={VD_AGENT_MOUSE_STATE:1,VD_AGENT_MONITORS_CONFIG:2,VD_AGENT_REPLY:3,VD_AGENT_CLIPBOARD:4,VD_AGENT_DISPLAY_CONFIG:5,VD_AGENT_ANNOUNCE_CAPABILITIES:6,VD_AGENT_CLIPBOARD_GRAB:7,VD_AGENT_CLIPBOARD_REQUEST:8,VD_AGENT_CLIPBOARD_RELEASE:9,VD_AGENT_GET_WINDOWS_LIST:10,VD_AGENT_CLOSE_WINDOW:11,VD_AGENT_MOVE_WINDOW:12,VD_AGENT_RESIZE_WINDOW:13,VD_AGENT_MINIMIZE_WINDOW:14,VD_AGENT_RESTORE_WINDOW:15,VD_AGENT_MAXIMIZE_WINDOW:16,VD_AGENT_FOCUS_WINDOW:17,VD_AGENT_EXECUTE_COMMAND:18};wdi.ClipBoardTypes={VD_AGENT_CLIPBOARD_NONE:0,VD_AGENT_CLIPBOARD_UTF8_TEXT:1,VD_AGENT_CLIPBOARD_IMAGE_PNG:2,VD_AGENT_CLIPBOARD_IMAGE_BMP:3,VD_AGENT_CLIPBOARD_IMAGE_TIFF:4,VD_AGENT_CLIPBOARD_IMAGE_JPG:5};wdi.GraphicDebug=$.spcExtend(wdi.DomainObject,{debugMode:null,spiceGraphicMessageTypes:[],cloneSpiceMessage:null,clientGui:null,tmpCanvas:null,tmpContext:null,originalCanvas:null,spiceMessageData:null,endCanvas:null,currentOperation:null,init:function(c){this.debugMode=c.debugMode;if(this.debugMode){this._generateArray();this._showDebug()}else{this._hideDebug()}},_generateArray:function(){var self=this;$.each(wdi.SpiceVars,function(key,value){if(key.search("SPICE_MSG_DISPLAY_")!=-1){self.spiceGraphicMessageTypes[value]=key}})},_showDebug:function(){$("#canvasSpace").show();$("#graphicDebug").show()},_hideDebug:function(){$("#canvasSpace").hide();$("#graphicDebug").hide()},printDebugMessageOnFilter:function(spiceMessage,clientGui){if(spiceMessage.channel===wdi.SpiceVars.SPICE_CHANNEL_DISPLAY&&this.debugMode&&$("#logActive").prop("checked")){var surface_id=null;this.clientGui=clientGui;this.cloneSpiceMessage=$.extend(true,{},spiceMessage);if(this.cloneSpiceMessage.args.base&&this.cloneSpiceMessage.args.base.surface_id!==null){surface_id=this.cloneSpiceMessage.args.base.surface_id;var box=wdi.graphics.getBoxFromSrcArea(this.cloneSpiceMessage.args.base.box);var spiceMessageDiv=$("<div/>").append(prettyPrint(this.cloneSpiceMessage)).hide();this.originalCanvas=this._copyCanvasFromSurfaceId(surface_id);this.spiceMessageData=spiceMessage.args.originalData;this.currentOperation=this.spiceGraphicMessageTypes[this.cloneSpiceMessage.messageType];$("#debugInfo").append($("<br/>")).append($("<hr/>")).append(this._copyAndHighlightCanvas(surface_id,box)).append($("<br/>")).append($("<div/>").append(this.currentOperation+" (Click to hide/show)").css("cursor","pointer").css("color","blue").css("text-decoration","underline").click(function(){spiceMessageDiv.toggle()})).append(spiceMessageDiv);if(this.cloneSpiceMessage.args.hasOwnProperty("image")){this._printImage(spiceMessageDiv)}}}},_printImage:function(spiceMessageDiv){wdi.graphics.getImageFromSpice(this.cloneSpiceMessage.args.image.imageDescriptor,this.cloneSpiceMessage.args.image.data,this.clientGui,function(srcImg){if(srcImg){spiceMessageDiv.append($("<div/>").css("font-size","12px").append("Image inside spiceMessage:").append($("<br/>")).css("border","1px solid black").append(srcImg))}},this)},printDebugMessageOnNotifyEnd:function(spiceMessage,clientGui){this.clientGui=clientGui;if(spiceMessage.channel===wdi.SpiceVars.SPICE_CHANNEL_DISPLAY&&this.debugMode&&$("#logActive").prop("checked")){var surface_id=null;if(spiceMessage.args.base&&spiceMessage.args.base.surface_id!==null){var self=this;var createTestClickCallback=function(currentSpiceMessage,originalCanvas,endCanvas,currentOperation){return function(){self.createImageTest(currentSpiceMessage,originalCanvas,endCanvas,currentOperation)}};var createReplayClickCallback=function(currentSpiceMessage,originalCanvas,endCanvas,currentOperation){return function(){self.createReplay(currentSpiceMessage,originalCanvas,endCanvas,currentOperation)}};surface_id=spiceMessage.args.base.surface_id;var box=wdi.graphics.getBoxFromSrcArea(spiceMessage.args.base.box);var currentCanvas=this._copyCanvasFromSurfaceId(surface_id);$("#debugInfo").append($("<br/>")).append($("<div/>").append($("<button>Create test</button>").css("cursor","pointer").click(createTestClickCallback(this.spiceMessageData,this.originalCanvas,currentCanvas,this.currentOperation))).append($("<button>Create replay window</button>").css("cursor","pointer").click(createReplayClickCallback(this.spiceMessageData,this.originalCanvas,currentCanvas,this.currentOperation)))).append($("<br/>")).append(this._copyAndHighlightCanvas(surface_id,box))}}},createImageTest:function(spiceMessage,originalCanvas,endCanvas,currentOperation){var name=prompt("Name of the test",currentOperation);var data1=originalCanvas.toDataURL("image/png");var data2=endCanvas.toDataURL("image/png");var dataObj={origin:data1,expected:data2,object:spiceMessage,name:name};var data=JSON.stringify(dataObj);var fileName=name.replace(/\s/g,"_");$.post("graphictestgenerator.php","data="+data+"&name="+fileName).done(function(data,status,xhr){alert("Test created")}).fail(function(jqXHR,textStatus,errorThrown){alert("Test creation failed.\n\nGot response: "+jqXHR.status+" "+jqXHR.statusText+"\n\n"+jqXHR.responseText)})},createReplay:function(spiceMessage,originalCanvas){var data1=originalCanvas.toDataURL("image/png");var dataObj={origin:data1,object:spiceMessage,width:originalCanvas.width,height:originalCanvas.height};var data=JSON.stringify(dataObj);$.post("graphictestgenerator.php","data="+data+"&replay=true").done(function(data,status,xhr){window.open("replay.html","replay")}).fail(function(jqXHR,textStatus,errorThrown){alert("Replay failed.\n\nGot response: "+jqXHR.status+" "+jqXHR.statusText+"\n\n"+jqXHR.responseText)})},_copyCanvasFromSurfaceId:function(surface_id){var context=this.clientGui.getContext(surface_id);this.tmpCanvas=context.canvas;var myCanvas=document.createElement("canvas");myCanvas.width=this.tmpCanvas.width;myCanvas.height=this.tmpCanvas.height;myCanvas.getContext("2d").drawImage(this.tmpCanvas,0,0);return myCanvas},_copyAndHighlightCanvas:function(surface_id,box){var myCanvas=this._copyCanvasFromSurfaceId(surface_id);context=myCanvas.getContext("2d");context.fillStyle="rgba(255,0,0,0.3)";context.fillRect(box.x,box.y,box.width,box.height);return myCanvas}});wdi.LZSS={LZ_IMAGE_TYPE_INVALID:0,LZ_IMAGE_TYPE_PLT1_LE:1,LZ_IMAGE_TYPE_PLT1_BE:2,LZ_IMAGE_TYPE_PLT4_LE:3,LZ_IMAGE_TYPE_PLT4_BE:4,LZ_IMAGE_TYPE_PLT8:5,LZ_IMAGE_TYPE_RGB16:6,LZ_IMAGE_TYPE_RGB24:7,LZ_IMAGE_TYPE_RGB32:8,LZ_IMAGE_TYPE_RGBA:9,LZ_IMAGE_TYPE_XXXA:10,LZPALETTE_FLAG_PAL_CACHE_ME:1,LZPALETTE_FLAG_PAL_FROM_CACHE:2,LZPALETTE_FLAG_TOP_DOWN:4,PLT_PIXELS_PER_BYTE:[0,8,8,2,2,1],PLT1_MASK:[1,2,4,8,16,32,64,128],copy_pixel:function(op,color,out_buf){out_buf[op+0]=color.r;out_buf[op+1]=color.g;out_buf[op+2]=color.b},lz_rgb32_decompress_rgb:function(arr){var encoder=0;var op=0;var ctrl;var in_buf=new Uint8Array(arr);var format=in_buf[encoder++];var opaque=in_buf[encoder++];var type=in_buf[encoder++];encoder++;var low=in_buf[encoder+1]*Math.pow(16,2)+in_buf[encoder];encoder+=2;var high=in_buf[encoder+1]*Math.pow(16,2)+in_buf[encoder];encoder+=2;var len=high*Math.pow(16,4)+low;var buf=new ArrayBuffer(len);var buf8=new Uint8Array(buf);var data=new Uint32Array(buf);var out_buf_len=len/4;var code,ref,len,ofs,ref_4,b_4,b;for(ctrl=in_buf[encoder++];op<out_buf_len;ctrl=in_buf[encoder++]){ref=op;len=ctrl>>5;ofs=(ctrl&31)<<8;if(ctrl>31){len--;if(len===6){do{code=in_buf[encoder++];len+=code}while(code===255)}code=in_buf[encoder++];ofs+=code;if(code===255){if(ofs-code===31<<8){ofs=in_buf[encoder++]<<8;ofs+=in_buf[encoder++];ofs+=8191}}len+=1;ofs+=1;ref-=ofs;if(ref===op-1){b=ref;b_4=b*4;for(;len;--len){data[op]=255<<24|buf8[b_4+2]<<16|buf8[b_4+1]<<8|buf8[b_4];op++}}else{for(;len;--len){ref_4=ref*4;data[op]=255<<24|buf8[ref_4+2]<<16|buf8[ref_4+1]<<8|buf8[ref_4];op++;ref++}}}else{ctrl++;data[op]=255<<24|in_buf[encoder]<<16|in_buf[encoder+1]<<8|in_buf[encoder+2];encoder+=3;op++;for(--ctrl;ctrl;ctrl--){data[op]=255<<24|in_buf[encoder]<<16|in_buf[encoder+1]<<8|in_buf[encoder+2];encoder+=3;op++}}}if(type===this.LZ_IMAGE_TYPE_RGBA&&!opaque){op=0;ctrl=null;encoder--;for(ctrl=in_buf[encoder++];op<out_buf_len;ctrl=in_buf[encoder++]){var ref=op;var len=ctrl>>5;var ofs=(ctrl&31)<<8;var op_4=op*4;if(ctrl>=32){var code;len--;if(len===7-1){do{code=in_buf[encoder++];len+=code}while(code===255)}code=in_buf[encoder++];ofs+=code;if(code===255){if(ofs-code===31<<8){ofs=in_buf[encoder++]<<8;ofs+=in_buf[encoder++];ofs+=8191}}len+=3;ofs+=1;ref-=ofs;if(ref===op-1){var b=ref;for(;len;--len){op_4=op*4;buf8[op_4+3]=buf8[b*4+3];op++}}else{for(;len;--len){op_4=op*4;buf8[op_4+3]=buf8[ref*4+3];op++;ref++}}}else{ctrl++;buf8[op_4+3]=in_buf[encoder++];op++;for(--ctrl;ctrl;ctrl--){op_4=op*4;buf8[op_4+3]=in_buf[encoder++];op++}}}}return buf},lz_rgb32_decompress:function(in_buf,at,out_buf,type,default_alpha,palette,opaque){var encoder=at;var op=0;var ctrl;var out_buf_len=out_buf.length/4;var is_rgba=type===this.LZ_IMAGE_TYPE_RGBA?true:false;for(ctrl=in_buf[encoder++];op<out_buf_len;ctrl=in_buf[encoder++]){var ref=op;var len=ctrl>>5;var ofs=(ctrl&31)<<8;var op_4=op*4;if(ctrl>=32){var code;len--;if(len===7-1){do{code=in_buf[encoder++];len+=code}while(code===255)}code=in_buf[encoder++];ofs+=code;if(code===255){if(ofs-code===31<<8){ofs=in_buf[encoder++]<<8;ofs+=in_buf[encoder++];ofs+=8191}}len+=1;if(is_rgba||palette)len+=2;ofs+=1;if(type===this.LZ_IMAGE_TYPE_PLT4_LE||type===this.LZ_IMAGE_TYPE_PLT4_BE){ofs=ofs*2;len=len*2}else if(type===this.LZ_IMAGE_TYPE_PLT1_BE||type===this.LZ_IMAGE_TYPE_PLT1_LE){ofs=ofs*8;len=len*8}ref-=ofs;if(ref===op-1){var b=ref;for(;len;--len){op_4=op*4;if(is_rgba){if(opaque){out_buf[op_4+3]=255}else{out_buf[op_4+3]=out_buf[b*4+3]}}else{for(var i=0;i<4;i++)out_buf[op_4+i]=out_buf[b*4+i]}op++}}else{for(;len;--len){op_4=op*4;if(is_rgba){if(opaque){out_buf[op_4+3]=255}else{out_buf[op_4+3]=out_buf[ref*4+3]}}else{for(i=0;i<4;i++)out_buf[op_4+i]=out_buf[ref*4+i]}op++;ref++}}}else{ctrl++;if(is_rgba){if(opaque){out_buf[op_4+3]=255;encoder++}else{out_buf[op_4+3]=in_buf[encoder++]}}else if(palette){if(type===this.LZ_IMAGE_TYPE_PLT1_LE){var oct=in_buf[encoder++];var foreColor=palette[1];var backColor=palette[0];for(var i=0;i<8;i++){if(oct&this.PLT1_MASK[i]){this.copy_pixel(op_4,foreColor,out_buf)}else{this.copy_pixel(op_4,backColor,out_buf)}if(default_alpha)out_buf[op_4+3]=255;if(i<7)op++;op_4=op*4}}else if(type===this.LZ_IMAGE_TYPE_PLT1_BE){var oct=in_buf[encoder++];var foreColor=palette[1];var backColor=palette[0];for(var i=7;i>=0;i--){if(oct&this.PLT1_MASK[i]){this.copy_pixel(op_4,foreColor,out_buf)}else{this.copy_pixel(op_4,backColor,out_buf)}if(default_alpha)out_buf[op_4+3]=255;if(i>0)op++;op_4=op*4}}else if(type===this.LZ_IMAGE_TYPE_PLT4_LE){var oct=in_buf[encoder++];var spiceColor=palette[oct&15];this.copy_pixel(op_4,spiceColor,out_buf);if(default_alpha)out_buf[op_4+3]=255;op++;op_4=op*4;var spiceColor=palette[oct>>>4&15];this.copy_pixel(op_4,spiceColor,out_buf);if(default_alpha)out_buf[op_4+3]=255}else if(type===this.LZ_IMAGE_TYPE_PLT4_BE){var oct=in_buf[encoder++];var bits1=oct>>>4&15;var bits2=oct&15;var spiceColor=palette[bits1];this.copy_pixel(op_4,spiceColor,out_buf);if(default_alpha)out_buf[op_4+3]=255;op++;op_4=op*4;var spiceColor=palette[bits2];this.copy_pixel(op_4,spiceColor,out_buf);if(default_alpha)out_buf[op_4+3]=255}else if(type===this.LZ_IMAGE_TYPE_PLT8){var posPal=in_buf[encoder++];var spiceColor=palette[posPal];this.copy_pixel(op_4,spiceColor,out_buf);if(default_alpha)out_buf[op_4+3]=255}}else{out_buf[op_4+0]=in_buf[encoder+2];out_buf[op_4+1]=in_buf[encoder+1];out_buf[op_4+2]=in_buf[encoder+0];if(default_alpha)out_buf[op_4+3]=255;encoder+=3}op++;for(--ctrl;ctrl;ctrl--){op_4=op*4;if(is_rgba){if(opaque){out_buf[op_4+3]=255}else{out_buf[op_4+3]=in_buf[encoder++]}}else if(palette){if(type===this.LZ_IMAGE_TYPE_PLT1_LE){var oct=in_buf[encoder++];var foreColor=palette[1];var backColor=palette[0];for(var i=0;i<8;i++){if(oct&this.PLT1_MASK[i]){this.copy_pixel(op_4,foreColor,out_buf)}else{this.copy_pixel(op_4,backColor,out_buf)}if(default_alpha)out_buf[op_4+3]=255;if(i<7)op++;op_4=op*4}}else if(type===this.LZ_IMAGE_TYPE_PLT1_BE){var oct=in_buf[encoder++];var foreColor=palette[1];var backColor=palette[0];for(var i=7;i>=0;i--){if(oct&this.PLT1_MASK[i]){this.copy_pixel(op_4,foreColor,out_buf)}else{this.copy_pixel(op_4,backColor,out_buf)}if(default_alpha)out_buf[op_4+3]=255;if(i>0)op++;op_4=op*4}}else if(type===this.LZ_IMAGE_TYPE_PLT4_LE){var oct=in_buf[encoder++];var spiceColor=palette[oct&15];this.copy_pixel(op_4,spiceColor,out_buf);if(default_alpha)out_buf[op_4+3]=255;op++;op_4=op*4;var spiceColor=palette[oct>>>4&15];this.copy_pixel(op_4,spiceColor,out_buf);if(default_alpha)out_buf[op_4+3]=255}else if(type===this.LZ_IMAGE_TYPE_PLT4_BE){var oct=in_buf[encoder++];var spiceColor=palette[oct>>>4&15];this.copy_pixel(op_4,spiceColor,out_buf);if(default_alpha)out_buf[op_4+3]=255;op++;op_4=op*4;var spiceColor=palette[oct&15];this.copy_pixel(op_4,spiceColor,out_buf);if(default_alpha)out_buf[op_4+3]=255}else if(type===this.LZ_IMAGE_TYPE_PLT8){var posPal=in_buf[encoder++];var spiceColor=palette[posPal];this.copy_pixel(op_4,spiceColor,out_buf);if(default_alpha)out_buf[op_4+3]=255}}else{out_buf[op_4+0]=in_buf[encoder+2];out_buf[op_4+1]=in_buf[encoder+1];out_buf[op_4+2]=in_buf[encoder+0];
if(default_alpha)out_buf[op_4+3]=255;encoder+=3}op++}}}return encoder-1},convert_spice_lz_to_web:function(context,data,imageDescriptor,opaque){var format=imageDescriptor.type;data=data.toJSArray();if(format===wdi.SpiceImageType.SPICE_IMAGE_TYPE_LZ_PLT){var flags=wdi.SpiceObject.bytesToInt8(data.splice(0,1));if(flags===this.LZPALETTE_FLAG_PAL_FROM_CACHE){var header=data.splice(0,12);var length=wdi.SpiceObject.bytesToInt32(header.splice(0,4));var palette_id=wdi.SpiceObject.bytesToInt64(header.splice(0,8));header=data;var magic=wdi.SpiceObject.bytesToStringBE(header.splice(0,4));var version=wdi.SpiceObject.bytesToInt32BE(header.splice(0,4));var type=wdi.SpiceObject.bytesToInt32BE(header.splice(0,4));var width=wdi.SpiceObject.bytesToInt32BE(header.splice(0,4));var height=wdi.SpiceObject.bytesToInt32BE(header.splice(0,4));var stride=wdi.SpiceObject.bytesToInt32BE(header.splice(0,4));var top_down=wdi.SpiceObject.bytesToInt32BE(header.splice(0,4))}else if(flags===this.LZPALETTE_FLAG_PAL_CACHE_ME){var imageHeaders=imageDescriptor.offset+1;var currentHeaders=36;var header=data.splice(0,currentHeaders);var length=wdi.SpiceObject.bytesToInt32(header.splice(0,4));var palette_offset=wdi.SpiceObject.bytesToInt32(header.splice(0,4));var spliceInit=palette_offset-imageHeaders-currentHeaders;var magic=wdi.SpiceObject.bytesToStringBE(header.splice(0,4));var version=wdi.SpiceObject.bytesToInt32BE(header.splice(0,4));var type=wdi.SpiceObject.bytesToInt32BE(header.splice(0,4));var width=wdi.SpiceObject.bytesToInt32BE(header.splice(0,4));var height=wdi.SpiceObject.bytesToInt32BE(header.splice(0,4));var stride=wdi.SpiceObject.bytesToInt32BE(header.splice(0,4));var top_down=wdi.SpiceObject.bytesToInt32BE(header.splice(0,4));var palette_id=wdi.SpiceObject.bytesToInt64(data.splice(spliceInit,8));var num_palettes=wdi.SpiceObject.bytesToInt16(data.splice(spliceInit,2));var palette=[];for(var i=0;i<num_palettes;i++){var queue=new wdi.Queue;queue.setData(data.splice(spliceInit,4));palette.push((new wdi.SpiceColor).demarshall(queue))}wdi.ImageCache.addPalette(palette_id,palette)}else{wdi.Debug.error("Unimplemented lz palette top down")}var palette=wdi.ImageCache.getPalette(palette_id)}if(type!==this.LZ_IMAGE_TYPE_RGB32&&type!==this.LZ_IMAGE_TYPE_RGBA&&type!==this.LZ_IMAGE_TYPE_RGB24&&type!==this.LZ_IMAGE_TYPE_PLT8&&type!==this.LZ_IMAGE_TYPE_PLT1_LE&&type!==this.LZ_IMAGE_TYPE_PLT1_BE&&type!==this.LZ_IMAGE_TYPE_PLT4_LE&&type!==this.LZ_IMAGE_TYPE_PLT4_BE){return false}if(palette){var ret=context.createImageData(stride*this.PLT_PIXELS_PER_BYTE[type],height);this.lz_rgb32_decompress(data,0,ret.data,type,type!==this.LZ_IMAGE_TYPE_RGBA,palette);var tmpCanvas=wdi.graphics.getNewTmpCanvas(width,height);tmpCanvas.getContext("2d").putImageData(ret,0,0,0,0,width,height);ret=tmpCanvas}else{var arr=new ArrayBuffer(data.length+8);var u8=new Uint8Array(arr);u8[0]=1;u8[1]=opaque;u8[2]=type;u8[3]=0;var number=ret.data.length;for(var i=0;i<4;i++){u8[4+i]=number&255;number=number>>8}u8.set(data,8);var result=new Uint8ClampedArray(this.lz_rgb32_decompress_rgb(arr));ret=new ImageData(result,width,height);ret=wdi.graphics.getImageFromData(ret)}if(!top_down){ret=wdi.RasterOperation.flip(ret)}return ret},demarshall_rgb:function(data){var header=data.splice(0,32);return{length:wdi.SpiceObject.bytesToInt32(header.splice(0,4)),magic:wdi.SpiceObject.bytesToStringBE(header.splice(0,4)),version:wdi.SpiceObject.bytesToInt32BE(header.splice(0,4)),type:wdi.SpiceObject.bytesToInt32BE(header.splice(0,4)),width:wdi.SpiceObject.bytesToInt32BE(header.splice(0,4)),height:wdi.SpiceObject.bytesToInt32BE(header.splice(0,4)),stride:wdi.SpiceObject.bytesToInt32BE(header.splice(0,4)),top_down:wdi.SpiceObject.bytesToInt32BE(header.splice(0,4))}},lz_rgb32_plt1_be_decompress:function(in_buf,out_buf,palette){var encoder=0;var op=0;var ctrl;var out_buf_len=out_buf.length/4;var ref,len,ofs,next,ref_4,oct,foreColor,backColor,i;var type=this.LZ_IMAGE_TYPE_PLT1_BE;var pix_per_byte=this.PLT_PIXELS_PER_BYTE[type];var pre_255_24=255<<24;var pre_31_8_plus255=(31<<8)+255;for(ctrl=in_buf[encoder++];op<out_buf_len;ctrl=in_buf[encoder++]){ref=op;len=ctrl>>5;ofs=(ctrl&31)<<8;if(ctrl>31){if(len===7){do{next=in_buf[encoder++];len+=next}while(next===255)}ofs+=in_buf[encoder++];if(ofs===pre_31_8_plus255){ofs+=in_buf[encoder++]<<8+in_buf[encoder++]}len=(len+2)*pix_per_byte;ref-=(ofs+1)*pix_per_byte;if(ref===op-1){ref_4=ref*4;while(len--!==0){op_4=op*4;out_buf[op_4]=out_buf[ref_4];out_buf[op_4+1]=out_buf[ref_4+1];out_buf[op_4+2]=out_buf[ref_4+2];out_buf[op_4+3]=out_buf[ref_4+3];op++}}else{while(len--!==0){op_4=op*4;ref_4=ref*4;out_buf[op_4]=out_buf[ref_4];out_buf[op_4+1]=out_buf[ref_4+1];out_buf[op_4+2]=out_buf[ref_4+2];out_buf[op_4+3]=out_buf[ref_4+3];op++;ref++}}}else{while(ctrl--!==-1){op_4=op*4;oct=in_buf[encoder++];foreColor=palette[1];backColor=palette[0];for(i=7;i>=0;i--){op_4=op*4;if(oct&this.PLT1_MASK[i]){out_buf[op_4+0]=foreColor.r;out_buf[op_4+1]=foreColor.g;out_buf[op_4+2]=foreColor.b}else{out_buf[op_4+0]=backColor.r;out_buf[op_4+1]=backColor.g;out_buf[op_4+2]=backColor.b}out_buf[op_4+3]=255;op++}}}}}};wdi.BMP2=$.spcExtend(wdi.SpiceObject,{objectSize:0,mapper:[0,1,1,4,4,8,16,24,32,32],init:function(imageData){var type=this.bytesToInt8(imageData);var flags=this.bytesToInt8(imageData);var width=this.bytesToInt32(imageData);var height=this.bytesToInt32(imageData);var stride=this.bytesToInt32(imageData);var len;var bpp=this.mapper[type];var i;var paletteSize=0,unique,paletteData,numEnts=0;if(bpp<=8&&bpp>0){var palette=[];if(flags&1){var paletteOffset=this.bytesToInt32(imageData);len=imageData.length;paletteSize=4*Math.pow(2,bpp);var paletteDataSize=paletteSize+8+2;len-=paletteDataSize;paletteData=imageData.splice(len,paletteDataSize);unique=this.bytesToInt64(paletteData);numEnts=this.bytesToInt16(paletteData);var queue;for(i=0;i<numEnts*4;i+=4){queue=new wdi.Queue;queue.setData(paletteData.slice(i,i+4));palette.push((new wdi.SpiceColor).demarshall(queue))}wdi.ImageCache.addPalette(unique,palette)}else{unique=this.bytesToInt64(imageData);len=imageData.length;palette=wdi.ImageCache.getPalette(unique);var spiceColors;paletteData=[];numEnts=palette.length;for(i=0;i<numEnts;i++){spiceColors=palette[i].marshall();spiceColors.push(0);paletteData=paletteData.concat(spiceColors)}}}else{var unknown=this.bytesToInt32(imageData)}this.setContent({imageSize:len,width:width,height:height,bpp:bpp,imageData:imageData,paletteSize:numEnts*4,palette:palette,stride:stride,type:type})},setContent:function(c){this.imageSize=c.imageSize;this.width=c.width;this.height=c.height;this.bpp=c.bpp;this.imageData=c.imageData;this.palette=c.palette;this.offset=c.paletteSize+54;this.size=this.offset+this.imageSize;this.stride=c.stride;this.type=c.type},marshall:function(context){var type=this.type;var palette=this.palette;var width=this.width;var height=this.height;var stride=this.stride;var data=this.imageData;var size=data.length;var pixelsStride=stride*8/this.bpp;var bytesStride=pixelsStride*4;var buf=new ArrayBuffer(bytesStride*height);var buf8=new Uint8ClampedArray(buf);var buf32=new Uint32Array(buf);var topdown=false;var oct,i,pos,buffPos,spiceColor;var b;if(palette){buffPos=0;if(type===wdi.SpiceBitmapFmt.SPICE_BITMAP_FMT_1BIT_BE){spiceColor=palette[1];var foreColor=spiceColor.r<<24|spiceColor.g<<16|spiceColor.b<<8|255;spiceColor=palette[0];var backColor=spiceColor.r<<24|spiceColor.g<<16|spiceColor.b<<8|255;var PLT1_MASK=[1,2,4,8,16,32,64,128];for(pos=0;pos<size;pos++){oct=data[pos];for(i=7;i>=0;i--){if(oct&PLT1_MASK[i]){buf32[buffPos++]=foreColor}else{buf32[buffPos++]=backColor}}}}else if(type===wdi.SpiceBitmapFmt.SPICE_BITMAP_FMT_4BIT_BE){for(pos=0;pos<size;pos++){oct=data[pos];spiceColor=palette[oct>>>4];buf32[buffPos++]=spiceColor.r<<24|spiceColor.g<<16|spiceColor.b<<8|255;spiceColor=palette[oct&15];buf32[buffPos++]=spiceColor.r<<24|spiceColor.g<<16|spiceColor.b<<8|255}}}else{if(type===wdi.SpiceBitmapFmt.SPICE_BITMAP_FMT_32BIT){for(pos=0;pos<size;pos+=4){b=data[pos];data[pos]=data[pos+2];data[pos+2]=b;data[pos+3]=255}}else if(type===wdi.SpiceBitmapFmt.SPICE_BITMAP_FMT_RGBA){topdown=true;for(pos=0;pos<size;pos+=4){b=data[pos];data[pos]=data[pos+2];data[pos+2]=b}}else if(type===wdi.SpiceBitmapFmt.SPICE_BITMAP_FMT_24BIT){for(pos=0;pos<size;pos+=3){b=data[pos];data[pos]=data[pos+2];data[pos+2]=b}}buf8=new Uint8ClampedArray(data)}var ret=new ImageData(buf8,pixelsStride,height);var tmpCanvas=wdi.graphics.getNewTmpCanvas(width,height);tmpCanvas.getContext("2d").putImageData(ret,0,0,0,0,width,height);ret=tmpCanvas;if(!topdown){ret=wdi.RasterOperation.flip(ret)}return ret}});"use strict";var rfc2083_crc_table=Array(256);var rfc2083_crc_table_computed=0;function rfc2083_make_crc_table(){var c;var n,k;for(n=0;n<256;n++){c=n;for(k=0;k<8;k++){if(c&1)c=(3988292384^c>>>1)>>>0&4294967295;else c=c>>>1}rfc2083_crc_table[n]=c}rfc2083_crc_table_computed=1}function rfc2083_update_crc(crc,u8buf,at,len){var c=crc;var n;if(!rfc2083_crc_table_computed)rfc2083_make_crc_table();for(n=0;n<len;n++){c=rfc2083_crc_table[(c^u8buf[at+n])&255]^c>>>8}return c}function rfc2083_crc(u8buf,at,len){return rfc2083_update_crc(4294967295,u8buf,at,len)^4294967295}function crc32(mb,at,len){var u8=new Uint8Array(mb);return rfc2083_crc(u8,at,len)}function PngIHDR(width,height){this.width=width;this.height=height;this.depth=8;this.type=6;this.compression=0;this.filter=0;this.interlace=0}PngIHDR.prototype={to_buffer:function(a,at){at=at||0;var orig=at;var dv=new SpiceDataView(a);dv.setUint32(at,this.buffer_size()-12);at+=4;dv.setUint8(at,"I".charCodeAt(0));at++;dv.setUint8(at,"H".charCodeAt(0));at++;dv.setUint8(at,"D".charCodeAt(0));at++;dv.setUint8(at,"R".charCodeAt(0));at++;dv.setUint32(at,this.width);at+=4;dv.setUint32(at,this.height);at+=4;dv.setUint8(at,this.depth);at++;dv.setUint8(at,this.type);at++;dv.setUint8(at,this.compression);at++;dv.setUint8(at,this.filter);at++;dv.setUint8(at,this.interlace);at++;dv.setUint32(at,crc32(a,orig+4,this.buffer_size()-8));at+=4;return at},buffer_size:function(){return 12+13}};function adler(){this.s1=1;this.s2=0}adler.prototype.update=function(b){this.s1+=b;this.s1%=65521;this.s2+=this.s1;this.s2%=65521};function PngIDAT(width,height,bytes){if(bytes.byteLength>65535){throw new Error("Cannot handle more than 64K")}this.data=bytes;this.width=width;this.height=height}PngIDAT.prototype={to_buffer:function(a,at){at=at||0;var orig=at;var x,y,i,j;var dv=new SpiceDataView(a);var zsum=new adler;dv.setUint32(at,this.buffer_size()-12);at+=4;dv.setUint8(at,"I".charCodeAt(0));at++;dv.setUint8(at,"D".charCodeAt(0));at++;dv.setUint8(at,"A".charCodeAt(0));at++;dv.setUint8(at,"T".charCodeAt(0));at++;dv.setUint8(at,120);at++;dv.setUint8(at,1);at++;dv.setUint8(at,128);at++;dv.setUint16(at,this.data.byteLength+this.height);at+=2;dv.setUint16(at,~(this.data.byteLength+this.height));at+=2;var u8=new Uint8Array(this.data);for(i=0,y=0;y<this.height;y++){dv.setUint8(at,0);at++;zsum.update(0);for(x=0;x<this.width&&i<this.data.byteLength;x++){zsum.update(u8[i]);dv.setUint8(at,u8[i++]);at++;zsum.update(u8[i]);dv.setUint8(at,u8[i++]);at++;zsum.update(u8[i]);dv.setUint8(at,u8[i++]);at++;zsum.update(u8[i]);dv.setUint8(at,u8[i++]);at++}}dv.setUint16(at,zsum.s2);at+=2;dv.setUint16(at,zsum.s1);at+=2;dv.setUint32(at,crc32(a,orig+4,this.buffer_size()-8));at+=4;return at},buffer_size:function(){return 12+this.data.byteLength+this.height+4+2+1+2+2}};function PngIEND(){}PngIEND.prototype={to_buffer:function(a,at){at=at||0;var orig=at;var i;var dv=new SpiceDataView(a);dv.setUint32(at,this.buffer_size()-12);at+=4;dv.setUint8(at,"I".charCodeAt(0));at++;dv.setUint8(at,"E".charCodeAt(0));at++;dv.setUint8(at,"N".charCodeAt(0));at++;dv.setUint8(at,"D".charCodeAt(0));at++;dv.setUint32(at,crc32(a,orig+4,this.buffer_size()-8));at+=4;return at},buffer_size:function(){return 12}};function create_rgba_png(width,height,bytes){var i;var ihdr=new PngIHDR(width,height);var idat=new PngIDAT(width,height,bytes);var iend=new PngIEND;var mb=new ArrayBuffer(ihdr.buffer_size()+idat.buffer_size()+iend.buffer_size());var at=ihdr.to_buffer(mb);at=idat.to_buffer(mb,at);at=iend.to_buffer(mb,at);var u8=new Uint8Array(mb);var str="";for(i=0;i<at;i++){str+="%";if(u8[i]<16)str+="0";str+=u8[i].toString(16)}return"%89PNG%0D%0A%1A%0A"+str}wdi.RunQueue=$.spcExtend(wdi.DomainObject,{tasks:null,isRunning:false,init:function(){this.tasks=[]},getTasksLength:function(){return this.tasks.length},add:function(fn,scope,endCallback,params){this.tasks.push({fn:fn,scope:scope,fnFinish:endCallback,params:params});return this},clear:function(){this.tasks=[];return this},_process:function(){wdi.ExecutionControl.sync=true;var proxy,self=this;this.isRunning=true;var task=this.tasks.shift();if(!task){this.isRunning=false;return}proxy={end:function(){if(task.fnFinish){task.fnFinish.call(task.scope)}self._process()}};try{task.fn.call(task.scope,proxy,task.params)}catch(e){wdi.Debug.error(e.message);proxy.end()}return this},process:function(){if(!this.isRunning){this._process()}else{return}}});wdi.ExecutionControl={currentProxy:null,sync:true,runQ:new wdi.RunQueue};if(typeof CanvasPixelArray!="undefined"&&!CanvasPixelArray.prototype.set){CanvasPixelArray.prototype.set=function(u8){var length=u8.length;for(var i=0;i<length;i++){this[i]=u8[i]}}}wdi.graphics={tmpCanvas:document.createElement("canvas"),imageLoader:new Image,getRect:function(box,image){if(box.x===0&&box.y===0&&box.width===image.width&&box.height===image.height){return image}var cnv=this.getImageFromData(image);var tmp_canvas=wdi.graphics.getNewTmpCanvas(box.width,box.height);var tmp_context=tmp_canvas.getContext("2d");tmp_context.drawImage(cnv,box.x,box.y,box.width,box.height,0,0,box.width,box.height);return tmp_canvas},argbToImageData:function(bytes,width,height){var length=bytes.length;var canvas=wdi.graphics.getTmpCanvas(width,height);var context=canvas.getContext("2d");var imageData=context.createImageData(width,height);for(var i=0;i<length;i+=4){imageData.data[i]=bytes[i];imageData.data[i+1]=bytes[i+1];imageData.data[i+2]=bytes[i+2];imageData.data[i+3]=bytes[i+3]}return imageData},align:function(a,size){return a+(size-1)&~(size-1)},monoMask:[1,2,4,8,16,32,64,128],monoToImageData:function(bytes,width,height){var stride=this.align(width,8)>>>3;var length=bytes.length;var half=length/2;var canvas=wdi.graphics.getTmpCanvas(width,height);var context=canvas.getContext("2d");var result=context.createImageData(width,height);var andMask=[];var xorMask=[];for(var i=0;i<length;i++){var currentByte=bytes[i];var bitsLeft=8;if(i>=half){while(bitsLeft--){var bit=currentByte&this.monoMask[bitsLeft]&&true;andMask.push(bit)}}else if(i<half){while(bitsLeft--){var bit=currentByte&this.monoMask[bitsLeft]&&true;xorMask.push(bit)}}}var pos=0;half=xorMask.length;for(i=0;i<half;i++){pos=i*4;if(!andMask[i]&&!xorMask[i]){result.data[pos]=0;result.data[pos+1]=0;result.data[pos+2]=0;result.data[pos+3]=255}else if(!andMask[i]&&xorMask[i]){result.data[pos]=255;result.data[pos+1]=255;result.data[pos+2]=255;result.data[pos+3]=0}else if(andMask[i]&&!xorMask[i]){result.data[pos]=255;result.data[pos+1]=255;result.data[pos+2]=255;result.data[pos+3]=255}else if(andMask[i]&&xorMask[i]){result.data[pos]=0;result.data[pos+1]=0;result.data[pos+2]=0;result.data[pos+3]=255}}return result},drawJpeg:function(imageDescriptor,jpegData,callback,previousScope){return this.drawBrowserImage(imageDescriptor,jpegData,callback,previousScope,"jpeg",false)},drawBrowserImage:function(imageDescriptor,jpegData,callback,previousScope,type,alreadyEncoded){var tmpstr;var img=wdi.GlobalPool.create("Image");var url;img.onload=function(){URL.revokeObjectURL(url);try{if(imageDescriptor.flags&wdi.SpiceImageFlags.SPICE_IMAGE_FLAGS_CACHE_ME){var myImage=wdi.graphics.getTmpCanvas(this.width,this.height);var tmp_context=myImage.getContext("2d");tmp_context.drawImage(this,0,0);wdi.ImageCache.addImage(imageDescriptor,myImage)}callback.call(previousScope,this)}catch(e){wdi.Debug.error(e.message)}finally{wdi.ExecutionControl.currentProxy.end()}};img.onerror=function(){URL.revokeObjectURL(url);wdi.Debug.error("failed to load JPEG image");wdi.ExecutionControl.currentProxy.end()};if(!alreadyEncoded){url=wdi.SpiceObject.bytesToURI(jpegData);img.src=url}else{tmpstr=jpegData;img.src=tmpstr}},getImageFromSpice:function(imageDescriptor,imageData,clientGui,callback,previousScope,options){var myImage;var source_img=null;var opaque;var brush;var raw;if(options){opaque=options["opaque"];brush=options["brush"];raw=options["raw"]}else{opaque=false;raw=false;brush=false}switch(imageDescriptor.type){case wdi.SpiceImageType.SPICE_IMAGE_TYPE_LZ_RGB:source_img=this.processLz(imageDescriptor,imageData,brush,opaque,clientGui);break;case wdi.SpiceImageType.SPICE_IMAGE_TYPE_LZ_PLT:wdi.Debug.log("lz plt decode");source_img=wdi.LZSS.convert_spice_lz_to_web(clientGui.getContext(0),imageData,imageDescriptor,opaque);break;case wdi.SpiceImageType.SPICE_IMAGE_TYPE_QUIC:source_img=this.processQuic(imageDescriptor,imageData,brush,opaque,clientGui);break;case wdi.SpiceImageType.SPICE_IMAGE_TYPE_JPEG:wdi.Debug.log("JPEG decode");wdi.ExecutionControl.sync=false;this.drawJpeg(imageDescriptor,imageData.subarray(4),callback,previousScope);return;case wdi.SpiceImageType.SPICE_IMAGE_TYPE_JPEG_ALPHA:wdi.Debug.log("JPEG Alpha decode");wdi.ExecutionControl.sync=false;var jpeg_data=imageData.subarray(9);this.drawJpeg(imageDescriptor,jpeg_data,callback,previousScope);return;case wdi.SpiceImageType.SPICE_IMAGE_TYPE_BITMAP:wdi.Debug.log("BMP");if(imageData.toJSArray){imageData=imageData.toJSArray()}source_img=new wdi.BMP2(imageData).marshall(clientGui.getContext(0));break;case wdi.SpiceImageType.SPICE_IMAGE_TYPE_FROM_CACHE_LOSSLESS:case wdi.SpiceImageType.SPICE_IMAGE_TYPE_FROM_CACHE:wdi.ExecutionControl.sync=false;wdi.ImageCache.getImageFrom(imageDescriptor,function(img){callback.call(previousScope,img);wdi.ExecutionControl.currentProxy.end()});return;case wdi.SpiceImageType.SPICE_IMAGE_TYPE_SURFACE:var origin_surface_id=wdi.SpiceObject.bytesToInt32(imageData.toJSArray());var context=clientGui.getContext(origin_surface_id);source_img=context.canvas;break;case wdi.SpiceImageType.SPICE_IMAGE_TYPE_CANVAS:source_img=imageData;break;case wdi.SpiceImageType.SPICE_IMAGE_TYPE_PNG:wdi.ExecutionControl.sync=false;imageData=wdi.SpiceObject.bytesToString(imageData.toJSArray());this.drawBrowserImage(imageDescriptor,imageData,callback,previousScope,"png",true);return;default:wdi.Debug.log("Unknown image type: "+imageDescriptor.type);wdi.ExecutionControl.currentProxy.end();return}myImage=null;if(imageDescriptor.flags&wdi.SpiceImageFlags.SPICE_IMAGE_FLAGS_CACHE_ME){wdi.ImageCache.addImage(imageDescriptor,source_img)}if(source_img.getContext||raw){myImage=source_img}else{myImage=this.getImageFromData(source_img)}if(imageDescriptor.flags&wdi.SpiceImageFlags.SPICE_IMAGE_FLAGS_CACHE_ME){wdi.ImageCache.addImage(imageDescriptor,myImage)}if(wdi.ExecutionControl.sync)callback.call(previousScope,myImage)},processUncompress:function(imageDescriptor,imageData,brush,opaque,clientGui,callback){var scope=this;var imageUncompressor=wdi.ImageUncompressor.getSyncInstance();imageUncompressor.process(imageDescriptor,imageData,brush,opaque,clientGui,callback,scope)},processQuic:function(imageDescriptor,imageData,brush,opaque,clientGui){var source_img;var callback=function(data){var u8=new Uint8ClampedArray(data);source_img=new ImageData(u8,imageDescriptor.width,imageDescriptor.height)};this.processUncompress(imageDescriptor,imageData,brush,opaque,clientGui,callback);return source_img},processLz:function(imageDescriptor,imageData,brush,opaque,clientGui){var source_img;var self=this;function callback(data){var imageUncompressor=wdi.ImageUncompressor.getSyncInstance();var extractedData=imageUncompressor.extractLzHeader(imageData,brush);var u8=new Uint8ClampedArray(data);source_img=new ImageData(u8,imageDescriptor.width,imageDescriptor.height);if(!extractedData.header.top_down&&!opaque){source_img=this.imageFlip(source_img)}}this.processUncompress(imageDescriptor,imageData,brush,opaque,clientGui,callback);return source_img},imageFlip:function(source_img){return wdi.RasterOperation.flip(this.getImageFromData(source_img))},getImageFromData:function(data,notUsePool){if(data.getContext||data instanceof Image){return data}var sourceCanvas;if(!notUsePool){sourceCanvas=this.getNewTmpCanvas(data.width,data.height)}else{sourceCanvas=$("<canvas/>").attr({width:data.width,height:data.height})[0]}var srcCtx=sourceCanvas.getContext("2d");srcCtx.putImageData(data,0,0);return sourceCanvas},getDataFromImage:function(canvas){return canvas.getContext("2d").getImageData(0,0,canvas.width,canvas.height)},getBoxFromSrcArea:function(src_area){var box={width:src_area.right-src_area.left,height:src_area.bottom-src_area.top,x:src_area.left,y:src_area.top};return box},setBrush:function(clientGui,context,brush,box,ropd){var pattern,imageDescriptor,type,imageData;if(brush.type===wdi.SpiceBrushType.SPICE_BRUSH_TYPE_PATTERN){imageDescriptor=brush.pattern.image;this.getImageFromSpice(imageDescriptor,brush.pattern.imageData,clientGui,function(sourceImg){pattern=context.createPattern(sourceImg,"repeat");if(ropd===wdi.SpiceRopd.SPICE_ROPD_OP_PUT){context.fillStyle=pattern;context.fillRect(box.x,box.y,box.width,box.height)}else{var tmp_canvas=wdi.graphics.getTmpCanvas(box.width,box.height);var tmp_context=tmp_canvas.getContext("2d");tmp_context.fillStyle=pattern;tmp_context.fillRect(0,0,box.width,box.height);var dest=wdi.graphics.getRect(box,context.canvas);imageData=wdi.RasterOperation.process(ropd,tmp_canvas,dest);context.drawImage(imageData,box.x,box.y,box.width,box.height)}},this,{opaque:true})}else if(brush.type===wdi.SpiceBrushType.SPICE_BRUSH_TYPE_SOLID){if(ropd===wdi.SpiceRopd.SPICE_ROPD_OP_PUT){if(context.fillStyle!=brush.color.simple_html_color){context.fillStyle=brush.color.simple_html_color}context.fillRect(box.x,box.y,box.width,box.height)}else{var tmp_canvas=wdi.graphics.getTmpCanvas(box.width,box.height);var tmp_context=tmp_canvas.getContext("2d");tmp_context.fillStyle=brush.color.html_color;tmp_context.fillRect(0,0,box.width,box.height);var dest=wdi.graphics.getRect(box,context.canvas);imageData=wdi.RasterOperation.process(ropd,tmp_canvas,dest);context.drawImage(imageData,box.x,box.y,box.width,box.height)}}},imageIsEntireColor:function(r,g,b,size,data){var pos=0;var equal;do{equal=data[pos]===r&&data[pos+1]===g&&data[pos+2]===b;pos+=4}while(pos!=size&&equal);return equal},drawBackText:function(clientGui,context,text){var back_brush=text.back_brush;var back_mode=text.back_mode;var box=wdi.graphics.getBoxFromSrcArea(text.base.box);this.setBrush(clientGui,context,back_brush,box,back_mode)},drawString:function(context,string,bpp,fore_brush,clip_type,display){var color=fore_brush.color;var length=string.len;var render_pos,glyph_origin;var width;var height;var data;var lines;var imgData;var factor;var x;var y;var i;var buf,buf8,rawData;var bytesLeft;var bytesTotal;var subData;var rasterArray=string.raster_glyph;var currentRaster;var rawLine;var bitsLeft;var byteCounter;var alpha;var index;var box;if(bpp===1){factor=255}else if(bpp===4){factor=17}else{factor=1}for(i=0;i<length;i++){currentRaster=rasterArray[i];render_pos=currentRaster.render_pos;glyph_origin=currentRaster.glyph_origin;width=currentRaster.width;height=currentRaster.height;data=currentRaster.data;lines=height;buf=new ArrayBuffer(width*height*4);buf8=new Uint8ClampedArray(buf);rawData=new Uint32Array(buf);x=0;y=0;while(lines--){bytesLeft=Math.ceil(width*bpp/8);bytesTotal=bytesLeft;subData=[];while(bytesTotal--){subData.push(data.pop())}while(bytesLeft--){rawLine=subData.pop();bitsLeft=8;byteCounter=0;while(bitsLeft){alpha=wdi.bppMask[bpp][byteCounter]&rawLine;if(bpp===1&&alpha){alpha=1}else if(bpp===4&&alpha&&alpha>15){alpha=alpha>>4}if(alpha){index=y*width+x;rawData[index]=factor*alpha<<24|color.b<<16|color.g<<8|color.r}bitsLeft-=bpp;x++;byteCounter++}}y++;x=0}box={x:render_pos.x+glyph_origin.x,y:render_pos.y+glyph_origin.y-1,width:width,height:height};imgData=new ImageData(buf8,width,height);var tmpCanvas=wdi.graphics.getImageFromData(imgData);display.drawClip(tmpCanvas,box,context);wdi.GlobalPool.discard("Canvas",tmpCanvas)}},getImgDataPosition:function(x,y,width){var index=(y*width+x)*4;return index},getTmpCanvas:function(width,height){var canvas=this.tmpCanvas;canvas.width=width;canvas.height=height;return canvas},getNewTmpCanvas:function(width,height){var sourceCanvas=wdi.GlobalPool.create("Canvas");sourceCanvas.width=width;sourceCanvas.height=height;return sourceCanvas}};wdi.Rop3={1:function(pat,src,dest){return~(pat|src|dest)},2:function(pat,src,dest){return~(pat|src)&dest},4:function(pat,src,dest){return~(pat|dest)&src},6:function(pat,src,dest){return~(~(src^dest)|pat)},7:function(pat,src,dest){return~(src&dest|pat)},8:function(pat,src,dest){return~pat&dest&src},9:function(pat,src,dest){return~(src^dest|pat)},11:function(pat,src,dest){return~(~dest&src|pat)},13:function(pat,src,dest){return~(~src&dest|pat)},14:function(pat,src,dest){return~(~(src|dest)|pat)},16:function(pat,src,dest){return~(src|dest)&pat},18:function(pat,src,dest){return~(~(pat^dest)|src)},19:function(pat,src,dest){return~(pat&dest|src)},20:function(pat,src,dest){return~(~(pat^src)|dest)},21:function(pat,src,dest){return~(pat&src|dest)},22:function(pat,src,dest){return~(pat&src)&dest^src^pat},23:function(pat,src,dest){return~((src^dest)&(src^pat)^src)},24:function(pat,src,dest){return(src^pat)&(pat^dest)},25:function(pat,src,dest){return~(~(pat&src)&dest^src)},26:function(pat,src,dest){return(pat&src|dest)^pat},27:function(pat,src,dest){return~((pat^src)&dest^src)},28:function(pat,src,dest){return(pat&dest|src)^pat},29:function(pat,src,dest){return~((pat^dest)&src^dest)},30:function(pat,src,dest){return(dest|src)^pat},31:function(pat,src,dest){return~((src|dest)&pat)},32:function(pat,src,dest){return~src&pat&dest},33:function(pat,src,dest){return~(pat^dest|src)},35:function(pat,src,dest){return~(~dest&pat|src)},36:function(pat,src,dest){return(src^pat)&(dest^src)},37:function(pat,src,dest){return~(~(src&pat)&dest^pat)},38:function(pat,src,dest){return(src&pat|dest)^src},39:function(pat,src,dest){return(~(src^pat)|dest)^src},40:function(pat,src,dest){return(pat^src)&dest},41:function(pat,src,dest){return~((src&pat|dest)^src^pat)},42:function(pat,src,dest){return~(src&pat)&dest},43:function(pat,src,dest){return~((pat^dest)&(src^pat)^src)},44:function(pat,src,dest){return(src|dest)&pat^src},45:function(pat,src,dest){return(~dest|src)^pat},46:function(pat,src,dest){return(pat^dest|src)^pat},47:function(pat,src,dest){return~((~dest|src)&pat)},49:function(pat,src,dest){return~(~pat&dest|src)},50:function(pat,src,dest){return(src|pat|dest)^src},52:function(pat,src,dest){return(src&dest|pat)^src},53:function(pat,src,dest){return(~(src^dest)|pat)^src},54:function(pat,src,dest){return(pat|dest)^src},55:function(pat,src,dest){return~((pat|dest)&src)},56:function(pat,src,dest){return(pat|dest)&src^pat},57:function(pat,src,dest){return(~dest|pat)^src},58:function(pat,src,dest){return(src^dest|pat)^src},59:function(pat,src,dest){return~((~dest|pat)&src)},61:function(pat,src,dest){return(~(src|dest)|pat)^src},62:function(pat,src,dest){return(~src&dest|pat)^src},64:function(pat,src,dest){return~dest&src&pat},65:function(pat,src,dest){return~(src^pat|dest)},66:function(pat,src,dest){return(src^dest)&(pat^dest)},67:function(pat,src,dest){return~(~(src&dest)&pat^src)},69:function(pat,src,dest){return~(~src&pat|dest)},70:function(pat,src,dest){return(dest&pat|src)^dest},71:function(pat,src,dest){return~((pat^dest)&src^pat)},72:function(pat,src,dest){return(pat^dest)&src},73:function(pat,src,dest){return~((dest&pat|src)^dest^pat)},74:function(pat,src,dest){return(dest|src)&pat^dest},75:function(pat,src,dest){return(~src|dest)^pat},76:function(pat,src,dest){return~(pat&dest)&src},77:function(pat,src,dest){return~((src^dest|src^pat)^src)},78:function(pat,src,dest){return(pat^src|dest)^pat},79:function(pat,src,dest){return~((~src|dest)&pat)},81:function(pat,src,dest){return~(~pat&src|dest)},82:function(pat,src,dest){return(dest&src|pat)^dest},83:function(pat,src,dest){return~((src^dest)&pat^src)},84:function(pat,src,dest){return~(~(src|pat)|dest)},86:function(pat,src,dest){return(src|pat)^dest},87:function(pat,src,dest){return~((src|pat)&dest)},88:function(pat,src,dest){return(pat|src)&dest^pat},89:function(pat,src,dest){return(~src|pat)^dest},91:function(pat,src,dest){return(~(dest|src)|pat)^dest},92:function(pat,src,dest){return(dest^src|pat)^dest},93:function(pat,src,dest){return~((~src|pat)&dest)},94:function(pat,src,dest){return(~dest&src|pat)^dest},96:function(pat,src,dest){return(src^dest)&pat},97:function(pat,src,dest){return~((src&dest|pat)^src^dest)},98:function(pat,src,dest){return(dest|pat)&src^dest},99:function(pat,src,dest){return(~pat|dest)^src},100:function(pat,src,dest){return(src|pat)&dest^src},101:function(pat,src,dest){return(~pat|src)^dest},103:function(pat,src,dest){return(~(src|pat)|dest)^src},104:function(pat,src,dest){return~((~(src|dest)|pat)^src^dest)},105:function(pat,src,dest){return~(src^dest^pat)},106:function(pat,src,dest){return src&pat^dest},107:function(pat,src,dest){return~((src|pat)&dest^src^pat)},108:function(pat,src,dest){return pat&dest^src},109:function(pat,src,dest){return~((dest|pat)&src^dest^pat)},110:function(pat,src,dest){return(~src|pat)&dest^src},111:function(pat,src,dest){return~(~(src^dest)&pat)},112:function(pat,src,dest){return~(src&dest)&pat},113:function(pat,src,dest){return~((dest^pat)&(src^dest)^src)},114:function(pat,src,dest){return(src^pat|dest)^src},115:function(pat,src,dest){return~((~pat|dest)&src)},116:function(pat,src,dest){return(dest^pat|src)^dest},117:function(pat,src,dest){return~((~pat|src)&dest)},118:function(pat,src,dest){return(~src&pat|dest)^src},120:function(pat,src,dest){return src&dest^pat},121:function(pat,src,dest){return~((src|dest)&pat^src^dest)},122:function(pat,src,dest){return(~dest|src)&pat^dest},123:function(pat,src,dest){return~(~(pat^dest)&src)},124:function(pat,src,dest){return(~src|dest)&pat^src},125:function(pat,src,dest){return~(~(src^pat)&dest)},126:function(pat,src,dest){return src^dest|pat^src},127:function(pat,src,dest){return~(src&pat&dest)},128:function(pat,src,dest){return src&pat&dest},129:function(pat,src,dest){return~(src^dest|pat^src)},130:function(pat,src,dest){return~(src^pat)&dest},131:function(pat,src,dest){return~((~src|dest)&pat^src)},132:function(pat,src,dest){return~(pat^dest)&src},133:function(pat,src,dest){return~((~pat|src)&dest^pat)},134:function(pat,src,dest){return(src|dest)&pat^src^dest},135:function(pat,src,dest){return~(src&dest^pat)},137:function(pat,src,dest){return~((~src&pat|dest)^src)},138:function(pat,src,dest){return(~pat|src)&dest},139:function(pat,src,dest){return~((dest^pat|src)^dest)},140:function(pat,src,dest){return(~pat|dest)&src},141:function(pat,src,dest){return~((src^pat|dest)^src)},142:function(pat,src,dest){return(dest^pat)&(dest^src)^src},143:function(pat,src,dest){return~(~(src&dest)&pat)},144:function(pat,src,dest){return~(src^dest)&pat},145:function(pat,src,dest){return~((~src|pat)&dest^src)},146:function(pat,src,dest){return(pat|dest)&src^pat^dest},147:function(pat,src,dest){return~(dest&pat^src)},148:function(pat,src,dest){return(src|pat)&dest^src^pat},149:function(pat,src,dest){return~(src&pat^dest)},150:function(pat,src,dest){return src^pat^dest},151:function(pat,src,dest){return(~(src|pat)|dest)^src^pat},152:function(pat,src,dest){return~((~(src|pat)|dest)^src)},154:function(pat,src,dest){return~src&pat^dest},155:function(pat,src,dest){return~((src|pat)&dest^src)},156:function(pat,src,dest){return~dest&pat^src},157:function(pat,src,dest){return~((dest|pat)&src^dest)},158:function(pat,src,dest){return(src&dest|pat)^src^dest},159:function(pat,src,dest){return~((src^dest)&pat)},161:function(pat,src,dest){return~((~pat&src|dest)^pat)},162:function(pat,src,dest){
return(~src|pat)&dest},163:function(pat,src,dest){return~((dest^src|pat)^dest)},164:function(pat,src,dest){return~((~(pat|src)|dest)^pat)},166:function(pat,src,dest){return~pat&src^dest},167:function(pat,src,dest){return~((pat|src)&dest^pat)},168:function(pat,src,dest){return(src|pat)&dest},169:function(pat,src,dest){return~((src|pat)^dest)},171:function(pat,src,dest){return~(src|pat)|dest},172:function(pat,src,dest){return(src^dest)&pat^src},173:function(pat,src,dest){return~((dest&src|pat)^dest)},174:function(pat,src,dest){return~pat&src|dest},176:function(pat,src,dest){return(~src|dest)&pat},177:function(pat,src,dest){return~((pat^src|dest)^pat)},178:function(pat,src,dest){return(src^dest|pat^src)^src},179:function(pat,src,dest){return~(~(pat&dest)&src)},180:function(pat,src,dest){return~dest&src^pat},181:function(pat,src,dest){return~((dest|src)&pat^dest)},182:function(pat,src,dest){return(pat&dest|src)^pat^dest},183:function(pat,src,dest){return~((pat^dest)&src)},184:function(pat,src,dest){return(dest^pat)&src^pat},185:function(pat,src,dest){return~((dest&pat|src)^dest)},186:function(pat,src,dest){return~src&pat|dest},188:function(pat,src,dest){return~(src&dest)&pat^src},189:function(pat,src,dest){return~((dest^pat)&(dest^src))},190:function(pat,src,dest){return src^pat|dest},191:function(pat,src,dest){return~(src&pat)|dest},193:function(pat,src,dest){return~((~src&dest|pat)^src)},194:function(pat,src,dest){return~((~(src|dest)|pat)^src)},196:function(pat,src,dest){return(~dest|pat)&src},197:function(pat,src,dest){return~((src^dest|pat)^src)},198:function(pat,src,dest){return~pat&dest^src},199:function(pat,src,dest){return~((pat|dest)&src^pat)},200:function(pat,src,dest){return(pat|dest)&src},201:function(pat,src,dest){return~((dest|pat)^src)},202:function(pat,src,dest){return(dest^src)&pat^dest},203:function(pat,src,dest){return~((src&dest|pat)^src)},205:function(pat,src,dest){return~(pat|dest)|src},206:function(pat,src,dest){return~pat&dest|src},208:function(pat,src,dest){return(~dest|src)&pat},209:function(pat,src,dest){return~((pat^dest|src)^pat)},210:function(pat,src,dest){return~src&dest^pat},211:function(pat,src,dest){return~((src|dest)&pat^src)},212:function(pat,src,dest){return(dest^pat)&(pat^src)^src},213:function(pat,src,dest){return~(~(src&pat)&dest)},214:function(pat,src,dest){return(src&pat|dest)^src^pat},215:function(pat,src,dest){return~((src^pat)&dest)},216:function(pat,src,dest){return(pat^src)&dest^pat},217:function(pat,src,dest){return~((src&pat|dest)^src)},218:function(pat,src,dest){return~(dest&src)&pat^dest},219:function(pat,src,dest){return~((src^dest)&(pat^src))},220:function(pat,src,dest){return~dest&pat|src},222:function(pat,src,dest){return pat^dest|src},223:function(pat,src,dest){return~(pat&dest)|src},224:function(pat,src,dest){return(src|dest)&pat},225:function(pat,src,dest){return~((src|dest)^pat)},226:function(pat,src,dest){return(dest^pat)&src^dest},227:function(pat,src,dest){return~((pat&dest|src)^pat)},228:function(pat,src,dest){return(src^pat)&dest^src},229:function(pat,src,dest){return~((pat&src|dest)^pat)},230:function(pat,src,dest){return~(src&pat)&dest^src},231:function(pat,src,dest){return~((dest^pat)&(pat^src))},232:function(pat,src,dest){return(src^dest)&(pat^src)^src},233:function(pat,src,dest){return~(~(src&dest)&pat^src^dest)},234:function(pat,src,dest){return src&pat|dest},235:function(pat,src,dest){return~(src^pat)|dest},236:function(pat,src,dest){return pat&dest|src},237:function(pat,src,dest){return~(pat^dest)|src},239:function(pat,src,dest){return~pat|dest|src},241:function(pat,src,dest){return~(src|dest)|pat},242:function(pat,src,dest){return~src&dest|pat},244:function(pat,src,dest){return~dest&src|pat},246:function(pat,src,dest){return src^dest|pat},247:function(pat,src,dest){return~(src&dest)|pat},248:function(pat,src,dest){return src&dest|pat},249:function(pat,src,dest){return~(src^dest)|pat},251:function(pat,src,dest){return~src|pat|dest},253:function(pat,src,dest){return~dest|src|pat},254:function(pat,src,dest){return src|pat|dest}};Uint8Array.prototype.toJSArray=function(){if(this.length==1){return[this[0]]}var len=this.length;var arr=new Array(len);for(var i=0;i<len;i++){arr[i]=this[i]}return arr};wdi.FixedQueue=$.spcExtend(wdi.DomainObject,{q:null,size:1024*1024*10,grow:1024*1024*10,woffset:0,roffset:0,init:function(c){this.q=new Uint8Array(this.size)},setData:function(q){this.woffset=q.length;this.roffset=0;this.q.set(q)},shift:function(elements){if(this.roffset+elements>this.woffset){throw"Not enough queue to read"}var toreturn=this.q.subarray(this.roffset,this.roffset+elements);this.roffset=this.roffset+elements;if(this.woffset==this.roffset){this.woffset=0;this.roffset=0}return toreturn},push:function(collection){if(this.woffset+collection.byteLength>this.size){var oldq=this.q;this.size+=this.grow;this.q=new Uint8Array(this.size);this.q.set(oldq)}this.q.set(collection,this.woffset);this.woffset+=collection.byteLength},getLength:function(){return this.woffset-this.roffset}});wdi.Queue=$.spcExtend(wdi.DomainObject,{q:null,raw:false,init:function(c){if(c.raw){this.raw=c.raw}this.q=new Uint8Array(0)},getData:function(){return this.toJSArray(this.q)},setData:function(q){this.q=new Uint8Array(q.length);this.q.set(q)},shift:function(){var elements=arguments[0]||this.getLength();if(elements===this.q.length){var toreturn=this.q;this.q=new Uint8Array(0)}else{var toreturn=this.q.subarray(0,elements);this.q=this.q.subarray(elements)}return this.toJSArray(toreturn)},peek:function(begin,end){var tmp=null;if(begin==0&&!end){tmp=this.q}else{tmp=this.q.subarray(begin,end)}return this.toJSArray(tmp)},push:function(collection){if(typeof collection=="string"){var len=collection.length;var newq=new Uint8Array(this.q.length+len);newq.set(this.q);for(var i=0;i<len;i++){newq[i+this.q.length]=collection[i]}this.q=newq}else{if(this.getLength()===0){this.q=new Uint8Array(collection.length);this.q.set(collection)}else{var newq=new Uint8Array(collection.length+this.q.length);newq.set(this.q);newq.set(collection,this.q.length);this.q=newq}}},getLength:function(){return this.q.length},toJSArray:function(data){if(this.raw){return data}return data.toJSArray()}});wdi.ViewQueue=$.spcExtend(wdi.DomainObject,{q:null,at:null,init:function(){this.q=new Uint8Array;this.at=0},getData:function(){return this.toJSArray(this.q.subarray(this.at))},getDataOffset:function(pos){return this.toJSArray(this.q.subarray(pos))},getRawData:function(){return this.q.subarray(this.at)},getRawDataOffset:function(pos){return this.q.subarray(pos)},setData:function(q){this.q=new Uint8Array(q.length);this.q.set(q);this.at=0},shift:function(length){var elements=length||this.getLength();if(elements>this.getLength()){elements=this.getLength()}var ret=this.q.subarray(0+this.at,elements+this.at);this.at+=elements;return this.toJSArray(ret)},eatBytes:function(bytes){this.at+=bytes},getByte:function(pos){return this.q[pos+this.at]},peek:function(begin,end){var tmp=null;if(begin==0&&!end){tmp=this.q}else{if(end){end+=this.at}tmp=this.q.subarray(begin+this.at,end)}return this.toJSArray(tmp)},push:function(collection){if(typeof collection=="string"){var len=collection.length;var newq=new Uint8Array(this.q.length+len);newq.set(this.q);for(var i=0;i<len;i++){newq[i+this.q.length]=collection[i]}this.q=newq}else{if(this.getLength()===0){this.q=new Uint8Array(collection.length);this.q.set(collection)}else{var newq=new Uint8Array(collection.length+this.q.length);newq.set(this.q);newq.set(collection,this.q.length);this.q=newq}}},getLength:function(){return this.q.length-this.at},getPosition:function(){return this.at},toJSArray:function(data){if(data.length==1){return[data[0]]}return data.toJSArray()}});wdi.ImageUncompressor=$.spcExtend(wdi.EventObject.prototype,{init:function(c){this.syncAsyncHandler=c.syncAsyncHandler||new wdi.SyncAsyncHandler({isAsync:c.isAsync})},lzHeaderSize:32,extractLzHeader:function(imageData,brush){var headerData,header;if(!brush){if(Object.prototype.toString.call(imageData)==="[object Array]"){headerData=imageData.slice(0,this.lzHeaderSize);imageData=imageData.slice(this.lzHeaderSize)}else{headerData=imageData.subarray(0,this.lzHeaderSize).toJSArray();imageData=imageData.subarray(this.lzHeaderSize)}header=wdi.LZSS.demarshall_rgb(headerData)}else{header=wdi.LZSS.demarshall_rgb(imageData)}return{header:header,imageData:imageData}},processLz:function(imageData,brush,opaque,clientGui,callback,scope){var extractedData,u8,buffer,number,context;extractedData=this.extractLzHeader(imageData,brush);imageData=extractedData.imageData;number=extractedData.header.width*extractedData.header.height*4;buffer=new ArrayBuffer(imageData.length+16);u8=new Uint8Array(buffer);u8[0]=1;u8[1]=opaque;u8[2]=extractedData.header.type;u8[3]=extractedData.header.top_down;for(var i=0;i<4;i++){u8[4+i]=number&255;number=number>>8}var view=new DataView(buffer);view.setUint32(8,extractedData.header.width);view.setUint32(12,extractedData.header.height);u8.set(imageData,16);this.syncAsyncHandler.dispatch(buffer,callback,scope)},processQuic:function(imageData,opaque,clientGui,callback,scope){wdi.Debug.log("Quic decode");buffer=new ArrayBuffer(imageData.length+4);view=new Uint8Array(buffer);view.set(imageData,4);view[3]=opaque?1:0;view[0]=0;this.syncAsyncHandler.dispatch(buffer,callback,scope)},process:function(imageDescriptor,imageData,brush,opaque,clientGui,callback,scope){switch(imageDescriptor.type){case wdi.SpiceImageType.SPICE_IMAGE_TYPE_QUIC:this.processQuic(imageData,opaque,clientGui,callback,scope);break;case wdi.SpiceImageType.SPICE_IMAGE_TYPE_LZ_RGB:this.processLz(imageData,brush,opaque,clientGui,callback,scope);break}},dispose:function(){this.syncAsyncHandler.dispose()}});var syncInstance;var asyncInstance;wdi.ImageUncompressor.getSyncInstance=function(){if(!syncInstance){syncInstance=new wdi.ImageUncompressor({isAsync:false})}return syncInstance};wdi.ImageUncompressor.getAsyncInstance=function(){if(!asyncInstance){asyncInstance=new wdi.ImageUncompressor({isAsync:true})}return asyncInstance};wdi.SyncAsyncHandler=$.spcExtend(wdi.EventObject.prototype,{init:function(c){this.isAsync=!!c.isAsync;if(this.isAsync){this.asyncWorker=c.asyncWorker||new wdi.AsyncWorker({script:"application/WorkerProcess.js"})}},isAsync:null,dispatch:function(buffer,callback,scope){if(this.isAsync){this.asyncWorker.run(buffer,callback,scope)}else{var result=window["workerDispatch"](buffer,this.isAsync);callback.call(scope,result)}},dispose:function(){if(this.isAsync){this.asyncWorker.dispose()}}});wdi.IntegrationBenchmark={benchmarking:false,startTime:0,timeoutInterval:3e3,timeOutId:undefined,busConnection:undefined,setEndTime:function(){var self=this;this.timeOutId=setTimeout(function(){self.timeOutId=undefined;self.benchmarking=false;var now=(new Date).getTime();var elapsed=now-self.startTime-self.timeoutInterval;self.onEndBenchmarkCallback(elapsed);var message={type:wdi.BUS_TYPES.killApplicationDoNotUseInProductionEver,application:"EXCEL.EXE"};self.busConnection.send(message)},this.timeoutInterval)},setStartTime:function(){if(this.timeOutId!==undefined){clearTimeout(this.timeOutId)}},launchApp:function(busConnection,onEndBenchmarkCallback){this.busConnection=busConnection;wdi.IntegrationBenchmark.benchmarking=true;wdi.IntegrationBenchmark.setStartTime();this.onEndBenchmarkCallback=onEndBenchmarkCallback;this.startTime=(new Date).getTime();var message={type:wdi.BUS_TYPES.launchApplication,file:"c:\\Users\\eyeos\\Desktop\\test.xlsx"};this.busConnection.send(message)}};wdi.StuckKeysHandler=$.spcExtend(wdi.EventObject.prototype,{ctrlTimeoutId:null,altTimeoutId:null,shiftTimeoutId:null,shiftKeyPressed:false,ctrlKeyPressed:false,altKeyPressed:false,handleStuckKeys:function(jqueryEvent){if(jqueryEvent){switch(jqueryEvent.keyCode){case 16:this._handleKey("shiftTimeoutId",jqueryEvent.type,16);break;case 17:this._handleKey("ctrlTimeoutId",jqueryEvent.type,17);break;case 18:this._handleKey("altTimeoutId",jqueryEvent.type,18);break}}},releaseAllKeys:function releaseAllKeys(){var e;var i;for(i=0;i<300;i++){this.releaseKeyPressed(i)}},_handleKey:function(variable,type,keyCode){if(type==="keydown"){this[variable]=this._configureTimeout(keyCode)}else if(type==="keyup"){clearTimeout(this[variable])}},_configureTimeout:function(keyCode){var self=this;return setTimeout(function keyPressedTimeout(){self.releaseKeyPressed(keyCode)},wdi.StuckKeysHandler.defaultTimeout)},releaseKeyPressed:function(keyCode){var e=window.jQuery.Event("keyup");e["which"]=keyCode;e["keyCode"]=keyCode;e["charCode"]=0;e["generated"]=true;this.fire("inputStuck",["keyup",[e]])},checkSpecialKey:function(event,keyCode){switch(keyCode){case 16:this.shiftKeyPressed=event==="keydown";break;case 17:this.ctrlKeyPressed=event==="keydown";break;case 18:this.altKeyPressed=event==="keydown";break}},releaseSpecialKeysPressed:function(){if(this.shiftKeyPressed){this.releaseKeyPressed(16);this.shiftKeyPressed=false}if(this.ctrlKeyPressed){this.releaseKeyPressed(17);this.ctrlKeyPressed=false}if(this.altKeyPressed){this.releaseKeyPressed(18);this.altKeyPressed=false}}});wdi.StuckKeysHandler.defaultTimeout=2e3;wdi.TimeLapseDetector=$.spcExtend(wdi.EventObject.prototype,{lastTime:null,init:function timeLapseDetector_Init(c){this.superInit()},startTimer:function timeLapseDetector_startTimer(){var self=this;this.lastTime=Date.now();window.setInterval(function timeLapseDetectorInterval(){var now=Date.now();var elapsed=now-self.lastTime;if(elapsed>=self.constructor.maxIntervalAllowed){self.fire("timeLapseDetected",elapsed)}self.lastTime=now},wdi.TimeLapseDetector.defaultInterval)},getLastTime:function timeLapseDetector_getLastTime(){return this.lastTime},setLastTime:function timeLapseDetector_setLastTime(lastTime){this.lastTime=lastTime;return this}});wdi.TimeLapseDetector.defaultInterval=5e3;wdi.TimeLapseDetector.maxIntervalAllowed=wdi.TimeLapseDetector.defaultInterval*3;wdi.DisplayRouter=$.spcExtend(wdi.EventObject.prototype,{init:function(c){this.clientGui=c.clientGui;this.rasterEngine=c.rasterEngine||new wdi.RasterEngine({clientGui:this.clientGui});if(c.routeList){this.routeList=c.routeList}else{this._initRoutes()}},_initRoutes:function(){this.routeList={};this.routeList[wdi.SpiceVars.SPICE_MSG_DISPLAY_SURFACE_CREATE]=this.rasterEngine.drawCanvas;this.routeList[wdi.SpiceVars.SPICE_MSG_DISPLAY_SURFACE_DESTROY]=this.rasterEngine.removeCanvas;this.routeList[wdi.SpiceVars.SPICE_MSG_DISPLAY_DRAW_COPY]=this.rasterEngine.drawImage;this.routeList[wdi.SpiceVars.SPICE_MSG_DISPLAY_DRAW_FILL]=this.rasterEngine.drawFill;this.routeList[wdi.SpiceVars.SPICE_MSG_DISPLAY_DRAW_ALPHA_BLEND]=this.rasterEngine.drawAlphaBlend;this.routeList[wdi.SpiceVars.SPICE_MSG_DISPLAY_DRAW_WHITENESS]=this.rasterEngine.drawWhiteness;this.routeList[wdi.SpiceVars.SPICE_MSG_DISPLAY_DRAW_BLACKNESS]=this.rasterEngine.drawBlackness;this.routeList[wdi.SpiceVars.SPICE_MSG_DISPLAY_DRAW_TRANSPARENT]=this.rasterEngine.drawTransparent;this.routeList[wdi.SpiceVars.SPICE_MSG_DISPLAY_COPY_BITS]=this.rasterEngine.drawCopyBits;this.routeList[wdi.SpiceVars.SPICE_MSG_DISPLAY_DRAW_TEXT]=this.rasterEngine.drawText;this.routeList[wdi.SpiceVars.SPICE_MSG_DISPLAY_DRAW_STROKE]=this.rasterEngine.drawStroke;this.routeList[wdi.SpiceVars.SPICE_MSG_DISPLAY_DRAW_ROP3]=this.rasterEngine.drawRop3;this.routeList[wdi.SpiceVars.SPICE_MSG_DISPLAY_DRAW_INVERS]=this.rasterEngine.drawInvers;this.routeList[wdi.SpiceVars.SPICE_MSG_DISPLAY_STREAM_CREATE]=this.rasterEngine.handleStreamCreate;this.routeList[wdi.SpiceVars.SPICE_MSG_DISPLAY_STREAM_DESTROY]=this.rasterEngine.handleStreamDestroy;this.routeList[wdi.SpiceVars.SPICE_MSG_DISPLAY_STREAM_DATA]=this.rasterEngine.handleStreamData;this.routeList[wdi.SpiceVars.SPICE_MSG_DISPLAY_STREAM_CLIP]=this.rasterEngine.handleStreamClip;this.routeList[wdi.SpiceVars.SPICE_MSG_DISPLAY_DRAW_BLEND]=this.rasterEngine.drawBlend;this.routeList[wdi.SpiceVars.SPICE_MSG_DISPLAY_INVAL_LIST]=this.rasterEngine.invalList;this.routeList[wdi.SpiceVars.SPICE_MSG_DISPLAY_INVAL_ALL_PALETTES]=this.rasterEngine.invalPalettes;this.routeList[wdi.SpiceVars.SPICE_MSG_DISPLAY_MARK]=false;this.routeList[wdi.SpiceVars.SPICE_MSG_DISPLAY_RESET]=false},processPacket:function(spiceMessage){if(!spiceMessage){wdi.Debug.log("DisplayProcess processPacket: Skipping empty message...");return}var route=this.routeList[spiceMessage.messageType];if(route){route.call(this.rasterEngine,spiceMessage)}}});wdi.RasterEngine=$.spcExtend(wdi.EventObject.prototype,{init:function(c){this.clientGui=c.clientGui},drawCanvas:function(spiceMessage){return this.clientGui.drawCanvas(spiceMessage)},removeCanvas:function(spiceMessage){return this.clientGui.removeCanvas(spiceMessage)},invalList:function(spiceMessage){var items=spiceMessage.args.items;var item=null;for(var i in items){item=items[i];wdi.ImageCache.delImage(item.id)}},handleStreamCreate:function(spiceMessage){var stream=spiceMessage.args;stream.computedBox=wdi.graphics.getBoxFromSrcArea(stream.rect);wdi.Stream.addStream(spiceMessage.args.id,stream)},handleStreamData:function(spiceMessage){var imageData=spiceMessage.args.data;var stream=wdi.Stream.getStream(spiceMessage.args.id);var context=this.clientGui.getContext(stream.surface_id);var img=wdi.GlobalPool.create("Image");wdi.ExecutionControl.sync=true;var url;img.onload=function(){URL.revokeObjectURL(url);var box=stream.computedBox;if(!stream.flags&wdi.SpiceStreamFlags.SPICE_STREAM_FLAGS_TOP_DOWN){var offsetX=box.x+this.width/2;var offsetY=box.y+this.height/2;context.save();context.translate(offsetX,offsetY);context.rotate(Math.PI);context.scale(-1,1);context.drawImage(this,box.x-offsetX,box.y-offsetY,box.width,box.height);context.restore()}else{context.drawImage(this,box.x,box.y,box.width,box.height)}};img.onerror=function(){URL.revokeObjectURL(url)};url=wdi.SpiceObject.bytesToURI(imageData);img.src=url},handleStreamClip:function(spiceMessage){wdi.Stream.clip(spiceMessage.args.id,spiceMessage.args.clip)},handleStreamDestroy:function(spiceMessage){wdi.Stream.deleteStream(spiceMessage.args.id)},drawRop3:function(spiceMessage){var box=wdi.graphics.getBoxFromSrcArea(spiceMessage.args.base.box);var context=this.clientGui.getContext(spiceMessage.args.base.surface_id);var destImg=context.getImageData(box.x,box.y,box.width,box.height);var clientGui=this.clientGui;var brush=spiceMessage.args.brush;var rop=spiceMessage.args.rop_descriptor;var srcArea=wdi.graphics.getBoxFromSrcArea(spiceMessage.args.src_area);wdi.graphics.getImageFromSpice(spiceMessage.args.src_image.imageDescriptor,spiceMessage.args.src_image.data,this.clientGui,function(sourceCanvas){if(sourceCanvas){var sourceContext=sourceCanvas.getContext("2d");var srcImg=sourceContext.getImageData(srcArea.x,srcArea.y,srcArea.width,srcArea.height);var srcImgData=srcImg.data;var tmpcanvas=wdi.graphics.getNewTmpCanvas(box.width,box.height);var tmpcontext=tmpcanvas.getContext("2d");var brushBox={width:box.width,height:box.height,x:0,y:0};wdi.graphics.setBrush(clientGui,tmpcontext,brush,brushBox,wdi.SpiceRopd.SPICE_ROPD_OP_PUT);var pattern=tmpcontext.getImageData(0,0,box.width,box.height);var patImgData=pattern.data;var destImgData=destImg.data;tmpcanvas=wdi.graphics.getNewTmpCanvas(box.width,box.height);tmpcontext=tmpcanvas.getContext("2d");var result=tmpcontext.createImageData(box.width,box.height);var resultData=result.data;if(srcImg.width!=pattern.width||srcImg.width!=destImg.width||(srcImg.height!=pattern.height||srcImg.height!=destImg.height)){}var length=destImgData.length;var func=wdi.Rop3[rop];for(var i=0;i<length;i+=4){resultData[i]=func(patImgData[i],srcImgData[i],destImgData[i])&255;resultData[i+1]=func(patImgData[i+1],srcImgData[i+1],destImgData[i+1])&255;resultData[i+2]=func(patImgData[i+2],srcImgData[i+2],destImgData[i+2])&255;resultData[i+3]=255}tmpcontext.putImageData(result,0,0);this.drawClip(tmpcanvas,box,context)}else{wdi.Debug.log("Unable to get image!")}},this)},drawInvers:function(spiceMessage){var drawBase=spiceMessage.args.base;var box=wdi.graphics.getBoxFromSrcArea(drawBase.box);var surface_id=drawBase.surface_id;var context=this.clientGui.getContext(surface_id);var destImg=wdi.graphics.getRect(box,context.canvas);var imageData=wdi.RasterOperation.process(wdi.SpiceRopd.SPICE_ROPD_OP_INVERS,null,destImg);context.drawImage(imageData,box.x,box.y,box.width,box.height)},drawStroke:function(spiceMessage){var stroke=spiceMessage.args,context=this.clientGui.getContext(spiceMessage.args.base.surface_id),color=stroke.brush.color.html_color,lineWidth=1,pointsLength,firstPoint,i,j,length=stroke.path.num_segments,seg;if(stroke.attr.flags&wdi.SpiceLineFlags.SPICE_LINE_FLAGS_STYLED){wdi.Debug.log("SPICE_LINE_FLAGS_STYLED")}for(var i=0;i<length;i++){seg=stroke.path.segments[i];if(seg.flags&wdi.SpicePathFlags.SPICE_PATH_BEGIN){context.beginPath();context.moveTo(seg.points[0].x,seg.points[0].y);context.strokeStyle=color;context.lineWidth=lineWidth}if(seg.flags&wdi.SpicePathFlags.SPICE_PATH_BEZIER){pointsLength=seg.points.length;if(pointsLength%3==0){for(j=0;j<pointsLength;j+=3){context.bezierCurveTo(seg.points[j].x,seg.points[j].y,seg.points[j+1].x,seg.points[j+1].y,seg.points[j+2].x,seg.points[j+2].y)}}}else{pointsLength=seg.points.length;for(j=0;j<pointsLength;j++){if(j==0)firstPoint=seg.points[j];context.lineTo(seg.points[j].x+lineWidth/2,seg.points[j].y+lineWidth/2)}}if(seg.flags&wdi.SpicePathFlags.SPICE_PATH_END){if(seg.flags&wdi.SpicePathFlags.SPICE_PATH_CLOSE){context.lineTo(firstPoint.x+lineWidth/2,firstPoint.y+lineWidth/2)}context.stroke();context.closePath()}}},drawImage:function(spiceMessage){var args=spiceMessage.args;var drawBase=args.base;var surface_id=drawBase.surface_id;var rop=args.rop_descriptor;var scale=args.scale_mode;var box_origin=wdi.graphics.getBoxFromSrcArea(args.src_area);var box_dest=wdi.graphics.getBoxFromSrcArea(drawBase.box);if(rop===wdi.SpiceRopd.SPICE_ROPD_OP_PUT){var destImg=null}else{var destImg=wdi.graphics.getRect(box_dest,this.clientGui.getCanvas(surface_id))}if(window.vdiLoadTest&&window.firstImage===undefined){window.firstImage=true}wdi.graphics.getImageFromSpice(args.image.imageDescriptor,args.image.data,this.clientGui,function(srcImg){if(srcImg){if(window.firstImage){var data;if(srcImg.getContext){data=srcImg.getContext("2d").getImageData(0,0,srcImg.width,srcImg.height).data.buffer.slice(0)}else{data=srcImg.data.buffer.slice(0)}window.firstImageData=data;window.firstImage=false}srcImg=wdi.graphics.getRect(box_origin,srcImg);if(box_origin.width!==box_dest.width&&box_origin.height!==box_dest.height){srcImg=wdi.graphics.getImageFromData(srcImg);var newSrcImg=wdi.graphics.getNewTmpCanvas(box_dest.width,box_dest.height);var tmpcontext=newSrcImg.getContext("2d");tmpcontext.drawImage(srcImg,0,0,box_origin.width,box_origin.height,0,0,box_dest.width,box_dest.height);srcImg=newSrcImg}srcImg=wdi.RasterOperation.process(rop,srcImg,destImg);var context=this.clientGui.getContext(surface_id);if(args.base.clip.type===wdi.SpiceClipType.SPICE_CLIP_TYPE_RECTS){srcImg=wdi.graphics.getImageFromData(srcImg)}if(srcImg instanceof ImageData){context.putImageData(srcImg,box_dest.x,box_dest.y,0,0,box_dest.width,box_dest.height)}else{context.drawImage(srcImg,box_dest.x,box_dest.y,box_dest.width,box_dest.height)}}else{wdi.Debug.log("Unable to get image!")}},this,{opaque:true,brush:args.brush,raw:false})},drawClip:function(srcImg,box,context){context.drawImage(srcImg,box.x,box.y,box.width,box.height)},drawFill:function(spiceMessage){var args=spiceMessage.args;var context=this.clientGui.getContext(args.base.surface_id);var box=wdi.graphics.getBoxFromSrcArea(args.base.box);var brush=args.brush;var ropd=args.rop_descriptor;wdi.graphics.setBrush(this.clientGui,context,brush,box,ropd)},drawCopyBits:function(spiceMessage){var drawBase=spiceMessage.args.base;var surface_id=drawBase.surface_id;var src_position=spiceMessage.args.src_position;var context=this.clientGui.getContext(surface_id);var box=drawBase.box;var width=box.right-box.left;var height=box.bottom-box.top;context.drawImage(context.canvas,src_position.x,src_position.y,width,height,drawBase.box.left,drawBase.box.top,width,height)},drawBlend:function(spiceMessage){var descriptor=spiceMessage.args.image.imageDescriptor;var drawBase=spiceMessage.args.base;var imgData=spiceMessage.args.image.data;var surface_id=spiceMessage.args.base.surface_id;var rop_desc=spiceMessage.args.rop_descriptor;var flags=spiceMessage.args.flags;wdi.graphics.getImageFromSpice(descriptor,imgData,this.clientGui,function(srcImg){if(!srcImg){wdi.Debug.log("There is no image on Blend");return}var box=wdi.graphics.getBoxFromSrcArea(spiceMessage.args.src_area);srcImg=wdi.graphics.getRect(box,srcImg);var dest_box=wdi.graphics.getBoxFromSrcArea(drawBase.box);var destImg=wdi.graphics.getRect(dest_box,this.clientGui.getCanvas(surface_id));var result=wdi.RasterOperation.process(rop_desc,srcImg,destImg);this.clientGui.getCanvas(surface_id).getContext("2d").drawImage(result,dest_box.x,dest_box.y,dest_box.width,dest_box.height)},this)},drawAlphaBlend:function(spiceMessage){var descriptor=spiceMessage.args.image.imageDescriptor;var drawBase=spiceMessage.args.base;var imgData=spiceMessage.args.image.data;var surface_id=spiceMessage.args.base.surface_id;var flags=spiceMessage.args.alpha_flags;var alpha=spiceMessage.args.alpha;wdi.graphics.getImageFromSpice(descriptor,imgData,this.clientGui,function(srcImg){if(!srcImg){wdi.Debug.log("There is no image on drawAlphaBlend")}var box=wdi.graphics.getBoxFromSrcArea(spiceMessage.args.src_area);srcImg=wdi.graphics.getRect(box,srcImg);var box_dest=wdi.graphics.getBoxFromSrcArea(drawBase.box);var destImg=wdi.graphics.getRect(box_dest,this.clientGui.getCanvas(surface_id));if(box.width!==box_dest.width&&box.height!==box_dest.height){var tmpcanvas=wdi.graphics.getNewTmpCanvas(box_dest.width,box_dest.height);var tmpcontext=tmpcanvas.getContext("2d");tmpcontext.drawImage(srcImg,0,0,box.width,box.height,0,0,box_dest.width,box_dest.height);srcImg=tmpcanvas}var src=wdi.graphics.getDataFromImage(srcImg).data;var dst=wdi.graphics.getDataFromImage(destImg).data;var length=src.length-1;var imageResult=wdi.graphics.getNewTmpCanvas(box_dest.width,box_dest.height);var context=imageResult.getContext("2d");var resultImageData=context.createImageData(box_dest.width,box_dest.height);var result=resultImageData.data;var rS,rD;var gS,gD;var bS,bD;var aS;for(var px=0;px<length;px+=4){rS=src[px];gS=src[px+1];bS=src[px+2];if(flags||alpha===255){aS=src[px+3]}else{aS=alpha}rD=dst[px];gD=dst[px+1];bD=dst[px+2];if(aS>30&&alpha===255){result[px]=rD*(255-aS)/255+rS&255;result[px+1]=gD*(255-aS)/255+gS&255;result[px+2]=bD*(255-aS)/255+bS&255}else{result[px]=(rS*aS+rD*(255-aS))/255&255;result[px+1]=(gS*aS+gD*(255-aS))/255&255;result[px+2]=(bS*aS+bD*(255-aS))/255&255}result[px+3]=255}imageResult.getContext("2d").putImageData(resultImageData,0,0);this.drawClip(imageResult,box_dest,this.clientGui.getContext(surface_id))},this)},drawWhiteness:function(spiceMessage){var base=spiceMessage.args.base;var context=this.clientGui.getContext(base.surface_id);var box=wdi.graphics.getBoxFromSrcArea(base.box);context.fillStyle="white";context.fillRect(box.x,box.y,box.width,box.height)},drawBlackness:function(spiceMessage){var base=spiceMessage.args.base;var context=this.clientGui.getContext(base.surface_id);var box=wdi.graphics.getBoxFromSrcArea(base.box);context.fillStyle="black";context.fillRect(box.x,box.y,box.width,box.height)},drawTransparent:function(spiceMessage){var drawBase=spiceMessage.args.base;var surface_id=drawBase.surface_id;var box=wdi.graphics.getBoxFromSrcArea(spiceMessage.args.src_area);var dest_box=wdi.graphics.getBoxFromSrcArea(drawBase.box);var destImg=this.clientGui.getContext(surface_id).getImageData(dest_box.x,dest_box.y,dest_box.width,dest_box.height);wdi.graphics.getImageFromSpice(spiceMessage.args.image.imageDescriptor,spiceMessage.args.image.data,this.clientGui,function(srcImg){if(srcImg){srcImg=wdi.graphics.getRect(box,srcImg);var source=wdi.graphics.getDataFromImage(srcImg).data;var dest=destImg.data;var length=source.length-1;var resultImageData=this.clientGui.getContext(surface_id).createImageData(dest_box.width,dest_box.height);var color=spiceMessage.args.transparent_true_color;while(length>0){resultImageData.data[length]=255;if(source[length-1]===color.b&&source[length-2]===color.g&&source[length-3]===color.r){resultImageData.data[length-1]=dest[length-1];resultImageData.data[length-2]=dest[length-2];resultImageData.data[length-3]=dest[length-3]}else{resultImageData.data[length-1]=source[length-1];resultImageData.data[length-2]=source[length-2];resultImageData.data[length-3]=source[length-3]}length-=4}var resultImage=wdi.graphics.getImageFromData(resultImageData);this.drawClip(resultImage,dest_box,this.clientGui.getContext(surface_id))}else{wdi.Debug.log("Unable to get image!")}},this)},drawText:function(spiceMessage){var context=this.clientGui.getContext(spiceMessage.args.base.surface_id);var bbox=spiceMessage.args.base.box;var clip=spiceMessage.args.base.clip;var text=spiceMessage.args;var string=text.glyph_string;var bpp=string.flags===1?1:string.flags*2;if(text.back_mode!==0){wdi.graphics.drawBackText(this.clientGui,context,text)}wdi.graphics.drawString(context,string,bpp,text.fore_brush,clip.type,this)},invalPalettes:function(spiceMessage){wdi.ImageCache.clearPalettes()}});wdi.DataLogger={testStartTime:0,testStopTime:0,networkStart:0,networkTotalTime:0,data:{},routeList:{},imageTypes:{},startTimes:[],init:function(){this.routeList[wdi.SpiceVars.SPICE_MSG_DISPLAY_SURFACE_CREATE]="drawCanvas";this.routeList[wdi.SpiceVars.SPICE_MSG_DISPLAY_SURFACE_DESTROY]="removeCanvas";this.routeList[wdi.SpiceVars.SPICE_MSG_DISPLAY_DRAW_COPY]="drawImage";this.routeList[wdi.SpiceVars.SPICE_MSG_DISPLAY_DRAW_FILL]="drawFill";this.routeList[wdi.SpiceVars.SPICE_MSG_DISPLAY_DRAW_ALPHA_BLEND]="drawAlphaBlend";this.routeList[wdi.SpiceVars.SPICE_MSG_DISPLAY_DRAW_WHITENESS]="drawWhiteness";this.routeList[wdi.SpiceVars.SPICE_MSG_DISPLAY_DRAW_BLACKNESS]="drawBlackness";this.routeList[wdi.SpiceVars.SPICE_MSG_DISPLAY_DRAW_TRANSPARENT]="drawTransparent";this.routeList[wdi.SpiceVars.SPICE_MSG_DISPLAY_COPY_BITS]="drawCopyBits";this.routeList[wdi.SpiceVars.SPICE_MSG_DISPLAY_DRAW_TEXT]="drawText";this.routeList[wdi.SpiceVars.SPICE_MSG_DISPLAY_DRAW_STROKE]="drawStroke";this.routeList[wdi.SpiceVars.SPICE_MSG_DISPLAY_DRAW_ROP3]="drawRop3";this.routeList[wdi.SpiceVars.SPICE_MSG_DISPLAY_DRAW_INVERS]="drawInvers";this.routeList[wdi.SpiceVars.SPICE_MSG_DISPLAY_STREAM_CREATE]="handleStreamCreate";this.routeList[wdi.SpiceVars.SPICE_MSG_DISPLAY_STREAM_DESTROY]="handleStreamDestroy";this.routeList[wdi.SpiceVars.SPICE_MSG_DISPLAY_STREAM_DATA]="handleStreamData";this.routeList[wdi.SpiceVars.SPICE_MSG_DISPLAY_STREAM_CLIP]="handleStreamClip";this.routeList[wdi.SpiceVars.SPICE_MSG_DISPLAY_DRAW_BLEND]="drawBlend";this.routeList[wdi.SpiceVars.SPICE_MSG_DISPLAY_INVAL_LIST]="invalList";this.routeList[wdi.SpiceVars.SPICE_MSG_DISPLAY_INVAL_ALL_PALETTES]="invalPalettes";this.routeList[wdi.SpiceVars.SPICE_MSG_DISPLAY_MARK]="displayMark";this.routeList[wdi.SpiceVars.SPICE_MSG_DISPLAY_RESET]="displayReset";this.imageTypes[wdi.SpiceImageType.SPICE_IMAGE_TYPE_BITMAP]="bitmap";this.imageTypes[wdi.SpiceImageType.SPICE_IMAGE_TYPE_QUIC]="quic";this.imageTypes[wdi.SpiceImageType.SPICE_IMAGE_TYPE_RESERVED]="reserved";this.imageTypes[wdi.SpiceImageType.SPICE_IMAGE_TYPE_PNG]="png";this.imageTypes[wdi.SpiceImageType.SPICE_IMAGE_TYPE_LZ_PLT]="lz_plt";this.imageTypes[wdi.SpiceImageType.SPICE_IMAGE_TYPE_LZ_RGB]="lz_rgb";this.imageTypes[wdi.SpiceImageType.SPICE_IMAGE_TYPE_GLZ_RGB]="glz_rgb";this.imageTypes[wdi.SpiceImageType.SPICE_IMAGE_TYPE_FROM_CACHE]="cache";this.imageTypes[wdi.SpiceImageType.SPICE_IMAGE_TYPE_SURFACE]="surface";this.imageTypes[wdi.SpiceImageType.SPICE_IMAGE_TYPE_JPEG]="jpeg";this.imageTypes[wdi.SpiceImageType.SPICE_IMAGE_TYPE_FROM_CACHE_LOSSLESS]="cache_lossless";this.imageTypes[wdi.SpiceImageType.SPICE_IMAGE_TYPE_ZLIB_GLZ_RGB]="zlib_glz_rgb";
this.imageTypes[wdi.SpiceImageType.SPICE_IMAGE_TYPE_JPEG_ALPHA]="jpeg_alpha";this.imageTypes[wdi.SpiceImageType.SPICE_IMAGE_TYPE_CANVAS]="canvas"},setStartTime:function(time){this.startTimes.push(time)},getSpiceMessageType:function(spiceMessage,prepend,append){var type=this.routeList[spiceMessage.messageType];if(type==="drawImage"){type+="_"+this.imageTypes[spiceMessage.args.image.imageDescriptor.type]}return(prepend||"")+type+(append||"")},setNetworkTimeStart:function(time){this.networkStart=this.networkStart||time||Date.now()},logNetworkTime:function(){if(this.networkStart){this.networkTotalTime+=Date.now()-this.networkStart;this.networkStart=0}},startTestSession:function(){this.clear();wdi.logOperations=true;this.testStartTime=Date.now()},stopTestSession:function(){this.testStopTime=Date.now();wdi.logOperations=false},log:function(spiceMessage,start,customType,useTimeQueue,prepend,append){var end=Date.now();var type;if(customType){type=customType}else{type=this.getSpiceMessageType(spiceMessage,prepend,append)}if(!this.data.hasOwnProperty(type)){this.data[type]=[]}if(useTimeQueue){start=this.startTimes.shift()}this.data[type].push({start:start,end:end})},clear:function(){this.data={};this.testStartTime=0;this.testStopTime=0;this.networkTotalTime=0;this.networkStart=0},getData:function(){return this.data},getStats:function(){var networkTime=this.networkTotalTime;var numOperations=0;var totalTimeSpent=networkTime;var totalTime=this.testStopTime-this.testStartTime;var dataSource=this.data;var partialTimes={};var result="";var data;for(var i in this.data){if(this.data.hasOwnProperty(i)){data=dataSource[i];numOperations+=data.length;partialTimes[i]=0;for(var x=0;x<data.length;x++){partialTimes[i]+=data[x].end-data[x].start}totalTimeSpent+=partialTimes[i]}}result+="Total operations by number:\n";var partial=0;for(var i in dataSource){if(dataSource.hasOwnProperty(i)){partial=dataSource[i].length/numOperations*100;result+=i+": "+~~partial+"% ("+dataSource[i].length+")\n"}}result+="Total numOperations: "+numOperations+"\n";result+="---------------------------------\n";result+="\n";result+="Total Operations by time:\n";for(i in partialTimes){if(partialTimes.hasOwnProperty(i)){partial=partialTimes[i]/totalTime*100;result+=i+": "+~~partial+"% ("+partialTimes[i]+"ms)\n"}}var idleTime=totalTime-totalTimeSpent;partial=idleTime/totalTime*100;result+="Idle: "+~~partial+"% ("+idleTime+"ms)\n";partial=networkTime/totalTime*100;result+="Network: "+~~partial+"% ("+networkTime+"ms)\n";result+="Total time: "+totalTime+"ms \n";return"BEGIN OF PERFORMANCE STATS\n"+result+"\nEND OF PERFORMANCE STATS\n"}};wdi.DataLogger.init();wdi.socketStatus={idle:0,prepared:1,connected:2,disconnected:3,failed:4};wdi.Socket=$.spcExtend(wdi.EventObject.prototype,{websocket:null,status:wdi.socketStatus.idle,binary:false,connect:function(uri){var self=this;var protocol="base64";if(Modernizr["websocketsbinary"]){protocol="binary";this.binary=true}this.websocket=new WebSocket(uri,protocol);wdi.Debug.log("Socket: using protocol: "+protocol);if(this.binary){this.websocket.binaryType="arraybuffer"}this.status=wdi.socketStatus.prepared;this.websocket.onopen=function(){self.status=wdi.socketStatus.connected;self.fire("open")};this.websocket.onmessage=function(e){self.fire("message",e.data)};this.websocket.onclose=function(e){self.status=wdi.socketStatus.disconnected;console.warn("Spice Web Client: ",e.code,e.reason);self.disconnect();self.fire("error",e)};this.websocket.onerror=function(e){self.status=wdi.socketStatus.failed;self.fire("error",e)}},setOnMessageCallback:function(callback){this.websocket.onmessage=callback},send:function(message){try{this.websocket.send(this.encode_message(message))}catch(err){this.status=wdi.socketStatus.failed;this.fire("error",err)}},disconnect:function(){if(this.websocket){this.websocket.onopen=function(){};this.websocket.onmessage=function(){};this.websocket.onclose=function(){};this.websocket.onerror=function(){};this.websocket.close();this.websocket=null}},setStatus:function(status){this.status=status;this.fire("status",status)},getStatus:function(){return this.status},encode_message:function(mess){if(!this.binary){var arr=Base64.encode(mess);return arr}var len=mess.length;var buffer=new ArrayBuffer(len);var u8=new Uint8Array(buffer);u8.set(mess);return u8}});wdi.ClusterNodeChooser=$.spcExtend(wdi.EventObject.prototype,{init:function(c){},setNodeList:function(nodeList){this._nodeList=this._shuffle(nodeList);this._nodeListLength=this._nodeList.length;this._currentIndex=0},getAnother:function(){var toReturn=this._nodeList[this._currentIndex++%this._nodeListLength];return toReturn},_shuffle:function(list){var counter=list.length,temp,index;while(counter>0){index=Math.floor(Math.random()*counter);counter--;temp=list[counter];list[counter]=list[index];list[index]=temp}return list}});wdi.SocketQueue=$.spcExtend(wdi.EventObject.prototype,{rQ:null,sQ:null,socket:null,init:function(c){this.superInit();this.socket=c.socket||new wdi.Socket;this.rQ=c.rQ||new wdi.FixedQueue;this.sQ=c.sQ||new wdi.Queue;this.setup()},setup:function(){this.socket.addListener("open",function(){this.fire("open")},this);this.socket.addListener("message",function(data){this.rQ.push(new Uint8Array(data));this.fire("message")},this);this.socket.addListener("close",function(e){this.fire("close",e)},this);this.socket.addListener("error",function(e){this.fire("error",e)},this)},getStatus:function(){return this.socket.getStatus()},connect:function(uri){this.socket.connect(uri)},disconnect:function(){this.socket.disconnect()},send:function(data,shouldFlush){if(shouldFlush===undefined){var flush=true}else{var flush=shouldFlush}if(this.sQ.getLength()==0&&flush){this.socket.send(data);return}this.sQ.push(data);if(flush)this.flush()},flush:function(){var data=this.sQ.shift();this.socket.send(data)}});wdi.PacketController=$.spcExtend(wdi.EventObject.prototype,{sizeDefiner:null,packetExtractor:null,init:function(c){this.superInit();this.sizeDefiner=c.sizeDefiner;this.packetExtractor=c.packetExtractor},getNextPacket:function(data){var self=this;if(wdi.logOperations){wdi.DataLogger.setNetworkTimeStart()}var size=this.sizeDefiner.getSize(data);this.packetExtractor.getBytes(size,function(bytes){var status=this.sizeDefiner.getStatus();this.execute(new wdi.RawMessage({status:status,data:bytes}));self.getNextPacket(bytes)},this)},execute:function(message){try{this.fire("chunkComplete",message)}catch(e){console.error("PacketTroller: ",e)}}});wdi.PacketExtractor=$.spcExtend(wdi.EventObject.prototype,{socketQ:null,numBytes:null,callback:null,scope:null,init:function(c){this.superInit();this.socketQ=c.socketQ;this.setListener()},setListener:function(){this.socketQ.addListener("message",function(){if(wdi.logOperations){wdi.DataLogger.setNetworkTimeStart()}this.getBytes(this.numBytes,this.callback,this.scope)},this)},getBytes:function(numBytes,callback,scope){var retLength=this.socketQ.rQ.getLength();this.numBytes=numBytes;this.callback=callback;this.scope=scope;if(numBytes!==null&&retLength>=numBytes){var ret;if(numBytes){ret=this.socketQ.rQ.shift(numBytes)}else{ret=new Uint8Array(0)}this.numBytes=null;this.callback=null;this.scope=null;callback.call(scope,ret)}else{if(wdi.logOperations){wdi.DataLogger.logNetworkTime()}}}});wdi.PacketReassembler=$.spcExtend(wdi.EventObject.prototype,{packetController:null,currentHeader:null,statusToString:null,sizeDefinerConstant:null,init:function(c){this.superInit();this.packetController=c.packetController;this.sizeDefinerConstant=wdi.SizeDefiner.prototype;this.statusToString=[];this.statusToString[this.sizeDefinerConstant.STATUS_REPLY_BODY]="reply";this.statusToString[this.sizeDefinerConstant.STATUS_ERROR_CODE]="errorCode";this.statusToString[this.sizeDefinerConstant.STATUS_BODY]="spicePacket";this.setListeners()},start:function(){this.packetController.getNextPacket()},setListeners:function(){this.packetController.addListener("chunkComplete",function(e){var rawMessage=e;var status=rawMessage.status;switch(status){case this.sizeDefinerConstant.STATUS_HEADER:case this.sizeDefinerConstant.STATUS_REPLY:this.currentHeader=rawMessage;break;case this.sizeDefinerConstant.STATUS_REPLY_BODY:case this.sizeDefinerConstant.STATUS_BODY:var tmpBuff=new Uint8Array(rawMessage.data.length+this.currentHeader.data.length);tmpBuff.set(this.currentHeader.data);tmpBuff.set(rawMessage.data,this.currentHeader.data.length);rawMessage.data=tmpBuff;rawMessage.status=this.statusToString[status];this.fire("packetComplete",rawMessage);break;default:rawMessage.status=this.statusToString[status];this.fire("packetComplete",rawMessage);break}},this)}});wdi.ReassemblerFactory={getPacketReassembler:function(socketQ){var pE=this.getPacketExtractor(socketQ);var sD=this.getSizeDefiner();var pC=this.getPacketController(pE,sD);return new wdi.PacketReassembler({packetController:pC})},getPacketExtractor:function(socketQ){return new wdi.PacketExtractor({socketQ:socketQ})},getSizeDefiner:function(){return new wdi.SizeDefiner},getPacketController:function(packetExtractor,sizeDefiner){return new wdi.PacketController({packetExtractor:packetExtractor,sizeDefiner:sizeDefiner})}};wdi.SizeDefiner=$.spcExtend(wdi.DomainObject,{ERROR_CODE_SIZE:4,status:null,STATUS_READY:0,STATUS_REPLY:1,STATUS_REPLY_BODY:2,STATUS_ERROR_CODE:3,STATUS_MESSAGE:4,STATUS_HEADER:5,STATUS_BODY:6,isHeader:false,init:function(c){this.status=this.STATUS_READY},getSize:function(arr){if(this.STATUS_READY===this.status){this.status++;return wdi.SpiceLinkHeader.prototype.objectSize}else if(this.STATUS_REPLY===this.status){this.status++;return this.getReplyBodySize(arr)}else if(this.STATUS_REPLY_BODY===this.status){this.status++;return this.ERROR_CODE_SIZE}else if(this.STATUS_ERROR_CODE===this.status){this.status++;this.isHeader=true;return 6}else{if(this.isHeader){this.isHeader=false;return this.getBodySizeFromArrayHeader(arr)}else{this.isHeader=true;return 6}}},getReplyBodySize:function(arr){var queue=wdi.GlobalPool.create("ViewQueue");queue.setData(arr);var header=(new wdi.SpiceLinkHeader).demarshall(queue);wdi.GlobalPool.discard("ViewQueue",queue);return header.size},getBodySizeFromArrayHeader:function(arr){var queue=wdi.GlobalPool.create("ViewQueue");queue.setData(arr);var header=(new wdi.SpiceDataHeader).demarshall(queue);wdi.GlobalPool.discard("ViewQueue",queue);return header.size},getStatus:function(){if(this.status===this.STATUS_MESSAGE&&this.isHeader){return this.STATUS_HEADER}else if(this.status===this.STATUS_MESSAGE&&!this.isHeader){return this.STATUS_BODY}else{return this.status}}});wdi.PacketLinkFactory={extract:function(header,queue){switch(header.type){case wdi.SpiceVars.SPICE_MSG_SET_ACK:return(new wdi.RedSetAck).demarshall(queue);case wdi.SpiceVars.SPICE_MSG_PING:return(new wdi.RedPing).demarshall(queue,header.size);case wdi.SpiceVars.SPICE_MSG_MIGRATE:return(new wdi.RedMigrate).demarshall(queue);case wdi.SpiceVars.SPICE_MSG_MIGRATE_DATA:return(new wdi.RedMigrateData).demarshall(queue,header.size);case wdi.SpiceVars.SPICE_MSG_WAIT_FOR_CHANNELS:return(new wdi.RedWaitForChannels).demarshall(queue);case wdi.SpiceVars.SPICE_MSG_DISCONNECTING:return(new wdi.RedDisconnect).demarshall(queue);case wdi.SpiceVars.SPICE_MSG_NOTIFY:var packet=(new wdi.RedNotify).demarshall(queue);return packet;case wdi.SpiceVars.SPICE_MSG_MAIN_MOUSE_MODE:return(new wdi.SpiceMouseMode).demarshall(queue)}}};wdi.PacketLinkProcess={process:function(header,packet,channel){switch(header.type){case wdi.SpiceVars.SPICE_MSG_SET_ACK:var body=wdi.SpiceObject.numberTo32(packet.generation);channel.setAckWindow(packet.window);channel.sendObject(body,wdi.SpiceVars.SPICE_MSGC_ACK_SYNC);break;case wdi.SpiceVars.SPICE_MSG_PING:var body=new wdi.RedPing({id:packet.id,time:packet.time}).marshall();channel.sendObject(body,wdi.SpiceVars.SPICE_MSGC_PONG);break;case wdi.SpiceVars.SPICE_MSG_MAIN_MOUSE_MODE:channel.fire("mouseMode",packet.current_mode);break;case wdi.SpiceVars.SPICE_MSG_NOTIFY:channel.fire("notify");break}}};wdi.SpiceChannel=$.spcExtend(wdi.EventObject.prototype,{counter:0,ackWindow:0,connectionId:0,socketQ:null,packetReassembler:null,channel:1,proxy:null,token:null,init:function(c){this.superInit();this.socketQ=c.socketQ||new wdi.SocketQueue;this.packetReassembler=c.packetReassembler||wdi.ReassemblerFactory.getPacketReassembler(this.socketQ);this.setListeners();this.ackWindow=0},setListeners:function(){var date;this.packetReassembler.addListener("packetComplete",function(e){var rawMessage=e;if(rawMessage.status==="spicePacket"){if(wdi.logOperations){wdi.DataLogger.logNetworkTime();date=Date.now()}var rsm=this.getRawSpiceMessage(rawMessage.data);if(rsm){if(wdi.logOperations&&rsm.channel===wdi.SpiceVars.SPICE_CHANNEL_DISPLAY){wdi.DataLogger.setStartTime(date)}this.fire("message",rsm)}}else if(rawMessage.status==="reply"){var packet=this.getRedLinkReplyBytes(rawMessage.data);this.send(packet)}else if(rawMessage.status==="errorCode"){var packet=this.getErrorCodeBytes(rawMessage.data);if(packet){this.send(packet)}this.fire("channelConnected")}},this);this.socketQ.addListener("open",function(){var packet=this.getRedLinkMessBytes();this.send(packet);this.proxy?this.proxy.end():false},this);this.socketQ.addListener("close",function(e){if(this.channel===1){this.fire("error",e)}this.socketQ.disconnect()},this);this.socketQ.addListener("error",function(){this.fire("error",3);this.socketQ.disconnect()},this)},connect:function(connectionInfo,channel,connectionId,proxy){var url=wdi.Utils.generateWebSocketUrl(connectionInfo.protocol,connectionInfo.host,connectionInfo.port,connectionInfo.vmHost,connectionInfo.vmPort,"spice",connectionInfo.vmInfoToken);this.channel=channel;this.connectionId=connectionId||0;this.socketQ.connect(url);this.proxy=proxy;this.token=connectionInfo.token;this.packetReassembler.start()},disconnect:function(){this.socketQ.disconnect()},send:function(data,flush){this.socketQ.send(data,flush)},sendObject:function(data,type,flush){var packet=new wdi.SpiceDataHeader({type:type,size:data.length}).marshall();packet=packet.concat(data);this.send(packet,flush)},setAckWindow:function(window){this.ackWindow=window;this.counter=0},getRawSpiceMessage:function(rawData){var headerQueue=wdi.GlobalPool.create("ViewQueue");var body=wdi.GlobalPool.create("ViewQueue");var header=new Uint8Array(rawData,0,wdi.SpiceDataHeader.prototype.objectSize);headerQueue.setData(header);var headerObj=(new wdi.SpiceDataHeader).demarshall(headerQueue);wdi.GlobalPool.discard("ViewQueue",headerQueue);var rawBody=rawData.subarray(wdi.SpiceDataHeader.prototype.objectSize);body.setData(rawBody);this.counter++;if(this.ackWindow&&this.counter===this.ackWindow){this.counter=0;var ack=new wdi.SpiceDataHeader({type:wdi.SpiceVars.SPICE_MSGC_ACK,size:0}).marshall();this.send(ack)}var packet=wdi.PacketLinkFactory.extract(headerObj,body)||false;if(packet){wdi.PacketLinkProcess.process(headerObj,packet,this);wdi.GlobalPool.discard("ViewQueue",body);return false}else{var rawSpiceMessage=wdi.GlobalPool.create("RawSpiceMessage");rawSpiceMessage.set(headerObj,body,this.channel);return rawSpiceMessage}},getRedLinkReplyBytes:function(data){if(this.token){var newq=new wdi.ViewQueue;newq.setData(data);newq.eatBytes(wdi.SpiceLinkHeader.prototype.objectSize);var myBody=(new wdi.SpiceLinkReply).demarshall(newq);var key=wdi.SpiceObject.stringHexToBytes(RSA_public_encrypt(this.token,myBody.pub_key));return key}else{return wdi.SpiceObject.stringToBytesPadding("",128)}},getRedLinkMessBytes:function(){var header=new wdi.SpiceLinkHeader({magic:1363428690,major_version:2,minor_version:2,size:22}).marshall();var body=new wdi.SpiceLinkMess({connection_id:this.connectionId,channel_type:this.channel,caps_offset:18,num_common_caps:1,common_caps:1<<wdi.SpiceVars.SPICE_COMMON_CAP_MINI_HEADER}).marshall();return header.concat(body)},getErrorCodeBytes:function(data){var errorQ=wdi.GlobalPool.create("ViewQueue");errorQ.setData(data);var errorCode=wdi.SpiceObject.bytesToInt32NoAllocate(errorQ);wdi.GlobalPool.discard("ViewQueue",errorQ);if(errorCode===0){if(this.channel===wdi.SpiceVars.SPICE_CHANNEL_DISPLAY){var redDisplayInit=new wdi.SpiceDataHeader({type:wdi.SpiceVars.SPICE_MSGC_DISPLAY_INIT,size:14}).marshall();var cache_size=0*1024*1024;var body=new wdi.SpiceCDisplayInit({pixmap_cache_id:1,pixmap_cache_size:cache_size,glz_dictionary_id:0,glz_dictionary_window_size:1}).marshall();return redDisplayInit.concat(body)}else if(this.channel==wdi.SpiceVars.SPICE_CHANNEL_MAIN){return new wdi.SpiceDataHeader({type:wdi.SpiceVars.SPICE_MSGC_MAIN_ATTACH_CHANNELS,size:0}).marshall()}}else{throw new wdi.Exception({message:"Server refused client",errorCode:2})}}});wdi.BusConnection=$.spcExtend(wdi.EventObject.prototype,{ws:null,subscriptions:[],_busUser:null,_busPass:null,fileServerBaseUrl:null,queue:"",binary:false,init:function(c){this.superInit();this.ws=c.websocket||new wdi.WebSocketWrapper;this.clusterNodeChooser=c.clusterNodeChooser||new wdi.ClusterNodeChooser;this.binary=c.binary||false},connect:function(c){if(!c["useBus"]){wdi.Debug.warn("Not using the bus");return}this._vdiBusToken=c["vdiBusToken"];if(!c["busHostList"]){wdi.Debug.warn("Deprecated: using old busHost & busPort params");c["busHostList"]=[{host:c["busHost"],port:c["busPort"]}]}this.clusterNodeChooser.setNodeList(c["busHostList"]);if(Modernizr["websocketsbinary"]){this.binary=true}this._busUser=c["busUser"];this._busPass=c["busPass"];this._websockifyProtocol=c["protocol"];this._websockifyHost=c["host"];this._websockifyPort=c["port"];this.fileServerBaseUrl=c["busFileServerBaseUrl"];this.subscriptions=c["busSubscriptions"];this._connectToNextHost()},_connectToNextHost:function(){var busData=this.clusterNodeChooser.getAnother();var url=wdi.Utils.generateWebSocketUrl(this._websockifyProtocol,this._websockifyHost,this._websockifyPort,busData.host,busData.port,"raw",this._vdiBusToken);var websocketProtocol="base64";if(this.binary){websocketProtocol="binary"}this.ws.connect(url,websocketProtocol);wdi.Debug.log("BusConnection: using protocol: "+websocketProtocol);if(this.binary){this.ws.setBinaryType("arraybuffer")}this.setListeners()},disconnect:function(){this.ws.close()},setListeners:function(){var self=this;this.ws.onOpen(function(e){self._send("CONNECT\nlogin:"+self._busUser+"\npasscode:"+self._busPass+"\n\n\x00")});this.ws.onMessage(function(e){var message;var result;if(!self.binary){message=Base64.decodeStr(e.data)}else{message=String.fromCharCode.apply(null,new Uint8Array(e.data));message=decodeURIComponent(escape(message))}var subChunks=message.split("\x00");if(subChunks.length==1){self.queue+=subChunks[0]}else{for(var i=0;i<subChunks.length-1;i++){message=self.queue+subChunks[i];result=self.parseMessage(message);self.fire("busMessage",result);self.queue=""}self.queue=subChunks[subChunks.length-1]}});this.ws.onClose(function(e){wdi.Debug.log("BusConnection CLOSED! connecting again in 1 second");self.fire("error",e)});this.ws.onError(function(e){wdi.Debug.error("BusConnection ERROR:",e)})},parseMessage:function(message){try{var arr=message.split("\n\n");var header=arr[0].trim();var body=arr[1].replace(/\x00/,"").trim();if(body.length!=0){body=JSON.parse(body)}else{body=null}arr=header.split("\n");var verb=arr.shift();header="{";var len=arr.length;for(var i=0;i<len;i++){var headerName=arr[i].split(":")[0];header+='"'+headerName+'":"'+arr[i].replace(headerName+":","")+'"';if(i!=len-1){header+=","}}header+="}";return{verb:verb,header:JSON.parse(header),body:body}}catch(e){wdi.Debug.error("Error parsing Bus Info: ",e);return{verb:"ERROR"}}},setSubscriptions:function(){var len=this.subscriptions.length;for(var i=0;i<len;i++){this.subscribe(this.subscriptions[i])}},send:function(message){var destination=this.subscriptions[0];this._send("SEND\ndestination:"+destination+"\ncontent-type:text/plain\n\n"+JSON.stringify(message)+"\x00")},subscribe:function(destination){this._send("SUBSCRIBE\ndestination:"+destination+"\n\n\x00")},_send:function(message){if(!this.binary){this.ws.send(Base64.encodeStr(message))}else{this.ws.send(message)}}});wdi.WebSocketWrapper=$.spcExtend({},{ws:{},onopen:null,onmessage:null,onclose:null,onerror:null,init:function(){},connect:function(url,protocol){this.ws=new WebSocket(url,protocol)},onOpen:function(callback){this.ws.onopen=callback},onMessage:function(callback){this.ws.onmessage=callback},onClose:function(callback){this.ws.onclose=callback},onError:function(callback){this.ws.onerror=callback},setBinaryType:function(type){this.ws.binaryType=type},close:function(){if(!this.ws||!this.ws.close){return}this.ws.close();this.ws.onopen=function(){};this.ws.onmessage=function(){};this.ws.onclose=function(){};this.ws.onerror=function(){};this.onopen=function(){};this.onmessage=function(){};this.onclose=function(){};this.onerror=function(){}},send:function(message){this.ws.send(message)}});wdi.ConnectionControl=$.spcExtend(wdi.EventObject.prototype,{socket:null,pendingTimeToConnectionLost:null,previousTimeOut:null,init:function(c){this.superInit();this.socket=c.socket||new wdi.Socket},connect:function(c){var url=wdi.Utils.generateWebSocketUrl(c.protocol,c.host,c.port,null,null,"raw",c.heartbeatToken);this.socket.connect(url);this.pendingTimeToConnectionLost=c.heartbeatTimeout;wdi.Debug.log("ConnectionControl: connected");this.setListeners()},disconnect:function(){if(this.previousTimeOut){clearTimeout(this.previousTimeOut)}this.socket.disconnect()},setListeners:function(){var self=this;this.socket.setOnMessageCallback(function(e){wdi.Debug.log("ConectionControl: beat");clearTimeout(self.previousTimeOut);self.previousTimeOut=setTimeout(function(){wdi.Debug.log("ConnectionControl: firing connectionLost event");self.fire("connectionLost",e)},self.pendingTimeToConnectionLost)})}});wdi.Agent=$.spcExtend(wdi.EventObject.prototype,{clientTokens:null,serverTokens:10,app:null,clipboardContent:null,clipboardGrabbed:false,clipboardRequestReceived:false,clipboardPending:false,clipboardEnabled:true,windows:null,init:function(c){this.superInit();this.app=c.app},sendInitMessage:function(){var packet=new wdi.SpiceMessage({messageType:wdi.SpiceVars.SPICE_MSGC_MAIN_AGENT_START,channel:wdi.SpiceVars.SPICE_CHANNEL_MAIN,args:new wdi.SpiceMsgMainAgentTokens({num_tokens:this.serverTokens})});this.app.spiceConnection.send(packet);var mycaps=1<<wdi.AgentCaps.VD_AGENT_CAP_MONITORS_CONFIG;if(this.clipboardEnabled){mycaps=mycaps|1<<wdi.AgentCaps.VD_AGENT_CAP_CLIPBOARD_BY_DEMAND}packet=new wdi.SpiceMessage({messageType:wdi.SpiceVars.SPICE_MSGC_MAIN_AGENT_DATA,channel:wdi.SpiceVars.SPICE_CHANNEL_MAIN,args:new wdi.VDAgentMessage({protocol:1,type:wdi.AgentMessageTypes.VD_AGENT_ANNOUNCE_CAPABILITIES,opaque:0,data:new wdi.VDAgentAnnounceCapabilities({request:0,caps:mycaps})})});this.sendAgentPacket(packet)},setResolution:function(width,height){if(width<800){width=800}if(height<600){height=600}var packet=new wdi.SpiceMessage({messageType:wdi.SpiceVars.SPICE_MSGC_MAIN_AGENT_DATA,channel:wdi.SpiceVars.SPICE_CHANNEL_MAIN,args:new wdi.VDAgentMessage({protocol:1,type:wdi.AgentMessageTypes.VD_AGENT_MONITORS_CONFIG,opaque:0,data:new wdi.VDAgentMonitorsConfig({num_of_monitors:1,flags:0,data:new wdi.VDAgentMonConfig({width:width,height:height,depth:32,x:0,y:0})})})});this.sendAgentPacket(packet)},setClientTokens:function(tokens){this.clientTokens=tokens},sendAgentPacket:function(packet){this.clientTokens--;this.app.spiceConnection.send(packet)},onAgentData:function(packet){this.serverTokens--;if(this.serverTokens==0){packet=new wdi.SpiceMessage({messageType:wdi.SpiceVars.SPICE_MSGC_MAIN_AGENT_TOKEN,channel:wdi.SpiceVars.SPICE_CHANNEL_MAIN,args:new wdi.SpiceMsgMainAgentTokens({num_tokens:10})});this.app.spiceConnection.send(packet);this.serverTokens=10}if(packet.type==wdi.AgentMessageTypes.VD_AGENT_ANNOUNCE_CAPABILITIES){}else if(packet.type==wdi.AgentMessageTypes.VD_AGENT_CLIPBOARD_GRAB){if(packet.clipboardType==wdi.ClipBoardTypes.VD_AGENT_CLIPBOARD_UTF8_TEXT){var packet=new wdi.SpiceMessage({messageType:wdi.SpiceVars.SPICE_MSGC_MAIN_AGENT_DATA,channel:wdi.SpiceVars.SPICE_CHANNEL_MAIN,args:new wdi.VDAgentMessage({protocol:1,type:wdi.AgentMessageTypes.VD_AGENT_CLIPBOARD_REQUEST,opaque:0,data:new wdi.VDAgentClipboardRequest({type:wdi.ClipBoardTypes.VD_AGENT_CLIPBOARD_UTF8_TEXT})})});this.sendAgentPacket(packet)}}else if(packet.type==wdi.AgentMessageTypes.VD_AGENT_CLIPBOARD){this.fire("clipBoardData",packet.clipboardData)}else if(packet.type==wdi.AgentMessageTypes.VD_AGENT_CLIPBOARD_REQUEST){this.clipboardRequestReceived=true;if(this.clipboardPending){this.clipboardPending=false;this.sendPaste()}}else if(packet.type==wdi.AgentMessageTypes.VD_AGENT_CLIPBOARD_RELEASE){this.clipboardGrabbed=false;this.clipboardRequestReceived=false}else if(packet.type==wdi.AgentMessageTypes.VD_AGENT_REPLY){}else{console.log("agent ?",packet.type)}},setClipboard:function(text){if(text!=this.clipboardContent){this.clipboardContent=text;this.sendGrab();this.sendPaste()}this.app.sendShortcut(wdi.keyShortcutsHandled.CTRLV)},sendGrab:function(){if(!this.clipboardGrabbed){var packet=new wdi.SpiceMessage({messageType:wdi.SpiceVars.SPICE_MSGC_MAIN_AGENT_DATA,channel:wdi.SpiceVars.SPICE_CHANNEL_MAIN,args:new wdi.VDAgentMessage({protocol:1,type:wdi.AgentMessageTypes.VD_AGENT_CLIPBOARD_GRAB,opaque:0,data:new wdi.VDAgentClipboardGrab({types:[wdi.ClipBoardTypes.VD_AGENT_CLIPBOARD_UTF8_TEXT]})})});this.sendAgentPacket(packet)}},sendPaste:function(){if(this.clipboardRequestReceived){var packet=new wdi.SpiceMessage({messageType:wdi.SpiceVars.SPICE_MSGC_MAIN_AGENT_DATA,channel:wdi.SpiceVars.SPICE_CHANNEL_MAIN,args:new wdi.VDAgentMessage({protocol:1,type:wdi.AgentMessageTypes.VD_AGENT_CLIPBOARD,opaque:0,data:new wdi.VDAgentClipboard({type:wdi.ClipBoardTypes.VD_AGENT_CLIPBOARD_UTF8_TEXT,data:this.clipboardContent})})});this.clipboardRequestReceived=false;this.sendAgentPacket(packet)}else{this.clipboardPending=true}},disableClipboard:function(){this.clipboardEnabled=false}});wdi.SpiceConnection=$.spcExtend(wdi.EventObject.prototype,{channels:null,connectionId:null,connectionInfo:null,runQ:null,token:null,connectionControl:null,init:function(c){this.superInit();this.channels={};this.channels[wdi.SpiceVars.SPICE_CHANNEL_MAIN]=c.mainChannel||new wdi.SpiceChannel;this.channels[wdi.SpiceVars.SPICE_CHANNEL_DISPLAY]=c.displayChannel||new wdi.SpiceChannel;this.channels[wdi.SpiceVars.SPICE_CHANNEL_INPUTS]=c.inputsChannel||new wdi.SpiceChannel;this.channels[wdi.SpiceVars.SPICE_CHANNEL_CURSOR]=c.cursorChannel||new wdi.SpiceChannel;this.channels[wdi.SpiceVars.SPICE_CHANNEL_PLAYBACK]=c.playbackChannel||new wdi.SpiceChannel;this.runQ=c.runQ||new wdi.RunQueue;this.connectionControl=c.connectionControl||new wdi.ConnectionControl;this.setup()},connect:function(connectionInfo){this.connectionInfo=connectionInfo;if(connectionInfo.connectionControl){this.connectionControl.connect(connectionInfo)}this.channels[wdi.SpiceVars.SPICE_CHANNEL_MAIN].connect(this.connectionInfo,wdi.SpiceVars.SPICE_CHANNEL_MAIN)},disconnect:function(){for(var i in this.channels){this.channels[i].disconnect();this.channels[i]=null;delete this.channels[i]}this.connectionControl.disconnect()},send:function(spcMessage){var data=spcMessage.args.marshall();if(this.channels[spcMessage.channel]){this.channels[spcMessage.channel].sendObject(data,spcMessage.messageType)}else{console.error("channel not available",spcMessage.channel)}},setup:function(){this.channels[wdi.SpiceVars.SPICE_CHANNEL_MAIN].addListener("connectionId",this.onConnectionId,this);this.channels[wdi.SpiceVars.SPICE_CHANNEL_MAIN].addListener("channelListAvailable",this.onChannelList,this);this.channels[wdi.SpiceVars.SPICE_CHANNEL_MAIN].addListener("mouseMode",this.onMouseMode,this);this.channels[wdi.SpiceVars.SPICE_CHANNEL_MAIN].addListener("initAgent",this.onInitAgent,this);this.channels[wdi.SpiceVars.SPICE_CHANNEL_MAIN].addListener("notify",this.onNotify,this);this.connectionControl.addListener("connectionLost",this.onDisconnect,this);this._setConnectedListeners();var f=null;if(wdi.exceptionHandling){f=this.onChannelMessageExceptionHandled}else{f=this.processChannelMessage}for(var i in this.channels){if(this.channels.hasOwnProperty(i)){this.channels[i].addListener("message",f,this);this.channels[i].addListener("status",this.onStatus,this);this.channels[i].addListener("error",this.onDisconnect,this)}}},_setConnectedListeners:function(){this._setConnectedListener(wdi.SpiceVars.SPICE_CHANNEL_MAIN);this._setConnectedListener(wdi.SpiceVars.SPICE_CHANNEL_DISPLAY);this._setConnectedListener(wdi.SpiceVars.SPICE_CHANNEL_INPUTS);this._setConnectedListener(wdi.SpiceVars.SPICE_CHANNEL_CURSOR);this._setConnectedListener(wdi.SpiceVars.SPICE_CHANNEL_PLAYBACK)},_setConnectedListener:function(channel){this.channels[channel].addListener("channelConnected",function(){this.fire("channelConnected",channel)},this)},onDisconnect:function(params){this.fire("error",params)},onConnectionId:function(params){this.connectionId=params},onChannelList:function(params){this.connectChannels(params)},connectChannels:function(channels){for(var i in this.channels){i=parseInt(i,10);if(i!=wdi.SpiceVars.SPICE_CHANNEL_MAIN&&channels.indexOf(i)!=-1){this.runQ.add(function(proxy,params){this.channels[params].connect(this.connectionInfo,params,this.connectionId,proxy)},this,false,i)}}this.runQ.process()},onInitAgent:function(params){var tokens=params;this.fire("initAgent",tokens)},onMouseMode:function(params){var mode=params;this.fire("mouseMode",mode)},onNotify:function(params){this.fire("notify")},onStatus:function(params){},onChannelMessageExceptionHandled:function(params){try{return this.processChannelMessage(params)}catch(e){wdi.Debug.error("SpiceConnection: Packet decodification error",e)}},processChannelMessage:function(params){var packet=wdi.PacketFactory.extract(params);wdi.GlobalPool.discard("ViewQueue",params.body);wdi.GlobalPool.discard("RawSpiceMessage",params);if(packet){this.fire("message",packet)}else{wdi.Debug.log("Unknown packet "+params.channel+" "+params.header.type);wdi.Debug.log(params)}}});wdi.SPICE_INPUT_MOTION_ACK_BUNCH=8;wdi.ClientGui=$.spcExtend(wdi.EventObject.prototype,{width:null,height:null,canvas:null,ack_wait:0,mouse_mode:0,mouse_status:0,eventLayer:null,counter:0,mainCanvas:0,firstTime:true,clientOffsetX:0,clientOffsetY:0,magnifier:null,magnifierBackground:null,firstMove:true,isMagnified:true,isMouseDown:false,soundStarted:false,canvasMarginY:0,canvasMarginX:0,stuckKeysHandler:null,subCanvas:{},inputManager:null,clipboardEnabled:true,layer:null,init:function(c){this.canvas={};this.contexts={};this.superInit();this.magnifier=window.$("<canvas/>").attr({width:150,height:150}).css({position:"absolute",left:"0px",top:"0px"});this.stuckKeysHandler=c.stuckKeysHandler||new wdi.StuckKeysHandler;this.stuckKeysHandler.addListener("inputStuck",this._sendInput.bind(this),this);this.magnifierBackground=window.$("<img/>");this.magnifierBackground.attr("src","resources/magnifier.png");this.initSound();this.inputManager=c.inputManager||new wdi.InputManager({stuckKeysHandler:this.stuckKeysHandler,window:$(window)});this.inputManager.setCurrentWindow(window)},setLayer:function(layer){this.layer=layer},disableClipboard:function(){this.clipboardEnabled=false},_sendInput:function(params){var data=params;var type=data[0];var event=data[1];this.fire("input",[type,event])},releaseAllKeys:function(){this.stuckKeysHandler.releaseAllKeys()},getContext:function(surface_id){return this.contexts[surface_id]},getCanvas:function(surface_id){return this.canvas[surface_id]},checkFeatures:function(){if(!Modernizr.canvas||!Modernizr.websockets){alert("Your Browser is not compatible with WDI. Visit ... for a list of compatible browsers");return false}return true},deleteSubCanvas:function(window){var obj=this.subCanvas[window["hwnd"]];this.subCanvas[window["hwnd"]]=null;return obj},moveSubCanvas:function(window){var obj=this.subCanvas[window["hwnd"]];obj["info"]=window;this._fillSubCanvasFromWindow(window);return obj},resizeSubCanvas:function(window){
var obj=this.subCanvas[window["hwnd"]];$([obj["canvas"],obj["eventLayer"]]).attr({width:window["width"],height:window["height"]});obj["info"]=window;this._fillSubCanvasFromWindow(window);return obj},_fillSubCanvasFromWindow:function(window){var top=parseInt(window.top,10);var left=parseInt(window.left,10);var width=parseInt(window.width,10);var height=parseInt(window.height,10);this.fillSubCanvas({top:top,left:left,right:left+width,bottom:top+height})},createNewSubCanvas:function(window){var evtlayer=this.createEventLayer(window["hwnd"]+"_event",window["width"],window["height"]);this.subCanvas[window["hwnd"]]={canvas:$("<canvas/>").attr({width:window["width"],height:window["height"]}).css({display:window["iconic"]?"none":"block"})[0],eventLayer:evtlayer,info:window,position:0};if(this.canvas[this.mainCanvas]){this._fillSubCanvasFromWindow(window)}return[this.subCanvas[window["hwnd"]]]},fillSubCanvas:function(filterPosition){var canvas=this.canvas[this.mainCanvas];var info=null;for(var i in this.subCanvas){if(this.subCanvas[i]!=null&&this.subCanvas[i]!==undefined&&this.subCanvas.hasOwnProperty(i)){info=this.subCanvas[i]["info"];if(filterPosition!=null||filterPosition!=undefined){var top=parseInt(info["top"],10);var left=parseInt(info["left"],10);var width=parseInt(info["width"],10);var height=parseInt(info["height"],10);var position={top:top,left:left,right:left+width,bottom:top+height};if(wdi.CollisionDetector.thereIsBoxCollision(position,filterPosition)){this._doDrawSubCanvas(canvas,this.subCanvas[i],info)}}else{this._doDrawSubCanvas(canvas,this.subCanvas[i],info)}}}},_doDrawSubCanvas:function(canvas,subCanvas,info){if(this.canvas[this.mainCanvas]==null||this.canvas[this.mainCanvas]==undefined){return}var destCtx=null;if(info["iconic"]===0){var destCanvas=subCanvas["canvas"];destCtx=destCanvas.getContext("2d");var x=0;var y=0;var width=+info.width;var height=+info.height;var left=+info["left"];var top=+info["top"];if(left<0){width=width+left;x=-left;left=0}if(top<0){height=height+top;y=-top;top=0}try{width=Math.max(1,Math.floor(width));height=Math.max(1,Math.floor(height));if(width>canvas.width)width=canvas.width;if(height>canvas.height)height=canvas.height;destCtx.drawImage(canvas,left,top,width,height,x,y,width,height)}catch(err){console.log(err)}}},removeCanvas:function(spiceMessage){var surface=spiceMessage.args;if(surface.surface_id===this.mainCanvas){$(this.eventLayer).remove();this.eventLayer=null}this.canvas[surface.surface_id].keepAlive=false;delete this.canvas[surface.surface_id];delete this.contexts[surface.surface_id]},drawCanvas:function(spiceMessage){var surface=spiceMessage.args;var cnv=wdi.GlobalPool.create("Canvas");cnv.keepAlive=true;cnv.id="canvas_"+surface.surface_id;cnv.width=surface.width;cnv.height=surface.height;cnv.style.position="absolute";cnv.style.top=this.canvasMarginY+"px";cnv.style.left=this.canvasMarginX+"px";this.canvas[surface.surface_id]=cnv;this.contexts[surface.surface_id]=cnv.getContext("2d");if(surface.flags&&!wdi.SeamlessIntegration){this.mainCanvas=surface.surface_id;this.eventLayer=this.createEventLayer("eventLayer",surface.width,surface.height);var evLayer=$(this.eventLayer).css({position:"absolute",top:this.canvasMarginY+"px",left:this.canvasMarginX+"px"})[0];if(this.layer){this.layer.appendChild(cnv);this.layer.appendChild(evLayer)}else{document.body.appendChild(cnv);document.body.appendChild(evLayer)}this.enableKeyboard()}if(this.firstTime&&this.clipboardEnabled){var self=this;$(document).bind("paste",function(event){self.fire("paste",event.originalEvent.clipboardData.getData("text/plain"))});this.firstTime=false}if(surface.flags){this.fire("resolution",[this.canvas[surface.surface_id].width,this.canvas[surface.surface_id].height])}},disableKeyboard:function(){var documentDOM=window.$(window.document);documentDOM.unbind("keydown",this.handleKey);documentDOM.unbind("keyup",this.handleKey);documentDOM.unbind("keypress",this.handleKey);this.inputManager.disable()},enableKeyboard:function(){var self=this,documentDOM=window.$(window.document);documentDOM["keydown"]([self],this.handleKey);documentDOM["keypress"]([self],this.handleKey);documentDOM["keyup"]([self],this.handleKey);this.inputManager.enable()},setCanvasMargin:function(canvasMargin){this.canvasMarginX=canvasMargin.x;this.canvasMarginY=canvasMargin.y},createEventLayer:function(event_id,width,height){var self=this;var eventLayer=$("<canvas/>").css({cursor:"default",position:"absolute"}).attr({id:event_id,width:width,height:height});if(window["bowser"]["firefox"]){eventLayer.attr("contentEditable",true)}eventLayer.bind("touchstart",function(event){event.preventDefault();var touch=event.originalEvent.touches[0]||event.originalEvent.changedTouches[0];var x=touch.pageX;var y=touch.pageY;self.generateEvent.call(self,"mousemove",[x+self.clientOffsetX,y+self.clientOffsetY,self.mouse_status]);if(event.originalEvent.touches.length===1){self.enabledTouchMove=true;self.launchRightClick.call(self,x,y)}else if(event.originalEvent.touches.length===2){self.touchX=x;self.touchY=y;self.enabledTouchMove=false}else if(event.originalEvent.touches.length===3){self.touchY3=y;self.enabledTouchMove=false}});eventLayer.bind("touchmove",function(event){var touch=event.originalEvent.touches[0]||event.originalEvent.changedTouches[0];var x=touch.pageX;var y=touch.pageY;if(event.originalEvent.touches.length===1&&self.enabledTouchMove){self.isMagnified=true;clearInterval(self.rightClickTimer);if(!self.isMouseDown){clearInterval(self.mouseDownTimer);self.launchMouseDown()}self.generateEvent.call(self,"mousemove",[x+self.clientOffsetX,y+self.clientOffsetY-80,self.mouse_status]);var pos=$(this).offset();var myX=x-pos.left;var myY=y-pos.top;if(self.firstMove){$("body").append(self.magnifier);self.firstMove=false}var posX=myX-75;var posY=myY-160;self.magnifier.css({left:posX,top:posY});var ctx=self.magnifier[0].getContext("2d");ctx.clearRect(0,0,150,150);ctx.save();ctx.beginPath();ctx.arc(75,75,75,0,2*Math.PI,false);ctx.clip();ctx.drawImage(self.getCanvas(0),myX-50,myY-50-80,100,100,0,0,150,150);ctx.drawImage(self.magnifierBackground[0],0,0);ctx.restore()}else if(event.originalEvent.touches.length===2){var delta=self.touchY-y;if(Math.abs(delta)>10){var button=delta>0?4:3;self.touchX=x;self.touchY=y;self.generateEvent.call(self,"mousedown",button);self.generateEvent.call(self,"mouseup",button)}}else if(event.originalEvent.touches.length===3){var delta=self.touchY3-y;if(delta>100){document.getElementById("hiddeninput").select()}}event.preventDefault()});eventLayer.bind("touchend",function(event){if(self.enabledTouchMove){var touch=event.originalEvent.touches[0]||event.originalEvent.changedTouches[0];var x=touch.pageX;var y=touch.pageY;if(!self.isMouseDown){self.generateEvent.call(self,"mousedown",0)}self.isMouseDown=false;self.generateEvent.call(self,"mouseup",0);var pos=$(this).offset();self.enabledTouchMove=false;self.firstMove=true;if(self.isMagnified){self.magnifier.remove()}self.isMagnified=false}clearInterval(self.rightClickTimer);clearInterval(self.mouseDownTimer)});eventLayer["mouseup"](function(event){var button=event.button;self.generateEvent.call(self,"mouseup",button);self.mouse_status=0;event.preventDefault()});eventLayer["mousedown"](function(event){var button=event.button;self.generateEvent.call(self,"mousedown",button);self.mouse_status=1;event.preventDefault()});eventLayer["mousemove"](function(event){var x=event.pageX;var y=event.pageY;self.generateEvent.call(self,"mousemove",[x+self.clientOffsetX,y+self.clientOffsetY,self.mouse_status]);event.preventDefault()});eventLayer.bind("contextmenu",function(event){event.preventDefault();return false});var mouseEventPause=false;eventLayer.bind("mousewheel",function(event,delta){var button=delta>0?3:4;self.generateEvent.call(self,"mousedown",button);self.generateEvent.call(self,"mouseup",button);return false});wdi.VirtualMouse.setEventLayer(eventLayer[0],0,0,width,height,1);return eventLayer[0]},launchRightClick:function(x,y){var self=this;this.rightClickTimer=setTimeout(function(){self.generateEvent.call(self,"mousedown",2);self.generateEvent.call(self,"mouseup",2);self.enabledTouchMove=false},400)},launchMouseDown:function(x,y){var self=this;this.mouseDownTimer=setTimeout(function(){self.isMouseDown=true;self.generateEvent.call(self,"mousedown",0)},1500)},showError:function(message){wdi.Debug.warn(message);$("<div/>",{id:"error"}).html(message).css({"background-color":"#ff4141"}).appendTo("body");setTimeout("$('#error').remove()",2e3)},generateEvent:function(event,params){if(event==="mousemove"||event==="joystick"){if(this.ack_wait<wdi.SPICE_INPUT_MOTION_ACK_BUNCH){this.ack_wait++;this.fire("input",[event,params])}}else{if(event.indexOf("key")>-1){this.stuckKeysHandler.checkSpecialKey(event,params[0]["keyCode"]);var val=this.inputManager.getValue();if(val){params=this.inputManager.manageChar(val,params)}}this.fire("input",[event,params])}},motion_ack:function(){this.ack_wait=0},setMouseMode:function(mode){this.mouse_mode=mode},handleKey:function(e){e.data[0].generateEvent.call(e.data[0],e.type,[e]);if(wdi.Keymap.isInKeymap(e.keyCode)&&e.type!=="keypress"){e.preventDefault()}},setClientOffset:function(x,y){this.clientOffsetX=x;this.clientOffsetY=y},setClipBoardData:function(data){prompt("New clipboard data available, press ctrl+c to copy it",data)},initSound:function(){var self=this;this.soundStarted=true;window.setTimeout(function(){self.fire("startAudio")},100)}});wdi.PacketProcess=$.spcExtend(wdi.DomainObject,{processors:{},init:function(c){this.processors[wdi.SpiceVars.SPICE_CHANNEL_MAIN]=c.mainProcess||new wdi.MainProcess({app:c.app});this.processors[wdi.SpiceVars.SPICE_CHANNEL_DISPLAY]=c.displayProcess||new wdi.DisplayPreProcess({clientGui:c.clientGui});this.processors[wdi.SpiceVars.SPICE_CHANNEL_INPUTS]=c.inputsProcess||new wdi.InputProcess({clientGui:c.clientGui,spiceConnection:c.spiceConnection});this.processors[wdi.SpiceVars.SPICE_CHANNEL_CURSOR]=c.cursorProcess||new wdi.CursorProcess;this.processors[wdi.SpiceVars.SPICE_CHANNEL_PLAYBACK]=c.playbackProcess||new wdi.PlaybackProcess({app:c.app})},process:function(spiceMessage){if(wdi.exceptionHandling){return this.processExceptionHandled(spiceMessage)}else{return this.processPacket(spiceMessage)}},processExceptionHandled:function(spiceMessage){try{return this.processPacket(spiceMessage)}catch(e){wdi.Debug.error("PacketProcess: Error processing packet",e)}},processPacket:function(spiceMessage){if(!spiceMessage||!this.processors[spiceMessage.channel]){throw"Invalid channel or null message"}this.processors[spiceMessage.channel].process(spiceMessage)},dispose:function(){this.processors[wdi.SpiceVars.SPICE_CHANNEL_DISPLAY].dispose()}});wdi.PacketFilter={restoreContext:false,start:null,filter:function(spiceMessage,fn,scope,clientGui){if(wdi.logOperations){this.start=Date.now()}if(wdi.graphicDebug&&wdi.graphicDebug.debugMode){wdi.graphicDebug.printDebugMessageOnFilter(spiceMessage,clientGui)}if(wdi.IntegrationBenchmark&&wdi.IntegrationBenchmark.benchmarking){var date=new Date;wdi.IntegrationBenchmark.setStartTime(date.getTime())}if(spiceMessage.args.base){if(spiceMessage.args.base.clip.type===wdi.SpiceClipType.SPICE_CLIP_TYPE_RECTS){var context=clientGui.getContext(spiceMessage.args.base.surface_id);context.save();context.beginPath();var rects=spiceMessage.args.base.clip.rects.rects;var len=rects.length;while(len--){var box=wdi.graphics.getBoxFromSrcArea(rects[len]);context.rect(box.x,box.y,box.width,box.height)}context.clip();this.restoreContext=spiceMessage.args.base.surface_id}}fn.call(scope,spiceMessage)},notifyEnd:function(spiceMessage,clientGui){if(this.restoreContext!==false){var context=clientGui.getContext(this.restoreContext);context.restore();this.restoreContext=false}if(wdi.SeamlessIntegration){var filterPosition=null;if(spiceMessage.args.base&&spiceMessage.args.base.box){filterPosition=spiceMessage.args.base.box}clientGui.fillSubCanvas(filterPosition)}if(wdi.graphicDebug&&wdi.graphicDebug.debugMode){wdi.graphicDebug.printDebugMessageOnNotifyEnd(spiceMessage,clientGui)}if(wdi.IntegrationBenchmark&&wdi.IntegrationBenchmark.benchmarking){var date=new Date;wdi.IntegrationBenchmark.setEndTime(date.getTime())}wdi.GlobalPool.cleanPool("Canvas");wdi.GlobalPool.cleanPool("Image");if(wdi.logOperations){wdi.DataLogger.log(spiceMessage,this.start)}}};wdi.PacketFactory={extract:function(rawSpiceMessage){var packet=null;switch(rawSpiceMessage.channel){case wdi.SpiceVars.SPICE_CHANNEL_DISPLAY:if(wdi.graphicDebug&&wdi.graphicDebug.debugMode){var originalData=JSON.stringify(rawSpiceMessage)}switch(rawSpiceMessage.header.type){case wdi.SpiceVars.SPICE_MSG_DISPLAY_MODE:break;case wdi.SpiceVars.SPICE_MSG_DISPLAY_MARK:packet=(new wdi.SpiceDisplayMark).demarshall(rawSpiceMessage.body);break;case wdi.SpiceVars.SPICE_MSG_DISPLAY_RESET:packet=(new wdi.SpiceDisplayReset).demarshall(rawSpiceMessage.body);break;case wdi.SpiceVars.SPICE_MSG_DISPLAY_COPY_BITS:packet=(new wdi.SpiceCopyBits).demarshall(rawSpiceMessage.body);break;case wdi.SpiceVars.SPICE_MSG_DISPLAY_INVAL_LIST:packet=(new wdi.SpiceResourceList).demarshall(rawSpiceMessage.body);break;case wdi.SpiceVars.SPICE_MSG_DISPLAY_INVAL_ALL_PIXMAPS:break;case wdi.SpiceVars.SPICE_MSG_DISPLAY_INVAL_PALETTE:break;case wdi.SpiceVars.SPICE_MSG_DISPLAY_INVAL_ALL_PALETTES:packet=(new wdi.SpiceDisplayInvalidAllPalettes).demarshall(rawSpiceMessage.body);break;case wdi.SpiceVars.SPICE_MSG_DISPLAY_STREAM_CREATE:packet=(new wdi.SpiceStreamCreate).demarshall(rawSpiceMessage.body);break;case wdi.SpiceVars.SPICE_MSG_DISPLAY_STREAM_DATA:packet=(new wdi.SpiceStreamData).demarshall(rawSpiceMessage.body);break;case wdi.SpiceVars.SPICE_MSG_DISPLAY_STREAM_CLIP:packet=(new wdi.SpiceStreamClip).demarshall(rawSpiceMessage.body);break;case wdi.SpiceVars.SPICE_MSG_DISPLAY_STREAM_DESTROY:packet=(new wdi.SpiceStreamDestroy).demarshall(rawSpiceMessage.body);break;case wdi.SpiceVars.SPICE_MSG_DISPLAY_STREAM_DESTROY_ALL:break;case wdi.SpiceVars.SPICE_MSG_DISPLAY_DRAW_FILL:packet=(new wdi.SpiceDrawFill).demarshall(rawSpiceMessage.body);break;case wdi.SpiceVars.SPICE_MSG_DISPLAY_DRAW_OPAQUE:break;case wdi.SpiceVars.SPICE_MSG_DISPLAY_DRAW_COPY:packet=(new wdi.SpiceDrawCopy).demarshall(rawSpiceMessage.body);break;case wdi.SpiceVars.SPICE_MSG_DISPLAY_DRAW_BLEND:packet=(new wdi.drawBlend).demarshall(rawSpiceMessage.body);break;case wdi.SpiceVars.SPICE_MSG_DISPLAY_DRAW_BLACKNESS:packet=(new wdi.SpiceDrawBlackness).demarshall(rawSpiceMessage.body);break;case wdi.SpiceVars.SPICE_MSG_DISPLAY_DRAW_WHITENESS:packet=(new wdi.SpiceDrawWhiteness).demarshall(rawSpiceMessage.body);break;case wdi.SpiceVars.SPICE_MSG_DISPLAY_DRAW_INVERS:packet=(new wdi.SpiceDrawInvers).demarshall(rawSpiceMessage.body);break;case wdi.SpiceVars.SPICE_MSG_DISPLAY_DRAW_ROP3:packet=(new wdi.SpiceDrawRop3).demarshall(rawSpiceMessage.body);break;case wdi.SpiceVars.SPICE_MSG_DISPLAY_DRAW_STROKE:packet=(new wdi.SpiceStroke).demarshall(rawSpiceMessage.body);break;case wdi.SpiceVars.SPICE_MSG_DISPLAY_DRAW_TEXT:packet=(new wdi.SpiceDrawText).demarshall(rawSpiceMessage.body,rawSpiceMessage.header.size);break;case wdi.SpiceVars.SPICE_MSG_DISPLAY_DRAW_TRANSPARENT:packet=(new wdi.drawTransparent).demarshall(rawSpiceMessage.body);break;case wdi.SpiceVars.SPICE_MSG_DISPLAY_DRAW_ALPHA_BLEND:packet=(new wdi.drawAlphaBlend).demarshall(rawSpiceMessage.body);break;case wdi.SpiceVars.SPICE_MSG_DISPLAY_SURFACE_CREATE:packet=(new wdi.SpiceSurface).demarshall(rawSpiceMessage.body);break;case wdi.SpiceVars.SPICE_MSG_DISPLAY_SURFACE_DESTROY:packet=(new wdi.SpiceSurfaceDestroy).demarshall(rawSpiceMessage.body);break}break;case wdi.SpiceVars.SPICE_CHANNEL_INPUTS:switch(rawSpiceMessage.header.type){case wdi.SpiceVars.SPICE_MSG_INPUTS_MOUSE_MOTION_ACK:packet=new Object;break}break;case wdi.SpiceVars.SPICE_CHANNEL_MAIN:switch(rawSpiceMessage.header.type){case wdi.SpiceVars.SPICE_MSG_MAIN_INIT:packet=(new wdi.RedMainInit).demarshall(rawSpiceMessage.body);break;case wdi.SpiceVars.SPICE_MSG_MAIN_AGENT_DATA:packet=(new wdi.VDAgentMessage).demarshall(rawSpiceMessage.body);break;case wdi.SpiceVars.SPICE_MSG_MAIN_AGENT_DISCONNECTED:packet=(new wdi.SpiceMsgMainAgentDisconnected).demarshall(rawSpiceMessage.body);break;case wdi.SpiceVars.SPICE_MSG_MAIN_AGENT_CONNECTED:packet=(new wdi.SpiceMsgMainAgentConnected).demarshall(rawSpiceMessage.body);break;case wdi.SpiceVars.SPICE_MSG_MAIN_MULTI_MEDIA_TIME:packet=(new wdi.MainMultiMediaTime).demarshall(rawSpiceMessage.body);break;case wdi.SpiceVars.SPICE_MSG_MAIN_CHANNELS_LIST:packet=(new wdi.MainMChannelsList).demarshall(rawSpiceMessage.body);break}break;case wdi.SpiceVars.SPICE_CHANNEL_CURSOR:switch(rawSpiceMessage.header.type){case wdi.SpiceVars.SPICE_MSG_CURSOR_INIT:packet=(new wdi.RedCursorInit).demarshall(rawSpiceMessage.body,rawSpiceMessage.header.size);break;case wdi.SpiceVars.SPICE_MSG_CURSOR_SET:packet=(new wdi.RedCursorSet).demarshall(rawSpiceMessage.body,rawSpiceMessage.header.size);break}break;case wdi.SpiceVars.SPICE_CHANNEL_PLAYBACK:switch(rawSpiceMessage.header.type){case wdi.SpiceVars.SPICE_MSG_PLAYBACK_MODE:packet=(new wdi.PlaybackMode).demarshall(rawSpiceMessage.body,rawSpiceMessage.header.size);break;case wdi.SpiceVars.SPICE_MSG_PLAYBACK_START:packet=(new wdi.PlaybackStart).demarshall(rawSpiceMessage.body,rawSpiceMessage.header.size);break;case wdi.SpiceVars.SPICE_MSG_PLAYBACK_STOP:packet=(new wdi.PlaybackStop).demarshall(rawSpiceMessage.body,rawSpiceMessage.header.size);break;case wdi.SpiceVars.SPICE_MSG_PLAYBACK_DATA:packet=(new wdi.PlaybackData).demarshall(rawSpiceMessage.body,rawSpiceMessage.header.size);break}}if(packet){if(wdi.graphicDebug&&wdi.graphicDebug.debugMode&&originalData){packet.originalData=originalData}return new wdi.SpiceMessage({messageType:rawSpiceMessage.header.type,channel:rawSpiceMessage.channel,args:packet})}wdi.Debug.log(rawSpiceMessage.header.type,rawSpiceMessage.header.channel);return false}};Application=$.spcExtend(wdi.DomainObject,{spiceConnection:null,clientGui:null,agent:null,externalCallback:null,keyboardEnabled:true,packetProcess:null,inputProcess:null,multimediaTime:null,lastMultimediaTime:null,busConnection:null,busProcess:null,timeLapseDetector:null,init:function(c){wdi.GlobalPool.init();this.spiceConnection=c.spiceConnection||new wdi.SpiceConnection;this.clientGui=c.clientGui||new wdi.ClientGui;this.agent=c.agent||new wdi.Agent({app:this});this.inputProcess=c.inputProcess||new wdi.InputProcess({clientGui:this.clientGui,spiceConnection:this.spiceConnection});this.packetProcess=c.packetProcess;this.busConnection=c.busConnection||new wdi.BusConnection;this.busProcess=c.busProcess||new wdi.BusProcess({clientGui:this.clientGui,busConnection:this.busConnection});this.timeLapseDetector=c.timeLapseDetector||new wdi.TimeLapseDetector;this.setup()},run:function(c){if(c.hasOwnProperty("seamlessDesktopIntegration")){wdi.SeamlessIntegration=c["seamlessDesktopIntegration"]}if(!this.packetProcess){var displayProcess=false;if(c.useWorkers===false){displayProcess=new wdi.DisplayProcess({clientGui:this.clientGui})}this.packetProcess=new wdi.PacketProcess({app:this,clientGui:this.clientGui,agent:this.agent,spiceConnection:this.spiceConnection,inputsProcess:this.inputProcess,displayProcess:displayProcess})}if(window.vdiLoadTest){this.spiceConnection.addListener("message",this.onMessage,this)}else{this.spiceConnection.addListener("message",this.packetProcess.process,this.packetProcess)}this.busConnection.connect(c);this.timeLapseDetector.startTimer();if(c["canvasMargin"]){this.clientGui.setCanvasMargin(c["canvasMargin"])}if(c["disableClipboard"]){this.agent.disableClipboard();this.clientGui.disableClipboard();this.enableCtrlV()}if(c["layer"]){this.clientGui.setLayer(c["layer"])}if(this.clientGui.checkFeatures()){if(wdi.SeamlessIntegration){this.disableKeyboard()}wdi.Keymap.loadKeyMap(c["layout"]);this.setExternalCallback(c["callback"],c["context"]);try{this.connect({host:c["host"],port:c["port"],protocol:c["protocol"],vmHost:c["vmHost"],vmPort:c["vmPort"],vmInfoToken:c["vmInfoToken"],busHost:c["busHost"],token:c["token"],connectionControl:c["connectionControl"],heartbeatToken:c["heartbeatToken"],heartbeatTimeout:c["heartbeatTimeout"]})}catch(e){this.executeExternalCallback("error",1)}this.clientGui.setClientOffset(c["clientOffset"]["x"],c["clientOffset"]["y"])}if(c.hasOwnProperty("externalClipboardHandling")){this.externalClipoardHandling=c["externalClipboardHandling"]}},end:function(){},setup:function(){this.spiceConnection.addListener("mouseMode",this.onMouseMode,this);this.spiceConnection.addListener("initAgent",this.onInitAgent,this);this.spiceConnection.addListener("error",this.onDisconnect,this);this.spiceConnection.addListener("channelConnected",this.onChannelConnected,this);this.clientGui.addListener("input",this.onClientInput,this);this.clientGui.addListener("resolution",this.onResolution,this);this.clientGui.addListener("paste",this.onPaste,this);this.clientGui.addListener("startAudio",this.onStartAudio,this);this.busProcess.addListener("windowCreated",this.onWindowCreated,this);this.busProcess.addListener("windowClosed",this.onWindowClosed,this);this.busProcess.addListener("windowMoved",this.onWindowMoved,this);this.busProcess.addListener("windowResized",this.onWindowResized,this);this.busProcess.addListener("windowFocused",this.onWindowFocused,this);this.busProcess.addListener("windowMinimized",this.onWindowMinimized,this);this.busProcess.addListener("windowRestored",this.onWindowRestored,this);this.busProcess.addListener("windowMaximized",this.onWindowMaximized,this);this.busProcess.addListener("busConnected",this.onBusConnected,this);this.busProcess.addListener("menuResponse",this.onMenuResponse,this);this.busProcess.addListener("networkDriveResponse",this.onNetworkDriveResponse,this);this.busProcess.addListener("wrongPathError",this.onWrongPathError,this);this.busProcess.addListener("applicationLaunchedSuccessfully",this.onApplicationLaunchedSuccessfully,this);this.agent.addListener("clipBoardData",this.onClipBoardData,this);this.busConnection.addListener("busMessage",this.onBusMessage,this);this.busConnection.addListener("error",this.onDisconnect,this);this.timeLapseDetector.addListener("timeLapseDetected",this.onTimeLapseDetected,this)},onChannelConnected:function(params){var channel=params;if(channel===wdi.SpiceVars.SPICE_CHANNEL_INPUTS){this.clientGui.releaseAllKeys()}},onNetworkDriveResponse:function(params){this.executeExternalCallback("networkDriveResponse",params)},onDisconnect:function(params){var error=params;this.executeExternalCallback("error",error)},onResolution:function(params){this.executeExternalCallback("resolution",params)},onClipBoardData:function(params){if(this.externalClipoardHandling){this.executeExternalCallback("clipboardEvent",params)}else{this.clientGui.setClipBoardData(params)}},onWindowMinimized:function(params){var window=params;var params=this.clientGui.resizeSubCanvas(window);this.executeExternalCallback("windowMinimized",params)},onWindowFocused:function(params){this.executeExternalCallback("windowFocused",params)},onWindowRestored:function(params){var window=params;var params=this.clientGui.resizeSubCanvas(window);this.executeExternalCallback("windowRestored",params)},onWindowMaximized:function(params){var window=params;var params=this.clientGui.resizeSubCanvas(window);this.executeExternalCallback("windowMaximized",params)},onWindowResized:function(params){var window=params;var params=this.clientGui.resizeSubCanvas(window);this.executeExternalCallback("windowResized",params)},onWindowMoved:function(params){var window=params;var params=this.clientGui.moveSubCanvas(window);this.executeExternalCallback("windowMoved",params)},onWindowClosed:function(params){var window=params;var params=this.clientGui.deleteSubCanvas(window);this.executeExternalCallback("windowClosed",params)},onWindowCreated:function(params){var window=params;var params=this.clientGui.createNewSubCanvas(window);this.executeExternalCallback("windowCreated",params)},onMenuResponse:function(params){var menuData=params;this.executeExternalCallback("menuResponse",menuData)},onClientInput:function(params){var data=params;var type=data[0];this.inputProcess.send(data,type)},onMessage:function(params){var message=params;this.packetProcess.process(message);var self=this;window.checkResultsTimer&&clearTimeout(window.checkResultsTimer);window.checkResultsTimer=window.setTimeout(function(){self.executeExternalCallback("checkResults");window.vdiLoadTest=false},5e3)},onBusConnected:function(params){if(wdi.SeamlessIntegration){this.busProcess.requestWindowList()}},onBusMessage:function(params){var message=params;this.busProcess.process(message)},onInitAgent:function(params){this.agent.setClientTokens(params);this.agent.sendInitMessage(this);this.executeExternalCallback("ready",params)},onMouseMode:function(params){this.clientGui.setMouseMode(params)},onPaste:function(params){this.agent.setClipboard(params)},onStartAudio:function(){this.packetProcess.processors[wdi.SpiceVars.SPICE_CHANNEL_PLAYBACK].startAudio()},onTimeLapseDetected:function(params){var elapsedMillis=params;this.executeExternalCallback("timeLapseDetected",elapsedMillis)},connect:function(connectionInfo){try{this.spiceConnection.connect(connectionInfo)}catch(e){this.clientGui.showError(e.message)}},setExternalCallback:function(fn,context){this.externalCallback=[fn,context]},executeExternalCallback:function(action,params){this.externalCallback[0].call(this.externalCallback[1],action,params)},sendCommand:function(action,params){switch(action){case"close":this.busProcess.closeWindow(params["hwnd"]);break;case"move":this.busProcess.moveWindow(params["hwnd"],params["x"],params["y"]);break;case"minimize":this.busProcess.minimizeWindow(params["hwnd"]);break;case"maximize":this.busProcess.maximizeWindow(params["hwnd"]);break;case"restore":this.busProcess.restoreWindow(params["hwnd"]);break;case"focus":this.busProcess.focusWindow(params["hwnd"]);break;case"resize":this.busProcess.resizeWindow(params["hwnd"],params["width"],params["height"]);break;case"run":this.busProcess.executeCommand(params["cmd"]);break;case"setResolution":this.agent.setResolution(params["width"],params["height"]);break;case"getMenu":this.busProcess.getMenu();break;case"reMountNetworkDrive":this.busProcess.reMountNetworkDrive(params["host"],params["username"],params["password"]);break}},enableKeyboard:function(){this.clientGui.enableKeyboard()},disableKeyboard:function(){this.clientGui.disableKeyboard()},enableCtrlV:function(){wdi.KeymapES.setCtrlKey(86,47);wdi.KeymapUS.setCtrlKey(86,47)},disconnect:function(){this.busConnection.disconnect();this.spiceConnection.disconnect()},setMultimediaTime:function(time){this.multimediaTime=time;this.lastMultimediaTime=Date.now()},sendShortcut:function(shortcut){if(shortcut==wdi.keyShortcutsHandled.CTRLV){this.inputProcess.send(["keydown",[{generated:true,type:"keydown",keyCode:17,charCode:0}]],"keydown");this.inputProcess.send(["keydown",[{generated:true,type:"keydown",keyCode:86,charCode:0}]],"keydown");this.inputProcess.send(["keyup",[{generated:true,type:"keyup",keyCode:86,charCode:0}]],"keyup");this.inputProcess.send(["keyup",[{generated:true,type:"keyup",keyCode:17,charCode:0}]],"keyup")}},dispose:function(){this.disableKeyboard();this.disconnect();this.packetProcess.dispose()},onWrongPathError:function(params){this.executeExternalCallback("wrongPathError",params)},onApplicationLaunchedSuccessfully:function(params){this.executeExternalCallback("applicationLaunchedSuccessfully",params)},getKeyboardHandler:function(){return this.clientGui.handleKey},getClientGui:function(){return this.clientGui},setCurrentWindow:function(wnd){this.clientGui.inputManager.setCurrentWindow(wnd)}});window["Application"]=Application;Application.prototype["run"]=Application.prototype.run;Application.prototype["sendCommand"]=Application.prototype.sendCommand;Application.prototype["enableKeyboard"]=Application.prototype.enableKeyboard;Application.prototype["disableKeyboard"]=Application.prototype.disableKeyboard;Application.prototype["dispose"]=Application.prototype.dispose;Application.prototype["getKeyboardHandler"]=Application.prototype.getKeyboardHandler;Application.prototype["getClientGui"]=Application.prototype.getClientGui;Application.prototype["setCurrentWindow"]=Application.prototype.setCurrentWindow;wdi.VirtualMouse={eventLayers:[],mouseData:null,visible:null,lastLayer:null,hotspot:{x:0,y:0},lastMousePosition:{x:0,y:0,width:0,height:0},setHotspot:function(x,y){this.hotspot.x=x;this.hotspot.y=y},setEventLayer:function(ev,x,y,width,height,position){this.eventLayers.push({layer:ev,left:x,top:y,right:x+width,bottom:y+height,position:position})},removeEventLayer:function(ev){var len=this.eventLayers.length;for(var i=0;i<len;i++){if(this.eventLayers[i].layer.id===ev.id){this.eventLayers[ev.id]=undefined}}},getEventLayer:function(x,y){var len=this.eventLayers.length;var layer=null;for(var i=0;i<len;i++){layer=this.eventLayers[i];if(x>=layer.left&&x<=layer.right&&y>=layer.top&&y<=layer.bottom){return layer.layer}}},setMouse:function(mouseData,x,y){var layer=null;var len=this.eventLayers.length;for(var i=0;i<len;i++){layer=this.eventLayers[i];layer.layer.style.cursor="url("+mouseData+") "+x+" "+y+", default"}}};wdi.ImageCache={images:{},cursor:{},palettes:{},getImageFrom:function(descriptor,cb){var cnv=wdi.GlobalPool.create("Canvas");var imgData=this.images[descriptor.id.toString()];cnv.width=imgData.width;cnv.height=imgData.height;cnv.getContext("2d").putImageData(imgData,0,0);cb(cnv)},isImageInCache:function(descriptor){if(descriptor.id.toString()in this.images){return true}return false},delImage:function(id){delete this.images[id.toString()]},addImage:function(descriptor,canvas){if(canvas.getContext){this.images[descriptor.id.toString()]=canvas.getContext("2d").getImageData(0,0,canvas.width,canvas.height)}else{this.images[descriptor.id.toString()]=canvas}},getCursorFrom:function(cursor){return this.cursor[cursor.header.unique.toString()]},addCursor:function(cursor,imageData){this.cursor[cursor.header.unique.toString()]=imageData},getPalette:function(id){return this.palettes[id.toString()]},addPalette:function(id,palette){this.palettes[id.toString()]=palette},clearPalettes:function(){this.palettes={}}};wdi.RasterOperation={process:function(rop,sourceImg,destImg){var result=null;if(rop&wdi.SpiceRopd.SPICE_ROPD_INVERS_SRC){sourceImg=this.invert(sourceImg)}else if(rop&wdi.SpiceRopd.SPICE_ROPD_INVERS_BRUSH){sourceImg=this.invert(sourceImg)}else if(rop&wdi.SpiceRopd.SPICE_ROPD_INVERS_DEST){destImg=this.invert(destImg)}if(rop&wdi.SpiceRopd.SPICE_ROPD_OP_PUT){return sourceImg}else if(rop&wdi.SpiceRopd.SPICE_ROPD_OP_OR){result=this.boolOp(sourceImg,destImg,"or")}else if(rop&wdi.SpiceRopd.SPICE_ROPD_OP_AND){result=this.boolOp(sourceImg,destImg,"and")}else if(rop&wdi.SpiceRopd.SPICE_ROPD_OP_XOR){result=this.boolOp(sourceImg,destImg,"xor")}else if(rop&wdi.SpiceRopd.SPICE_ROPD_OP_BLACKNESS){result=this.lightness(destImg,"b")}else if(rop&wdi.SpiceRopd.SPICE_ROPD_OP_WHITENESS){result=this.lightness(destImg)}else if(rop&wdi.SpiceRopd.SPICE_ROPD_OP_INVERS){result=this.invert(destImg)}if(rop&wdi.SpiceRopd.SPICE_ROPD_INVERS_RES){return this.invert(result)}else{return result}},flip:function(sourceImg){sourceImg=wdi.Flipper.flip(sourceImg);return sourceImg},invert:function(sourceImg){sourceImg=$(sourceImg).pixastic("invert")[0];return sourceImg},lightness:function(sourceImg,ratio){var ratio=ratio==="b"?-100:100;sourceImg=$(sourceImg).pixastic("hsl",{hue:30,saturation:20,lightness:ratio})[0];return sourceImg},boolOp:function(sourceImg,destImg,op){var source=wdi.graphics.getDataFromImage(sourceImg).data;var dest=wdi.graphics.getDataFromImage(destImg).data;var length=source.length-1;var tmp_canvas=wdi.graphics.getNewTmpCanvas(sourceImg.width,sourceImg.height);var tmp_context=tmp_canvas.getContext("2d");var resultImageData=tmp_context.createImageData(sourceImg.width,sourceImg.height);
var result=resultImageData.data;if(op==="or"){while(length>0){resultImageData.data[length]=255;result[length-1]=source[length-1]|dest[length-1];result[length-2]=source[length-2]|dest[length-2];result[length-3]=source[length-3]|dest[length-3];length-=4}}else if(op==="and"){while(length>0){resultImageData.data[length]=255;result[length-1]=source[length-1]&dest[length-1];result[length-2]=source[length-2]&dest[length-2];result[length-3]=source[length-3]&dest[length-3];length-=4}}else if(op==="xor"){while(length>0){resultImageData.data[length]=255;result[length-1]=source[length-1]^dest[length-1];result[length-2]=source[length-2]^dest[length-2];result[length-3]=source[length-3]^dest[length-3];length-=4}}tmp_context.putImageData(resultImageData,0,0);return tmp_canvas}};wdi.Stream={streams:{},addStream:function(id,stream){this.streams[id]=stream},deleteStream:function(id){this.streams[id]=undefined},getStream:function(id){return this.streams[id]},clip:function(id,clip){this.streams[id].clip=clip}};wdi.InputManager=$.spcExtend(wdi.EventObject.prototype,{checkFocus:false,input:null,window:null,stuckKeysHandler:null,init:function(c){this.superInit();this.input=c.input;this.window=c.window;this.stuckKeysHandler=c.stuckKeysHandler;this.$=c.jQuery||$;if(!c.disableInput){this.inputElement=this.$('<div style="position:absolute"><input type="text" id="inputmanager" style="opacity:0;color:transparent"/></div>')}this.currentWindow=null},setCurrentWindow:function(wnd){wnd=this.$(wnd);if(this.currentWindow){this.inputElement.remove();this.currentWindow.unbind("blur")}this.$(wnd[0].document.body).prepend(this.inputElement);this.input=this.$(wnd[0].document.getElementById("inputmanager"));this.addListeners(wnd);this.currentWindow=wnd},addListeners:function(wnd){this._onBlur(wnd);this._onInput()},_onBlur:function(wnd){var self=this;wnd.on("blur",function onBlur(e){if(self.checkFocus){self.input.focus()}self.stuckKeysHandler.releaseSpecialKeysPressed()})},_onInput:function(){var self=this;this.input.on("input",function input(e){var aux=self.input.val();if(aux.length>1){self.reset()}})},enable:function(){this.checkFocus=true;this.input.select()},disable:function(){this.checkFocus=false;this.input.blur()},reset:function(){this.input.val("")},getValue:function(){var val=this.input.val();if(val){this.reset()}return val},manageChar:function(val,params){var res=[Object.create(params[0])];res[0]["type"]="inputmanager";res[0]["charCode"]=val.charCodeAt(0);return res}});wdi.BUS_TYPES={file:0,print:1,launchApplication:2,windowManagement:3,menu:5,networkDriveManagement:6,killApplicationDoNotUseInProductionEver:34423423};wdi.BusProcess=$.spcExtend(wdi.EventObject.prototype,{busConnection:null,clientGui:null,init:function(c){this.superInit();this.clientGui=c.clientGui;this.busConnection=c.busConnection},process:function(message){switch(message["verb"]){case"CONNECTED":this.busConnection.setSubscriptions();this.fire("busConnected");break;case"MESSAGE":this.parseMessage(message["body"]);break;case"ERROR":console.error("Bus error");break;default:wdi.Debug.warn("Not implemented Stomp Verb: "+message["verb"])}},parseMessage:function(body){switch(parseInt(body["type"])){case wdi.BUS_TYPES.launchApplication:this.parseLaunchApplicationMessage(body);break;case wdi.BUS_TYPES.killApplicationDoNotUseInProductionEver:break;case wdi.BUS_TYPES.windowManagement:this.parseWindowManagementMessage(body);break;case wdi.BUS_TYPES.menu:this.handleMenuMessage(body);break;case wdi.BUS_TYPES.networkDriveManagement:this._handleNetworkDriveMessage(body);break;default:wdi.Debug.info("Bus type '"+body["type"]+"' not implemented.")}},_handleNetworkDriveMessage:function(message){if(message.event!="reMountNetworkDrive"){this.fire("networkDriveResponse",message)}},getMenu:function(){this.busConnection.send({type:wdi.BUS_TYPES.menu,value:false,event:"request"})},handleMenuMessage:function(message){if(message.event=="response"){this.fire("menuResponse",message)}},parseWindowManagementMessage:function(message){switch(message["event"]){case"windowList":case"windowCreated":case"windowClosed":case"windowMoved":case"windowResized":case"windowFocused":case"windowMinimized":case"windowRestored":case"windowMaximized":this.fire(message["event"],message["value"]);break;default:wdi.Debug.info("Event '"+message["event"]+"' not implemented.")}},closeWindow:function(hwnd){this.busConnection.send(this._constructWindowManagementMessage({event:"closeWindow",hwnd:hwnd}))},moveWindow:function(hwnd,x,y){this.busConnection.send(this._constructWindowManagementMessage({event:"moveWindow",hwnd:hwnd,left:x,top:y}))},minimizeWindow:function(hwnd){this.busConnection.send(this._constructWindowManagementMessage({event:"minimizeWindow",hwnd:hwnd}))},maximizeWindow:function(hwnd){this.busConnection.send(this._constructWindowManagementMessage({event:"maximizeWindow",hwnd:hwnd}))},restoreWindow:function(hwnd){this.busConnection.send(this._constructWindowManagementMessage({event:"restoreWindow",hwnd:hwnd}))},focusWindow:function(hwnd){this.busConnection.send(this._constructWindowManagementMessage({event:"focusWindow",hwnd:hwnd}))},resizeWindow:function(hwnd,width,height){this.busConnection.send(this._constructWindowManagementMessage({event:"resizeWindow",hwnd:hwnd,width:width,height:height}))},requestWindowList:function(){this.busConnection.send(this._constructWindowManagementMessage({event:"getWindowList"}))},executeCommand:function(cmd){this.busConnection.send({type:wdi.BUS_TYPES.launchApplication,application:cmd})},_constructWindowManagementMessage:function(obj){if(obj["event"]===undefined){throw new Error("You should pass an 'event' attribute in the object")}var ret={type:wdi.BUS_TYPES.windowManagement,event:obj["event"],value:{}};for(var i in obj){if(i!="event"&&obj.hasOwnProperty(i)){ret["value"][i]=obj[i]}}return ret},reMountNetworkDrive:function(host,username,password){this.busConnection.send({type:wdi.BUS_TYPES.networkDriveManagement,event:"reMountNetworkDrive",host:host,username:username,password:password})},parseLaunchApplicationMessage:function(message){switch(message["event"]){case"applicationLauncherWrongAppPathError":this.fire("wrongPathError",message);break;case"applicationLaunchedSuccessfully":this.fire("applicationLaunchedSuccessfully",message);break;default:wdi.Debug.info("Event '"+message["event"]+"' not implemented.")}}});wdi.DisplayProcess=$.spcExtend(wdi.EventObject.prototype,{runQ:null,packetFilter:null,init:function(c){this.runQ=c.runQ||wdi.ExecutionControl.runQ;this.packetFilter=c.packetFilter||wdi.PacketFilter;this.clientGui=c.clientGui;this.displayRouter=c.displayRouter||new wdi.DisplayRouter({clientGui:this.clientGui});this.started=false;this.waitingMessages=[];this.packetWorkerIdentifier=c.packetWorkerIdentifier||new wdi.PacketWorkerIdentifier},process:function(spiceMessage){var self=this;this.waitingMessages.push(spiceMessage);if(!this.started){this.timer=setInterval(function(){self.flush()},50);this.started=true}},flush:function(){if(this.waitingMessages.length===0){return}var i=0;var spiceMessage;this.removeRedundantDraws();var size=this.waitingMessages.length;while(i<size){spiceMessage=this.waitingMessages[i];this._process(spiceMessage);i++}this.waitingMessages=[]},removeRedundantDraws:function(){if(this.waitingMessages.length<2){return}var size=this.waitingMessages.length;var message,body,imageProperties,rop,base;var collision_boxes={};var to_delete=[];var deleted=false;var surface_id;var packetBox;var box;var i;var x;while(size--){message=this.waitingMessages[size];body=message.args;base=body.base;rop=body.rop_descriptor;deleted=false;if(base){surface_id=base.surface_id;packetBox=base.box;surface_id=base.surface_id;imageProperties=this.packetWorkerIdentifier.getImageProperties(message);if(!collision_boxes[surface_id]){collision_boxes[surface_id]=[]}if((!imageProperties||imageProperties&&!(imageProperties.descriptor.flags&wdi.SpiceImageFlags.SPICE_IMAGE_FLAGS_CACHE_ME))&&surface_id===0){for(i=0;i<collision_boxes[surface_id].length;i++){box=collision_boxes[surface_id][i];if(box.bottom>=packetBox.bottom&&box.top<=packetBox.top&&box.left<=packetBox.left&&box.right>=packetBox.right){deleted=true;to_delete.push(size);break}}}if(!deleted&&message.messageType===wdi.SpiceVars.SPICE_MSG_DISPLAY_COPY_BITS){break}if(!deleted&&body.getMessageProperty("overWriteScreenArea",false)&&base.clip.type==0&&rop==wdi.SpiceRopd.SPICE_ROPD_OP_PUT){collision_boxes[surface_id].push(base.box)}}}for(x=0;x<to_delete.length;x++){this.waitingMessages.splice(to_delete[x],1)}},_process:function(spiceMessage){if(wdi.logOperations){wdi.DataLogger.log(spiceMessage,0,null,true,"","_decode")}this.runQ.add(function(proxy){this.packetFilter.filter(spiceMessage,function(message){wdi.ExecutionControl.currentProxy=proxy;this.displayRouter.processPacket(message);this.postProcess()},this,this.clientGui);if(wdi.ExecutionControl.sync){proxy.end()}},this,function(){this.processEnd(spiceMessage,this.clientGui)});this.runQ.process()},processEnd:function(spiceMessage,clientGui){this.packetFilter.notifyEnd(spiceMessage,clientGui)},postProcess:function(){}});wdi.DisplayPreProcess=$.spcExtend(wdi.EventObject.prototype,{displayProcess:null,queued:[],inProcess:[],idleConsumers:[],consumers:[],init:function(c){this.superInit();this.displayProcess=c.displayProcess||new wdi.DisplayProcess({clientGui:c.clientGui});this.clientGui=c.clientGui;if(c.numConsumers==null||c.numConsumers==undefined)c.numConsumers=4;var numConsumers=c.numConsumers;for(var i=0;i<numConsumers;i++){var consumer=new wdi.AsyncConsumer;this.consumers.push(consumer);this.idleConsumers.push(consumer);consumer.addListener("done",this.onConsumerDone,this)}},onConsumerDone:function(e){var waitingTask=this.inProcess[0];var task=null;var i=0;while(waitingTask&&waitingTask.state===1){task=this.inProcess.shift();try{this.displayProcess.process(task.message)}catch(e){wdi.Debug.error("DisplayPreProcess error: ",e)}waitingTask=this.inProcess[0];i++}this.idleConsumers.push(e);if(this.queued.length>0){this.executeConsumer()}},process:function(spiceMessage){this.addTask(spiceMessage);this.executeConsumer()},addTask:function(spiceMessage){this.queued.push({message:spiceMessage,clientGui:this.clientGui})},getNextTask:function(){var task=this.queued.shift();while(typeof task=="undefined"&&this.queued.length!=0){task=this.queued.shift()}if(typeof task=="undefined"){return false}task.state=0;this.inProcess.push(task);return task},executeConsumer:function(){if(this.idleConsumers.length>0){wdi.Debug.log("DisplayPreProcess: available workers: "+this.idleConsumers.length);wdi.Debug.log("DisplaypreProcess: pending tasks: "+this.queued.length);var consumer=this.idleConsumers.shift();var task=this.getNextTask();if(task){consumer.consume(task)}}},dispose:function(){this.consumers.forEach(function(consumer){consumer.dispose()})}});wdi.InputProcess=$.spcExtend(wdi.EventObject.prototype,{clientGui:null,spiceConnection:null,init:function(c){this.superInit();this.clientGui=c.clientGui;this.spiceConnection=c.spiceConnection},process:function(spiceMessage){switch(spiceMessage.messageType){case wdi.SpiceVars.SPICE_MSG_INPUTS_MOUSE_MOTION_ACK:this.clientGui.motion_ack();break}},send:function(data,type){var packet,scanCodes,i;if(type=="mousemove"){packet=new wdi.SpiceMessage({messageType:wdi.SpiceVars.SPICE_MSGC_INPUTS_MOUSE_POSITION,channel:wdi.SpiceVars.SPICE_CHANNEL_INPUTS,args:new wdi.RedcMousePosition({x:data[1][0]+wdi.VirtualMouse.hotspot.x,y:data[1][1]+wdi.VirtualMouse.hotspot.y,buttons_state:data[1][2],display_id:0})});this.spiceConnection.send(packet)}else if(type=="mousedown"){packet=new wdi.SpiceMessage({messageType:wdi.SpiceVars.SPICE_MSGC_INPUTS_MOUSE_PRESS,channel:wdi.SpiceVars.SPICE_CHANNEL_INPUTS,args:new wdi.RedcMousePress({button_id:data[1]+1,buttons_state:1<<data[1]})});this.spiceConnection.send(packet)}else if(type=="mouseup"){packet=new wdi.SpiceMessage({messageType:wdi.SpiceVars.SPICE_MSGC_INPUTS_MOUSE_RELEASE,channel:wdi.SpiceVars.SPICE_CHANNEL_INPUTS,args:new wdi.RedcMousePress({button_id:data[1]+1,buttons_state:0})});this.spiceConnection.send(packet)}else if(type=="keydown"||type=="keypress"){scanCodes=wdi.Keymap.getScanCodes(data[1][0]);for(i=0;i<scanCodes.length;i++){packet=new wdi.SpiceMessage({messageType:wdi.SpiceVars.SPICE_MSGC_INPUTS_KEY_DOWN,channel:wdi.SpiceVars.SPICE_CHANNEL_INPUTS,args:new wdi.SpiceScanCode(scanCodes[i])});this.spiceConnection.send(packet)}}else if(type=="keyup"){scanCodes=wdi.Keymap.getScanCodes(data[1][0]);for(i=0;i<scanCodes.length;i++){packet=new wdi.SpiceMessage({messageType:wdi.SpiceVars.SPICE_MSGC_INPUTS_KEY_UP,channel:wdi.SpiceVars.SPICE_CHANNEL_INPUTS,args:new wdi.SpiceScanCode(scanCodes[i])});this.spiceConnection.send(packet)}}else if(type=="joystick"){packet=new wdi.SpiceMessage({messageType:wdi.SpiceVars.SPICE_MSGC_INPUTS_MOUSE_MOTION,channel:wdi.SpiceVars.SPICE_CHANNEL_INPUTS,args:new wdi.RedcMouseMotion({x:data[1][0],y:data[1][1],buttons_state:0})});this.spiceConnection.send(packet)}}});wdi.CursorProcess=$.spcExtend(wdi.EventObject.prototype,{imageData:null,process:function(spiceMessage){switch(spiceMessage.messageType){case wdi.SpiceVars.SPICE_MSG_CURSOR_INIT:case wdi.SpiceVars.SPICE_MSG_CURSOR_SET:var wdiCursor=this.extractCursor(spiceMessage);if(wdiCursor){wdi.VirtualMouse.setHotspot(0,0);wdi.VirtualMouse.setMouse(wdiCursor.data,wdiCursor.header.hot_spot_x,wdiCursor.header.hot_spot_y)}break}},_toUrl:function(data){var imageData=$("<canvas/>").attr({width:data.width,height:data.height})[0];var ctx=imageData.getContext("2d");ctx.putImageData(data,0,0);return imageData.toDataURL("image/png")},extractCursor:function(spiceMessage){var flags=spiceMessage.args.cursor.flags;var position=spiceMessage.args.position;var visible=spiceMessage.args.visible;if(flags&1){return null}var imageData=null;if(flags&wdi.SpiceCursorFlags.SPICE_CURSOR_FLAGS_FROM_CACHE){imageData=wdi.ImageCache.getCursorFrom(spiceMessage.args.cursor)}else{switch(spiceMessage.args.cursor.header.type){case wdi.SpiceCursorType.SPICE_CURSOR_TYPE_ALPHA:imageData=this._toUrl(wdi.graphics.argbToImageData(spiceMessage.args.cursor.data,spiceMessage.args.cursor.header.width,spiceMessage.args.cursor.header.height));break;case wdi.SpiceCursorType.SPICE_CURSOR_TYPE_MONO:imageData=this._toUrl(wdi.graphics.monoToImageData(spiceMessage.args.cursor.data,spiceMessage.args.cursor.header.width,spiceMessage.args.cursor.header.height));break;case 8:imageData=wdi.SpiceObject.bytesToString(spiceMessage.args.cursor.data);break;case wdi.SpiceCursorType.SPICE_CURSOR_TYPE_COLOR4:case wdi.SpiceCursorType.SPICE_CURSOR_TYPE_COLOR8:case wdi.SpiceCursorType.SPICE_CURSOR_TYPE_COLOR16:case wdi.SpiceCursorType.SPICE_CURSOR_TYPE_COLOR24:case wdi.SpiceCursorType.SPICE_CURSOR_TYPE_COLOR32:case wdi.SpiceCursorType.SPICE_CURSOR_TYPE_ENUM_END:break}}if(!imageData){return null}if(flags&wdi.SpiceCursorFlags.SPICE_CURSOR_FLAGS_CACHE_ME){wdi.ImageCache.addCursor(spiceMessage.args.cursor,imageData)}return{data:imageData,position:position,visible:visible,header:spiceMessage.args.cursor.header}}});wdi.PlaybackProcess=$.spcExtend(wdi.EventObject.prototype,{_lastApp:null,started:false,minBuffSize:1024*32,frequency:null,channels:null,audioContext:null,startTime:null,hasAudioSupport:true,typedBuffer:null,position:null,init:function(c){this.app=c.app;this.audioContext=this.getAudioContext();if(this.audioContext){this.hasAudioSupport=true}else{this.hasAudioSupport=false;wdi.Debug.warn("The client browser does not support Web Audio API")}this.startTime=0;this.typedBuffer=new ArrayBuffer(1024*32);this.position=0},getAudioContext:function(){try{return new AudioContext}catch(e){}try{return new webkitAudioContext}catch(e){}return false},process:function(spiceMessage){if(this.hasAudioSupport){switch(spiceMessage.messageType){case wdi.SpiceVars.SPICE_MSG_PLAYBACK_MODE:break;case wdi.SpiceVars.SPICE_MSG_PLAYBACK_START:var packet=spiceMessage.args;this.channels=packet.channels;this.frequency=packet.frequency;break;case wdi.SpiceVars.SPICE_MSG_PLAYBACK_STOP:this.startTime=0;var packet=spiceMessage.args;this.flush();break;case wdi.SpiceVars.SPICE_MSG_PLAYBACK_DATA:var packet=spiceMessage.args;var dataTimestamp=spiceMessage.args.multimedia_time;var tmpview=new Uint8Array(this.typedBuffer);tmpview.set(packet.data,this.position);this.position+=packet.data.length;this._lastApp=this.app;if(this.position>=this.minBuffSize){this.flush(dataTimestamp)}break}}else{}},flush:function(dataTimestamp){if(this.position>0){if(this.started){this.playSound(this.typedBuffer,dataTimestamp)}this.position=0;this.typedBuffer=new ArrayBuffer(1024*32)}},playSound:function(buffer,dataTimestamp){if(this.channels==2){return this.playSoundStereo(buffer,dataTimestamp)}var audio=new Int16Array(buffer);var channelData=new Array(this.channels);for(var i=0;i<this.channels;i++){channelData[i]=new Float32Array(audio.length/2)}var channelCounter=0;for(var i=0;i<audio.length;){for(var c=0;c<this.channels;c++){channelData[c][channelCounter]=audio[i++]/32768}channelCounter++}var source=this.audioContext["createBufferSource"]();var audioBuffer=this.audioContext["createBuffer"](this.channels,channelCounter,this.frequency);for(var i=0;i<this.channels;i++){audioBuffer["getChannelData"](i)["set"](channelData[i])}this._play(source,audioBuffer,dataTimestamp)},playSoundStereo:function(buffer,dataTimestamp){var audio=new Int16Array(buffer);var left=new Float32Array(audio.length/2);var right=new Float32Array(audio.length/2);var channelCounter=0;var audioContext=this.audioContext;var len=audio.length;for(var i=0;i<len;){left[channelCounter]=audio[i++]/32768;right[channelCounter]=audio[i++]/32768;channelCounter++}var source=audioContext["createBufferSource"]();var audioBuffer=audioContext["createBuffer"](2,channelCounter,this.frequency);audioBuffer["getChannelData"](0)["set"](left);audioBuffer["getChannelData"](1)["set"](right);this._play(source,audioBuffer,dataTimestamp)},_play:function(source,audioBuffer,dataTimestamp){var wait=0;if(dataTimestamp){var elapsedTime=Date.now()-this.app.lastMultimediaTime;var currentMultimediaTime=elapsedTime+this.app.multimediaTime;wait=dataTimestamp-currentMultimediaTime;if(wait<0){wait=0}}source["buffer"]=audioBuffer;source["connect"](this.audioContext["destination"]);source["start"](this.startTime+wait);this.startTime+=audioBuffer.duration},startAudio:function(){this.started=true;this.flush()}});wdi.MainProcess=$.spcExtend(wdi.EventObject.prototype,{init:function(c){this.superInit();this.app=c.app;this.spiceConnection=c.app.spiceConnection;this.agent=c.app.agent},process:function(spiceMessage){var channel=this.spiceConnection.channels[wdi.SpiceVars.SPICE_CHANNEL_MAIN];switch(spiceMessage.messageType){case wdi.SpiceVars.SPICE_MSG_MAIN_INIT:channel.connectionId=spiceMessage.args.session_id;channel.fire("connectionId",channel.connectionId);if(spiceMessage.args.agent_connected==1){channel.fire("initAgent",spiceMessage.args.agent_tokens)}if(spiceMessage.args.current_mouse_mode==1){channel.fire("mouseMode",spiceMessage.args.current_mouse_mode)}this.changeMouseMode();break;case wdi.SpiceVars.SPICE_MSG_MAIN_AGENT_DATA:var packet=spiceMessage.args;this.agent.onAgentData(packet);break;case wdi.SpiceVars.SPICE_MSG_MAIN_AGENT_CONNECTED:channel.fire("initAgent",spiceMessage.args.agent_tokens);this.changeMouseMode();break;case wdi.SpiceVars.SPICE_MSG_MAIN_MULTI_MEDIA_TIME:this.app.multimediaTime=spiceMessage.args.multimedia_time;break;case wdi.SpiceVars.SPICE_MSG_MAIN_CHANNELS_LIST:channel.fire("channelListAvailable",spiceMessage.args.channels);break}},changeMouseMode:function(){var packet=new wdi.SpiceMessage({messageType:wdi.SpiceVars.SPICE_MSGC_MAIN_MOUSE_MODE_REQUEST,channel:wdi.SpiceVars.SPICE_CHANNEL_MAIN,args:new wdi.SpiceMouseModeRequest({request_mode:2})});this.spiceConnection.send(packet)}});wdi.KeymapES=function(){var charmapES={};charmapES[""]=[[41,0,0,0],[169,0,0,0]];charmapES[""]=[[42,0,0,0],[41,0,0,0],[169,0,0,0],[170,0,0,0]];charmapES["\\"]=[[224,56,0,0],[41,0,0,0],[169,0,0,0],[224,184,0,0]];charmapES["1"]=[[2,0,0,0],[130,0,0,0]];charmapES["!"]=[[42,0,0,0],[2,0,0,0],[130,0,0,0],[170,0,0,0]];charmapES["|"]=[[224,56,0,0],[2,0,0,0],[130,0,0,0],[224,184,0,0]];charmapES["2"]=[[3,0,0,0],[131,0,0,0]];charmapES['"']=[[42,0,0,0],[3,0,0,0],[131,0,0,0],[170,0,0,0]];charmapES["@"]=[[224,56,0,0],[3,0,0,0],[131,0,0,0],[224,184,0,0]];charmapES["3"]=[[4,0,0,0],[132,0,0,0]];charmapES[""]=[[42,0,0,0],[4,0,0,0],[132,0,0,0],[170,0,0,0]];charmapES["#"]=[[224,56,0,0],[4,0,0,0],[132,0,0,0],[224,184,0,0]];charmapES["4"]=[[5,0,0,0],[133,0,0,0]];charmapES["$"]=[[42,0,0,0],[5,0,0,0],[133,0,0,0],[170,0,0,0]];charmapES["~"]=[[224,56,0,0],[5,0,0,0],[133,0,0,0],[224,184,0,0]];charmapES["5"]=[[6,0,0,0],[134,0,0,0]];charmapES["%"]=[[42,0,0,0],[6,0,0,0],[134,0,0,0],[170,0,0,0]];charmapES["6"]=[[7,0,0,0],[135,0,0,0]];charmapES["&"]=[[42,0,0,0],[7,0,0,0],[135,0,0,0],[170,0,0,0]];charmapES[""]=[[224,56,0,0],[7,0,0,0],[135,0,0,0],[224,184,0,0]];charmapES["7"]=[[8,0,0,0],[136,0,0,0]];charmapES["/"]=[[42,0,0,0],[8,0,0,0],[136,0,0,0],[170,0,0,0]];charmapES["8"]=[[9,0,0,0],[137,0,0,0]];charmapES["("]=[[42,0,0,0],[9,0,0,0],[137,0,0,0],[170,0,0,0]];charmapES["9"]=[[10,0,0,0],[138,0,0,0]];charmapES[")"]=[[42,0,0,0],[10,0,0,0],[138,0,0,0],[170,0,0,0]];charmapES["0"]=[[11,0,0,0],[139,0,0,0]];charmapES["="]=[[42,0,0,0],[11,0,0,0],[139,0,0,0],[170,0,0,0]];charmapES["'"]=[[12,0,0,0],[140,0,0,0]];charmapES["?"]=[[42,0,0,0],[12,0,0,0],[140,0,0,0],[170,0,0,0]];charmapES[""]=[[13,0,0,0],[141,0,0,0]];charmapES[""]=[[42,0,0,0],[13,0,0,0],[141,0,0,0],[170,0,0,0]];charmapES["q"]=[[16,0,0,0],[144,0,0,0]];charmapES["Q"]=[[42,0,0,0],[16,0,0,0],[144,0,0,0],[170,0,0,0]];charmapES["w"]=[[17,0,0,0],[145,0,0,0]];charmapES["W"]=[[42,0,0,0],[17,0,0,0],[145,0,0,0],[170,0,0,0]];charmapES["e"]=[[18,0,0,0],[146,0,0,0]];charmapES["E"]=[[42,0,0,0],[18,0,0,0],[146,0,0,0],[170,0,0,0]];charmapES[""]=[[224,56,0,0],[18,0,0,0],[146,0,0,0],[224,184,0,0]];charmapES["r"]=[[19,0,0,0],[147,0,0,0]];charmapES["R"]=[[42,0,0,0],[19,0,0,0],[147,0,0,0],[170,0,0,0]];charmapES["t"]=[[20,0,0,0],[148,0,0,0]];charmapES["T"]=[[42,0,0,0],[20,0,0,0],[148,0,0,0],[170,0,0,0]];charmapES["y"]=[[21,0,0,0],[149,0,0,0]];charmapES["Y"]=[[42,0,0,0],[21,0,0,0],[149,0,0,0],[170,0,0,0]];charmapES["u"]=[[22,0,0,0],[150,0,0,0]];charmapES["U"]=[[42,0,0,0],[22,0,0,0],[150,0,0,0],[170,0,0,0]];charmapES["i"]=[[23,0,0,0],[151,0,0,0]];charmapES["I"]=[[42,0,0,0],[23,0,0,0],[151,0,0,0],[170,0,0,0]];charmapES["o"]=[[24,0,0,0],[152,0,0,0]];charmapES["O"]=[[42,0,0,0],[24,0,0,0],[152,0,0,0],[170,0,0,0]];charmapES["p"]=[[25,0,0,0],[153,0,0,0]];charmapES["P"]=[[42,0,0,0],[25,0,0,0],[153,0,0,0],[170,0,0,0]];charmapES["`"]=[[26,0,0,0],[154,0,0,0],[57,0,0,0],[185,0,0,0]];charmapES[""]=[[26,0,0,0],[154,0,0,0],[30,0,0,0],[158,0,0,0]];charmapES[""]=[[170,0,0,0],[26,0,0,0],[154,0,0,0],[42,0,0,0],[30,0,0,0],[158,0,0,0]];charmapES[""]=[[26,0,0,0],[154,0,0,0],[18,0,0,0],[146,0,0,0]];charmapES[""]=[[170,0,0,0],[26,0,0,0],[154,0,0,0],[42,0,0,0],[18,0,0,0],[146,0,0,0]];charmapES[""]=[[26,0,0,0],[154,0,0,0],[23,0,0,0],[151,0,0,0]];charmapES[""]=[[170,0,0,0],[26,0,0,0],[154,0,0,0],[42,0,0,0],[23,0,0,0],[151,0,0,0]];charmapES[""]=[[26,0,0,0],[154,0,0,0],[24,0,0,0],[152,0,0,0]];charmapES[""]=[[170,0,0,0],[26,0,0,0],[154,0,0,0],[42,0,0,0],[24,0,0,0],[152,0,0,0]];charmapES[""]=[[26,0,0,0],[154,0,0,0],[22,0,0,0],[150,0,0,0]];charmapES[""]=[[170,0,0,0],[26,0,0,0],[154,0,0,0],[42,0,0,0],[22,0,0,0],[150,0,0,0]];charmapES[""]=[[42,0,0,0],[26,0,0,0],[154,0,0,0],[170,0,0,0],[30,0,0,0],[158,0,0,0]];charmapES[""]=[[26,0,0,0],[154,0,0,0],[30,0,0,0],[158,0,0,0]];charmapES[""]=[[42,0,0,0],[26,0,0,0],[154,0,0,0],[170,0,0,0],[18,0,0,0],[146,0,0,0]];charmapES[""]=[[26,0,0,0],[154,0,0,0],[18,0,0,0],[146,0,0,0]];charmapES[""]=[[42,0,0,0],[26,0,0,0],[154,0,0,0],[170,0,0,0],[23,0,0,0],[151,0,0,0]];charmapES[""]=[[26,0,0,0],[154,0,0,0],[23,0,0,0],[151,0,0,0]];charmapES[""]=[[42,0,0,0],[26,0,0,0],[154,0,0,0],[170,0,0,0],[24,0,0,0],[152,0,0,0]];charmapES[""]=[[26,0,0,0],[154,0,0,0],[24,0,0,0],[152,0,0,0]];charmapES[""]=[[42,0,0,0],[26,0,0,0],[154,0,0,0],[170,0,0,0],[22,0,0,0],[150,0,0,0]];charmapES[""]=[[26,0,0,0],[154,0,0,0],[22,0,0,0],[150,0,0,0]];charmapES["^"]=[[42,0,0,0],[26,0,0,0],[154,0,0,0],[170,0,0,0],[57,0,0,0],[185,0,0,0]];charmapES["["]=[[224,56,0,0],[26,0,0,0],[154,0,0,0],[224,184,0,0]];charmapES["+"]=[[27,0,0,0],[155,0,0,0]];charmapES["*"]=[[42,0,0,0],[27,0,0,0],[155,0,0,0],[170,0,0,0]];charmapES["]"]=[[224,56,0,0],[27,0,0,0],[155,0,0,0],[224,184,0,0]];charmapES["a"]=[[30,0,0,0],[158,0,0,0]];charmapES["A"]=[[42,0,0,0],[30,0,0,0],[158,0,0,0],[170,0,0,0]];charmapES["s"]=[[31,0,0,0],[159,0,0,0]];charmapES["S"]=[[42,0,0,0],[31,0,0,0],[159,0,0,0],[170,0,0,0]];charmapES["d"]=[[32,0,0,0],[160,0,0,0]];charmapES["D"]=[[42,0,0,0],[32,0,0,0],[160,0,0,0],[170,0,0,0]];charmapES["f"]=[[33,0,0,0],[161,0,0,0]];charmapES["F"]=[[42,0,0,0],[33,0,0,0],[161,0,0,0],[170,0,0,0]];charmapES["g"]=[[34,0,0,0],[162,0,0,0]];charmapES["G"]=[[42,0,0,0],[34,0,0,0],[162,0,0,0],[170,0,0,0]];charmapES["h"]=[[35,0,0,0],[163,0,0,0]];charmapES["H"]=[[42,0,0,0],[35,0,0,0],[163,0,0,0],[170,0,0,0]];charmapES["j"]=[[36,0,0,0],[164,0,0,0]];charmapES["J"]=[[42,0,0,0],[36,0,0,0],[164,0,0,0],[170,0,0,0]];charmapES["k"]=[[37,0,0,0],[165,0,0,0]];charmapES["K"]=[[42,0,0,0],[37,0,0,0],[165,0,0,0],[170,0,0,0]];charmapES["l"]=[[38,0,0,0],[166,0,0,0]];charmapES["L"]=[[42,0,0,0],[38,0,0,0],[166,0,0,0],[170,0,0,0]];charmapES[""]=[[39,0,0,0],[167,0,0,0]];charmapES[""]=[[42,0,0,0],[39,0,0,0],[167,0,0,0],[170,0,0,0]];charmapES[""]=[[40,0,0,0],[168,0,0,0],[30,0,0,0],[158,0,0,0]];charmapES[""]=[[170,0,0,0],[40,0,0,0],[168,0,0,0],[42,0,0,0],[30,0,0,0],[158,0,0,0]];charmapES[""]=[[40,0,0,0],[168,0,0,0],[18,0,0,0],[146,0,0,0]];charmapES[""]=[[170,0,0,0],[40,0,0,0],[168,0,0,0],[42,0,0,0],[18,0,0,0],[146,0,0,0]];charmapES[""]=[[40,0,0,0],[168,0,0,0],[23,0,0,0],[151,0,0,0]];charmapES[""]=[[170,0,0,0],[40,0,0,0],[168,0,0,0],[42,0,0,0],[23,0,0,0],[151,0,0,0]];charmapES[""]=[[40,0,0,0],[168,0,0,0],[24,0,0,0],[152,0,0,0]];charmapES[""]=[[170,0,0,0],[40,0,0,0],[168,0,0,0],[42,0,0,0],[24,0,0,0],[152,0,0,0]];charmapES[""]=[[40,0,0,0],[168,0,0,0],[22,0,0,0],[150,0,0,0]];charmapES[""]=[[170,0,0,0],[40,0,0,0],[168,0,0,0],[42,0,0,0],[22,0,0,0],[150,0,0,0]];charmapES[""]=[[42,0,0,0],[40,0,0,0],[168,0,0,0],[170,0,0,0],[30,0,0,0],[158,0,0,0]];charmapES[""]=[[40,0,0,0],[168,0,0,0],[30,0,0,0],[158,0,0,0]];charmapES[""]=[[42,0,0,0],[40,0,0,0],[168,0,0,0],[170,0,0,0],[18,0,0,0],[146,0,0,0]];charmapES[""]=[[40,0,0,0],[168,0,0,0],[18,0,0,0],[146,0,0,0]];charmapES[""]=[[42,0,0,0],[40,0,0,0],[168,0,0,0],[170,0,0,0],[23,0,0,0],[151,0,0,0]];charmapES[""]=[[40,0,0,0],[168,0,0,0],[23,0,0,0],[151,0,0,0]];charmapES[""]=[[42,0,0,0],[40,0,0,0],[168,0,0,0],[170,0,0,0],[24,0,0,0],[152,0,0,0]];charmapES[""]=[[40,0,0,0],[168,0,0,0],[24,0,0,0],[152,0,0,0]];charmapES[""]=[[42,0,0,0],[40,0,0,0],[168,0,0,0],[170,0,0,0],[22,0,0,0],[150,0,0,0]];charmapES[""]=[[40,0,0,0],[168,0,0,0],[22,0,0,0],[150,0,0,0]];charmapES["{"]=[[224,56,0,0],[40,0,0,0],[168,0,0,0],[224,184,0,0]];charmapES[""]=[[43,0,0,0],[171,0,0,0]];charmapES[""]=[[42,0,0,0],[43,0,0,0],[171,0,0,0],[170,0,0,0]];charmapES["}"]=[[224,56,0,0],[43,0,0,0],[171,0,0,0],[224,184,0,0]];charmapES["<"]=[[86,0,0,0],[214,0,0,0]];charmapES[">"]=[[42,0,0,0],[86,0,0,0],[214,0,0,0],[170,0,0,0]];charmapES["z"]=[[44,0,0,0],[172,0,0,0]];charmapES["Z"]=[[42,0,0,0],[44,0,0,0],[172,0,0,0],[170,0,0,0]];charmapES["x"]=[[45,0,0,0],[173,0,0,0]];charmapES["X"]=[[42,0,0,0],[45,0,0,0],[173,0,0,0],[170,0,0,0]];charmapES["c"]=[[46,0,0,0],[174,0,0,0]];charmapES["C"]=[[42,0,0,0],[46,0,0,0],[174,0,0,0],[170,0,0,0]];charmapES["v"]=[[47,0,0,0],[175,0,0,0]];charmapES["V"]=[[42,0,0,0],[47,0,0,0],[175,0,0,0],[170,0,0,0]];charmapES["b"]=[[48,0,0,0],[176,0,0,0]];charmapES["B"]=[[42,0,0,0],[48,0,0,0],[176,0,0,0],[170,0,0,0]];charmapES["n"]=[[49,0,0,0],[177,0,0,0]];charmapES["N"]=[[42,0,0,0],[49,0,0,0],[177,0,0,0],[170,0,0,0]];charmapES["m"]=[[50,0,0,0],[178,0,0,0]];charmapES["M"]=[[42,0,0,0],[50,0,0,0],[178,0,0,0],[170,0,0,0]];charmapES[","]=[[51,0,0,0],[179,0,0,0]];charmapES[";"]=[[42,0,0,0],[51,0,0,0],[179,0,0,0],[170,0,0,0]];charmapES["."]=[[52,0,0,0],[180,0,0,0]];charmapES[":"]=[[42,0,0,0],[52,0,0,0],[180,0,0,0],[170,0,0,0]];charmapES["-"]=[[53,0,0,0],[181,0,0,0]];charmapES["_"]=[[42,0,0,0],[53,0,0,0],[181,0,0,0],[170,0,0,0]];charmapES[" "]=[[57,0,0,0],[185,0,0,0]];var keymapES=[];keymapES[27]=1;keymapES[9]=15;keymapES[16]=42;keymapES[91]=29;keymapES[17]=29;keymapES[8]=14;keymapES[13]=28;keymapES[18]=56;keymapES[38]=72;keymapES[37]=75;keymapES[40]=80;keymapES[39]=77;keymapES[45]=82;keymapES[46]=83;keymapES[36]=71;keymapES[35]=79;keymapES[33]=73;keymapES[34]=81;keymapES[144]=69;keymapES[145]=70;keymapES[112]=59;keymapES[113]=60;keymapES[114]=61;keymapES[115]=62;keymapES[116]=63;keymapES[117]=64;keymapES[118]=65;keymapES[119]=66;keymapES[120]=67;keymapES[121]=68;keymapES[122]=87;keymapES[123]=88;var ctrlKeymapES=[];ctrlKeymapES[65]=30;ctrlKeymapES[81]=16;ctrlKeymapES[87]=17;ctrlKeymapES[69]=18;ctrlKeymapES[82]=19;ctrlKeymapES[84]=20;ctrlKeymapES[89]=21;ctrlKeymapES[85]=22;ctrlKeymapES[73]=23;ctrlKeymapES[79]=24;ctrlKeymapES[80]=25;ctrlKeymapES[65]=30;ctrlKeymapES[83]=31;ctrlKeymapES[68]=32;ctrlKeymapES[70]=33;ctrlKeymapES[71]=34;ctrlKeymapES[72]=35;ctrlKeymapES[74]=36;ctrlKeymapES[75]=37;ctrlKeymapES[76]=38;ctrlKeymapES[90]=44;ctrlKeymapES[88]=45;ctrlKeymapES[67]=46;ctrlKeymapES[66]=48;ctrlKeymapES[78]=49;ctrlKeymapES[77]=50;var reservedCtrlKeymap=[];reservedCtrlKeymap[86]=47;return{getKeymap:function(){return keymapES},getCtrlKeymap:function(){return ctrlKeymapES},getReservedCtrlKeymap:function(){return reservedCtrlKeymap},getCharmap:function(){return charmapES},setCtrlKey:function(key,val){ctrlKeymapES[key]=val}}}();wdi.KeymapIT=function(){var charmapIT={};charmapIT["\\"]=[[41,0,0,0],[169,0,0,0]];charmapIT["|"]=[[42,0,0,0],[41,0,0,0],[169,0,0,0],[170,0,0,0]];charmapIT["1"]=[[2,0,0,0],[130,0,0,0]];charmapIT["!"]=[[42,0,0,0],[2,0,0,0],[130,0,0,0],[170,0,0,0]];charmapIT["2"]=[[3,0,0,0],[131,0,0,0]];charmapIT['"']=[[42,0,0,0],[3,0,0,0],[131,0,0,0],[170,0,0,0]];charmapIT["3"]=[[4,0,0,0],[132,0,0,0]];charmapIT[""]=[[42,0,0,0],[4,0,0,0],[132,0,0,0],[170,0,0,0]];charmapIT["4"]=[[5,0,0,0],[133,0,0,0]];charmapIT["$"]=[[42,0,0,0],[5,0,0,0],[133,0,0,0],[170,0,0,0]];charmapIT["5"]=[[6,0,0,0],[134,0,0,0]];charmapIT["%"]=[[42,0,0,0],[6,0,0,0],[134,0,0,0],[170,0,0,0]];charmapIT["6"]=[[7,0,0,0],[135,0,0,0]];charmapIT["&"]=[[42,0,0,0],[7,0,0,0],[135,0,0,0],[170,0,0,0]];charmapIT["7"]=[[8,0,0,0],[136,0,0,0]];charmapIT["/"]=[[42,0,0,0],[8,0,0,0],[136,0,0,0],[170,0,0,0]];charmapIT["8"]=[[9,0,0,0],[137,0,0,0]];charmapIT["("]=[[42,0,0,0],[9,0,0,0],[137,0,0,0],[170,0,0,0]];charmapIT["9"]=[[10,0,0,0],[138,0,0,0]];charmapIT[")"]=[[42,0,0,0],[10,0,0,0],[138,0,0,0],[170,0,0,0]];charmapIT["0"]=[[11,0,0,0],[139,0,0,0]];charmapIT["="]=[[42,0,0,0],[11,0,0,0],[139,0,0,0],[170,0,0,0]];charmapIT["'"]=[[12,0,0,0],[140,0,0,0]];charmapIT["?"]=[[42,0,0,0],[12,0,0,0],[140,0,0,0],[170,0,0,0]];charmapIT["`"]=[[224,56,0,0],[12,0,0,0],[140,0,0,0],[224,184,0,0]];charmapIT[""]=[[13,0,0,0],[141,0,0,0]];charmapIT["^"]=[[42,0,0,0],[13,0,0,0],[141,0,0,0],[170,0,0,0]];charmapIT["~"]=[[224,56,0,0],[13,0,0,0],[141,0,0,0],[224,184,0,0]];charmapIT["q"]=[[16,0,0,0],[144,0,0,0]];charmapIT["Q"]=[[42,0,0,0],[16,0,0,0],[144,0,0,0],[170,0,0,0]];charmapIT["w"]=[[17,0,0,0],[145,0,0,0]];charmapIT["W"]=[[42,0,0,0],[17,0,0,0],[145,0,0,0],[170,0,0,0]];charmapIT["e"]=[[18,0,0,0],[146,0,0,0]];charmapIT["E"]=[[42,0,0,0],[18,0,0,0],[146,0,0,0],[170,0,0,0]];charmapIT[""]=[[224,56,0,0],[18,0,0,0],[146,0,0,0],[224,184,0,0]];charmapIT["r"]=[[19,0,0,0],[147,0,0,0]];charmapIT["R"]=[[42,0,0,0],[19,0,0,0],[147,0,0,0],[170,0,0,0]];charmapIT["t"]=[[20,0,0,0],[148,0,0,0]];charmapIT["T"]=[[42,0,0,0],[20,0,0,0],[148,0,0,0],[170,0,0,0]];charmapIT["y"]=[[21,0,0,0],[149,0,0,0]];charmapIT["Y"]=[[42,0,0,0],[21,0,0,0],[149,0,0,0],[170,0,0,0]];
charmapIT["u"]=[[22,0,0,0],[150,0,0,0]];charmapIT["U"]=[[42,0,0,0],[22,0,0,0],[150,0,0,0],[170,0,0,0]];charmapIT["i"]=[[23,0,0,0],[151,0,0,0]];charmapIT["I"]=[[42,0,0,0],[23,0,0,0],[151,0,0,0],[170,0,0,0]];charmapIT["o"]=[[24,0,0,0],[152,0,0,0]];charmapIT["O"]=[[42,0,0,0],[24,0,0,0],[152,0,0,0],[170,0,0,0]];charmapIT["p"]=[[25,0,0,0],[153,0,0,0]];charmapIT["P"]=[[42,0,0,0],[25,0,0,0],[153,0,0,0],[170,0,0,0]];charmapIT[""]=[[26,0,0,0],[154,0,0,0]];charmapIT[""]=[[42,0,0,0],[26,0,0,0],[154,0,0,0],[170,0,0,0]];charmapIT["["]=[[224,56,0,0],[26,0,0,0],[154,0,0,0],[224,184,0,0]];charmapIT["{"]=[[224,56,0,0],[42,0,0,0],[26,0,0,0],[154,0,0,0],[170,0,0,0],[224,184,0,0]];charmapIT["+"]=[[27,0,0,0],[155,0,0,0]];charmapIT["*"]=[[42,0,0,0],[27,0,0,0],[155,0,0,0],[170,0,0,0]];charmapIT["]"]=[[224,56,0,0],[27,0,0,0],[155,0,0,0],[224,184,0,0]];charmapIT["}"]=[[224,56,0,0],[42,0,0,0],[27,0,0,0],[155,0,0,0],[170,0,0,0],[224,184,0,0]];charmapIT["a"]=[[30,0,0,0],[158,0,0,0]];charmapIT["A"]=[[42,0,0,0],[30,0,0,0],[158,0,0,0],[170,0,0,0]];charmapIT["s"]=[[31,0,0,0],[159,0,0,0]];charmapIT["S"]=[[42,0,0,0],[31,0,0,0],[159,0,0,0],[170,0,0,0]];charmapIT["d"]=[[32,0,0,0],[160,0,0,0]];charmapIT["D"]=[[42,0,0,0],[32,0,0,0],[160,0,0,0],[170,0,0,0]];charmapIT["f"]=[[33,0,0,0],[161,0,0,0]];charmapIT["F"]=[[42,0,0,0],[33,0,0,0],[161,0,0,0],[170,0,0,0]];charmapIT["g"]=[[34,0,0,0],[162,0,0,0]];charmapIT["G"]=[[42,0,0,0],[34,0,0,0],[162,0,0,0],[170,0,0,0]];charmapIT["h"]=[[35,0,0,0],[163,0,0,0]];charmapIT["H"]=[[42,0,0,0],[35,0,0,0],[163,0,0,0],[170,0,0,0]];charmapIT["j"]=[[36,0,0,0],[164,0,0,0]];charmapIT["J"]=[[42,0,0,0],[36,0,0,0],[164,0,0,0],[170,0,0,0]];charmapIT["k"]=[[37,0,0,0],[165,0,0,0]];charmapIT["K"]=[[42,0,0,0],[37,0,0,0],[165,0,0,0],[170,0,0,0]];charmapIT["l"]=[[38,0,0,0],[166,0,0,0]];charmapIT["L"]=[[42,0,0,0],[38,0,0,0],[166,0,0,0],[170,0,0,0]];charmapIT[""]=[[39,0,0,0],[167,0,0,0]];charmapIT[""]=[[42,0,0,0],[39,0,0,0],[167,0,0,0],[170,0,0,0]];charmapIT["@"]=[[224,56,0,0],[39,0,0,0],[167,0,0,0],[224,184,0,0]];charmapIT[""]=[[40,0,0,0],[168,0,0,0]];charmapIT[""]=[[42,0,0,0],[40,0,0,0],[168,0,0,0],[170,0,0,0]];charmapIT["#"]=[[224,56,0,0],[40,0,0,0],[168,0,0,0],[224,184,0,0]];charmapIT[""]=[[43,0,0,0],[171,0,0,0]];charmapIT[""]=[[42,0,0,0],[43,0,0,0],[171,0,0,0],[170,0,0,0]];charmapIT["<"]=[[86,0,0,0],[214,0,0,0]];charmapIT[">"]=[[42,0,0,0],[86,0,0,0],[214,0,0,0],[170,0,0,0]];charmapIT["z"]=[[44,0,0,0],[172,0,0,0]];charmapIT["Z"]=[[42,0,0,0],[44,0,0,0],[172,0,0,0],[170,0,0,0]];charmapIT["x"]=[[45,0,0,0],[173,0,0,0]];charmapIT["X"]=[[42,0,0,0],[45,0,0,0],[173,0,0,0],[170,0,0,0]];charmapIT["c"]=[[46,0,0,0],[174,0,0,0]];charmapIT["C"]=[[42,0,0,0],[46,0,0,0],[174,0,0,0],[170,0,0,0]];charmapIT["v"]=[[47,0,0,0],[175,0,0,0]];charmapIT["V"]=[[42,0,0,0],[47,0,0,0],[175,0,0,0],[170,0,0,0]];charmapIT["b"]=[[48,0,0,0],[176,0,0,0]];charmapIT["B"]=[[42,0,0,0],[48,0,0,0],[176,0,0,0],[170,0,0,0]];charmapIT["n"]=[[49,0,0,0],[177,0,0,0]];charmapIT["N"]=[[42,0,0,0],[49,0,0,0],[177,0,0,0],[170,0,0,0]];charmapIT["m"]=[[50,0,0,0],[178,0,0,0]];charmapIT["M"]=[[42,0,0,0],[50,0,0,0],[178,0,0,0],[170,0,0,0]];charmapIT[","]=[[51,0,0,0],[179,0,0,0]];charmapIT[";"]=[[42,0,0,0],[51,0,0,0],[179,0,0,0],[170,0,0,0]];charmapIT["."]=[[52,0,0,0],[180,0,0,0]];charmapIT[":"]=[[42,0,0,0],[52,0,0,0],[180,0,0,0],[170,0,0,0]];charmapIT["-"]=[[53,0,0,0],[181,0,0,0]];charmapIT["_"]=[[42,0,0,0],[53,0,0,0],[181,0,0,0],[170,0,0,0]];charmapIT[" "]=[[57,0,0,0],[185,0,0,0]];var keymapIT=[];keymapIT[27]=1;keymapIT[9]=15;keymapIT[16]=42;keymapIT[91]=29;keymapIT[17]=29;keymapIT[8]=14;keymapIT[12]=76;keymapIT[13]=28;keymapIT[18]=56;keymapIT[93]=93;keymapIT[38]=72;keymapIT[37]=75;keymapIT[40]=80;keymapIT[39]=77;keymapIT[45]=82;keymapIT[46]=83;keymapIT[36]=71;keymapIT[35]=79;keymapIT[33]=73;keymapIT[34]=81;keymapIT[144]=69;keymapIT[145]=70;keymapIT[112]=59;keymapIT[113]=60;keymapIT[114]=61;keymapIT[115]=62;keymapIT[116]=63;keymapIT[117]=64;keymapIT[118]=65;keymapIT[119]=66;keymapIT[120]=67;keymapIT[121]=68;keymapIT[122]=87;keymapIT[123]=88;var ctrlKeymapIT=[];ctrlKeymapIT[65]=30;ctrlKeymapIT[81]=16;ctrlKeymapIT[87]=17;ctrlKeymapIT[69]=18;ctrlKeymapIT[82]=19;ctrlKeymapIT[84]=20;ctrlKeymapIT[89]=21;ctrlKeymapIT[85]=22;ctrlKeymapIT[73]=23;ctrlKeymapIT[79]=24;ctrlKeymapIT[80]=25;ctrlKeymapIT[65]=30;ctrlKeymapIT[83]=31;ctrlKeymapIT[68]=32;ctrlKeymapIT[70]=33;ctrlKeymapIT[71]=34;ctrlKeymapIT[72]=35;ctrlKeymapIT[74]=36;ctrlKeymapIT[75]=37;ctrlKeymapIT[76]=38;ctrlKeymapIT[90]=44;ctrlKeymapIT[88]=45;ctrlKeymapIT[67]=46;ctrlKeymapIT[66]=48;ctrlKeymapIT[78]=49;ctrlKeymapIT[77]=50;var reservedCtrlKeymap=[];reservedCtrlKeymap[86]=47;return{getKeymap:function(){return keymapIT},getCtrlKeymap:function(){return ctrlKeymapIT},getReservedCtrlKeymap:function(){return reservedCtrlKeymap},getCharmap:function(){return charmapIT},setCtrlKey:function(key,val){ctrlKeymapIT[key]=val}}}();wdi.KeymapUS=function(){var charmapUS=[];charmapUS["`"]=[[41,0,0,0],[169,0,0,0]];charmapUS["~"]=[[42,0,0,0],[41,0,0,0],[169,0,0,0],[170,0,0,0]];charmapUS["1"]=[[2,0,0,0],[130,0,0,0]];charmapUS["!"]=[[42,0,0,0],[2,0,0,0],[130,0,0,0],[170,0,0,0]];charmapUS["2"]=[[3,0,0,0],[131,0,0,0]];charmapUS["@"]=[[42,0,0,0],[3,0,0,0],[131,0,0,0],[170,0,0,0]];charmapUS["3"]=[[4,0,0,0],[132,0,0,0]];charmapUS["#"]=[[42,0,0,0],[4,0,0,0],[132,0,0,0],[170,0,0,0]];charmapUS["4"]=[[5,0,0,0],[133,0,0,0]];charmapUS["$"]=[[42,0,0,0],[5,0,0,0],[133,0,0,0],[170,0,0,0]];charmapUS["5"]=[[6,0,0,0],[134,0,0,0]];charmapUS["%"]=[[42,0,0,0],[6,0,0,0],[134,0,0,0],[170,0,0,0]];charmapUS["6"]=[[7,0,0,0],[135,0,0,0]];charmapUS["^"]=[[42,0,0,0],[7,0,0,0],[135,0,0,0],[170,0,0,0]];charmapUS["7"]=[[8,0,0,0],[136,0,0,0]];charmapUS["&"]=[[42,0,0,0],[8,0,0,0],[136,0,0,0],[170,0,0,0]];charmapUS["8"]=[[9,0,0,0],[137,0,0,0]];charmapUS["*"]=[[42,0,0,0],[9,0,0,0],[137,0,0,0],[170,0,0,0]];charmapUS["9"]=[[10,0,0,0],[138,0,0,0]];charmapUS["("]=[[42,0,0,0],[10,0,0,0],[138,0,0,0],[170,0,0,0]];charmapUS["0"]=[[11,0,0,0],[139,0,0,0]];charmapUS[")"]=[[42,0,0,0],[11,0,0,0],[139,0,0,0],[170,0,0,0]];charmapUS["-"]=[[12,0,0,0],[140,0,0,0]];charmapUS["_"]=[[42,0,0,0],[12,0,0,0],[140,0,0,0],[170,0,0,0]];charmapUS["="]=[[13,0,0,0],[141,0,0,0]];charmapUS["+"]=[[42,0,0,0],[13,0,0,0],[141,0,0,0],[170,0,0,0]];charmapUS["q"]=[[16,0,0,0],[144,0,0,0]];charmapUS["Q"]=[[42,0,0,0],[16,0,0,0],[144,0,0,0],[170,0,0,0]];charmapUS["w"]=[[17,0,0,0],[145,0,0,0]];charmapUS["W"]=[[42,0,0,0],[17,0,0,0],[145,0,0,0],[170,0,0,0]];charmapUS["e"]=[[18,0,0,0],[146,0,0,0]];charmapUS["E"]=[[42,0,0,0],[18,0,0,0],[146,0,0,0],[170,0,0,0]];charmapUS["r"]=[[19,0,0,0],[147,0,0,0]];charmapUS["R"]=[[42,0,0,0],[19,0,0,0],[147,0,0,0],[170,0,0,0]];charmapUS["t"]=[[20,0,0,0],[148,0,0,0]];charmapUS["T"]=[[42,0,0,0],[20,0,0,0],[148,0,0,0],[170,0,0,0]];charmapUS["y"]=[[21,0,0,0],[149,0,0,0]];charmapUS["Y"]=[[42,0,0,0],[21,0,0,0],[149,0,0,0],[170,0,0,0]];charmapUS["u"]=[[22,0,0,0],[150,0,0,0]];charmapUS["U"]=[[42,0,0,0],[22,0,0,0],[150,0,0,0],[170,0,0,0]];charmapUS["i"]=[[23,0,0,0],[151,0,0,0]];charmapUS["I"]=[[42,0,0,0],[23,0,0,0],[151,0,0,0],[170,0,0,0]];charmapUS["o"]=[[24,0,0,0],[152,0,0,0]];charmapUS["O"]=[[42,0,0,0],[24,0,0,0],[152,0,0,0],[170,0,0,0]];charmapUS["p"]=[[25,0,0,0],[153,0,0,0]];charmapUS["P"]=[[42,0,0,0],[25,0,0,0],[153,0,0,0],[170,0,0,0]];charmapUS["["]=[[26,0,0,0],[154,0,0,0]];charmapUS["{"]=[[42,0,0,0],[26,0,0,0],[154,0,0,0],[170,0,0,0]];charmapUS["]"]=[[27,0,0,0],[155,0,0,0]];charmapUS["}"]=[[42,0,0,0],[27,0,0,0],[155,0,0,0],[170,0,0,0]];charmapUS["\\"]=[[43,0,0,0],[171,0,0,0]];charmapUS["|"]=[[42,0,0,0],[43,0,0,0],[171,0,0,0],[170,0,0,0]];charmapUS["a"]=[[30,0,0,0],[158,0,0,0]];charmapUS["A"]=[[42,0,0,0],[30,0,0,0],[158,0,0,0],[170,0,0,0]];charmapUS["s"]=[[31,0,0,0],[159,0,0,0]];charmapUS["S"]=[[42,0,0,0],[31,0,0,0],[159,0,0,0],[170,0,0,0]];charmapUS["d"]=[[32,0,0,0],[160,0,0,0]];charmapUS["D"]=[[42,0,0,0],[32,0,0,0],[160,0,0,0],[170,0,0,0]];charmapUS["f"]=[[33,0,0,0],[161,0,0,0]];charmapUS["F"]=[[42,0,0,0],[33,0,0,0],[161,0,0,0],[170,0,0,0]];charmapUS["g"]=[[34,0,0,0],[162,0,0,0]];charmapUS["G"]=[[42,0,0,0],[34,0,0,0],[162,0,0,0],[170,0,0,0]];charmapUS["h"]=[[35,0,0,0],[163,0,0,0]];charmapUS["H"]=[[42,0,0,0],[35,0,0,0],[163,0,0,0],[170,0,0,0]];charmapUS["j"]=[[36,0,0,0],[164,0,0,0]];charmapUS["J"]=[[42,0,0,0],[36,0,0,0],[164,0,0,0],[170,0,0,0]];charmapUS["k"]=[[37,0,0,0],[165,0,0,0]];charmapUS["K"]=[[42,0,0,0],[37,0,0,0],[165,0,0,0],[170,0,0,0]];charmapUS["l"]=[[38,0,0,0],[166,0,0,0]];charmapUS["L"]=[[42,0,0,0],[38,0,0,0],[166,0,0,0],[170,0,0,0]];charmapUS[";"]=[[39,0,0,0],[167,0,0,0]];charmapUS[":"]=[[42,0,0,0],[39,0,0,0],[167,0,0,0],[170,0,0,0]];charmapUS["'"]=[[40,0,0,0],[168,0,0,0]];charmapUS['"']=[[42,0,0,0],[40,0,0,0],[168,0,0,0],[170,0,0,0]];charmapUS["z"]=[[44,0,0,0],[172,0,0,0]];charmapUS["Z"]=[[42,0,0,0],[44,0,0,0],[172,0,0,0],[170,0,0,0]];charmapUS["x"]=[[45,0,0,0],[173,0,0,0]];charmapUS["X"]=[[42,0,0,0],[45,0,0,0],[173,0,0,0],[170,0,0,0]];charmapUS["c"]=[[46,0,0,0],[174,0,0,0]];charmapUS["C"]=[[42,0,0,0],[46,0,0,0],[174,0,0,0],[170,0,0,0]];charmapUS["v"]=[[47,0,0,0],[175,0,0,0]];charmapUS["V"]=[[42,0,0,0],[47,0,0,0],[175,0,0,0],[170,0,0,0]];charmapUS["b"]=[[48,0,0,0],[176,0,0,0]];charmapUS["B"]=[[42,0,0,0],[48,0,0,0],[176,0,0,0],[170,0,0,0]];charmapUS["n"]=[[49,0,0,0],[177,0,0,0]];charmapUS["N"]=[[42,0,0,0],[49,0,0,0],[177,0,0,0],[170,0,0,0]];charmapUS["m"]=[[50,0,0,0],[178,0,0,0]];charmapUS["M"]=[[42,0,0,0],[50,0,0,0],[178,0,0,0],[170,0,0,0]];charmapUS[","]=[[51,0,0,0],[179,0,0,0]];charmapUS["<"]=[[42,0,0,0],[51,0,0,0],[179,0,0,0],[170,0,0,0]];charmapUS["."]=[[52,0,0,0],[180,0,0,0]];charmapUS[">"]=[[42,0,0,0],[52,0,0,0],[180,0,0,0],[170,0,0,0]];charmapUS["/"]=[[53,0,0,0],[181,0,0,0]];charmapUS["?"]=[[42,0,0,0],[53,0,0,0],[181,0,0,0],[170,0,0,0]];charmapUS[" "]=[[57,0,0,0],[185,0,0,0]];var keymapUS=[];keymapUS[27]=1;keymapUS[9]=15;keymapUS[16]=42;keymapUS[91]=29;keymapUS[17]=29;keymapUS[32]=57;keymapUS[8]=14;keymapUS[13]=28;keymapUS[38]=72;keymapUS[37]=75;keymapUS[40]=80;keymapUS[39]=77;keymapUS[45]=82;keymapUS[46]=83;keymapUS[36]=71;keymapUS[35]=79;keymapUS[33]=73;keymapUS[34]=81;keymapUS[144]=69;keymapUS[145]=70;keymapUS[112]=59;keymapUS[113]=60;keymapUS[114]=61;keymapUS[115]=62;keymapUS[116]=63;keymapUS[117]=64;keymapUS[118]=65;keymapUS[119]=66;keymapUS[120]=67;keymapUS[121]=68;keymapUS[122]=87;keymapUS[123]=88;var ctrlkeymapUS=[];ctrlkeymapUS[65]=30;ctrlkeymapUS[81]=16;ctrlkeymapUS[87]=17;ctrlkeymapUS[69]=18;ctrlkeymapUS[82]=19;ctrlkeymapUS[84]=20;ctrlkeymapUS[89]=21;ctrlkeymapUS[85]=22;ctrlkeymapUS[73]=23;ctrlkeymapUS[79]=24;ctrlkeymapUS[80]=25;ctrlkeymapUS[65]=30;ctrlkeymapUS[83]=31;ctrlkeymapUS[68]=32;ctrlkeymapUS[70]=33;ctrlkeymapUS[71]=34;ctrlkeymapUS[72]=35;ctrlkeymapUS[74]=36;ctrlkeymapUS[75]=37;ctrlkeymapUS[76]=38;ctrlkeymapUS[90]=44;ctrlkeymapUS[88]=45;ctrlkeymapUS[67]=46;ctrlkeymapUS[66]=48;ctrlkeymapUS[78]=49;ctrlkeymapUS[77]=50;var reservedCtrlKeymap=[];reservedCtrlKeymap[86]=47;return{getKeymap:function(){return keymapUS},getCtrlKeymap:function(){return ctrlkeymapUS},getReservedCtrlKeymap:function(){return reservedCtrlKeymap},getCharmap:function(){return charmapUS},setCtrlKey:function(key,val){ctrlkeymapUS[key]=val}}}();wdi.keyShortcutsHandled={CTRLV:0};wdi.Keymap={keymap:{},ctrlKeymap:{},charmap:{},ctrlPressed:false,twoBytesScanCodes:[91,219,92,220,29,157,93,221,82,210,83,211,75,203,71,201,79,207,72,200,80,208,73,201,81,209,77,205,28,156],loadKeyMap:function(layout){try{this.keymap=wdi["Keymap"+layout.toUpperCase()].getKeymap();this.ctrlKeymap=wdi["Keymap"+layout.toUpperCase()].getCtrlKeymap();this.reservedCtrlKeymap=wdi["Keymap"+layout.toUpperCase()].getReservedCtrlKeymap();this.charmap=wdi["Keymap"+layout.toUpperCase()].getCharmap()}catch(e){this.keymap=wdi.KeymapES.getKeymap();this.ctrlKeymap=wdi.KeymapES.getCtrlKeymap();this.reservedCtrlKeymap=wdi.KeymapES.getReservedCtrlKeymap();this.charmap=wdi.KeymapES.getCharmap()}},isInKeymap:function(keycode){if(this.keymap[keycode]===undefined)return false;else return true},getScanCodes:function(e){if(e["hasScanCode"]){return e["scanCode"]}else if(this.handledByCtrlKeyCode(e["type"],e["keyCode"],e["generated"])){return this.getScanCodeFromKeyCode(e["keyCode"],e["type"],this.ctrlKeymap,this.reservedCtrlKeymap)}else if(this.handledByCharmap(e["type"])){return this.getScanCodesFromCharCode(e["charCode"])}else if(this.handledByNormalKeyCode(e["type"],e["keyCode"])){return this.getScanCodeFromKeyCode(e["keyCode"],e["type"],this.keymap)}else{return[]}},getScanCodeFromKeyCode:function(keyCode,type,keymap,additionalKeymap){this.controlPressed(keyCode,type);var key=null;if(keyCode in keymap){key=keymap[keyCode]}else{key=additionalKeymap[keyCode]}if(key===undefined)return[];if(key<256){if(type=="keydown"){return[this.makeKeymap(key)]}else if(type=="keyup"){return[this.makeKeymap(key|128)]}}else{if(type=="keydown"){return[this.makeKeymap(224|key-256<<8)]}else if(type=="keyup"){return[this.makeKeymap(32992|key-256<<8)]}}return key},controlPressed:function(keyCode,type){if(keyCode===17||keyCode===91){if(type==="keydown")this.ctrlPressed=true;else if(type==="keyup")this.ctrlPressed=false}},handledByCtrlKeyCode:function(type,keyCode,generated){if(type==="keydown"||type==="keyup"||type==="keypress"){if(this.ctrlPressed){if(type==="keypress"){return true}if(this.ctrlKeymap[keyCode]){return true}if(generated&&this.reservedCtrlKeymap[keyCode]){return true}}}return false},handledByNormalKeyCode:function(type,keyCode){if(type==="keydown"||type==="keyup"){if(this.keymap[keyCode]){return true}}return false},handledByCharmap:function(type){if(type==="inputmanager")return true;else return false},getScanCodesFromCharCode:function(charCode){var scanCode=this.charmap[String.fromCharCode(charCode)];if(scanCode===undefined)scanCode=[];return scanCode},makeKeymap:function(scancode){if($.inArray(scancode,this.twoBytesScanCodes)!=-1){return[224,scancode,0,0]}else{return[scancode,0,0]}}};window=this;if(!window["wdi"]){window["wdi"]={}}window["wdi"].WorkerOperations={quic:0,lz_rgb:1,bytesToUriJpeg:2,bytesToUriPng:3};function dispatch(arr,useMessage){var u8=new Uint8Array(arr);var postMessageW3CCompilant=u8[3];var result=null;var operation=u8[0];if(operation===wdi.WorkerOperations.quic){try{result=wdi.JSQuic.quic_decode(arr)}catch(e){}}else if(operation===wdi.WorkerOperations.lz_rgb){try{result=wdi.LZSS.lz_rgb32_decompress_rgb(arr)}catch(e){}}else if(operation===wdi.WorkerOperations.bytesToUriJpeg){try{result=bytesToURI(u8,"jpeg");self.postMessage(result);return}catch(e){}}else if(operation===wdi.WorkerOperations.bytesToUriPng){try{result=bytesToURI(u8,"png");self.postMessage(result);return}catch(e){}}if(useMessage&&result){if(postMessageW3CCompilant){self.postMessage(result,[result])}else{self.postMessage(result)}}else{return result}}window["workerDispatch"]=dispatch;self.addEventListener("message",function(e){return dispatch(e.data,true)},false);function bytesToURI(data,type){var tmpstr="data:image/"+type+",";var len=data.length;for(var i=4;i<len;i++){if(data[i]<16){tmpstr+="%0"}else{tmpstr+="%"}tmpstr+=data[i].toString(16)}return tmpstr}wdi.QuicImageType={QUIC_IMAGE_TYPE_INVALID:0,QUIC_IMAGE_TYPE_GRAY:1,QUIC_IMAGE_TYPE_RGB16:2,QUIC_IMAGE_TYPE_RGB24:3,QUIC_IMAGE_TYPE_RGB32:4,QUIC_IMAGE_TYPE_RGBA:5};function bytesToInt16(bytes){var low=bytes.shift();var high=bytes.shift();return high*Math.pow(16,2)+low}function bytesToInt32(bytes){var low=bytesToInt16(bytes);var high=bytesToInt16(bytes);return high*Math.pow(16,4)+low}wdi.quic={};function wdi_quic_QuicFamily(){this.notGRcwlen=[];this.nGRcodewords=[];this.notGRprefixmask=[];this.notGRsuffixlen=[];this.xlatU2L=[];this.xlatL2U=[]}function wdi_quic_s_bucket(){this.pcounters=null;this.bestcode=0}function wdi_quic_CommonState(){this.wm_trigger=this;this.encoder=null;this.waitcnt=0;this.tabrand_seed=wdi.JSQuic.stabrand();this.wmidx=wdi.JSQuic.DEFwmistart;this.wmileft=wdi.JSQuic.wminext;wdi.JSQuic.set_wm_trigger(this);this.melcstate=0;this.melclen=wdi.JSQuic.J[0];this.melcorder=1<<this.melclen>>>0}function wdi_quic_FamilyStat(){this.buckets_buf=null;this.buckets_ptrs=null;this.counters=0}function wdi_quic_Channel(){this.encoder=null;this.correlate_row_width=0;this.correlate_row=null;this._buckets_ptrs=null;this.family_stat_8bpc=new wdi_quic_FamilyStat;this.family_stat_5bpc=new wdi_quic_FamilyStat;this.state=new wdi_quic_CommonState;this.oldFirst=0}wdi.JSQuic={QUIC_MAGIC:1364543811,MAXNUMCODES:8,DEFevol:3,MINevol:0,MAXevol:5,DEFwmistart:0,MINwmistart:0,DEFmaxclen:26,DEFwmimax:6,DEFwminext:2048,MINwminext:1,MAXwminext:1e8,MAX_CHANNELS:4,wmimax:6,wminext:2048,evol:3,family_8bpc:new wdi_quic_QuicFamily,family_5bpc:new wdi_quic_QuicFamily,bppmask:new Int32Array([0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215,33554431,67108863,134217727,268435455,536870911,1073741823,2147483647,4294967295]),bitat:new Int32Array([1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536,131072,262144,524288,1048576,2097152,4194304,8388608,16777216,33554432,67108864,134217728,268435456,536870912,1073741824,2147483648]),TABRAND_TABSIZE:256,TABRAND_SEEDMASK:255,tabrand_chaos:new Int32Array([46495042,893548311,794435923,2453991765,2077388039,894197842,1462934312,697534094,1826128012,343623392,2581292719,3811265708,459739748,2638427270,1654964626,101227083,2654850628,3668700691,572794346,2758751005,3445133904,2344099199,3367450297,898927923,3618406352,1606297603,754696453,20823118,2050458127,972590750,3990194068,3305596553,4239238564,1690498157,3015324227,2306127097,1510321853,548392192,971157512,2292288069,1611390505,4086766286,4084927083,1883326811,1891043243,113180603,1107690783,3778825955,3248980775,2443839100,2190866218,1932072870,495393613,1078522166,4051963518,1784694977,1768732442,2146763203,264646923,1474361405,2361552500,296035746,2489922759,2094565616,2409465348,1334241083,72483606,3740181004,4057920662,1734898312,4114662834,574624900,880305546,3258472262,26713132,1571648456,52557195,4043234286,2458021343,676064371,1528437109,64953873,546717185,2709319979,1947039598,2812723004,28691684,286829174,4235176970,3465707163,12526951,2154766700,3165032534,2036061161,3386656087,2301212354,2023576300,1061142336,3105452904,2743866805,3283373992,3397596080,3085489552,3196092395,3210707808,3651022684,925444321,2088074316,230011220,3223248386,533229176,523863486,3028311159,13140218,2538347282,900399636,3000796173,1526771255,3541282854,2992674461,2135722105,389334227,1225164337,3119947809,1803959919,3471171263,704170491,1407019136,1924534819,526887421,168782227,333811993,298623278,4268451686,381087740,2542899140,3266880867,2498950977,200969370,3511909096,3252303004,2268881098,2499828613,2606499854,3163208665,3790254546,1840025712,1319758833,3771674836,519421307,3512796222,1563402978,4284300462,2263719815,715250337,3178437172,2660191010,2982332026,3256309961,2709659997,3434092872,2367065591,69438718,915160508,183164069,3134331940,175242981,2680543346,1421955782,4231173251,1736652874,3990568476,1710820912,2286604440,3464587098,1261907837,1757387321,1128554270,1090050251,2429922486,1288729218,882830086,211637042,1376462063,2147615815,1737974929,798170275,4271572277,4241687072,1638524620,2760366295,1065115089,2097227717,1224023317,1625204849,3383303351,1488272307,2640186157,1649047732,819719707,2615091943,502645401,760628135,4108137983,63606742,1404337880,1865161130,4272996852,1239761976,790984678,3213322601,1917062825,4195069880,1962259360,2111002573,2311983960,1861406170,511141875,2797510619,1331661048,3130608186,147483493,3767089176,2650841450,4096523407,2574446300,1956416337,851468126,3607527519,1811658703,3642821136,832691095,2453312857,933732854,94341217,3393797730,1695907457,2405722077,2877685663,2469507058,2249636341,3988608661,4001245617,825934927,3103985967,1127151177,3691656896,1640967098,2168932645,2830550957,3998822878,3002602893,1509651465,775813869,2599574079,3791574229]),besttrigtab:[[550,900,800,700,500,350,300,200,180,180,160],[110,550,900,800,550,400,350,250,140,160,140],[100,120,550,900,700,500,400,300,220,250,160]],lzeroes:new Int32Array([8,7,6,6,5,5,5,5,4,4,4,4,4,4,4,4,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),J:new Int32Array([0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,5,5,6,6,7,7,8,9,10,11,12,13,14,15]),zeroLUT:null,BPC_MASK:{4:255,5:255,24:255,16:31},stabrand:function(){return this.TABRAND_SEEDMASK},tabrand:function(rgb_state){rgb_state.tabrand_seed++;return this.tabrand_chaos[rgb_state.tabrand_seed&this.TABRAND_SEEDMASK]},set_wm_trigger:function(state){var wm=state.wmidx;if(wm>10){wm=10}state.wm_trigger=wdi.JSQuic.besttrigtab[Math.floor(wdi.JSQuic.evol>>1)][wm]},ceil_log_2:function(val){var result;if(val===1){return 0}result=1;val-=1;while(val>>>=1){result++}return result},decorelate_init:function(family,bpc){var pixelbitmask=this.bppmask[bpc];var pixelbitmaskshr=pixelbitmask>>>1;var s;for(s=0;s<=pixelbitmask;s++){if(s<=pixelbitmaskshr){family.xlatU2L[s]=s<<1>>>0}else{family.xlatU2L[s]=(pixelbitmask-s<<1>>>0)+1}}},corelate_init:function(family,bpc){var pixelbitmask=this.bppmask[bpc];var s;for(s=0;s<=pixelbitmask;s++){if(s&1){family.xlatL2U[s]=pixelbitmask-(s>>>1)}else{family.xlatL2U[s]=s>>>1}}},family_init:function(family,bpc,limit){var l;for(l=0;l<bpc;l++){var altprefixlen,altcodewords;altprefixlen=limit-bpc;if(altprefixlen>parseInt(this.bppmask[bpc-l])){altprefixlen=this.bppmask[bpc-l]}altcodewords=this.bppmask[bpc]+1-(altprefixlen<<l>>>0);family.nGRcodewords[l]=altprefixlen<<l>>>0;family.notGRcwlen[l]=altprefixlen+this.ceil_log_2(altcodewords);family.notGRprefixmask[l]=this.bppmask[32-altprefixlen];family.notGRsuffixlen[l]=this.ceil_log_2(altcodewords)}this.corelate_init(family,bpc)},init_zeroLUT:function(){this.zeroLUT=new Int32Array(256);var i,j,k,l;j=k=1;l=8;for(i=0;i<256;++i){this.zeroLUT[i]=l;--k;if(k===0){k=j;--l;j*=2}}},quic_init:function(){this.family_init(this.family_8bpc,8,this.DEFmaxclen);this.init_zeroLUT();wdi.xlatL2U=new Int32Array(this.family_8bpc.xlatL2U.length);wdi.xlatL2U.set(this.family_8bpc.xlatL2U);wdi.notGRprefixmask=new Int32Array(this.family_8bpc.notGRprefixmask.length);wdi.notGRprefixmask.set(this.family_8bpc.notGRprefixmask);wdi.nGRcodewords=new Int32Array(this.family_8bpc.nGRcodewords.length);wdi.nGRcodewords.set(this.family_8bpc.nGRcodewords);wdi.notGRcwlen=new Int32Array(this.family_8bpc.notGRcwlen.length);wdi.notGRcwlen.set(this.family_8bpc.notGRcwlen);wdi.notGRsuffixlen=new Int32Array(this.family_8bpc.notGRsuffixlen.length);wdi.notGRsuffixlen.set(this.family_8bpc.notGRsuffixlen);var lzeroes=wdi.JSQuic.lzeroes;var lzeroes8=new Int32Array(lzeroes);var len=lzeroes.length;for(var i=0;i<len;i++){lzeroes8[i]=lzeroes[i]+8}wdi.JSQuic.lzeroes8=lzeroes8;var lzeroes16=new Int32Array(lzeroes);for(var i=0;i<len;i++){lzeroes16[i]=lzeroes[i]+16}wdi.JSQuic.lzeroes16=lzeroes16;var lzeroes24=new Int32Array(lzeroes);for(var i=0;i<len;i++){lzeroes24[i]=lzeroes[i]+24}wdi.JSQuic.lzeroes24=lzeroes24},quic_image_params:function(encoder,type){var channels,bpc;switch(type){case wdi.QuicImageType.QUIC_IMAGE_TYPE_GRAY:channels=1;bpc=8;break;case wdi.QuicImageType.QUIC_IMAGE_TYPE_RGB16:channels=3;bpc=5;break;case wdi.QuicImageType.QUIC_IMAGE_TYPE_RGB24:channels=3;bpc=8;break;case wdi.QuicImageType.QUIC_IMAGE_TYPE_RGB32:channels=3;bpc=8;break;case wdi.QuicImageType.QUIC_IMAGE_TYPE_RGBA:channels=4;bpc=8;break;case wdi.QuicImageType.QUIC_IMAGE_TYPE_INVALID:default:channels=0;bpc=0}return[channels,bpc]},find_model_params:function(encoder,bpc){var bsize=0;var bstart=0;var bend=0;var repcntr=0;var result={};result.ncounters=8;result.levels=1<<bpc;result.n_buckets_ptrs=0;switch(this.evol){case 1:result.repfirst=3;result.firstsize=1;result.repnext=2;result.mulsize=2;break;case 3:result.repfirst=1;result.firstsize=1;result.repnext=1;result.mulsize=2;break;case 5:result.repfirst=1;result.firstsize=1;result.repnext=1;result.mulsize=4;break;case 0:case 2:case 4:default:wdi.Debug.error("fund model params: invalid evol");return false}result.nbuckets=0;repcntr=result.repfirst+1;bsize=result.firstsize;do{if(result.nbuckets){bstart=bend+1}else{bstart=0}if(!--repcntr){repcntr=result.repnext;bsize*=result.mulsize}bend=bstart+bsize-1;if(bend+bsize>=result.levels){bend=result.levels-1}if(!result.n_buckets_ptrs){result.n_buckets_ptrs=result.levels}result.nbuckets++}while(bend<result.levels-1);return result},init_model_structures:function(encoder,family,params){family.buckets_buf=[];for(var i=0;i<params.nbuckets;i++){family.buckets_buf[i]=new wdi_quic_s_bucket}family.buckets_ptrs=[];family.counters=[];this.fill_model_structures(encoder,family,params)},fill_model_structures:function(encoder,family,params){var bsize,bstart,bend=0,repcntr,bnumber;bnumber=0;repcntr=params.repfirst+1;bsize=params.firstsize;do{if(bnumber){bstart=bend+1}else{bstart=0}if(!--repcntr){repcntr=params.repnext;bsize*=params.mulsize}bend=bstart+bsize-1;if(bend+bsize>=params.levels){bend=params.levels-1}family.buckets_buf[bnumber].pcounters=new Int32Array(params.ncounters);for(var x=0;x<params.ncounters;x++){family.buckets_buf[bnumber].pcounters[x]=0}for(var i=bstart;i<=bend;i++){family.buckets_ptrs[i]=family.buckets_buf[bnumber]}bnumber++}while(bend<params.levels-1)},initChannel:function(encoder,channel){channel.encoder=encoder;channel.state.encoder=encoder;channel.correlate_row_width=0;channel.correlate_row=null;var params=this.find_model_params(encoder,8);encoder.n_buckets_8bpc=params.nbuckets;this.init_model_structures(encoder,channel.family_stat_8bpc,params);params=this.find_model_params(encoder,5);encoder.n_buckets_5bpc=params.nbuckets;this.init_model_structures(encoder,channel.family_stat_5bpc,params)},encoder_reste_channels:function(encoder,channels,width,bpc){encoder.num_channels=channels;for(var i=0;i<channels;i++){var bucket,end_bucket;if(encoder.channels[i].correlate_row_width<width){encoder.channels[i].correlate_row=new Array(width);encoder.channels[i].correlate_row_width=width}encoder.channels[i].num_channel=i;if(bpc===8){bucket=encoder.channels[i].family_stat_8bpc.buckets_buf;end_bucket=encoder.n_buckets_8bpc;for(var x=0;x<end_bucket;x++){bucket[x].bestcode=8-1}encoder.channels[i]._buckets_ptrs=encoder.channels[i].family_stat_8bpc.buckets_ptrs}else if(bpc===5){bucket=encoder.channels[i].family_stat_5bpc.buckets_buf;end_bucket=encoder.n_buckets_5bpc;for(var x=0;x<end_bucket;x++){bucket[x].bestcode=5-1}encoder.channels[i]._buckets_ptrs=encoder.channels[i].family_stat_5bpc.buckets_ptrs}else{return FALSE}encoder.channels[i].state.waitcnt=0;encoder.channels[i].state.tabrand_seed=wdi.JSQuic.stabrand();encoder.channels[i].state.wmidx=wdi.JSQuic.DEFwmistart;encoder.channels[i].state.wmileft=wdi.JSQuic.wminext}return true},decode_channel_run:function(encoder,channel){var runlen=0;do{var temp,hits;temp=wdi.JSQuic.zeroLUT[(~(encoder.io_word>>>24)>>>0)%256];for(hits=1;hits<=temp;hits++){runlen+=channel.state.melcorder;if(channel.state.melcstate<32){channel.state.melclen=wdi.JSQuic.J[++channel.state.melcstate];channel.state.melcorder=1<<channel.state.melclen>>>0}}if(temp!==8){encoder.eatbits(temp+1,encoder);break}encoder.eatbits(8,encoder)}while(1);if(channel.state.melclen){runlen+=encoder.io_word>>>32-channel.state.melclen;encoder.eatbits(channel.state.melclen,encoder)}if(channel.state.melcstate){channel.state.melclen=wdi.JSQuic.J[--channel.state.melcstate];channel.state.melcorder=1<<channel.state.melclen>>>0}return runlen},decode_run:function(encoder){var runlen=0;var temp,hits,tempadd;var zeroLUT=wdi.JSQuic.zeroLUT;var rgb_state=encoder.rgb_state;var J=wdi.JSQuic.J;var eatbits=encoder.eatbits;do{temp=zeroLUT[(~(encoder.io_word>>>24)>>>0)%256];tempadd=temp+1;for(hits=1;hits<tempadd;hits++){runlen+=encoder.rgb_state.melcorder;if(rgb_state.melcstate<32){rgb_state.melclen=J[++rgb_state.melcstate];rgb_state.melcorder=1<<rgb_state.melclen>>>0}}if(temp!==8){eatbits(tempadd,encoder);break}encoder.eatbits(8,encoder)}while(1);if(rgb_state.melclen){runlen+=encoder.io_word>>>32-rgb_state.melclen;eatbits(rgb_state.melclen,encoder)}if(rgb_state.melcstate){rgb_state.melclen=J[--rgb_state.melcstate];rgb_state.melcorder=1<<rgb_state.melclen>>>0}return runlen},quic_decode:function(data){var view=new Uint32Array(data);var encoder=new wdi_quic_Encoder(view);var opaque=encoder.io_word&65280;var format=encoder.io_word>>>24&255;encoder.eat32bits();encoder.eat32bits();var magic=encoder.io_word;encoder.eat32bits();var version=encoder.io_word;encoder.eat32bits();var type=encoder.io_word;encoder.eat32bits();encoder.type=type;var width=encoder.io_word;encoder.width=width;encoder.eat32bits();var height=encoder.io_word;encoder.height=height;encoder.eat32bits();var result=wdi.JSQuic.quic_image_params(encoder,type);var channels=result[0];var bpc=result[1];this.encoder_reste_channels(encoder,channels,width,bpc);var buf=new ArrayBuffer(width*height*4);var buf8=new Uint8Array(buf);var data=new Uint32Array(buf);encoder.result=buf8;encoder.resultData=data;encoder.setComputedWidth(width);switch(type){case wdi.QuicImageType.QUIC_IMAGE_TYPE_RGB32:case wdi.QuicImageType.QUIC_IMAGE_TYPE_RGB24:QUIC_UNCOMPRESS_RGB(encoder,channels,bpc,type);break;case wdi.QuicImageType.QUIC_IMAGE_TYPE_RGB16:break;case wdi.QuicImageType.QUIC_IMAGE_TYPE_RGBA:QUIC_UNCOMPRESS_RGBA(encoder,channels,bpc,type);if(opaque){var len=buf8.length-1;while(len>0){buf8[len]=255;len-=4}}break}return buf}};wdi.JSQuic.quic_init();function wdi_quic_Encoder(data){this.computedWidth=0;this.result=[];this.cnt=0;this.pxCnt=0,this.usr=data;this.type=null;this.width=null;this.height=null;this.num_channels=null;this.n_buckets_8bpc=null;this.n_buckets_5bpc=null;this.io_available_bits=32;this.io_now=0;this.io_next_word=null;this.io_now=null;this.read_io_word();this.io_word=this.io_next_word;this.read_io_word();this.io_words_count=data.length;this.rows_completed=0;this.channels=[];this.alphaPos=3;this.rgb_state=new wdi_quic_CommonState;for(var i=0;i<4;i++){this.channels[i]=new wdi_quic_Channel;wdi.JSQuic.initChannel(this,this.channels[i])}}wdi_quic_Encoder.prototype.append=function(databyte){this.result[this.cnt++]=databyte};wdi_quic_Encoder.prototype.appendPixel=function(r,g,b){this.resultData[this.pxCnt++]=255<<24|b<<16|g<<8|r;this.cnt+=4};wdi_quic_Encoder.prototype.eatbits=function(len,encoder){var available_bits=encoder.io_available_bits;var io_word=encoder.io_word;var delta=available_bits-len;io_word=io_word<<len;if(delta>=0){io_word=(io_word|encoder.io_next_word>>>delta)>>>0;encoder.io_available_bits=delta;encoder.io_word=io_word;return}var io_next_word=encoder.io_next_word;delta=-delta;io_word=io_word|io_next_word<<delta>>>0;io_next_word=encoder.usr[encoder.io_now++];available_bits=32-delta;io_word=(io_word|io_next_word>>>available_bits)>>>0;encoder.io_available_bits=available_bits;encoder.io_word=io_word;encoder.io_next_word=io_next_word};wdi_quic_Encoder.prototype.eat32bits=function(){this.eatbits(16,this);this.eatbits(16,this)};wdi_quic_Encoder.prototype.read_io_word=function(){this.io_next_word=this.usr[this.io_now++]};wdi_quic_Encoder.prototype.row_completed=function(){this.rows_completed++};wdi_quic_Encoder.prototype.setComputedWidth=function(width){this.computedWidth=width*4};wdi_quic_Encoder.prototype.appendAlpha=function(databyte){this.result[this.alphaPos]=databyte;this.alphaPos+=4};function cnt_l_zeroes(bits){if(bits>8388607){return wdi.JSQuic.lzeroes[bits>>>24]}else if(bits>32767){return 8+wdi.JSQuic.lzeroes[bits>>>16&255]}else if(bits>127){return 16+wdi.JSQuic.lzeroes[bits>>>8&255]}else{return 24+wdi.JSQuic.lzeroes[bits&255]}}function golomb_code_len(n,l){if(n<wdi.nGRcodewords[l]){return(n>>>l)+1+l}else{
return wdi.notGRcwlen[l]}}function golomb_decoding(l,bits,bppmask,notGRprefixmask,notGRcwlen,nGRcodewords,notGRsuffixlen){var cwlen;var result;if(bits>notGRprefixmask[l]){var zeroprefix=cnt_l_zeroes(bits);cwlen=zeroprefix+1+l;result=zeroprefix<<l|bits>>>32-cwlen&bppmask[l]}else{cwlen=notGRcwlen[l];result=nGRcodewords[l]+(bits>>>32-cwlen&bppmask[notGRsuffixlen[l]])}return[result,cwlen]}function real_update_model(state,bucket,curval,bpp,wm_trigger){var i;var bestcode;var bestcodelen;var ithcodelen;var pcounters=bucket.pcounters;bestcode=bpp-1;bestcodelen=pcounters[bestcode]+=golomb_code_len(curval,bestcode);for(i=bpp-2;i>=0;i--){ithcodelen=pcounters[i]+=golomb_code_len(curval,i);if(ithcodelen<bestcodelen){bestcode=i;bestcodelen=ithcodelen}}bucket.bestcode=bestcode;if(bestcodelen>state.wm_trigger){while(bpp-- >0){pcounters[bpp]>>>=1}}}function UPDATE_MODEL(index,encoder,bpp,correlate_row_r,correlate_row_g,correlate_row_b){real_update_model(encoder.rgb_state,find_bucket(encoder.channels[0],correlate_row_r[index-1]),correlate_row_r[index],bpp);real_update_model(encoder.rgb_state,find_bucket(encoder.channels[1],correlate_row_g[index-1]),correlate_row_g[index],bpp);real_update_model(encoder.rgb_state,find_bucket(encoder.channels[2],correlate_row_b[index-1]),correlate_row_b[index],bpp)}function find_bucket(channel,val){if(val===undefined){val=channel.oldFirst}return channel._buckets_ptrs[val]}function QUIC_UNCOMPRESS_RGBA(encoder,channels,bpc,type){quic_uncompress_row0(encoder,channels,bpc,type);quic_four_uncompress_row0(encoder,encoder.channels[3],bpc,type);encoder.row_completed();var height=encoder.height;var rgb_state=encoder.rgb_state;for(var row=1;row<height;row++){quic_uncompress_row_a(encoder,channels,bpc,type,rgb_state);quic_four_uncompress_row(encoder,encoder.channels[3],bpc,type);encoder.row_completed()}}function quic_four_uncompress_row(encoder,channel,bpc,type){var bpc_mask=wdi.JSQuic.BPC_MASK[type];var pos=0;var width=encoder.width;while(wdi.JSQuic.wmimax>channel.state.wmidx&&channel.state.wmileft<=width){if(channel.state.wmileft){uncompress_four_row_seg(encoder,channel,pos,pos+channel.state.wmileft,bpc,bpc_mask,type);pos+=channel.state.wmileft;width-=channel.state.wmileft}channel.state.wmidx++;wdi.JSQuic.set_wm_trigger(channel.state);channel.state.wmileft=wdi.JSQuic.wminext}if(width){uncompress_four_row_seg(encoder,channel,pos,pos+width,bpc,bpc_mask,type);if(wdi.JSQuic.wmimax>channel.state.wmidx){channel.state.wmileft-=width}}}function uncompress_four_row_seg(encoder,channel,i,end,bpc,bpc_mask,type){var correlate_row=channel.correlate_row;var stopidx=0;var waitmask=wdi.JSQuic.bppmask[channel.state.wmidx];var run_index=0;var run_end=0;var rle=false;var computedWidth=encoder.computedWidth;var rows_completed=encoder.rows_completed;var offset=(encoder.rows_completed-1)*computedWidth;var data;var eatbits=encoder.eatbits;var appendAlpha=encoder.appendAlpha;var alpha;var ret,codewordlen;var bppmask=wdi.JSQuic.bppmask;var notGRprefixmask=wdi.notGRprefixmask;var notGRcwlen=wdi.notGRcwlen;var nGRcodewords=wdi.nGRcodewords;var notGRsuffixlen=wdi.notGRsuffixlen;if(!i){alpha=UNCOMPRESS_ONE_0_A(channel,encoder,bpc_mask,offset);if(channel.state.waitcnt){--channel.state.waitcnt}else{channel.state.waitcnt=wdi.JSQuic.tabrand(channel.state)&waitmask;real_update_model(channel.state,find_bucket(channel,correlate_row[-1]),correlate_row[0],bpc)}stopidx=++i+channel.state.waitcnt}else{stopidx=i+channel.state.waitcnt;alpha=encoder.result[encoder.alphaPos-4]}for(;;){while(stopidx<end){for(;i<=stopidx;i++){rle=RLE_PRED_A(i,encoder,run_index,computedWidth,rows_completed);if(rle)break;ret=golomb_decoding(find_bucket(channel,correlate_row[i-1]).bestcode,encoder.io_word,bppmask,notGRprefixmask,notGRcwlen,nGRcodewords,notGRsuffixlen);data=ret[0];codewordlen=ret[1];correlate_row[i]=data;alpha=(wdi.xlatL2U[data]+(alpha+PIXEL_B(channel,encoder,i,offset)>>>1)&bpc_mask)>>>0;appendAlpha.call(encoder,alpha);eatbits(codewordlen,encoder)}if(!rle){real_update_model(channel.state,find_bucket(channel,correlate_row[stopidx-1]),correlate_row[stopidx],bpc);stopidx=i+(wdi.JSQuic.tabrand(channel.state)&waitmask)}else{break}}if(!rle){for(;i<end;i++){rle=RLE_PRED_A(i,encoder,run_index,computedWidth,rows_completed);if(rle)break;ret=golomb_decoding(find_bucket(channel,correlate_row[i-1]).bestcode,encoder.io_word,bppmask,notGRprefixmask,notGRcwlen,nGRcodewords,notGRsuffixlen);data=ret[0];codewordlen=ret[1];correlate_row[i]=data;alpha=(wdi.xlatL2U[data]+(alpha+PIXEL_B(channel,encoder,i,offset)>>>1)&bpc_mask)>>>0;appendAlpha.call(encoder,alpha);eatbits(codewordlen,encoder)}if(!rle){channel.state.waitcnt=stopidx-end;return}}channel.state.waitcnt=stopidx-i;run_index=i;run_end=i+wdi.JSQuic.decode_channel_run(encoder,channel);var cpos=encoder.rows_completed*(encoder.width*4)+i*4;var a=encoder.result[cpos-1];for(;i<run_end;i++){appendAlpha.call(encoder,a)}if(i===end){return}stopidx=i+channel.state.waitcnt;rle=false}}function quic_four_uncompress_row0(encoder,channel,bpc,type){var bpc_mask=wdi.JSQuic.BPC_MASK[type];var pos=0;var width=encoder.width;while(wdi.JSQuic.wmimax>channel.state.wmidx&&channel.state.wmileft<=width){if(channel.state.wmileft){uncompress_four_row0_seg(encoder,channel,pos,pos+channel.wmileft,wdi.JSQuic.bppmask[channel.state.wmidx],bpc,bpc_mask,type);pos+=channel.state.wmileft;width-=channel.state.wmileft}channel.state.wmidx++;wdi.JSQuic.set_wm_trigger(channel.state);channel.state.wmileft=wdi.JSQuic.wminext}if(width){uncompress_four_row0_seg(encoder,channel,pos,pos+width,wdi.JSQuic.bppmask[channel.state.wmidx],bpc,bpc_mask,type);if(wdi.JSQuic.wmimax>channel.state.wmidx){channel.state.wmileft-=width}}}function uncompress_four_row0_seg(encoder,channel,i,end,waitmask,bpc,bpc_mask,type){var correlate_row=channel.correlate_row;var stopidx=0;if(!i){UNCOMPRESS_ONE_ROW0_0_A(channel);if(channel.state.waitcnt){--channel.state.waitcnt}else{channel.state.waitcnt=wdi.JSQuic.tabrand(channel.state)&waitmask;real_update_model(channel.state,find_bucket(channel,correlate_row[-1]),correlate_row[0],bpc)}stopidx=++i+channel.state.waitcnt}else{stopidx=i+channel.state.waitcnt}while(stopidx<end){for(;i<=stopidx;i++){UNCOMPRESS_ONE_ROW0_A(channel,i,bpc_mask,encoder,correlate_row)}real_update_model(channel.state,find_bucket(channel,correlate_row[stopidx-1]),correlate_row[stopidx],bpc);stopidx=i+(wdi.JSQuic.tabrand(channel.state)&waitmask)}for(;i<end;i++){UNCOMPRESS_ONE_ROW0_A(channel,i,bpc_mask,encoder,correlate_row)}channel.state.waitcnt=stopidx-end}function SAME_PIXEL_A(i,result){if(result[i-1]===result[i+3]){return true}return false}function RLE_PRED_A(i,encoder,run_index,width,rows_completed){var pr=(rows_completed-1)*width+i*4;if(run_index!==i&&i>2){if(SAME_PIXEL_A(pr,encoder.result)){pr=rows_completed*width+(i-1)*4;if(SAME_PIXEL_A(pr,encoder.result)){return true}}}return false}function UNCOMPRESS_ONE_0_A(channel,encoder,bpc_mask,offset){var ret,codewordlen;channel.oldFirst=channel.correlate_row[0];ret=golomb_decoding(find_bucket(channel,channel.correlate_row[-1]).bestcode,encoder.io_word,wdi.JSQuic.bppmask,wdi.notGRprefixmask,wdi.notGRcwlen,wdi.nGRcodewords,wdi.notGRsuffixlen);channel.correlate_row[0]=ret[0];codewordlen=ret[1];var residuum=wdi.xlatL2U[channel.correlate_row[0]];var prev=PIXEL_B(channel,encoder,0,offset);var resultpixel=(residuum+prev&bpc_mask)>>>0;encoder.appendAlpha(resultpixel);encoder.eatbits(codewordlen,encoder);return resultpixel}function UNCOMPRESS_ONE_A(channel,i,bpc_mask,encoder,correlate_row,offset){var ret,codewordlen;ret=golomb_decoding(find_bucket(channel,correlate_row[i-1]).bestcode,encoder.io_word,wdi.JSQuic.bppmask,wdi.notGRprefixmask,wdi.notGRcwlen,wdi.nGRcodewords,wdi.notGRsuffixlen);var data=ret[0];codewordlen=ret[1];correlate_row[i]=data;encoder.appendAlpha((wdi.xlatL2U[data]+(PIXEL_A_A(encoder)+PIXEL_B(channel,encoder,i,offset)>>>1)&bpc_mask)>>>0);encoder.eatbits(codewordlen,encoder)}function UNCOMPRESS_ONE_ROW0_0_A(channel){var ret,codewordlen;var encoder=channel.encoder;ret=golomb_decoding(find_bucket(channel,0).bestcode,encoder.io_word,wdi.JSQuic.bppmask,wdi.notGRprefixmask,wdi.notGRcwlen,wdi.nGRcodewords,wdi.notGRsuffixlen);channel.correlate_row[0]=ret[0];codewordlen=ret[1];encoder.appendAlpha(wdi.xlatL2U[channel.correlate_row[0]]);encoder.eatbits(codewordlen,encoder)}function UNCOMPRESS_ONE_ROW0_A(channel,i,bpc_mask,encoder,correlate_row){var ret,codewordlen;ret=golomb_decoding(find_bucket(channel,correlate_row[i-1]).bestcode,encoder.io_word,wdi.JSQuic.bppmask,wdi.notGRprefixmask,wdi.notGRcwlen,wdi.nGRcodewords,wdi.notGRsuffixlen);var data=ret[0];codewordlen=ret[1];correlate_row[i]=data;encoder.appendAlpha(CORELATE_0_A(encoder,channel,i,bpc_mask,correlate_row));encoder.eatbits(codewordlen,encoder)}function CORELATE_0_A(encoder,channel,curr,bpc_mask,correlate_row){return(wdi.xlatL2U[correlate_row[curr]]+PIXEL_A_A(encoder)&bpc_mask)>>>0}function PIXEL_A_A(encoder){return encoder.result[encoder.alphaPos-4]}function QUIC_UNCOMPRESS_RGB(encoder,channels,bpc,type){quic_uncompress_row0(encoder,channels,bpc,type);encoder.row_completed();var rgb_state=encoder.rgb_state;var height=encoder.height;var computedAlpha=255<<24;var result=encoder.result;var resultData=encoder.resultData;var width=encoder.width;var bpc_mask=wdi.JSQuic.BPC_MASK[type];var jsquic=wdi.JSQuic;var channel_r=encoder.channels[0];var channel_g=encoder.channels[1];var channel_b=encoder.channels[2];var buckets_ptrs_r=channel_r._buckets_ptrs;var buckets_ptrs_g=channel_g._buckets_ptrs;var buckets_ptrs_b=channel_b._buckets_ptrs;var correlate_row_r=channel_r.correlate_row;var correlate_row_g=channel_g.correlate_row;var correlate_row_b=channel_b.correlate_row;var computedWidth=encoder.computedWidth;var xlatL2U=wdi.xlatL2U;var lzeroes=wdi.JSQuic.lzeroes;var lzeroes8=wdi.JSQuic.lzeroes8;var lzeroes16=wdi.JSQuic.lzeroes16;var lzeroes24=wdi.JSQuic.lzeroes24;var notGRprefixmask=wdi.notGRprefixmask;var notGRcwlen=wdi.notGRcwlen;var nGRcodewords=wdi.nGRcodewords;var notGRsuffixlen=wdi.notGRsuffixlen;var eatbits=encoder.eatbits;var tabrand=wdi.JSQuic.tabrand;var decode_run=wdi.JSQuic.decode_run;var bppmask=wdi.JSQuic.bppmask;var jsquic=wdi.JSQuic;var tabrand_chaos=wdi.JSQuic.tabrand_chaos;var tabrand_seedmask=jsquic.TABRAND_SEEDMASK;var usr=encoder.usr;for(var row=1;row<height;row++){quic_uncompress_row(encoder,channels,bpc,type,rgb_state,computedAlpha,result,resultData,width,bpc_mask,jsquic,channel_r,channel_g,channel_b,buckets_ptrs_r,buckets_ptrs_g,buckets_ptrs_b,correlate_row_r,correlate_row_g,correlate_row_b,computedWidth,xlatL2U,lzeroes,lzeroes8,lzeroes16,lzeroes24,notGRprefixmask,notGRcwlen,nGRcodewords,notGRsuffixlen,eatbits,tabrand,decode_run,bppmask,tabrand_chaos,tabrand_seedmask,usr);encoder.rows_completed++}}function quic_uncompress_row(encoder,channels,bpc,type,rgb_state,computedAlpha,result,resultData,width,bpc_mask,jsquic,channel_r,channel_g,channel_b,buckets_ptrs_r,buckets_ptrs_g,buckets_ptrs_b,correlate_row_r,correlate_row_g,correlate_row_b,computedWidth,xlatL2U,lzeroes,lzeroes8,lzeroes16,lzeroes24,notGRprefixmask,notGRcwlen,nGRcodewords,notGRsuffixlen,eatbits,tabrand,decode_run,bppmask,tabrand_chaos,tabrand_seedmask,usr){var pos=0;var rows_completed=encoder.rows_completed;var currentOffset32=rows_completed*computedWidth/4;var offset=(rows_completed-1)*computedWidth;while(jsquic.wmimax>rgb_state.wmidx&&rgb_state.wmileft<=width){if(rgb_state.wmileft){uncompress_row_seg(encoder,pos,pos+rgb_state.wmileft,bpc,bpc_mask,type,rgb_state,computedAlpha,result,resultData,channel_r,channel_g,channel_b,buckets_ptrs_r,buckets_ptrs_g,buckets_ptrs_b,correlate_row_r,correlate_row_g,correlate_row_b,computedWidth,xlatL2U,lzeroes,lzeroes8,lzeroes16,lzeroes24,notGRprefixmask,notGRcwlen,nGRcodewords,notGRsuffixlen,eatbits,tabrand,decode_run,bppmask,jsquic,tabrand_chaos,rows_completed,tabrand_seedmask,offset,currentOffset32,usr);pos+=rgb_state.wmileft;width-=rgb_state.wmileft}rgb_state.wmidx++;jsquic.set_wm_trigger(rgb_state);rgb_state.wmileft=jsquic.wminext}if(width){uncompress_row_seg(encoder,pos,pos+width,bpc,bpc_mask,type,rgb_state,computedAlpha,result,resultData,channel_r,channel_g,channel_b,buckets_ptrs_r,buckets_ptrs_g,buckets_ptrs_b,correlate_row_r,correlate_row_g,correlate_row_b,computedWidth,xlatL2U,lzeroes,lzeroes8,lzeroes16,lzeroes24,notGRprefixmask,notGRcwlen,nGRcodewords,notGRsuffixlen,eatbits,tabrand,decode_run,bppmask,jsquic,tabrand_chaos,rows_completed,tabrand_seedmask,offset,currentOffset32,usr);if(jsquic.wmimax>encoder.rgb_state.wmidx){rgb_state.wmileft-=width}}}function quic_uncompress_row_a(encoder,channels,bpc,type,rgb_state){var bpc_mask=wdi.JSQuic.BPC_MASK[type];var pos=0;var width=encoder.width;while(wdi.JSQuic.wmimax>rgb_state.wmidx&&rgb_state.wmileft<=width){if(rgb_state.wmileft){uncompress_row_seg_a(encoder,pos,pos+rgb_state.wmileft,bpc,bpc_mask,type,rgb_state);pos+=rgb_state.wmileft;width-=rgb_state.wmileft}rgb_state.wmidx++;wdi.JSQuic.set_wm_trigger(rgb_state);rgb_state.wmileft=wdi.JSQuic.wminext}if(width){uncompress_row_seg_a(encoder,pos,pos+width,bpc,bpc_mask,type,rgb_state);if(wdi.JSQuic.wmimax>encoder.rgb_state.wmidx){rgb_state.wmileft-=width}}}function SAME_PIXEL_RGB_A(i,result){if(result[i-4]===result[i]&&result[i-3]===result[i+1]&&result[i-2]===result[i+2])return true;return false}function SAME_PIXEL(i,result){if(result[i-1]===result[i])return true;return false}function RLE_PRED_RGB_A(i,encoder,offset,currentOffset,run_index){if(run_index!==i&&i>2){if(SAME_PIXEL_RGB_A(offset,encoder.result)){var pr=currentOffset+(i-1)*4;if(SAME_PIXEL_RGB_A(pr,encoder.result)){return true}}}return false}function RLE_PRED(i,encoder,offset,currentOffset,run_index){if(run_index!==i&&i>2){if(SAME_PIXEL(offset*4,encoder.result)){var pr=currentOffset+i-1;if(SAME_PIXEL(pr*4,encoder.result)){return true}}}return false}function uncompress_row_seg(encoder,i,end,bpc,bpc_mask,type,rgb_state,computedAlpha,result,resultData,channel_r,channel_g,channel_b,buckets_ptrs_r,buckets_ptrs_g,buckets_ptrs_b,correlate_row_r,correlate_row_g,correlate_row_b,computedWidth,xlatL2U,lzeroes,lzeroes8,lzeroes16,lzeroes24,notGRprefixmask,notGRcwlen,nGRcodewords,notGRsuffixlen,eatbits,tabrand,decode_run,bppmask,jsquic,tabrand_chaos,rows_completed,tabrand_seedmask,offset,currentOffset32,usr){var stopidx=0;var waitmask=bppmask[rgb_state.wmidx];var run_index=0;var rle=false;var i_1,i_4;var pr,pg,pb;var prevCorrelatedR,prevCorrelatedG,prevCorrelatedB;var ret,codewordlen,l,bits,zeroprefix;var cnt=encoder.cnt;var pxCnt=encoder.pxCnt;var prev_row,i4sub,stopidx_sub1;var available_bits,io_word,delta,io_next_word;if(!i){pr=UNCOMPRESS_ONE_0(channel_r,encoder,bpc_mask,offset);pg=UNCOMPRESS_ONE_0(channel_g,encoder,bpc_mask,offset);pb=UNCOMPRESS_ONE_0(channel_b,encoder,bpc_mask,offset);prevCorrelatedR=correlate_row_r[0];prevCorrelatedG=correlate_row_g[0];prevCorrelatedB=correlate_row_b[0];resultData[pxCnt++]=255<<24|pb<<16|pg<<8|pr;if(rgb_state.waitcnt){--rgb_state.waitcnt}else{rgb_state.waitcnt=tabrand.call(jsquic,rgb_state)&waitmask;UPDATE_MODEL(0,encoder,bpc,correlate_row_r,correlate_row_g,correlate_row_b)}stopidx=++i+rgb_state.waitcnt}else{stopidx=i+rgb_state.waitcnt;pr=result[cnt-4];pg=result[cnt-3];pb=result[cnt-2];prevCorrelatedR=correlate_row_r[i-1];prevCorrelatedG=correlate_row_g[i-1];prevCorrelatedB=correlate_row_b[i-1]}while(true){while(stopidx<end){i_4=offset+i*4;for(;i<=stopidx;i++){i4sub=i_4/4;if(resultData[i4sub-1]===resultData[i4sub]){prev_row=currentOffset32+i-1;if(resultData[prev_row-1]===resultData[prev_row]){if(run_index!==i&&i>2){rle=true;break}}}l=buckets_ptrs_r[prevCorrelatedR].bestcode;bits=encoder.io_word;if(bits>notGRprefixmask[l]){if(bits>8388607){zeroprefix=lzeroes[bits>>>24]}else if(bits>32767){zeroprefix=lzeroes8[bits>>>16&255]}else if(bits>127){zeroprefix=lzeroes16[bits>>>8&255]}else{zeroprefix=lzeroes24[bits&255]}codewordlen=zeroprefix+1+l;prevCorrelatedR=zeroprefix<<l|bits>>>32-codewordlen&bppmask[l]}else{codewordlen=notGRcwlen[l];prevCorrelatedR=nGRcodewords[l]+(bits>>>32-codewordlen&bppmask[notGRsuffixlen[l]])}correlate_row_r[i]=prevCorrelatedR;pr=xlatL2U[prevCorrelatedR]+(pr+result[i_4++]>>>1)&bpc_mask;available_bits=encoder.io_available_bits;io_word=encoder.io_word;delta=available_bits-codewordlen;io_word=io_word<<codewordlen;if(delta>=0){io_word=(io_word|encoder.io_next_word>>>delta)>>>0;encoder.io_available_bits=delta;encoder.io_word=io_word}else{io_next_word=encoder.io_next_word;delta=-delta;io_word=io_word|io_next_word<<delta>>>0;io_next_word=usr[encoder.io_now++];available_bits=32-delta;io_word=(io_word|io_next_word>>>available_bits)>>>0;encoder.io_available_bits=available_bits;encoder.io_word=io_word;encoder.io_next_word=io_next_word}l=buckets_ptrs_g[prevCorrelatedG].bestcode;bits=encoder.io_word;if(bits>notGRprefixmask[l]){if(bits>8388607){zeroprefix=lzeroes[bits>>>24]}else if(bits>32767){zeroprefix=lzeroes8[bits>>>16&255]}else if(bits>127){zeroprefix=lzeroes16[bits>>>8&255]}else{zeroprefix=lzeroes24[bits&255]}codewordlen=zeroprefix+1+l;prevCorrelatedG=zeroprefix<<l|bits>>>32-codewordlen&bppmask[l]}else{codewordlen=notGRcwlen[l];prevCorrelatedG=nGRcodewords[l]+(bits>>>32-codewordlen&bppmask[notGRsuffixlen[l]])}correlate_row_g[i]=prevCorrelatedG;pg=xlatL2U[prevCorrelatedG]+(pg+result[i_4++]>>>1)&bpc_mask;available_bits=encoder.io_available_bits;io_word=encoder.io_word;delta=available_bits-codewordlen;io_word=io_word<<codewordlen;if(delta>=0){io_word=(io_word|encoder.io_next_word>>>delta)>>>0;encoder.io_available_bits=delta;encoder.io_word=io_word}else{io_next_word=encoder.io_next_word;delta=-delta;io_word=io_word|io_next_word<<delta>>>0;io_next_word=usr[encoder.io_now++];available_bits=32-delta;io_word=(io_word|io_next_word>>>available_bits)>>>0;encoder.io_available_bits=available_bits;encoder.io_word=io_word;encoder.io_next_word=io_next_word}l=buckets_ptrs_b[prevCorrelatedB].bestcode;bits=encoder.io_word;if(bits>notGRprefixmask[l]){if(bits>8388607){zeroprefix=lzeroes[bits>>>24]}else if(bits>32767){zeroprefix=lzeroes8[bits>>>16&255]}else if(bits>127){zeroprefix=lzeroes16[bits>>>8&255]}else{zeroprefix=lzeroes24[bits&255]}codewordlen=zeroprefix+1+l;prevCorrelatedB=zeroprefix<<l|bits>>>32-codewordlen&bppmask[l]}else{codewordlen=notGRcwlen[l];prevCorrelatedB=nGRcodewords[l]+(bits>>>32-codewordlen&bppmask[notGRsuffixlen[l]])}correlate_row_b[i]=prevCorrelatedB;pb=xlatL2U[prevCorrelatedB]+(pb+result[i_4++]>>>1)&bpc_mask;available_bits=encoder.io_available_bits;io_word=encoder.io_word;delta=available_bits-codewordlen;io_word=io_word<<codewordlen;if(delta>=0){io_word=(io_word|encoder.io_next_word>>>delta)>>>0;encoder.io_available_bits=delta;encoder.io_word=io_word}else{io_next_word=encoder.io_next_word;delta=-delta;io_word=io_word|io_next_word<<delta>>>0;io_next_word=usr[encoder.io_now++];available_bits=32-delta;io_word=(io_word|io_next_word>>>available_bits)>>>0;encoder.io_available_bits=available_bits;encoder.io_word=io_word;encoder.io_next_word=io_next_word}resultData[pxCnt++]=computedAlpha|pb<<16|pg<<8|pr;i_4++}if(!rle){stopidx_sub1=stopidx-1;real_update_model(rgb_state,buckets_ptrs_r[correlate_row_r[stopidx_sub1]],correlate_row_r[stopidx],bpc);real_update_model(rgb_state,buckets_ptrs_g[correlate_row_g[stopidx_sub1]],correlate_row_g[stopidx],bpc);real_update_model(rgb_state,buckets_ptrs_b[correlate_row_b[stopidx_sub1]],correlate_row_b[stopidx],bpc);rgb_state.tabrand_seed++;stopidx=i+(tabrand_chaos[rgb_state.tabrand_seed&tabrand_seedmask]&waitmask)}else{break}}if(!rle){i_4=offset+i*4;for(;i<end;i++){i4sub=i_4/4;if(resultData[i4sub-1]===resultData[i4sub]){prev_row=currentOffset32+i-1;if(resultData[prev_row-1]===resultData[prev_row]){if(run_index!==i&&i>2){rle=true;break}}}l=buckets_ptrs_r[prevCorrelatedR].bestcode;bits=encoder.io_word;if(bits>notGRprefixmask[l]){if(bits>8388607){zeroprefix=lzeroes[bits>>>24]}else if(bits>32767){zeroprefix=lzeroes8[bits>>>16&255]}else if(bits>127){zeroprefix=lzeroes16[bits>>>8&255]}else{zeroprefix=lzeroes24[bits&255]}codewordlen=zeroprefix+1+l;prevCorrelatedR=zeroprefix<<l|bits>>>32-codewordlen&bppmask[l]}else{codewordlen=notGRcwlen[l];prevCorrelatedR=nGRcodewords[l]+(bits>>>32-codewordlen&bppmask[notGRsuffixlen[l]])}correlate_row_r[i]=prevCorrelatedR;pr=xlatL2U[prevCorrelatedR]+(pr+result[i_4++]>>>1)&bpc_mask;available_bits=encoder.io_available_bits;io_word=encoder.io_word;delta=available_bits-codewordlen;io_word=io_word<<codewordlen;if(delta>=0){io_word=(io_word|encoder.io_next_word>>>delta)>>>0;encoder.io_available_bits=delta;encoder.io_word=io_word}else{io_next_word=encoder.io_next_word;delta=-delta;io_word=io_word|io_next_word<<delta>>>0;io_next_word=usr[encoder.io_now++];available_bits=32-delta;io_word=(io_word|io_next_word>>>available_bits)>>>0;encoder.io_available_bits=available_bits;encoder.io_word=io_word;encoder.io_next_word=io_next_word}l=buckets_ptrs_g[prevCorrelatedG].bestcode;bits=encoder.io_word;if(bits>notGRprefixmask[l]){if(bits>8388607){zeroprefix=lzeroes[bits>>>24]}else if(bits>32767){zeroprefix=lzeroes8[bits>>>16&255]}else if(bits>127){zeroprefix=lzeroes16[bits>>>8&255]}else{zeroprefix=lzeroes24[bits&255]}codewordlen=zeroprefix+1+l;prevCorrelatedG=zeroprefix<<l|bits>>>32-codewordlen&bppmask[l]}else{codewordlen=notGRcwlen[l];prevCorrelatedG=nGRcodewords[l]+(bits>>>32-codewordlen&bppmask[notGRsuffixlen[l]])}correlate_row_g[i]=prevCorrelatedG;pg=xlatL2U[prevCorrelatedG]+(pg+result[i_4++]>>>1)&bpc_mask;available_bits=encoder.io_available_bits;io_word=encoder.io_word;delta=available_bits-codewordlen;io_word=io_word<<codewordlen;if(delta>=0){io_word=(io_word|encoder.io_next_word>>>delta)>>>0;encoder.io_available_bits=delta;encoder.io_word=io_word}else{io_next_word=encoder.io_next_word;delta=-delta;io_word=io_word|io_next_word<<delta>>>0;io_next_word=usr[encoder.io_now++];available_bits=32-delta;io_word=(io_word|io_next_word>>>available_bits)>>>0;encoder.io_available_bits=available_bits;encoder.io_word=io_word;encoder.io_next_word=io_next_word}l=buckets_ptrs_b[prevCorrelatedB].bestcode;bits=encoder.io_word;if(bits>notGRprefixmask[l]){if(bits>8388607){zeroprefix=lzeroes[bits>>>24]}else if(bits>32767){zeroprefix=lzeroes8[bits>>>16&255]}else if(bits>127){zeroprefix=lzeroes16[bits>>>8&255]}else{zeroprefix=lzeroes24[bits&255]}codewordlen=zeroprefix+1+l;prevCorrelatedB=zeroprefix<<l|bits>>>32-codewordlen&bppmask[l]}else{codewordlen=notGRcwlen[l];prevCorrelatedB=nGRcodewords[l]+(bits>>>32-codewordlen&bppmask[notGRsuffixlen[l]])}correlate_row_b[i]=prevCorrelatedB;pb=xlatL2U[prevCorrelatedB]+(pb+result[i_4++]>>>1)&bpc_mask;available_bits=encoder.io_available_bits;io_word=encoder.io_word;delta=available_bits-codewordlen;io_word=io_word<<codewordlen;if(delta>=0){io_word=(io_word|encoder.io_next_word>>>delta)>>>0;encoder.io_available_bits=delta;encoder.io_word=io_word}else{io_next_word=encoder.io_next_word;delta=-delta;io_word=io_word|io_next_word<<delta>>>0;io_next_word=usr[encoder.io_now++];available_bits=32-delta;io_word=(io_word|io_next_word>>>available_bits)>>>0;encoder.io_available_bits=available_bits;encoder.io_word=io_word;encoder.io_next_word=io_next_word}resultData[pxCnt++]=255<<24|pb<<16|pg<<8|pr;i_4++}if(!rle){rgb_state.waitcnt=stopidx-end;encoder.cnt=pxCnt*4;encoder.pxCnt=pxCnt;return}}rgb_state.waitcnt=stopidx-i;run_index=i;run_end=decode_run(encoder);i=run_end+i;while(run_end-- >0){resultData[pxCnt++]=computedAlpha|pb<<16|pg<<8|pr}if(i===end){encoder.cnt=pxCnt*4;encoder.pxCnt=pxCnt;return}i_1=i-1;prevCorrelatedR=correlate_row_r[i_1];prevCorrelatedG=correlate_row_g[i_1];prevCorrelatedB=correlate_row_b[i_1];stopidx=i+rgb_state.waitcnt;rle=false}}function uncompress_row_seg_a(encoder,i,end,bpc,bpc_mask,type,rgb_state){var channel_r=encoder.channels[0];var channel_g=encoder.channels[1];var channel_b=encoder.channels[2];var buckets_ptrs_r=channel_r._buckets_ptrs;var buckets_ptrs_g=channel_g._buckets_ptrs;var buckets_ptrs_b=channel_b._buckets_ptrs;var correlate_row_r=channel_r.correlate_row;var correlate_row_g=channel_g.correlate_row;var correlate_row_b=channel_b.correlate_row;var stopidx=0;var waitmask=wdi.JSQuic.bppmask[rgb_state.wmidx];var run_index=0;var run_end=0;var rle=false;var computedWidth=encoder.computedWidth;var offset=(encoder.rows_completed-1)*computedWidth;var currentOffset=encoder.rows_completed*computedWidth;var offset32=(encoder.rows_completed-1)*computedWidth/4;var currentOffset32=encoder.rows_completed*computedWidth/4;var result=encoder.result;var resultData=encoder.resultData;var i_1,i_4;var xlatL2U=wdi.xlatL2U;var pr,pg,pb;var prevCorrelatedR,prevCorrelatedG,prevCorrelatedB;var eatbits=encoder.eatbits;var tabrand=wdi.JSQuic.tabrand;var decode_run=wdi.JSQuic.decode_run;var ret,codewordlen,l,bits,zeroprefix;var lzeroes=wdi.JSQuic.lzeroes;var lzeroes8=wdi.JSQuic.lzeroes8;var lzeroes16=wdi.JSQuic.lzeroes16;var lzeroes24=wdi.JSQuic.lzeroes24;var cnt=encoder.cnt;var pxCnt=encoder.pxCnt;var bppmask=wdi.JSQuic.bppmask;var notGRprefixmask=wdi.notGRprefixmask;var notGRcwlen=wdi.notGRcwlen;var nGRcodewords=wdi.nGRcodewords;var notGRsuffixlen=wdi.notGRsuffixlen;var prev_row,i4sub,ci;var computedAlpha=255<<24;if(!i){pr=UNCOMPRESS_ONE_0(channel_r,encoder,bpc_mask,offset);pg=UNCOMPRESS_ONE_0(channel_g,encoder,bpc_mask,offset);pb=UNCOMPRESS_ONE_0(channel_b,encoder,bpc_mask,offset);prevCorrelatedR=correlate_row_r[0];prevCorrelatedG=correlate_row_g[0];prevCorrelatedB=correlate_row_b[0];resultData[pxCnt++]=255<<24|pb<<16|pg<<8|pr;if(rgb_state.waitcnt){--rgb_state.waitcnt}else{rgb_state.waitcnt=tabrand.call(wdi.JSQuic,rgb_state)&waitmask;UPDATE_MODEL(0,encoder,bpc,correlate_row_r,correlate_row_g,correlate_row_b)}stopidx=++i+rgb_state.waitcnt}else{stopidx=i+rgb_state.waitcnt;pr=result[cnt-4];pg=result[cnt-3];pb=result[cnt-2];prevCorrelatedR=correlate_row_r[i-1];prevCorrelatedG=correlate_row_g[i-1];prevCorrelatedB=correlate_row_b[i-1]}while(true){while(stopidx<end){i_4=offset+i*4;for(;i<=stopidx;i++){rle=RLE_PRED_RGB_A(i,encoder,i_4,currentOffset,run_index);if(rle)break;l=buckets_ptrs_r[prevCorrelatedR].bestcode;bits=encoder.io_word;if(bits>notGRprefixmask[l]){zeroprefix=cnt_l_zeroes(bits);codewordlen=zeroprefix+1+l;prevCorrelatedR=zeroprefix<<l|bits>>>32-codewordlen&bppmask[l]}else{codewordlen=notGRcwlen[l];prevCorrelatedR=nGRcodewords[l]+(bits>>>32-codewordlen&bppmask[notGRsuffixlen[l]])}correlate_row_r[i]=prevCorrelatedR;pr=xlatL2U[prevCorrelatedR]+(pr+result[i_4++]>>>1)&bpc_mask;eatbits(codewordlen,encoder);l=buckets_ptrs_g[prevCorrelatedG].bestcode;bits=encoder.io_word;if(bits>notGRprefixmask[l]){zeroprefix=cnt_l_zeroes(bits);codewordlen=zeroprefix+1+l;prevCorrelatedG=zeroprefix<<l|bits>>>32-codewordlen&bppmask[l]}else{codewordlen=notGRcwlen[l];prevCorrelatedG=nGRcodewords[l]+(bits>>>32-codewordlen&bppmask[notGRsuffixlen[l]])}correlate_row_g[i]=prevCorrelatedG;pg=xlatL2U[prevCorrelatedG]+(pg+result[i_4++]>>>1)&bpc_mask;eatbits(codewordlen,encoder);l=buckets_ptrs_b[prevCorrelatedB].bestcode;bits=encoder.io_word;if(bits>notGRprefixmask[l]){zeroprefix=cnt_l_zeroes(bits);codewordlen=zeroprefix+1+l;prevCorrelatedB=zeroprefix<<l|bits>>>32-codewordlen&bppmask[l]}else{codewordlen=notGRcwlen[l];prevCorrelatedB=nGRcodewords[l]+(bits>>>32-codewordlen&bppmask[notGRsuffixlen[l]])}correlate_row_b[i]=prevCorrelatedB;pb=xlatL2U[prevCorrelatedB]+(pb+result[i_4++]>>>1)&bpc_mask;eatbits(codewordlen,encoder);resultData[pxCnt++]=computedAlpha|pb<<16|pg<<8|pr;i_4++}if(!rle){UPDATE_MODEL(stopidx,encoder,bpc,correlate_row_r,correlate_row_g,correlate_row_b);stopidx=i+(tabrand.call(wdi.JSQuic,rgb_state)&waitmask)}else{break}}if(!rle){i_4=offset+i*4;for(;i<end;i++){rle=RLE_PRED_RGB_A(i,encoder,i_4,currentOffset,run_index);if(rle)break;l=buckets_ptrs_r[prevCorrelatedR].bestcode;bits=encoder.io_word;if(bits>notGRprefixmask[l]){zeroprefix=cnt_l_zeroes(bits);codewordlen=zeroprefix+1+l;prevCorrelatedR=zeroprefix<<l|bits>>>32-codewordlen&bppmask[l]}else{codewordlen=notGRcwlen[l];prevCorrelatedR=nGRcodewords[l]+(bits>>>32-codewordlen&bppmask[notGRsuffixlen[l]])}correlate_row_r[i]=prevCorrelatedR;pr=xlatL2U[prevCorrelatedR]+(pr+result[i_4++]>>>1)&bpc_mask;eatbits(codewordlen,encoder);l=buckets_ptrs_g[prevCorrelatedG].bestcode;bits=encoder.io_word;if(bits>notGRprefixmask[l]){zeroprefix=cnt_l_zeroes(bits);codewordlen=zeroprefix+1+l;prevCorrelatedG=zeroprefix<<l|bits>>>32-codewordlen&bppmask[l]}else{codewordlen=notGRcwlen[l];prevCorrelatedG=nGRcodewords[l]+(bits>>>32-codewordlen&bppmask[notGRsuffixlen[l]])}correlate_row_g[i]=prevCorrelatedG;pg=xlatL2U[prevCorrelatedG]+(pg+result[i_4++]>>>1)&bpc_mask;eatbits(codewordlen,encoder);l=buckets_ptrs_b[prevCorrelatedB].bestcode;bits=encoder.io_word;if(bits>notGRprefixmask[l]){zeroprefix=cnt_l_zeroes(bits);codewordlen=zeroprefix+1+l;prevCorrelatedB=zeroprefix<<l|bits>>>32-codewordlen&bppmask[l]}else{codewordlen=notGRcwlen[l];prevCorrelatedB=nGRcodewords[l]+(bits>>>32-codewordlen&bppmask[notGRsuffixlen[l]])}correlate_row_b[i]=prevCorrelatedB;pb=xlatL2U[prevCorrelatedB]+(pb+result[i_4++]>>>1)&bpc_mask;eatbits(codewordlen,encoder);resultData[pxCnt++]=255<<24|pb<<16|pg<<8|pr;i_4++}if(!rle){rgb_state.waitcnt=stopidx-end;encoder.cnt=pxCnt*4;encoder.pxCnt=pxCnt;return}}rgb_state.waitcnt=stopidx-i;run_index=i;run_end=decode_run(encoder);i=run_end+i;while(run_end-- >0){resultData[pxCnt++]=computedAlpha|pb<<16|pg<<8|pr}if(i===end){encoder.cnt=pxCnt*4;encoder.pxCnt=pxCnt;return}i_1=i-1;prevCorrelatedR=correlate_row_r[i_1];prevCorrelatedG=correlate_row_g[i_1];prevCorrelatedB=correlate_row_b[i_1];stopidx=i+rgb_state.waitcnt;rle=false}}function quic_uncompress_row0(encoder,channels,bpc,type){var bpc_mask=wdi.JSQuic.BPC_MASK[type];var pos=0;var width=encoder.width;while(wdi.JSQuic.wmimax>encoder.rgb_state.wmidx&&encoder.rgb_state.wmileft<=width){if(encoder.rgb_state.wmileft){uncompress_row0_seg(encoder,pos,pos+encoder.rgb_state.wmileft,wdi.JSQuic.bppmask[encoder.rgb_state.wmidx],bpc,bpc_mask,type);pos+=encoder.rgb_state.wmileft;width-=encoder.rgb_state.wmileft}encoder.rgb_state.wmidx++;wdi.JSQuic.set_wm_trigger(encoder.rgb_state);encoder.rgb_state.wmileft=wdi.JSQuic.wminext}if(width){uncompress_row0_seg(encoder,pos,pos+width,wdi.JSQuic.bppmask[encoder.rgb_state.wmidx],bpc,bpc_mask,type);if(wdi.JSQuic.wmimax>encoder.rgb_state.wmidx){encoder.rgb_state.wmileft-=width}}}function uncompress_row0_seg(encoder,i,end,waitmask,bpc,bpc_mask,type){var channel_r=encoder.channels[0];var channel_g=encoder.channels[1];var channel_b=encoder.channels[2];var correlate_row_r=channel_r.correlate_row;var correlate_row_g=channel_g.correlate_row;var correlate_row_b=channel_b.correlate_row;var stopidx=0;var pr,pg,pb;if(!i){pr=UNCOMPRESS_ONE_ROW0_0(channel_r);pg=UNCOMPRESS_ONE_ROW0_0(channel_g);pb=UNCOMPRESS_ONE_ROW0_0(channel_b);encoder.appendPixel(pr,pg,pb);if(encoder.rgb_state.waitcnt){--encoder.rgb_state.waitcnt}else{encoder.rgb_state.waitcnt=wdi.JSQuic.tabrand(encoder.rgb_state)&waitmask;UPDATE_MODEL(0,encoder,bpc,correlate_row_r,correlate_row_g,correlate_row_b)}stopidx=++i+encoder.rgb_state.waitcnt}else{stopidx=i+encoder.rgb_state.waitcnt}while(stopidx<end){for(;i<=stopidx;i++){pr=UNCOMPRESS_ONE_ROW0(channel_r,i,bpc_mask,encoder,correlate_row_r,pr);pg=UNCOMPRESS_ONE_ROW0(channel_g,i,bpc_mask,encoder,correlate_row_g,pg);pb=UNCOMPRESS_ONE_ROW0(channel_b,i,bpc_mask,encoder,correlate_row_b,pb);encoder.appendPixel(pr,pg,pb)}UPDATE_MODEL(stopidx,encoder,bpc,correlate_row_r,correlate_row_g,correlate_row_b);stopidx=i+(wdi.JSQuic.tabrand(encoder.rgb_state)&waitmask)}for(;i<end;i++){pr=UNCOMPRESS_ONE_ROW0(channel_r,i,bpc_mask,encoder,correlate_row_r,pr);pg=UNCOMPRESS_ONE_ROW0(channel_g,i,bpc_mask,encoder,correlate_row_g,pg);pb=UNCOMPRESS_ONE_ROW0(channel_b,i,bpc_mask,encoder,correlate_row_b,pb);encoder.appendPixel(pr,pg,pb)}encoder.rgb_state.waitcnt=stopidx-end}function UNCOMPRESS_ONE_0(channel,encoder,bpc_mask,offset){var ret,codewordlen;channel.oldFirst=channel.correlate_row[0];ret=golomb_decoding(find_bucket(channel,channel.correlate_row[0]).bestcode,encoder.io_word,wdi.JSQuic.bppmask,wdi.notGRprefixmask,wdi.notGRcwlen,wdi.nGRcodewords,wdi.notGRsuffixlen);
channel.correlate_row[0]=ret[0];codewordlen=ret[1];var residuum=wdi.xlatL2U[channel.correlate_row[0]];var prev=encoder.result[offset+channel.num_channel];var resultpixel=residuum+prev&bpc_mask;encoder.eatbits(codewordlen,encoder);return resultpixel}function UNCOMPRESS_ONE(channel,i,i_1,i_4,bpc_mask,encoder,correlate_row,offset,result,num_channel,xlatL2U,buckets_ptrs,prev_pixel){var ret,codewordlen;ret=golomb_decoding(buckets_ptrs[correlate_row[i_1]].bestcode,encoder.io_word,wdi.JSQuic.bppmask,wdi.notGRprefixmask,wdi.notGRcwlen,wdi.nGRcodewords,wdi.notGRsuffixlen);var data=ret[0];codewordlen=ret[1];correlate_row[i]=data;var ret=xlatL2U[data]+(prev_pixel+result[offset+i_4+num_channel]>>>1)&bpc_mask;encoder.eatbits(codewordlen,encoder);return ret}function UNCOMPRESS_ONE_ROW0_0(channel){var ret,codewordlen;var encoder=channel.encoder;ret=golomb_decoding(find_bucket(channel,0).bestcode,encoder.io_word,wdi.JSQuic.bppmask,wdi.notGRprefixmask,wdi.notGRcwlen,wdi.nGRcodewords,wdi.notGRsuffixlen);channel.correlate_row[0]=ret[0];codewordlen=ret[1];var ret=wdi.xlatL2U[channel.correlate_row[0]];encoder.eatbits(codewordlen,encoder);return ret}function UNCOMPRESS_ONE_ROW0(channel,i,bpc_mask,encoder,correlate_row,prev_pixel){var ret,codewordlen;ret=golomb_decoding(find_bucket(channel,correlate_row[i-1]).bestcode,encoder.io_word,wdi.JSQuic.bppmask,wdi.notGRprefixmask,wdi.notGRcwlen,wdi.nGRcodewords,wdi.notGRsuffixlen);correlate_row[i]=ret[0];codewordlen=ret[1];var ret=CORELATE_0(encoder,channel,i,bpc_mask,correlate_row,prev_pixel);encoder.eatbits(codewordlen,encoder);return ret}function CORELATE_0(encoder,channel,curr,bpc_mask,correlate_row,prev_pixel){return wdi.xlatL2U[correlate_row[curr]]+prev_pixel&bpc_mask}function PIXEL_A(encoder){return encoder.result[encoder.cnt-4]}function PIXEL_B(channel,encoder,pos,offset){return encoder.result[offset+pos*4+channel.num_channel]}var lzDecompress={LZ_IMAGE_TYPE_INVALID:0,LZ_IMAGE_TYPE_PLT1_LE:1,LZ_IMAGE_TYPE_PLT1_BE:2,LZ_IMAGE_TYPE_PLT4_LE:3,LZ_IMAGE_TYPE_PLT4_BE:4,LZ_IMAGE_TYPE_PLT8:5,LZ_IMAGE_TYPE_RGB16:6,LZ_IMAGE_TYPE_RGB24:7,LZ_IMAGE_TYPE_RGB32:8,LZ_IMAGE_TYPE_RGBA:9,LZ_IMAGE_TYPE_XXXA:10,LZPALETTE_FLAG_PAL_CACHE_ME:1,LZPALETTE_FLAG_PAL_FROM_CACHE:2,LZPALETTE_FLAG_TOP_DOWN:4,PLT_PIXELS_PER_BYTE:[0,8,8,2,2,1],PLT1_MASK:[1,2,4,8,16,32,64,128],lz_rgb32_decompress_rgb_opaque_reverse:function(arr){var in_buf=new Uint8Array(arr);var type=in_buf[2];var low=in_buf[5]*256+in_buf[4];var high=in_buf[7]*256+in_buf[6];var len=high*65536+low;var buf=new ArrayBuffer(len);var data=new Uint32Array(buf);var view=new DataView(arr);var width=view.getUint32(8);var height=view.getUint32(12);var out_buf_len=len/4-1;var op=out_buf_len;var code,ref,ofs,b;var aux;var ctrl=in_buf[16];var encoder=16;while(op>=0){ctrl=in_buf[encoder++];if(ctrl!=0&&(len=ctrl>>5)!=0){ref=op;ofs=(ctrl&31)<<8;if(len==7){do{code=in_buf[encoder++];len+=code}while(code==255)}ofs+=in_buf[encoder++];if(ofs==0){aux=data[ref+1];while(len>9){data[op]=aux;data[op-1]=aux;data[op-2]=aux;data[op-3]=aux;data[op-4]=aux;data[op-5]=aux;data[op-6]=aux;data[op-7]=aux;data[op-8]=aux;data[op-9]=aux;op-=10;len-=10}while(len--!=0){data[op--]=aux}}else{if(ofs==8191){ofs+=(in_buf[encoder]<<8)+in_buf[encoder+1];encoder+=2}ref+=ofs+1;while(len>9){data[op]=data[ref];data[op-1]=data[ref-1];data[op-2]=data[ref-2];data[op-3]=data[ref-3];data[op-4]=data[ref-4];data[op-5]=data[ref-5];data[op-6]=data[ref-6];data[op-7]=data[ref-7];data[op-8]=data[ref-8];data[op-9]=data[ref-9];op-=10;len-=10;ref-=10}while(len--!==0){data[op--]=data[ref--]}}}else{while(ctrl>9){data[op]=4278190080|in_buf[encoder]<<16|in_buf[encoder+1]<<8|in_buf[encoder+2];data[op-1]=4278190080|in_buf[encoder+3]<<16|in_buf[encoder+4]<<8|in_buf[encoder+5];data[op-2]=4278190080|in_buf[encoder+6]<<16|in_buf[encoder+7]<<8|in_buf[encoder+8];data[op-3]=4278190080|in_buf[encoder+9]<<16|in_buf[encoder+10]<<8|in_buf[encoder+11];data[op-4]=4278190080|in_buf[encoder+12]<<16|in_buf[encoder+13]<<8|in_buf[encoder+14];data[op-5]=4278190080|in_buf[encoder+15]<<16|in_buf[encoder+16]<<8|in_buf[encoder+17];data[op-6]=4278190080|in_buf[encoder+18]<<16|in_buf[encoder+19]<<8|in_buf[encoder+20];data[op-7]=4278190080|in_buf[encoder+21]<<16|in_buf[encoder+22]<<8|in_buf[encoder+23];data[op-8]=4278190080|in_buf[encoder+24]<<16|in_buf[encoder+25]<<8|in_buf[encoder+26];data[op-9]=4278190080|in_buf[encoder+27]<<16|in_buf[encoder+28]<<8|in_buf[encoder+29];encoder+=30;op-=10;ctrl-=10}if(ctrl!=0){if(ctrl==9){data[op]=4278190080|in_buf[encoder]<<16|in_buf[encoder+1]<<8|in_buf[encoder+2];data[op-1]=4278190080|in_buf[encoder+3]<<16|in_buf[encoder+4]<<8|in_buf[encoder+5];data[op-2]=4278190080|in_buf[encoder+6]<<16|in_buf[encoder+7]<<8|in_buf[encoder+8];data[op-3]=4278190080|in_buf[encoder+9]<<16|in_buf[encoder+10]<<8|in_buf[encoder+11];data[op-4]=4278190080|in_buf[encoder+12]<<16|in_buf[encoder+13]<<8|in_buf[encoder+14];data[op-5]=4278190080|in_buf[encoder+15]<<16|in_buf[encoder+16]<<8|in_buf[encoder+17];data[op-6]=4278190080|in_buf[encoder+18]<<16|in_buf[encoder+19]<<8|in_buf[encoder+20];data[op-7]=4278190080|in_buf[encoder+21]<<16|in_buf[encoder+22]<<8|in_buf[encoder+23];data[op-8]=4278190080|in_buf[encoder+24]<<16|in_buf[encoder+25]<<8|in_buf[encoder+26];encoder+=27;op-=9}else if(ctrl==8){data[op]=4278190080|in_buf[encoder]<<16|in_buf[encoder+1]<<8|in_buf[encoder+2];data[op-1]=4278190080|in_buf[encoder+3]<<16|in_buf[encoder+4]<<8|in_buf[encoder+5];data[op-2]=4278190080|in_buf[encoder+6]<<16|in_buf[encoder+7]<<8|in_buf[encoder+8];data[op-3]=4278190080|in_buf[encoder+9]<<16|in_buf[encoder+10]<<8|in_buf[encoder+11];data[op-4]=4278190080|in_buf[encoder+12]<<16|in_buf[encoder+13]<<8|in_buf[encoder+14];data[op-5]=4278190080|in_buf[encoder+15]<<16|in_buf[encoder+16]<<8|in_buf[encoder+17];data[op-6]=4278190080|in_buf[encoder+18]<<16|in_buf[encoder+19]<<8|in_buf[encoder+20];data[op-7]=4278190080|in_buf[encoder+21]<<16|in_buf[encoder+22]<<8|in_buf[encoder+23];encoder+=24;op-=8}else if(ctrl==7){data[op]=4278190080|in_buf[encoder]<<16|in_buf[encoder+1]<<8|in_buf[encoder+2];data[op-1]=4278190080|in_buf[encoder+3]<<16|in_buf[encoder+4]<<8|in_buf[encoder+5];data[op-2]=4278190080|in_buf[encoder+6]<<16|in_buf[encoder+7]<<8|in_buf[encoder+8];data[op-3]=4278190080|in_buf[encoder+9]<<16|in_buf[encoder+10]<<8|in_buf[encoder+11];data[op-4]=4278190080|in_buf[encoder+12]<<16|in_buf[encoder+13]<<8|in_buf[encoder+14];data[op-5]=4278190080|in_buf[encoder+15]<<16|in_buf[encoder+16]<<8|in_buf[encoder+17];data[op-6]=4278190080|in_buf[encoder+18]<<16|in_buf[encoder+19]<<8|in_buf[encoder+20];encoder+=21;op-=7}else if(ctrl==6){data[op]=4278190080|in_buf[encoder]<<16|in_buf[encoder+1]<<8|in_buf[encoder+2];data[op-1]=4278190080|in_buf[encoder+3]<<16|in_buf[encoder+4]<<8|in_buf[encoder+5];data[op-2]=4278190080|in_buf[encoder+6]<<16|in_buf[encoder+7]<<8|in_buf[encoder+8];data[op-3]=4278190080|in_buf[encoder+9]<<16|in_buf[encoder+10]<<8|in_buf[encoder+11];data[op-4]=4278190080|in_buf[encoder+12]<<16|in_buf[encoder+13]<<8|in_buf[encoder+14];data[op-5]=4278190080|in_buf[encoder+15]<<16|in_buf[encoder+16]<<8|in_buf[encoder+17];encoder+=18;op-=6}else if(ctrl==5){data[op]=4278190080|in_buf[encoder]<<16|in_buf[encoder+1]<<8|in_buf[encoder+2];data[op-1]=4278190080|in_buf[encoder+3]<<16|in_buf[encoder+4]<<8|in_buf[encoder+5];data[op-2]=4278190080|in_buf[encoder+6]<<16|in_buf[encoder+7]<<8|in_buf[encoder+8];data[op-3]=4278190080|in_buf[encoder+9]<<16|in_buf[encoder+10]<<8|in_buf[encoder+11];data[op-4]=4278190080|in_buf[encoder+12]<<16|in_buf[encoder+13]<<8|in_buf[encoder+14];encoder+=15;op-=5}else if(ctrl==4){data[op]=4278190080|in_buf[encoder]<<16|in_buf[encoder+1]<<8|in_buf[encoder+2];data[op-1]=4278190080|in_buf[encoder+3]<<16|in_buf[encoder+4]<<8|in_buf[encoder+5];data[op-2]=4278190080|in_buf[encoder+6]<<16|in_buf[encoder+7]<<8|in_buf[encoder+8];data[op-3]=4278190080|in_buf[encoder+9]<<16|in_buf[encoder+10]<<8|in_buf[encoder+11];encoder+=12;op-=4}else if(ctrl==3){data[op]=4278190080|in_buf[encoder]<<16|in_buf[encoder+1]<<8|in_buf[encoder+2];data[op-1]=4278190080|in_buf[encoder+3]<<16|in_buf[encoder+4]<<8|in_buf[encoder+5];data[op-2]=4278190080|in_buf[encoder+6]<<16|in_buf[encoder+7]<<8|in_buf[encoder+8];encoder+=9;op-=3}else if(ctrl==2){data[op]=4278190080|in_buf[encoder]<<16|in_buf[encoder+1]<<8|in_buf[encoder+2];data[op-1]=4278190080|in_buf[encoder+3]<<16|in_buf[encoder+4]<<8|in_buf[encoder+5];encoder+=6;op-=2}else if(ctrl==1){data[op--]=4278190080|in_buf[encoder]<<16|in_buf[encoder+1]<<8|in_buf[encoder+2];encoder+=3}}data[op--]=4278190080|in_buf[encoder]<<16|in_buf[encoder+1]<<8|in_buf[encoder+2];encoder+=3}}var left,right,line,temporary;var length=width-1;while(height--){line=new Uint32Array(buf,height*width*4,width);left=0;right=length;while(left<right){var temporary=line[left];line[left++]=line[right];line[right--]=temporary}}return buf},lz_rgb32_decompress_rgb:function(arr){var op=0;var in_buf=new Uint8Array(arr);var opaque=in_buf[1];var type=in_buf[2];var top_down=in_buf[3];if(opaque&&!top_down){return lzDecompress.lz_rgb32_decompress_rgb_opaque_reverse(arr)}var low=in_buf[5]*256+in_buf[4];var high=in_buf[7]*256+in_buf[6];var len=high*65536+low;var buf=new ArrayBuffer(len);var data=new Uint32Array(buf);var out_buf_len=len/4;var code,ref,ofs,b;var op_4,aux;var ctrl=in_buf[16];var offsetView;var encoder=16;while(op!=out_buf_len){ctrl=in_buf[encoder++];if(ctrl!=0&&(len=ctrl>>5)!=0){ref=op;ofs=(ctrl&31)<<8;if(len==7){do{code=in_buf[encoder++];len+=code}while(code==255)}ofs+=in_buf[encoder++];if(ofs==0){aux=data[--ref];while(len>9){data[op]=aux;data[op+1]=aux;data[op+2]=aux;data[op+3]=aux;data[op+4]=aux;data[op+5]=aux;data[op+6]=aux;data[op+7]=aux;data[op+8]=aux;data[op+9]=aux;op+=10;len-=10}while(len--!=0){data[op++]=aux}}else{if(ofs==8191){ofs+=(in_buf[encoder]<<8)+in_buf[encoder+1];encoder+=2}ref-=ofs+1;if(len>100&&ref+len<op){offsetView=new Uint32Array(buf,ref*4,len);data.set(offsetView,op);op+=len;ref+=len}else{while(len>9){data[op]=data[ref];data[op+1]=data[ref+1];data[op+2]=data[ref+2];data[op+3]=data[ref+3];data[op+4]=data[ref+4];data[op+5]=data[ref+5];data[op+6]=data[ref+6];data[op+7]=data[ref+7];data[op+8]=data[ref+8];data[op+9]=data[ref+9];op+=10;len-=10;ref+=10}while(len--!==0){data[op++]=data[ref++]}}}}else{while(ctrl>9){data[op]=4278190080|in_buf[encoder]<<16|in_buf[encoder+1]<<8|in_buf[encoder+2];data[op+1]=4278190080|in_buf[encoder+3]<<16|in_buf[encoder+4]<<8|in_buf[encoder+5];data[op+2]=4278190080|in_buf[encoder+6]<<16|in_buf[encoder+7]<<8|in_buf[encoder+8];data[op+3]=4278190080|in_buf[encoder+9]<<16|in_buf[encoder+10]<<8|in_buf[encoder+11];data[op+4]=4278190080|in_buf[encoder+12]<<16|in_buf[encoder+13]<<8|in_buf[encoder+14];data[op+5]=4278190080|in_buf[encoder+15]<<16|in_buf[encoder+16]<<8|in_buf[encoder+17];data[op+6]=4278190080|in_buf[encoder+18]<<16|in_buf[encoder+19]<<8|in_buf[encoder+20];data[op+7]=4278190080|in_buf[encoder+21]<<16|in_buf[encoder+22]<<8|in_buf[encoder+23];data[op+8]=4278190080|in_buf[encoder+24]<<16|in_buf[encoder+25]<<8|in_buf[encoder+26];data[op+9]=4278190080|in_buf[encoder+27]<<16|in_buf[encoder+28]<<8|in_buf[encoder+29];encoder+=30;op+=10;ctrl-=10}if(ctrl!=0){if(ctrl==9){data[op]=4278190080|in_buf[encoder]<<16|in_buf[encoder+1]<<8|in_buf[encoder+2];data[op+1]=4278190080|in_buf[encoder+3]<<16|in_buf[encoder+4]<<8|in_buf[encoder+5];data[op+2]=4278190080|in_buf[encoder+6]<<16|in_buf[encoder+7]<<8|in_buf[encoder+8];data[op+3]=4278190080|in_buf[encoder+9]<<16|in_buf[encoder+10]<<8|in_buf[encoder+11];data[op+4]=4278190080|in_buf[encoder+12]<<16|in_buf[encoder+13]<<8|in_buf[encoder+14];data[op+5]=4278190080|in_buf[encoder+15]<<16|in_buf[encoder+16]<<8|in_buf[encoder+17];data[op+6]=4278190080|in_buf[encoder+18]<<16|in_buf[encoder+19]<<8|in_buf[encoder+20];data[op+7]=4278190080|in_buf[encoder+21]<<16|in_buf[encoder+22]<<8|in_buf[encoder+23];data[op+8]=4278190080|in_buf[encoder+24]<<16|in_buf[encoder+25]<<8|in_buf[encoder+26];encoder+=27;op+=9}else if(ctrl==8){data[op]=4278190080|in_buf[encoder]<<16|in_buf[encoder+1]<<8|in_buf[encoder+2];data[op+1]=4278190080|in_buf[encoder+3]<<16|in_buf[encoder+4]<<8|in_buf[encoder+5];data[op+2]=4278190080|in_buf[encoder+6]<<16|in_buf[encoder+7]<<8|in_buf[encoder+8];data[op+3]=4278190080|in_buf[encoder+9]<<16|in_buf[encoder+10]<<8|in_buf[encoder+11];data[op+4]=4278190080|in_buf[encoder+12]<<16|in_buf[encoder+13]<<8|in_buf[encoder+14];data[op+5]=4278190080|in_buf[encoder+15]<<16|in_buf[encoder+16]<<8|in_buf[encoder+17];data[op+6]=4278190080|in_buf[encoder+18]<<16|in_buf[encoder+19]<<8|in_buf[encoder+20];data[op+7]=4278190080|in_buf[encoder+21]<<16|in_buf[encoder+22]<<8|in_buf[encoder+23];encoder+=24;op+=8}else if(ctrl==7){data[op]=4278190080|in_buf[encoder]<<16|in_buf[encoder+1]<<8|in_buf[encoder+2];data[op+1]=4278190080|in_buf[encoder+3]<<16|in_buf[encoder+4]<<8|in_buf[encoder+5];data[op+2]=4278190080|in_buf[encoder+6]<<16|in_buf[encoder+7]<<8|in_buf[encoder+8];data[op+3]=4278190080|in_buf[encoder+9]<<16|in_buf[encoder+10]<<8|in_buf[encoder+11];data[op+4]=4278190080|in_buf[encoder+12]<<16|in_buf[encoder+13]<<8|in_buf[encoder+14];data[op+5]=4278190080|in_buf[encoder+15]<<16|in_buf[encoder+16]<<8|in_buf[encoder+17];data[op+6]=4278190080|in_buf[encoder+18]<<16|in_buf[encoder+19]<<8|in_buf[encoder+20];encoder+=21;op+=7}else if(ctrl==6){data[op]=4278190080|in_buf[encoder]<<16|in_buf[encoder+1]<<8|in_buf[encoder+2];data[op+1]=4278190080|in_buf[encoder+3]<<16|in_buf[encoder+4]<<8|in_buf[encoder+5];data[op+2]=4278190080|in_buf[encoder+6]<<16|in_buf[encoder+7]<<8|in_buf[encoder+8];data[op+3]=4278190080|in_buf[encoder+9]<<16|in_buf[encoder+10]<<8|in_buf[encoder+11];data[op+4]=4278190080|in_buf[encoder+12]<<16|in_buf[encoder+13]<<8|in_buf[encoder+14];data[op+5]=4278190080|in_buf[encoder+15]<<16|in_buf[encoder+16]<<8|in_buf[encoder+17];encoder+=18;op+=6}else if(ctrl==5){data[op]=4278190080|in_buf[encoder]<<16|in_buf[encoder+1]<<8|in_buf[encoder+2];data[op+1]=4278190080|in_buf[encoder+3]<<16|in_buf[encoder+4]<<8|in_buf[encoder+5];data[op+2]=4278190080|in_buf[encoder+6]<<16|in_buf[encoder+7]<<8|in_buf[encoder+8];data[op+3]=4278190080|in_buf[encoder+9]<<16|in_buf[encoder+10]<<8|in_buf[encoder+11];data[op+4]=4278190080|in_buf[encoder+12]<<16|in_buf[encoder+13]<<8|in_buf[encoder+14];encoder+=15;op+=5}else if(ctrl==4){data[op]=4278190080|in_buf[encoder]<<16|in_buf[encoder+1]<<8|in_buf[encoder+2];data[op+1]=4278190080|in_buf[encoder+3]<<16|in_buf[encoder+4]<<8|in_buf[encoder+5];data[op+2]=4278190080|in_buf[encoder+6]<<16|in_buf[encoder+7]<<8|in_buf[encoder+8];data[op+3]=4278190080|in_buf[encoder+9]<<16|in_buf[encoder+10]<<8|in_buf[encoder+11];encoder+=12;op+=4}else if(ctrl==3){data[op]=4278190080|in_buf[encoder]<<16|in_buf[encoder+1]<<8|in_buf[encoder+2];data[op+1]=4278190080|in_buf[encoder+3]<<16|in_buf[encoder+4]<<8|in_buf[encoder+5];data[op+2]=4278190080|in_buf[encoder+6]<<16|in_buf[encoder+7]<<8|in_buf[encoder+8];encoder+=9;op+=3}else if(ctrl==2){data[op]=4278190080|in_buf[encoder]<<16|in_buf[encoder+1]<<8|in_buf[encoder+2];data[op+1]=4278190080|in_buf[encoder+3]<<16|in_buf[encoder+4]<<8|in_buf[encoder+5];encoder+=6;op+=2}else if(ctrl==1){data[op++]=4278190080|in_buf[encoder]<<16|in_buf[encoder+1]<<8|in_buf[encoder+2];encoder+=3}}data[op++]=4278190080|in_buf[encoder]<<16|in_buf[encoder+1]<<8|in_buf[encoder+2];encoder+=3}}if(type===this.LZ_IMAGE_TYPE_RGBA&&!opaque){var buf8=new Uint8Array(buf);op=0;ctrl=null;for(ctrl=in_buf[encoder++];op<out_buf_len;ctrl=in_buf[encoder++]){ref=op;len=ctrl>>5;ofs=(ctrl&31)<<8;op_4=op*4;if(ctrl>=32){code;len--;if(len===7-1){do{code=in_buf[encoder++];len+=code}while(code===255)}code=in_buf[encoder++];ofs+=code;if(code===255){if(ofs-code===31<<8){ofs=in_buf[encoder++]<<8;ofs+=in_buf[encoder++];ofs+=8191}}len+=3;ofs+=1;ref-=ofs;if(ref===op-1){b=ref;for(;len;--len){op_4=op*4;buf8[op_4+3]=buf8[b*4+3];op++}}else{for(;len;--len){op_4=op*4;buf8[op_4+3]=buf8[ref*4+3];op++;ref++}}}else{ctrl++;buf8[op_4+3]=in_buf[encoder++];op++;for(--ctrl;ctrl;ctrl--){op_4=op*4;buf8[op_4+3]=in_buf[encoder++];op++}}}}return buf}};if(wdi.LZSS){wdi.LZSS.lz_rgb32_decompress_rgb=lzDecompress.lz_rgb32_decompress_rgb}else{wdi.LZSS=lzDecompress}function getURLParameter(name){return decodeURIComponent((new RegExp("[?|&]"+name+"="+"([^&;]+?)(&|#|;|$)").exec(location.search)||[,""])[1].replace(/\+/g,"%20"))||null}wdi.Debug.debug=false;wdi.exceptionHandling=false;wdi.IntegrationBenchmarkEnabled=false;function start(){var testSessionStarted=false;$("#getStats").click(function(){if(!testSessionStarted){testSessionStarted=true;alert("Starting test session");wdi.DataLogger.startTestSession()}else{wdi.DataLogger.stopTestSession();testSessionStarted=false;var stats=wdi.DataLogger.getStats();console.log(stats);alert(stats)}});wdi.graphicDebug=new wdi.GraphicDebug({debugMode:false});app=new Application;window.vdiLoadTest=getURLParameter("vdiLoadTest")||false;var performanceTest=getURLParameter("performanceTest")||false;var f=function(action,params){if(action=="windowClosed"){$(params.canvas).remove();$(params.eventLayer).remove()}else if(action=="windowMoved"){$(params.canvas).css({top:params.info.top+"px",left:params.info.left+"px"});$(params.eventLayer).css({top:params.info.top+"px",left:params.info.left+"px"})}else if(action=="init"||action=="windowCreated"){var item=null;var canvas=null;var eventlayer=null;var body=$("body");for(var i in params){item=params[i];var position=item.position*2;canvas=$(item.canvas).css({zIndex:1e4-position-1,position:"absolute",top:item.info.top+"px",left:item.info.left+"px"});eventlayer=$(item.eventLayer).css({top:item.info.top+"px",left:item.info.left+"px",zIndex:1e4-position});body.append(canvas);body.append(eventlayer)}}else if(action=="ready"){var width=$(window).width();var height=$(window).height();if(performanceTest){width=800;height=600;window.setTimeout(function(){if(!testSessionStarted){testSessionStarted=true;window.performanceTest.runner.startPerformanceTest()}},3e3)}app.sendCommand("setResolution",{width:width,height:height});if(wdi.IntegrationBenchmarkEnabled){$("#integrationBenchmark").css({display:"inline"});$("#launchWordButton").prop("disabled",false)}}else if(action=="resolution"){}else if(action=="windowMinimized"){$(params.canvas).css({display:"none"});$(params.eventLayer).css({display:"none"})}else if(action=="windowMaximized"){$(params.canvas).css({top:params.info.top+"px",left:params.info.left+"px"});$(params.eventLayer).css({top:params.info.top+"px",left:params.info.left+"px"})}else if(action=="windowRestored"){$(params.canvas).css({display:"block"});$(params.eventLayer).css({display:"block"});$(params.canvas).css({top:params.info.top+"px",left:params.info.left+"px"});$(params.eventLayer).css({top:params.info.top+"px",left:params.info.left+"px"})}else if(action=="windowFocused"){}else if(action=="timeLapseDetected"){wdi.Debug.log("Detected time lapse of ",params,"seconds")}else if(action=="error"){}else if("checkResults"){var cnv=$("#canvas_0")[0];var ctx=cnv.getContext("2d");var currentImgData=ctx.getImageData(0,0,cnv.width,cnv.height);var currArr=new Uint32Array(currentImgData.data.buffer);var firstArr=new Uint32Array(firstImageData);var errors=0;var l=firstArr.length;do{if(firstArr[l]!==currArr[l]){errors++;console.log("FAIL!!!!!!!!!!!!!",l,~~(l/1920),l%1920,parseInt(firstArr[l]).toString(2),parseInt(currArr[l]).toString(2));currArr[l]=255<<24|255}}while(l--);ctx.putImageData(currentImgData,0,0);var msg="Test finished: "+errors+" error found";if(errors){console.error(msg)}else{console.log(msg)}}};$(window)["resize"](function(){app.sendCommand("setResolution",{width:$(window).width(),height:$(window).height()})});var useWorkers=true;if(performanceTest){useWorkers=false;jQuery.getScript("performanceTests/lib/iopacketfactory.js");jQuery.getScript("performanceTests/lib/testlauncher.js");jQuery.getScript("performanceTests/tests/wordscroll.js")}app.run({callback:f,context:this,host:getURLParameter("host")||"10.11.12.100",port:getURLParameter("port")||8e3,protocol:getURLParameter("protocol")||"ws",token:"1q2w3e4r",vmHost:getURLParameter("vmhost")||false,vmPort:getURLParameter("vmport")||false,useBus:false,busHost:"10.11.12.200",busPort:61613,busSubscriptions:["/topic/00000000-0000-0000-0000-000000000000"],busUser:"00000000-0000-0000-0000-000000000000",busPass:"potato",connectionControl:false,heartbeatToken:"heartbeat",heartbeatTimeout:4e3,busFileServerBaseUrl:"https://10.11.12.200/fileserver/",layout:"es",clientOffset:{x:0,y:0},useWorkers:useWorkers,seamlessDesktopIntegration:false,externalClipboardHandling:false,disableClipboard:true,layer:document.getElementById("testVdi"),vmInfoToken:getURLParameter("vmInfoToken")})}function startBenchmark(){$("#launchWordButton").text("Benchmarking...").prop("disabled",true);wdi.IntegrationBenchmark.launchApp(app.busConnection,function(elapsed){$("#launchWordButton").remove();$("#integrationBenchmark").append('<div class="result">Total: '+elapsed+" ms</div>")})}function closeIntegrationBenchmark(){$("#integrationBenchmark").hide()}$(document).ready(start);
